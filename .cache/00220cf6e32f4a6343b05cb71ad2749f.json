{"d": [{"url": "https://api.github.com/repos/vercel/next.js/issues/49169", "repository_url": "https://api.github.com/repos/vercel/next.js", "labels_url": "https://api.github.com/repos/vercel/next.js/issues/49169/labels{/name}", "comments_url": "https://api.github.com/repos/vercel/next.js/issues/49169/comments", "events_url": "https://api.github.com/repos/vercel/next.js/issues/49169/events", "html_url": "https://github.com/vercel/next.js/issues/49169", "id": 1694663392, "node_id": "I_kwDOBC3Cis5lAoLg", "number": 49169, "title": "Error [ERR_PACKAGE_PATH_NOT_EXPORTED]: Package subpath './server.edge' is not defined by \"exports\"", "user": {"login": "dincerpece", "id": 57527680, "node_id": "MDQ6VXNlcjU3NTI3Njgw", "avatar_url": "https://avatars.githubusercontent.com/u/57527680?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dincerpece", "html_url": "https://github.com/dincerpece", "followers_url": "https://api.github.com/users/dincerpece/followers", "following_url": "https://api.github.com/users/dincerpece/following{/other_user}", "gists_url": "https://api.github.com/users/dincerpece/gists{/gist_id}", "starred_url": "https://api.github.com/users/dincerpece/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dincerpece/subscriptions", "organizations_url": "https://api.github.com/users/dincerpece/orgs", "repos_url": "https://api.github.com/users/dincerpece/repos", "events_url": "https://api.github.com/users/dincerpece/events{/privacy}", "received_events_url": "https://api.github.com/users/dincerpece/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 2471906168, "node_id": "MDU6TGFiZWwyNDcxOTA2MTY4", "url": "https://api.github.com/repos/vercel/next.js/labels/bug", "name": "bug", "color": "fddf99", "default": true, "description": "Issue was opened via the bug report template."}, {"id": 4932840687, "node_id": "LA_kwDOBC3Cis8AAAABJgUs7w", "url": "https://api.github.com/repos/vercel/next.js/labels/linear:%20next", "name": "linear: next", "color": "A53EF5", "default": false, "description": "Confirmed issue that is tracked by the Next.js team."}, {"id": 5721224978, "node_id": "LA_kwDOBC3Cis8AAAABVQL3Eg", "url": "https://api.github.com/repos/vercel/next.js/labels/locked", "name": "locked", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignees": [], "milestone": null, "comments": 174, "created_at": "2023-05-03T19:24:05Z", "updated_at": "2023-10-12T00:03:26Z", "closed_at": "2023-08-24T15:34:58Z", "assignee": null, "author_association": "NONE", "type": null, "active_lock_reason": "resolved", "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### Verify canary release\n\n- [X] I verified that the issue exists in the latest Next.js canary release\n\n### Provide environment information\n\n```bash\nOperating System:\r\n      Platform: win32\r\n      Arch: x64\r\n      Version: Windows 10 Pro\r\n    Binaries:\r\n      Node: 18.15.0\r\n      npm: N/A\r\n      Yarn: N/A\r\n      pnpm: N/A\r\n    Relevant packages:\r\n      next: 13.3.5-canary.6\r\n      eslint-config-next: 13.3.2\r\n      react: 18.2.0\r\n      react-dom: 18.2.0\n```\n\n\n### Which area(s) of Next.js are affected? (leave empty if unsure)\n\n_No response_\n\n### Link to the code that reproduces this issue\n\nsorry i can't upload because my project contains localhost database connections\n\n### To Reproduce\n\nOn my own server.js file, every page of my application in development mode gets the same error, while on my own server.js file in localhost in production mode, I get this error on the pages under [slug]! When I run this with my server.js file I get this error. While it then worked on 13.3.1, it's now broken!\r\n\r\n\r\n\r\nWhat am I missing in my server.js file or what should I do? I got this error in the last 13.3.2-canary.7 and it continued in later versions! Normally, I get this error when I refresh the pages under news-media/[slug] and other pages under news-media/[slug] while opening in production mode. I get this error on every page in development mode!\"dev\": \"next dev\",\r\n\"build\": \"next build\",\r\nWhile \"start\": \"next start\" was OK, as I mentioned above on my server.js file, after the \"next 13.3.1\" version, errors started on server.js both in development and production mode!\r\n\r\nHere's my run npm commands for my own server.js:\r\n     \"httpsDevelopment\": \"node --max_old_space_size=8192 server/server.js\",\r\n     \"httpsProduction\": \"next build && node server/server.js production\",\r\n     \r\nMy server.js file looks like this:\r\n\r\n![Screenshot_20](https://user-images.githubusercontent.com/57527680/236021249-857e29e4-29b8-46a3-84c1-cb53ee871af4.png)\r\n\r\n```\r\nconst { createServer } = require('https')\r\nconst { parse } = require('url')\r\nconst next = require('next')\r\nconst fs = require('fs')\r\nconst dev = process.argv[2] !== 'production'\r\nconst serverProduct = process.argv[3] === 'server' || undefined\r\n\r\nprocess.env.NODE_TLS_REJECT_UNAUTHORIZED = '0'\r\nconst hostname = 'localhost'\r\nconst port = 443\r\n// when using middleware hostname and port must be provided below\r\nconst app = next({ dev, hostname, port })\r\nconst handle = app.getRequestHandler()\r\nconst httpsOptions = {\r\nkey: fs.readFileSync(./server/certificates/${serverProduct ? 'cloudflare.key' : 'server.key'}),\r\ncert: fs.readFileSync(./server/certificates/${serverProduct ? 'cloudflare.pem' : 'server.crt'}),\r\n}\r\napp.prepare().then(() => {\r\ncreateServer(httpsOptions, async (req, res) => {\r\ntry {\r\nconst parsedUrl = parse(req.url, true)\r\nawait handle(req, res, parsedUrl).then(null)\r\n} catch (err) {\r\nconsole.error('Error occurred handling', req.url, err)\r\nres.statusCode = 500\r\nres.end('internal server error')\r\n}\r\n})\r\n.once('error', (err) => {\r\nconsole.error(err)\r\nprocess.exit(1)\r\n})\r\n.listen(port, () => {\r\nconsole.log(> Ready on https://${hostname})\r\n})\r\n})\r\n```\n\n### Describe the Bug\n\nWhat am I missing in my server.js file or what should I do? I got this error in the last 13.3.2-canary.7 and it continued in later versions! Normally, I get this error when I refresh the pages under news-media/[slug] and other pages under news-media/[slug] while opening in production mode. I get this error on every page in development mode!\"dev\": \"next dev\",\r\n\"build\": \"next build\",\r\nWhile \"start\": \"next start\" was OK, as I mentioned above on my server.js file, after the \"next 13.3.1\" version, errors started on server.js both in development and production mode!\r\n\r\nWhile in development:\r\n![dev1](https://user-images.githubusercontent.com/57527680/236022051-f605ac5c-c036-4233-9f7f-905ed6d126e5.png)\r\n![dev2](https://user-images.githubusercontent.com/57527680/236022086-5d5d5385-595a-482d-8c25-0cd1895865c1.png)\r\n\r\nWhile in production:\r\n![prod1](https://user-images.githubusercontent.com/57527680/236022209-3472fef9-1126-4f17-93f9-55380b4997f4.png)\r\n![prod2](https://user-images.githubusercontent.com/57527680/236022218-4e324f34-d69b-49f3-b474-f74c7260e629.png)\r\n\n\n### Expected Behavior\n\nI expect it to run smoothly on my own server.js file, both in development and production mode. I have 2 similar tickets closed. But the problem persists in a similar way!\n\n### Which browser are you using? (if relevant)\n\nChrome 112.0.5615.138\n\n### How are you deploying your application? (if relevant)\n\non my localhost with the command \"next build && node server/server.js production\". or \"node --max_old_space_size=8192 server/server.js\"\n\n<sub>[NEXT-1413](https://linear.app/vercel/issue/NEXT-1413/error-[err-package-path-not-exported]-package-subpath-serveredge-is)</sub>", "closed_by": {"login": "gnoff", "id": 2716369, "node_id": "MDQ6VXNlcjI3MTYzNjk=", "avatar_url": "https://avatars.githubusercontent.com/u/2716369?v=4", "gravatar_id": "", "url": "https://api.github.com/users/gnoff", "html_url": "https://github.com/gnoff", "followers_url": "https://api.github.com/users/gnoff/followers", "following_url": "https://api.github.com/users/gnoff/following{/other_user}", "gists_url": "https://api.github.com/users/gnoff/gists{/gist_id}", "starred_url": "https://api.github.com/users/gnoff/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/gnoff/subscriptions", "organizations_url": "https://api.github.com/users/gnoff/orgs", "repos_url": "https://api.github.com/users/gnoff/repos", "events_url": "https://api.github.com/users/gnoff/events{/privacy}", "received_events_url": "https://api.github.com/users/gnoff/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/vercel/next.js/issues/49169/reactions", "total_count": 46, "+1": 39, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 7}, "timeline_url": "https://api.github.com/repos/vercel/next.js/issues/49169/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/vercel/next.js/issues/49929", "repository_url": "https://api.github.com/repos/vercel/next.js", "labels_url": "https://api.github.com/repos/vercel/next.js/issues/49929/labels{/name}", "comments_url": "https://api.github.com/repos/vercel/next.js/issues/49929/comments", "events_url": "https://api.github.com/repos/vercel/next.js/issues/49929/events", "html_url": "https://github.com/vercel/next.js/issues/49929", "id": 1713798141, "node_id": "I_kwDOBC3Cis5mJnv9", "number": 49929, "title": "[NEXT-1314] High memory usage in deployed Next.js project", "user": {"login": "ProchaLu", "id": 80746311, "node_id": "MDQ6VXNlcjgwNzQ2MzEx", "avatar_url": "https://avatars.githubusercontent.com/u/80746311?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ProchaLu", "html_url": "https://github.com/ProchaLu", "followers_url": "https://api.github.com/users/ProchaLu/followers", "following_url": "https://api.github.com/users/ProchaLu/following{/other_user}", "gists_url": "https://api.github.com/users/ProchaLu/gists{/gist_id}", "starred_url": "https://api.github.com/users/ProchaLu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ProchaLu/subscriptions", "organizations_url": "https://api.github.com/users/ProchaLu/orgs", "repos_url": "https://api.github.com/users/ProchaLu/repos", "events_url": "https://api.github.com/users/ProchaLu/events{/privacy}", "received_events_url": "https://api.github.com/users/ProchaLu/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 2471906168, "node_id": "MDU6TGFiZWwyNDcxOTA2MTY4", "url": "https://api.github.com/repos/vercel/next.js/labels/bug", "name": "bug", "color": "fddf99", "default": true, "description": "Issue was opened via the bug report template."}, {"id": 4932840687, "node_id": "LA_kwDOBC3Cis8AAAABJgUs7w", "url": "https://api.github.com/repos/vercel/next.js/labels/linear:%20next", "name": "linear: next", "color": "A53EF5", "default": false, "description": "Confirmed issue that is tracked by the Next.js team."}], "state": "closed", "locked": true, "assignees": [], "milestone": null, "comments": 131, "created_at": "2023-05-17T12:28:24Z", "updated_at": "2023-08-24T08:47:26Z", "closed_at": "2023-08-24T08:46:15Z", "assignee": null, "author_association": "CONTRIBUTOR", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### Verify canary release\r\n\r\n- [X] I verified that the issue exists in the latest Next.js canary release\r\n\r\n### Provide environment information\r\n\r\n```bash\r\nOperating System:\r\n      Platform: darwin\r\n      Arch: arm64\r\n      Version: Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:30 PDT 2022; root:xnu-8792.41.9~2/RELEASE_ARM64_T8103\r\n    Binaries:\r\n      Node: 18.15.0\r\n      npm: 9.5.0\r\n      Yarn: 1.22.19\r\n      pnpm: 8.5.0\r\n    Relevant packages:\r\n      next: 13.4.3-canary.1\r\n      eslint-config-next: N/A\r\n      react: 18.2.0\r\n      react-dom: 18.2.0\r\n      typescript: 5.0.4\r\n```\r\n\r\n\r\n### Which area(s) of Next.js are affected? (leave empty if unsure)\r\n\r\n_No response_\r\n\r\n### Link to the code that reproduces this issue\r\n\r\nhttps://codesandbox.io/p/github/ProchaLu/next-js-ram-example/\r\n\r\n### To Reproduce\r\n\r\n - Clone the repository: https://github.com/ProchaLu/next-js-ram-example\r\n - Deploy the project on Fly.io\r\n\r\n### Describe the Bug\r\n\r\nI have been working on a small project to reproduce an issue related to memory usage in Next.js. The project is built using the Next.js canary version `13.4.3-canary.1`. It utilizes Next.js with App Router and Server Actions and does not use a database.\r\n\r\nThe problem arises when deploying the project on different platforms and observing the memory usage behavior. I have deployed the project on multiple platforms for testing purposes, including Vercel and Fly.io.\r\n\r\n - On Vercel: https://next-js-ram-example.vercel.app/ \r\n    When interacting with the deployed version on Vercel, the project responds as expected. The memory usage remains stable and does not show any significant increase or latency\r\n    \r\n- On Fly.io: https://memory-test.fly.dev/\r\n    However, when deploying the project on Fly.io, I noticed that the memory usage constantly remains around 220 MB, even during normal usage scenarios\r\n    \r\n\r\n### Expected Behavior\r\n\r\nI expect the small project to run smoothly without encountering any memory-related issues when deployed on various platforms, including Fly.io. Considering the previous successful deployment on Fly.io, which involved additional resource usage and utilized Next.js 13 with App Router and Server Actions, my anticipation is that the memory usage will remain stable and within acceptable limits.\r\n\r\nFly.io discussion: https://community.fly.io/t/high-memory-usage-in-deployed-next-js-project/12954?u=upleveled\r\n\r\n### Which browser are you using? (if relevant)\r\n\r\nChrome\r\n\r\n### How are you deploying your application? (if relevant)\r\n\r\nVercel, fly.io\n\n<sub>[NEXT-1314](https://linear.app/vercel/issue/NEXT-1314/high-memory-usage-in-deployed-nextjs-project)</sub>", "closed_by": {"login": "timneutkens", "id": 6324199, "node_id": "MDQ6VXNlcjYzMjQxOTk=", "avatar_url": "https://avatars.githubusercontent.com/u/6324199?v=4", "gravatar_id": "", "url": "https://api.github.com/users/timneutkens", "html_url": "https://github.com/timneutkens", "followers_url": "https://api.github.com/users/timneutkens/followers", "following_url": "https://api.github.com/users/timneutkens/following{/other_user}", "gists_url": "https://api.github.com/users/timneutkens/gists{/gist_id}", "starred_url": "https://api.github.com/users/timneutkens/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/timneutkens/subscriptions", "organizations_url": "https://api.github.com/users/timneutkens/orgs", "repos_url": "https://api.github.com/users/timneutkens/repos", "events_url": "https://api.github.com/users/timneutkens/events{/privacy}", "received_events_url": "https://api.github.com/users/timneutkens/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/vercel/next.js/issues/49929/reactions", "total_count": 95, "+1": 65, "-1": 0, "laugh": 0, "hooray": 0, "confused": 4, "heart": 0, "rocket": 0, "eyes": 26}, "timeline_url": "https://api.github.com/repos/vercel/next.js/issues/49929/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/vercel/next.js/issues/45508", "repository_url": "https://api.github.com/repos/vercel/next.js", "labels_url": "https://api.github.com/repos/vercel/next.js/issues/45508/labels{/name}", "comments_url": "https://api.github.com/repos/vercel/next.js/issues/45508/comments", "events_url": "https://api.github.com/repos/vercel/next.js/issues/45508/events", "html_url": "https://github.com/vercel/next.js/issues/45508", "id": 1567370312, "node_id": "I_kwDOBC3Cis5dbCxI", "number": 45508, "title": "Hight number of processes of /next/dist/compiled/jest-worker/processChild.js still alive after next build", "user": {"login": "zqjimlove", "id": 3240259, "node_id": "MDQ6VXNlcjMyNDAyNTk=", "avatar_url": "https://avatars.githubusercontent.com/u/3240259?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zqjimlove", "html_url": "https://github.com/zqjimlove", "followers_url": "https://api.github.com/users/zqjimlove/followers", "following_url": "https://api.github.com/users/zqjimlove/following{/other_user}", "gists_url": "https://api.github.com/users/zqjimlove/gists{/gist_id}", "starred_url": "https://api.github.com/users/zqjimlove/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zqjimlove/subscriptions", "organizations_url": "https://api.github.com/users/zqjimlove/orgs", "repos_url": "https://api.github.com/users/zqjimlove/repos", "events_url": "https://api.github.com/users/zqjimlove/events{/privacy}", "received_events_url": "https://api.github.com/users/zqjimlove/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 482888042, "node_id": "MDU6TGFiZWw0ODI4ODgwNDI=", "url": "https://api.github.com/repos/vercel/next.js/labels/please%20add%20a%20complete%20reproduction", "name": "please add a complete reproduction", "color": "fbca04", "default": false, "description": "Please add a complete reproduction."}, {"id": 2471906168, "node_id": "MDU6TGFiZWwyNDcxOTA2MTY4", "url": "https://api.github.com/repos/vercel/next.js/labels/bug", "name": "bug", "color": "fddf99", "default": true, "description": "Issue was opened via the bug report template."}, {"id": 4932840687, "node_id": "LA_kwDOBC3Cis8AAAABJgUs7w", "url": "https://api.github.com/repos/vercel/next.js/labels/linear:%20next", "name": "linear: next", "color": "A53EF5", "default": false, "description": "Confirmed issue that is tracked by the Next.js team."}], "state": "closed", "locked": true, "assignees": [], "milestone": null, "comments": 129, "created_at": "2023-02-02T05:55:49Z", "updated_at": "2023-08-28T08:15:48Z", "closed_at": "2023-08-26T21:28:47Z", "assignee": null, "author_association": "NONE", "type": null, "active_lock_reason": "resolved", "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### Verify canary release\r\n\r\n- [X] I verified that the issue exists in the latest Next.js canary release\r\n\r\n### Provide environment information\r\n\r\n    Operating System:\r\n      Platform: darwin\r\n      Arch: arm64\r\n      Version: Darwin Kernel Version 22.3.0: Thu Jan  5 20:48:54 PST 2023; root:xnu-8792.81.2~2/RELEASE_ARM64_T6000\r\n    Binaries:\r\n      Node: 18.13.0\r\n      npm: 8.19.3\r\n      Yarn: 1.22.19\r\n      pnpm: 7.26.2\r\n    Relevant packages:\r\n      next: 12.0.9\r\n      react: 17.0.2\r\n      react-dom: 17.0.2\r\n\r\n### Which area(s) of Next.js are affected? (leave empty if unsure)\r\n\r\nCLI (create-next-app)\r\n\r\n### Link to the code that reproduces this issue\r\n\r\nhttps://github.com/vercel/next.js/files/10565355/reproduce.zip\r\n\r\n### To Reproduce\r\n\r\n[reproduce.zip](https://github.com/vercel/next.js/files/10565355/reproduce.zip)\r\n\r\n<img width=\"1492\" alt=\"image\" src=\"https://user-images.githubusercontent.com/3240259/216242566-6f87ae6e-e369-405f-9fca-e525e051797d.png\">\r\n\r\nThis problem can reproduce above next@12.0.9, but 12.0.8 was all right.\r\n\r\nOr remove `getInitialProps` in `_app.tsx ` was all right above next@12.0.9.\r\n\r\n```ts\r\n// GlobalApp.getInitialProps = async function getInitialProps(appContext) {\r\n//   const appProps = await App.getInitialProps(appContext);\r\n\r\n//   return {\r\n//     ...appProps,\r\n//   };\r\n// };\r\n```\r\n\r\n\r\n\r\n### Describe the Bug\r\n\r\nHight number of processes of /next/dist/compiled/jest-worker/processChild.js still alive after next build\r\n\r\n### Expected Behavior\r\n\r\nKill all child processes.\r\n\r\n### Which browser are you using? (if relevant)\r\n\r\n_No response_\r\n\r\n### How are you deploying your application? (if relevant)\r\n\r\n_No response_\n\n<sub>[NEXT-1348](https://linear.app/vercel/issue/NEXT-1348/hight-number-of-processes-of-nextdistcompiledjest-workerprocesschildjs)</sub>", "closed_by": {"login": "kodiakhq[bot]", "id": 49736102, "node_id": "MDM6Qm90NDk3MzYxMDI=", "avatar_url": "https://avatars.githubusercontent.com/in/29196?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kodiakhq%5Bbot%5D", "html_url": "https://github.com/apps/kodiakhq", "followers_url": "https://api.github.com/users/kodiakhq%5Bbot%5D/followers", "following_url": "https://api.github.com/users/kodiakhq%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/kodiakhq%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/kodiakhq%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kodiakhq%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/kodiakhq%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/kodiakhq%5Bbot%5D/repos", "events_url": "https://api.github.com/users/kodiakhq%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/kodiakhq%5Bbot%5D/received_events", "type": "Bot", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/vercel/next.js/issues/45508/reactions", "total_count": 41, "+1": 37, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 4}, "timeline_url": "https://api.github.com/repos/vercel/next.js/issues/45508/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/vercel/next.js/issues/64409", "repository_url": "https://api.github.com/repos/vercel/next.js", "labels_url": "https://api.github.com/repos/vercel/next.js/issues/64409/labels{/name}", "comments_url": "https://api.github.com/repos/vercel/next.js/issues/64409/comments", "events_url": "https://api.github.com/repos/vercel/next.js/issues/64409/events", "html_url": "https://github.com/vercel/next.js/issues/64409", "id": 2240588643, "node_id": "I_kwDOBC3Cis6FjKtj", "number": 64409, "title": "next-lint Doesn't Support ESLint 9", "user": {"login": "dylandignan", "id": 5639519, "node_id": "MDQ6VXNlcjU2Mzk1MTk=", "avatar_url": "https://avatars.githubusercontent.com/u/5639519?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dylandignan", "html_url": "https://github.com/dylandignan", "followers_url": "https://api.github.com/users/dylandignan/followers", "following_url": "https://api.github.com/users/dylandignan/following{/other_user}", "gists_url": "https://api.github.com/users/dylandignan/gists{/gist_id}", "starred_url": "https://api.github.com/users/dylandignan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dylandignan/subscriptions", "organizations_url": "https://api.github.com/users/dylandignan/orgs", "repos_url": "https://api.github.com/users/dylandignan/repos", "events_url": "https://api.github.com/users/dylandignan/events{/privacy}", "received_events_url": "https://api.github.com/users/dylandignan/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 2471906168, "node_id": "MDU6TGFiZWwyNDcxOTA2MTY4", "url": "https://api.github.com/repos/vercel/next.js/labels/bug", "name": "bug", "color": "fddf99", "default": true, "description": "Issue was opened via the bug report template."}, {"id": 3499543244, "node_id": "LA_kwDOBC3Cis7QlsrM", "url": "https://api.github.com/repos/vercel/next.js/labels/Linting", "name": "Linting", "color": "0EC69C", "default": false, "description": "Related to `next lint` or ESLint with Next.js."}, {"id": 4932840687, "node_id": "LA_kwDOBC3Cis8AAAABJgUs7w", "url": "https://api.github.com/repos/vercel/next.js/labels/linear:%20next", "name": "linear: next", "color": "A53EF5", "default": false, "description": "Confirmed issue that is tracked by the Next.js team."}], "state": "closed", "locked": true, "assignees": [], "milestone": null, "comments": 110, "created_at": "2024-04-12T17:22:04Z", "updated_at": "2024-10-16T02:40:20Z", "closed_at": "2024-10-14T18:57:57Z", "assignee": null, "author_association": "NONE", "type": null, "active_lock_reason": "resolved", "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### Link to the code that reproduces this issue\r\n\r\nhttps://codesandbox.io/p/devbox/vigilant-pine-6wmz8y\r\n\r\n### To Reproduce\r\n\r\n1. Add `next lint` script to package.json per https://nextjs.org/docs/app/building-your-application/configuring/eslint\r\n2. Add `.eslintrc.json` to project per https://nextjs.org/docs/app/building-your-application/configuring/eslint\r\n```\r\n{\r\n  \"extends\": \"next/core-web-vitals\"\r\n}\r\n```\r\n3. Run lint and get an error\r\n```\r\n\u279c  /workspace git:(master) \u2717 npm run lint\r\n\r\n> lint\r\n> next lint\r\n\r\nInvalid Options:\r\n- Unknown options: useEslintrc, extensions, resolvePluginsRelativeTo, rulePaths, ignorePath, reportUnusedDisableDirectives\r\n- 'extensions' has been removed.\r\n- 'resolvePluginsRelativeTo' has been removed.\r\n- 'ignorePath' has been removed.\r\n- 'rulePaths' has been removed. Please define your rules using plugins.\r\n- 'reportUnusedDisableDirectives' has been removed. Please use the 'overrideConfig.linterOptions.reportUnusedDisableDirectives' option instead.\r\n```\r\n\r\n### Current vs. Expected behavior\r\n\r\nExpected lint to run successfully, but it failed with errors.\r\n\r\n### Provide environment information\r\n\r\n```bash\r\nOperating System:\r\n  Platform: linux\r\n  Arch: x64\r\n  Version: #1 SMP PREEMPT_DYNAMIC Sun Aug  6 20:05:33 UTC 2023\r\n  Available memory (MB): 4102\r\n  Available CPU cores: 2\r\nBinaries:\r\n  Node: 20.9.0\r\n  npm: 9.8.1\r\n  Yarn: 1.22.19\r\n  pnpm: 8.10.2\r\nRelevant Packages:\r\n  next: 14.2.1-canary.0 // Latest available version is detected (14.2.1-canary.0).\r\n  eslint-config-next: 14.1.4\r\n  react: 18.2.0\r\n  react-dom: 18.2.0\r\n  typescript: 5.1.3\r\nNext.js Config:\r\n  output: N/A\r\n```\r\n\r\n\r\n### Which area(s) are affected? (Select all that apply)\r\n\r\nESLint (eslint-config-next)\r\n\r\n### Which stage(s) are affected? (Select all that apply)\r\n\r\nnext dev (local), next build (local), next start (local)\r\n\r\n### Additional context\r\n\r\nIt looks like this is coming from https://github.com/vercel/next.js/blob/canary/packages/next/src/cli/next-lint.ts. This needs to be changed to support ESLint 9's flat config https://eslint.org/docs/latest/use/migrate-to-9.0.0#flat-config. The migration guide is at https://eslint.org/docs/latest/use/configure/migration-guide \n\n<sub>[NEXT-3112](https://linear.app/vercel/issue/NEXT-3112/next-lint-doesnt-support-eslint-9)</sub>", "closed_by": {"login": "devjiwonchoi", "id": 120007119, "node_id": "U_kgDOBycpzw", "avatar_url": "https://avatars.githubusercontent.com/u/120007119?v=4", "gravatar_id": "", "url": "https://api.github.com/users/devjiwonchoi", "html_url": "https://github.com/devjiwonchoi", "followers_url": "https://api.github.com/users/devjiwonchoi/followers", "following_url": "https://api.github.com/users/devjiwonchoi/following{/other_user}", "gists_url": "https://api.github.com/users/devjiwonchoi/gists{/gist_id}", "starred_url": "https://api.github.com/users/devjiwonchoi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/devjiwonchoi/subscriptions", "organizations_url": "https://api.github.com/users/devjiwonchoi/orgs", "repos_url": "https://api.github.com/users/devjiwonchoi/repos", "events_url": "https://api.github.com/users/devjiwonchoi/events{/privacy}", "received_events_url": "https://api.github.com/users/devjiwonchoi/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/vercel/next.js/issues/64409/reactions", "total_count": 349, "+1": 309, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 40}, "timeline_url": "https://api.github.com/repos/vercel/next.js/issues/64409/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/vercel/next.js/issues/43548", "repository_url": "https://api.github.com/repos/vercel/next.js", "labels_url": "https://api.github.com/repos/vercel/next.js/issues/43548/labels{/name}", "comments_url": "https://api.github.com/repos/vercel/next.js/issues/43548/comments", "events_url": "https://api.github.com/repos/vercel/next.js/issues/43548/events", "html_url": "https://github.com/vercel/next.js/issues/43548", "id": 1468779186, "node_id": "I_kwDOBC3Cis5Xi8qy", "number": 43548, "title": "[NEXT-1187] Link navigation with loading.tsx is not instant for dynamic pages", "user": {"login": "tonypizzicato", "id": 640122, "node_id": "MDQ6VXNlcjY0MDEyMg==", "avatar_url": "https://avatars.githubusercontent.com/u/640122?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tonypizzicato", "html_url": "https://github.com/tonypizzicato", "followers_url": "https://api.github.com/users/tonypizzicato/followers", "following_url": "https://api.github.com/users/tonypizzicato/following{/other_user}", "gists_url": "https://api.github.com/users/tonypizzicato/gists{/gist_id}", "starred_url": "https://api.github.com/users/tonypizzicato/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tonypizzicato/subscriptions", "organizations_url": "https://api.github.com/users/tonypizzicato/orgs", "repos_url": "https://api.github.com/users/tonypizzicato/repos", "events_url": "https://api.github.com/users/tonypizzicato/events{/privacy}", "received_events_url": "https://api.github.com/users/tonypizzicato/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 2471906168, "node_id": "MDU6TGFiZWwyNDcxOTA2MTY4", "url": "https://api.github.com/repos/vercel/next.js/labels/bug", "name": "bug", "color": "fddf99", "default": true, "description": "Issue was opened via the bug report template."}, {"id": 4932840687, "node_id": "LA_kwDOBC3Cis8AAAABJgUs7w", "url": "https://api.github.com/repos/vercel/next.js/labels/linear:%20next", "name": "linear: next", "color": "A53EF5", "default": false, "description": "Confirmed issue that is tracked by the Next.js team."}, {"id": 5721224978, "node_id": "LA_kwDOBC3Cis8AAAABVQL3Eg", "url": "https://api.github.com/repos/vercel/next.js/labels/locked", "name": "locked", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignees": [], "milestone": null, "comments": 107, "created_at": "2022-11-29T22:21:58Z", "updated_at": "2023-10-26T12:01:38Z", "closed_at": "2023-09-27T12:11:25Z", "assignee": null, "author_association": "NONE", "type": null, "active_lock_reason": "resolved", "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### Verify canary release\n\n- [X] I verified that the issue exists in the latest Next.js canary release\n\n### Provide environment information\n\n    Operating System:\r\n      Platform: darwin\r\n      Arch: arm64\r\n      Version: Darwin Kernel Version 22.1.0: Sun Oct  9 20:14:30 PDT 2022; root:xnu-8792.41.9~2/RELEASE_ARM64_T8103\r\n    Binaries:\r\n      Node: 18.12.1\r\n      npm: 8.19.2\r\n      Yarn: 1.22.19\r\n      pnpm: N/A\r\n    Relevant packages:\r\n      next: 13.0.6-canary.2\r\n      eslint-config-next: 13.0.5\r\n      react: 18.2.0\r\n      react-dom: 18.2.0\n\n### Which area of Next.js is affected? (leave empty if unsure)\n\nApp directory (appDir: true), Routing (next/router, next/navigation, next/link)\n\n### Link to reproduction - Issues with a link to complete (but minimal) reproduction code will be addressed faster\n\nhttps://github.com/tonypizzicato/next-13-loading\n\n### To Reproduce\n\n- pull the repo\r\n- run `yarn install && yarn dev`\r\n- open `localhost:3000` in the browser\r\n- go to the \"Careers\" page\r\n- reload the page\r\n- set some throttling in devtools\r\n- click different pages in the menu\r\n- notice that \"Careers\" page loading state and route change are done instantly but with some delay for other pages\n\n### Describe the Bug\n\nWhen you have a dynamic page with `loading.tsx` the route change and showing the loading animation are instant only for the page, which was freshly loaded. For other dynamic pages it hits the server first, then shows the loading state\r\n<img width=\"193\" alt=\"Screenshot 2022-11-29 at 23 19 38\" src=\"https://user-images.githubusercontent.com/640122/204660865-5d64b2bf-ef2f-4c4e-9d7b-5cf05944e3d1.png\">\r\n\r\n\r\nhttps://user-images.githubusercontent.com/640122/204661070-b9409f71-3814-45e6-bf56-923cdf4e2fc6.mov\r\n\r\n\n\n### Expected Behavior\n\nInstantly navigate to the desired dynamic page and show loading component\n\n### Which browser are you using? (if relevant)\n\n_No response_\n\n### How are you deploying your application? (if relevant)\n\n_No response_\n\n<sub>[NEXT-1187](https://linear.app/vercel/issue/NEXT-1187/link-navigation-with-loadingtsx-is-not-instant-for-dynamic-pages)</sub>", "closed_by": {"login": "timneutkens", "id": 6324199, "node_id": "MDQ6VXNlcjYzMjQxOTk=", "avatar_url": "https://avatars.githubusercontent.com/u/6324199?v=4", "gravatar_id": "", "url": "https://api.github.com/users/timneutkens", "html_url": "https://github.com/timneutkens", "followers_url": "https://api.github.com/users/timneutkens/followers", "following_url": "https://api.github.com/users/timneutkens/following{/other_user}", "gists_url": "https://api.github.com/users/timneutkens/gists{/gist_id}", "starred_url": "https://api.github.com/users/timneutkens/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/timneutkens/subscriptions", "organizations_url": "https://api.github.com/users/timneutkens/orgs", "repos_url": "https://api.github.com/users/timneutkens/repos", "events_url": "https://api.github.com/users/timneutkens/events{/privacy}", "received_events_url": "https://api.github.com/users/timneutkens/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/vercel/next.js/issues/43548/reactions", "total_count": 54, "+1": 54, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/vercel/next.js/issues/43548/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/vercel/next.js/issues/49334", "repository_url": "https://api.github.com/repos/vercel/next.js", "labels_url": "https://api.github.com/repos/vercel/next.js/issues/49334/labels{/name}", "comments_url": "https://api.github.com/repos/vercel/next.js/issues/49334/comments", "events_url": "https://api.github.com/repos/vercel/next.js/issues/49334/events", "html_url": "https://github.com/vercel/next.js/issues/49334", "id": 1698136631, "node_id": "I_kwDOBC3Cis5lN4I3", "number": 49334, "title": "[NEXT-1119] Socket.IO Not working anymore from Next.js 13.2.5-canary.27 to latest Next.js 13.4.1", "user": {"login": "saicharan-gevme", "id": 104352249, "node_id": "U_kgDOBjhJ-Q", "avatar_url": "https://avatars.githubusercontent.com/u/104352249?v=4", "gravatar_id": "", "url": "https://api.github.com/users/saicharan-gevme", "html_url": "https://github.com/saicharan-gevme", "followers_url": "https://api.github.com/users/saicharan-gevme/followers", "following_url": "https://api.github.com/users/saicharan-gevme/following{/other_user}", "gists_url": "https://api.github.com/users/saicharan-gevme/gists{/gist_id}", "starred_url": "https://api.github.com/users/saicharan-gevme/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/saicharan-gevme/subscriptions", "organizations_url": "https://api.github.com/users/saicharan-gevme/orgs", "repos_url": "https://api.github.com/users/saicharan-gevme/repos", "events_url": "https://api.github.com/users/saicharan-gevme/events{/privacy}", "received_events_url": "https://api.github.com/users/saicharan-gevme/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 2471906168, "node_id": "MDU6TGFiZWwyNDcxOTA2MTY4", "url": "https://api.github.com/repos/vercel/next.js/labels/bug", "name": "bug", "color": "fddf99", "default": true, "description": "Issue was opened via the bug report template."}, {"id": 4932840687, "node_id": "LA_kwDOBC3Cis8AAAABJgUs7w", "url": "https://api.github.com/repos/vercel/next.js/labels/linear:%20next", "name": "linear: next", "color": "A53EF5", "default": false, "description": "Confirmed issue that is tracked by the Next.js team."}, {"id": 5721224978, "node_id": "LA_kwDOBC3Cis8AAAABVQL3Eg", "url": "https://api.github.com/repos/vercel/next.js/labels/locked", "name": "locked", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignees": [], "milestone": null, "comments": 100, "created_at": "2023-05-05T20:05:59Z", "updated_at": "2023-11-13T12:01:39Z", "closed_at": "2023-10-23T17:23:36Z", "assignee": null, "author_association": "NONE", "type": null, "active_lock_reason": "resolved", "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### Verify canary release\n\n- [X] I verified that the issue exists in the latest Next.js canary release\n\n### Provide environment information\n\n```bash\nOperating System:\r\n      Platform: darwin\r\n      Arch: arm64\r\n      Version: Darwin Kernel Version 22.4.0: Mon Mar  6 21:00:41 PST 2023; root:xnu-8796.101.5~3/RELEASE_ARM64_T8103\r\n    Binaries:\r\n      Node: 18.16.0\r\n      npm: 9.5.1\r\n      Yarn: N/A\r\n      pnpm: N/A\r\n    Relevant packages:\r\n      next: 13.4.1-canary.2\r\n      eslint-config-next: N/A\r\n      react: 18.2.0\r\n      react-dom: 18.2.0\r\n\r\nwarn  - Latest canary version not detected, detected: \"13.4.1-canary.2\", newest: \"13.4.1\".\r\n        Please try the latest canary version (`npm install next@canary`) to confirm the issue still exists before creating a new issue.\r\n        Read more - https://nextjs.org/docs/messages/opening-an-issue\n```\n\n\n### Which area(s) of Next.js are affected? (leave empty if unsure)\n\nApp directory (appDir: true)\n\n### Link to the code that reproduces this issue\n\nhttps://codesandbox.io/p/sandbox/nextjs-socketio-u89y82?file=%2Fpackage.json&selection=%5B%7B%22endColumn%22%3A1%2C%22endLineNumber%22%3A4%2C%22startColumn%22%3A1%2C%22startLineNumber%22%3A4%7D%5D\n\n### To Reproduce\n\n## Agenda of this project?\r\n- To setup the Socket.Io server and share the information from one client to another user socket.io events\r\n\r\n## The App is have the following things - \r\n-  An api for initialising the Socket.Io server - inside /pages/api/socketio\r\n- A client page to connect to this server - inside /app/page\r\n\r\n\r\n## Whats the Issue?\r\n- There has been an unknown error in network connection from client side when its trying to create the Socket.Io connection.\r\n\r\n\r\n## Since when this issue is happening?\r\n- This has been happening from Next.js version 13.2.5-canary.27 version and its still happening even in latest canary release 13.4.1-canary.2 and also the latest release Next.js 13.4.1\r\n\r\n\r\n## Do we have an Example project?\r\n- Yes, I have created a testing project in codesandbox, that I have already shared. ([Link](https://codesandbox.io/p/sandbox/nextjs-socketio-u89y82?file=%2Fpackage.json&selection=%5B%7B%22endColumn%22%3A1%2C%22endLineNumber%22%3A4%2C%22startColumn%22%3A1%2C%22startLineNumber%22%3A4%7D%5D))\r\n\r\n\r\n## Steps to Reproduce\r\n- Just see the console and network tabs for the client connection error. It will happen to all the versions on and above 13.2.5-canary.27\r\n- And to see if its fixed, you need to downgrade to 13.2.5-canary.26\r\n\r\n## Some References PR for / might this issue have created?\r\n- I some how gathered the PR for the version when this Socket.Io broken (i.e. 13.2.5-canary.27) - [See here](https://github.com/vercel/next.js/pull/47208#issuecomment-1524565169)\r\n\r\n\r\n\n\n### Describe the Bug\n\n- There has been an unknown error in network connection from client side when its trying to create the Socket.Io connection.\n\n### Expected Behavior\n\n- There should be successful Socket.Io connection.\r\n- It should exactly work the same way as it was working 13.2.5-canary.26 or lower.\r\n- I was using 13.2.4 as stable version for our production application, as we had to use Socket.Io for websocket connection.\n\n### Which browser are you using? (if relevant)\n\nI am using latest Chrome version, but this has to do more with Next.js Core server. It has nothing to do with any browsers.\n\n### How are you deploying your application? (if relevant)\n\nUsing Docker, but this is irrelevant too, as in localhost also, there is this issue.\n\n<sub>[NEXT-1119](https://linear.app/vercel/issue/NEXT-1119/socketio-not-working-anymore-from-nextjs-1325-canary27-to-latest)</sub>", "closed_by": {"login": "kodiakhq[bot]", "id": 49736102, "node_id": "MDM6Qm90NDk3MzYxMDI=", "avatar_url": "https://avatars.githubusercontent.com/in/29196?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kodiakhq%5Bbot%5D", "html_url": "https://github.com/apps/kodiakhq", "followers_url": "https://api.github.com/users/kodiakhq%5Bbot%5D/followers", "following_url": "https://api.github.com/users/kodiakhq%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/kodiakhq%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/kodiakhq%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kodiakhq%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/kodiakhq%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/kodiakhq%5Bbot%5D/repos", "events_url": "https://api.github.com/users/kodiakhq%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/kodiakhq%5Bbot%5D/received_events", "type": "Bot", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/vercel/next.js/issues/49334/reactions", "total_count": 81, "+1": 81, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/vercel/next.js/issues/49334/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/vercel/next.js/issues/46756", "repository_url": "https://api.github.com/repos/vercel/next.js", "labels_url": "https://api.github.com/repos/vercel/next.js/issues/46756/labels{/name}", "comments_url": "https://api.github.com/repos/vercel/next.js/issues/46756/comments", "events_url": "https://api.github.com/repos/vercel/next.js/issues/46756/events", "html_url": "https://github.com/vercel/next.js/issues/46756", "id": 1609511796, "node_id": "I_kwDOBC3Cis5f7zN0", "number": 46756, "title": "appDir + RSC: \"The server is running out of memory, restarting to free up memory\"", "user": {"login": "timfee", "id": 3246342, "node_id": "MDQ6VXNlcjMyNDYzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3246342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/timfee", "html_url": "https://github.com/timfee", "followers_url": "https://api.github.com/users/timfee/followers", "following_url": "https://api.github.com/users/timfee/following{/other_user}", "gists_url": "https://api.github.com/users/timfee/gists{/gist_id}", "starred_url": "https://api.github.com/users/timfee/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/timfee/subscriptions", "organizations_url": "https://api.github.com/users/timfee/orgs", "repos_url": "https://api.github.com/users/timfee/repos", "events_url": "https://api.github.com/users/timfee/events{/privacy}", "received_events_url": "https://api.github.com/users/timfee/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 2471906168, "node_id": "MDU6TGFiZWwyNDcxOTA2MTY4", "url": "https://api.github.com/repos/vercel/next.js/labels/bug", "name": "bug", "color": "fddf99", "default": true, "description": "Issue was opened via the bug report template."}, {"id": 4932840687, "node_id": "LA_kwDOBC3Cis8AAAABJgUs7w", "url": "https://api.github.com/repos/vercel/next.js/labels/linear:%20next", "name": "linear: next", "color": "A53EF5", "default": false, "description": "Confirmed issue that is tracked by the Next.js team."}], "state": "closed", "locked": true, "assignees": [], "milestone": null, "comments": 97, "created_at": "2023-03-04T01:13:15Z", "updated_at": "2023-08-29T12:18:02Z", "closed_at": "2023-08-29T12:17:56Z", "assignee": null, "author_association": "CONTRIBUTOR", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### Verify canary release\r\n\r\n- [X] I verified that the issue exists in the latest Next.js canary release\r\n\r\n### Provide environment information\r\n\r\n```bash\r\nOperating System:\r\n      Platform: darwin\r\n      Arch: arm64\r\n      Version: Darwin Kernel Version 22.3.0: Mon Jan 30 20:38:37 PST 2023; root:xnu-8792.81.3~2/RELEASE_ARM64_T6000\r\n    Binaries:\r\n      Node: 19.7.0\r\n      npm: 9.5.0\r\n      Yarn: N/A\r\n      pnpm: 7.28.0\r\n    Relevant packages:\r\n      next: 13.2.4-canary.1\r\n      eslint-config-next: 13.2.3\r\n      react: 18.2.0\r\n      react-dom: 18.2.0\r\n```\r\n\r\n\r\n### Which area(s) of Next.js are affected? (leave empty if unsure)\r\n\r\n_No response_\r\n\r\n### Link to the code that reproduces this issue\r\n\r\nhttps://github.com/timfee/www/tree/meet2hire1\r\n\r\n### To Reproduce\r\n\r\nObserve the video, where the `node` process gradually exceeds 4GB after about 4 minutes of using the app. During this time, I refreshed/reloaded several times (appDir/RSC pages), as well as triggered hot reloading in the browser.\r\n\r\nThis has been happing since 13.1.x and continues.\r\n\r\nI couldn't find any obvious leaks in the sever-side code (you can see some CPU / memory heap dumps in the root directory of the repro repository), e.g.: https://github.com/timfee/www/blob/4a813e95eb866e0fee39795f38e461427bee9795/vscode-profile-2023-03-03-13-51-06.heapsnapshot\r\n\r\nI'm happy to do additional repro steps/troubleshooting on my end!\r\n\r\nHere's me intentionally trying to overwork it:\r\n\r\nhttps://user-images.githubusercontent.com/3246342/222865281-1b1be172-b777-4466-bd2b-062b1b46947b.mov\r\n\r\n\r\n\r\n### Describe the Bug\r\n\r\nAfter 5 mins of using the app (interacting and hot reloading), the server consumes > 4 GB and I get the message:\r\n\r\n> The server is running out of memory, restarting to free up memory.\r\n\r\n### Expected Behavior\r\n\r\nThis either wouldn't happen, or Next would inform me if there was something egregiously wrong. \r\n\r\n### Which browser are you using? (if relevant)\r\n\r\n110.0.5481.177 (Official Build) (arm64) \r\n\r\n### How are you deploying your application? (if relevant)\r\n\r\nnext dev\r\n\r\n<sub>[NEXT-1353](https://linear.app/vercel/issue/NEXT-1353/[next-790]-appdir-rsc-the-server-is-running-out-of-memory-restarting)</sub>", "closed_by": {"login": "timneutkens", "id": 6324199, "node_id": "MDQ6VXNlcjYzMjQxOTk=", "avatar_url": "https://avatars.githubusercontent.com/u/6324199?v=4", "gravatar_id": "", "url": "https://api.github.com/users/timneutkens", "html_url": "https://github.com/timneutkens", "followers_url": "https://api.github.com/users/timneutkens/followers", "following_url": "https://api.github.com/users/timneutkens/following{/other_user}", "gists_url": "https://api.github.com/users/timneutkens/gists{/gist_id}", "starred_url": "https://api.github.com/users/timneutkens/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/timneutkens/subscriptions", "organizations_url": "https://api.github.com/users/timneutkens/orgs", "repos_url": "https://api.github.com/users/timneutkens/repos", "events_url": "https://api.github.com/users/timneutkens/events{/privacy}", "received_events_url": "https://api.github.com/users/timneutkens/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/vercel/next.js/issues/46756/reactions", "total_count": 99, "+1": 99, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/vercel/next.js/issues/46756/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/vercel/next.js/issues/40184", "repository_url": "https://api.github.com/repos/vercel/next.js", "labels_url": "https://api.github.com/repos/vercel/next.js/issues/40184/labels{/name}", "comments_url": "https://api.github.com/repos/vercel/next.js/issues/40184/comments", "events_url": "https://api.github.com/repos/vercel/next.js/issues/40184/events", "html_url": "https://github.com/vercel/next.js/issues/40184", "id": 1360428587, "node_id": "I_kwDOBC3Cis5RFn4r", "number": 40184, "title": "Fast Refresh had to perform a full reload ", "user": {"login": "por14571-jochoa", "id": 106832368, "node_id": "U_kgDOBl4h8A", "avatar_url": "https://avatars.githubusercontent.com/u/106832368?v=4", "gravatar_id": "", "url": "https://api.github.com/users/por14571-jochoa", "html_url": "https://github.com/por14571-jochoa", "followers_url": "https://api.github.com/users/por14571-jochoa/followers", "following_url": "https://api.github.com/users/por14571-jochoa/following{/other_user}", "gists_url": "https://api.github.com/users/por14571-jochoa/gists{/gist_id}", "starred_url": "https://api.github.com/users/por14571-jochoa/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/por14571-jochoa/subscriptions", "organizations_url": "https://api.github.com/users/por14571-jochoa/orgs", "repos_url": "https://api.github.com/users/por14571-jochoa/repos", "events_url": "https://api.github.com/users/por14571-jochoa/events{/privacy}", "received_events_url": "https://api.github.com/users/por14571-jochoa/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 2471906168, "node_id": "MDU6TGFiZWwyNDcxOTA2MTY4", "url": "https://api.github.com/repos/vercel/next.js/labels/bug", "name": "bug", "color": "fddf99", "default": true, "description": "Issue was opened via the bug report template."}, {"id": 4932840687, "node_id": "LA_kwDOBC3Cis8AAAABJgUs7w", "url": "https://api.github.com/repos/vercel/next.js/labels/linear:%20next", "name": "linear: next", "color": "A53EF5", "default": false, "description": "Confirmed issue that is tracked by the Next.js team."}], "state": "closed", "locked": true, "assignees": [], "milestone": null, "comments": 93, "created_at": "2022-09-02T17:01:30Z", "updated_at": "2024-01-02T23:11:04Z", "closed_at": "2024-01-02T23:11:04Z", "assignee": null, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### Verify canary release\n\n- [X] I verified that the issue exists in the latest Next.js canary release\n\n### Provide environment information\n\n![image](https://user-images.githubusercontent.com/106832368/188202140-8736f3cf-df82-4d85-814c-4e7bdf554fa6.png)\r\n\n\n### What browser are you using? (if relevant)\n\nGoogle Chrome  102.0.5005.115\n\n### How are you deploying your application? (if relevant)\n\nnext run dev\n\n### Describe the Bug\n\nWhen data is sent to the service and a context that handles the entire application is updated, the system does not change the page but reloads itself, deleting everything in the provider (react)\n\n### Expected Behavior\n\nI hope you go to the next screen which is indicated by the router.push(urlRelative, url)\n\n### Link to reproduction\n\n/None\n\n### To Reproduce\n\nIs project in development\n\n<sub>[NEXT-1355](https://linear.app/vercel/issue/NEXT-1355/fast-refresh-had-to-perform-a-full-reload)</sub>", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/vercel/next.js/issues/40184/reactions", "total_count": 2, "+1": 2, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/vercel/next.js/issues/40184/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/vercel/next.js/issues/47115", "repository_url": "https://api.github.com/repos/vercel/next.js", "labels_url": "https://api.github.com/repos/vercel/next.js/issues/47115/labels{/name}", "comments_url": "https://api.github.com/repos/vercel/next.js/issues/47115/comments", "events_url": "https://api.github.com/repos/vercel/next.js/issues/47115/events", "html_url": "https://github.com/vercel/next.js/issues/47115", "id": 1623257075, "node_id": "I_kwDOBC3Cis5gwO_z", "number": 47115, "title": "[NEXT-1192] Failed to find font override - next/font/google", "user": {"login": "maxencerb", "id": 47566657, "node_id": "MDQ6VXNlcjQ3NTY2NjU3", "avatar_url": "https://avatars.githubusercontent.com/u/47566657?v=4", "gravatar_id": "", "url": "https://api.github.com/users/maxencerb", "html_url": "https://github.com/maxencerb", "followers_url": "https://api.github.com/users/maxencerb/followers", "following_url": "https://api.github.com/users/maxencerb/following{/other_user}", "gists_url": "https://api.github.com/users/maxencerb/gists{/gist_id}", "starred_url": "https://api.github.com/users/maxencerb/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/maxencerb/subscriptions", "organizations_url": "https://api.github.com/users/maxencerb/orgs", "repos_url": "https://api.github.com/users/maxencerb/repos", "events_url": "https://api.github.com/users/maxencerb/events{/privacy}", "received_events_url": "https://api.github.com/users/maxencerb/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 2471906168, "node_id": "MDU6TGFiZWwyNDcxOTA2MTY4", "url": "https://api.github.com/repos/vercel/next.js/labels/bug", "name": "bug", "color": "fddf99", "default": true, "description": "Issue was opened via the bug report template."}, {"id": 4932840687, "node_id": "LA_kwDOBC3Cis8AAAABJgUs7w", "url": "https://api.github.com/repos/vercel/next.js/labels/linear:%20next", "name": "linear: next", "color": "A53EF5", "default": false, "description": "Confirmed issue that is tracked by the Next.js team."}, {"id": 5721224978, "node_id": "LA_kwDOBC3Cis8AAAABVQL3Eg", "url": "https://api.github.com/repos/vercel/next.js/labels/locked", "name": "locked", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignees": [], "milestone": null, "comments": 82, "created_at": "2023-03-14T11:13:10Z", "updated_at": "2024-05-01T18:49:46Z", "closed_at": "2024-02-26T16:35:12Z", "assignee": null, "author_association": "NONE", "type": null, "active_lock_reason": "resolved", "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### Verify canary release\n\n- [X] I verified that the issue exists in the latest Next.js canary release\n\n### Provide environment information\n\n```bash\nOperating System:\r\n      Platform: darwin\r\n      Arch: arm64\r\n      Version: Darwin Kernel Version 22.3.0: Mon Jan 30 20:38:37 PST 2023; root:xnu-8792.81.3~2/RELEASE_ARM64_T6000\r\n    Binaries:\r\n      Node: 18.14.0\r\n      npm: 9.3.1\r\n      Yarn: 1.22.19\r\n      pnpm: N/A\r\n    Relevant packages:\r\n      next: 13.2.5-canary.3\r\n      eslint-config-next: N/A\r\n      react: 18.2.0\r\n      react-dom: 18.2.0\n```\n\n\n### Which area(s) of Next.js are affected? (leave empty if unsure)\n\nFont optimization (@next/font)\n\n### Link to the code that reproduces this issue\n\nhttps://github.com/maxencerb/next-font-bug\n\n### To Reproduce\n\n```ts utils/fonts.ts\r\n// utils/fonts.ts\r\nimport { Unbounded } from 'next/font/google';\r\n\r\nexport const unbounded = Unbounded({\r\n  subsets: ['latin'],\r\n  display: 'swap',\r\n})\r\n```\r\n\r\n```tsx app/page.tsx\r\n// app/page.tsx\r\nimport { unbounded } from \"../utils/fonts\"\r\n\r\nexport default function Home() {\r\n  return (\r\n    <h1 className={unbounded.className}>TEST TITLE</h1>\r\n  )\r\n}\r\n```\n\n### Describe the Bug\n\n## Output\r\n\r\nOutput works as expected\r\n\r\n![image](https://user-images.githubusercontent.com/47566657/224982403-c0981374-36dc-491c-ad36-3fa306203dce.png)\r\n\r\n## Console Output\r\n\r\n```bash\r\nerror - Failed to find font override values for font `Unbounded`\r\n```\r\n\r\n## Explaination\r\n\r\nAll fallback font metrics from google are loaded from `next/font/google/get-fallback-font-override-metrics.ts` where we can see the following method and doc :\r\n\r\n```ts\r\n// @ts-ignore\r\nimport { calculateSizeAdjustValues } from 'next/dist/server/font-utils'\r\n// @ts-ignore\r\nimport * as Log from 'next/dist/build/output/log'\r\n\r\n/**\r\n * Get precalculated fallback font metrics for the Google Fonts family.\r\n *\r\n * TODO:\r\n * We might want to calculate these values with fontkit instead (like in next/font/local).\r\n * That way we don't have to update the precalculated values every time a new font is added to Google Fonts.\r\n */\r\nexport function getFallbackFontOverrideMetrics(fontFamily: string) {\r\n  try {\r\n    const { ascent, descent, lineGap, fallbackFont, sizeAdjust } =\r\n      calculateSizeAdjustValues(\r\n        require('next/dist/server/google-font-metrics.json')[fontFamily]\r\n      )\r\n    return {\r\n      fallbackFont,\r\n      ascentOverride: `${ascent}%`,\r\n      descentOverride: `${descent}%`,\r\n      lineGapOverride: `${lineGap}%`,\r\n      sizeAdjust: `${sizeAdjust}%`,\r\n    }\r\n  } catch {\r\n    Log.error(`Failed to find font override values for font \\`${fontFamily}\\``)\r\n  }\r\n}\r\n```\r\n\r\nSo I think there might be a fix but I don't really know how to implement it. I tried looking at the local font optimization code.\r\n\r\nMaybe someone can either find the solution to calculate the values with fontkit or at least update the json file under `next/src/server/google-font-metrics.json` and tell how to find those values.\n\n### Expected Behavior\n\nFind the font fallback for any google font\n\n### Which browser are you using? (if relevant)\n\n_No response_\n\n### How are you deploying your application? (if relevant)\n\n_No response_\n\n<sub>[NEXT-1192](https://linear.app/vercel/issue/NEXT-1192/failed-to-find-font-override-nextfontgoogle)</sub>", "closed_by": {"login": "samcx", "id": 28912696, "node_id": "MDQ6VXNlcjI4OTEyNjk2", "avatar_url": "https://avatars.githubusercontent.com/u/28912696?v=4", "gravatar_id": "", "url": "https://api.github.com/users/samcx", "html_url": "https://github.com/samcx", "followers_url": "https://api.github.com/users/samcx/followers", "following_url": "https://api.github.com/users/samcx/following{/other_user}", "gists_url": "https://api.github.com/users/samcx/gists{/gist_id}", "starred_url": "https://api.github.com/users/samcx/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/samcx/subscriptions", "organizations_url": "https://api.github.com/users/samcx/orgs", "repos_url": "https://api.github.com/users/samcx/repos", "events_url": "https://api.github.com/users/samcx/events{/privacy}", "received_events_url": "https://api.github.com/users/samcx/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/vercel/next.js/issues/47115/reactions", "total_count": 46, "+1": 46, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/vercel/next.js/issues/47115/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/vercel/next.js/issues/45080", "repository_url": "https://api.github.com/repos/vercel/next.js", "labels_url": "https://api.github.com/repos/vercel/next.js/issues/45080/labels{/name}", "comments_url": "https://api.github.com/repos/vercel/next.js/issues/45080/comments", "events_url": "https://api.github.com/repos/vercel/next.js/issues/45080/events", "html_url": "https://github.com/vercel/next.js/issues/45080", "id": 1550588569, "node_id": "I_kwDOBC3Cis5cbBqZ", "number": 45080, "title": "Error 'Failed to fetch `Noto Sans JP` from Google Fonts.'", "user": {"login": "max-ch9i", "id": 1893149, "node_id": "MDQ6VXNlcjE4OTMxNDk=", "avatar_url": "https://avatars.githubusercontent.com/u/1893149?v=4", "gravatar_id": "", "url": "https://api.github.com/users/max-ch9i", "html_url": "https://github.com/max-ch9i", "followers_url": "https://api.github.com/users/max-ch9i/followers", "following_url": "https://api.github.com/users/max-ch9i/following{/other_user}", "gists_url": "https://api.github.com/users/max-ch9i/gists{/gist_id}", "starred_url": "https://api.github.com/users/max-ch9i/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/max-ch9i/subscriptions", "organizations_url": "https://api.github.com/users/max-ch9i/orgs", "repos_url": "https://api.github.com/users/max-ch9i/repos", "events_url": "https://api.github.com/users/max-ch9i/events{/privacy}", "received_events_url": "https://api.github.com/users/max-ch9i/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 2471906168, "node_id": "MDU6TGFiZWwyNDcxOTA2MTY4", "url": "https://api.github.com/repos/vercel/next.js/labels/bug", "name": "bug", "color": "fddf99", "default": true, "description": "Issue was opened via the bug report template."}, {"id": 5721224978, "node_id": "LA_kwDOBC3Cis8AAAABVQL3Eg", "url": "https://api.github.com/repos/vercel/next.js/labels/locked", "name": "locked", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignees": [], "milestone": null, "comments": 82, "created_at": "2023-01-20T10:03:03Z", "updated_at": "2023-09-03T12:01:28Z", "closed_at": "2023-06-28T05:48:12Z", "assignee": null, "author_association": "NONE", "type": null, "active_lock_reason": "resolved", "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### Verify canary release\r\n\r\n- [X] I verified that the issue exists in the latest Next.js canary release\r\n\r\n### Provide environment information\r\n\r\n\r\n    Operating System:\r\n      Platform: linux\r\n      Arch: x64\r\n      Version: Ubuntu 20.04.0 LTS Fri Jan 20 2023 09:56:57 GMT+0000 (Greenwich Mean Time)\r\n    Binaries:\r\n      Node: 16.14.2\r\n      npm: 7.17.0\r\n      Yarn: 1.22.19\r\n      pnpm: 7.13.6\r\n    Relevant packages:\r\n      next: 13.1.3\r\n      eslint-config-next: N/A\r\n      react: 18.2.0\r\n      react-dom: 18.2.0\r\n\r\n### Which area(s) of Next.js are affected? (leave empty if unsure)\r\n\r\nFont optimization (@next/font)\r\n\r\n### Link to the code that reproduces this issue\r\n\r\nhttps://stackblitz.com/edit/nextjs-qcjltu?file=app%2Fpage.js,package.json\r\n\r\n### To Reproduce\r\n\r\nTo reproduce, run `npm run build`.\r\n\r\n### Describe the Bug\r\n\r\nFont input is\r\n```\r\nimport { Noto_Sans_JP } from '@next/font/google';\r\n\r\nconst notoSansJapanese = Noto_Sans_JP({\r\n  weight: '400',\r\n  preload: false,\r\n});\r\n```\r\nresults in\r\n```\r\nFailed to compile.\r\n\r\napp/page.js\r\n`@next/font` error:\r\nFailed to fetch `Noto Sans JP` from Google Fonts.\r\n```\r\n\r\nPossibly related to https://github.com/vercel/next.js/pull/44594\r\nand https://github.com/vercel/next.js/commit/5f2c9d0b301588cec60c3bfb6b36cb7ece787659\r\n\r\n### Expected Behavior\r\n\r\nCompiles successfully.\r\n", "closed_by": {"login": "shuding", "id": 3676859, "node_id": "MDQ6VXNlcjM2NzY4NTk=", "avatar_url": "https://avatars.githubusercontent.com/u/3676859?v=4", "gravatar_id": "", "url": "https://api.github.com/users/shuding", "html_url": "https://github.com/shuding", "followers_url": "https://api.github.com/users/shuding/followers", "following_url": "https://api.github.com/users/shuding/following{/other_user}", "gists_url": "https://api.github.com/users/shuding/gists{/gist_id}", "starred_url": "https://api.github.com/users/shuding/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/shuding/subscriptions", "organizations_url": "https://api.github.com/users/shuding/orgs", "repos_url": "https://api.github.com/users/shuding/repos", "events_url": "https://api.github.com/users/shuding/events{/privacy}", "received_events_url": "https://api.github.com/users/shuding/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/vercel/next.js/issues/45080/reactions", "total_count": 42, "+1": 42, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/vercel/next.js/issues/45080/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/vercel/next.js/issues/56018", "repository_url": "https://api.github.com/repos/vercel/next.js", "labels_url": "https://api.github.com/repos/vercel/next.js/issues/56018/labels{/name}", "comments_url": "https://api.github.com/repos/vercel/next.js/issues/56018/comments", "events_url": "https://api.github.com/repos/vercel/next.js/issues/56018/events", "html_url": "https://github.com/vercel/next.js/issues/56018", "id": 1913481427, "node_id": "I_kwDOBC3Cis5yDWjT", "number": 56018, "title": "Routes using data fetching methods return 304 on non-conditional requests", "user": {"login": "kevineinarsson", "id": 38074925, "node_id": "MDQ6VXNlcjM4MDc0OTI1", "avatar_url": "https://avatars.githubusercontent.com/u/38074925?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kevineinarsson", "html_url": "https://github.com/kevineinarsson", "followers_url": "https://api.github.com/users/kevineinarsson/followers", "following_url": "https://api.github.com/users/kevineinarsson/following{/other_user}", "gists_url": "https://api.github.com/users/kevineinarsson/gists{/gist_id}", "starred_url": "https://api.github.com/users/kevineinarsson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kevineinarsson/subscriptions", "organizations_url": "https://api.github.com/users/kevineinarsson/orgs", "repos_url": "https://api.github.com/users/kevineinarsson/repos", "events_url": "https://api.github.com/users/kevineinarsson/events{/privacy}", "received_events_url": "https://api.github.com/users/kevineinarsson/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 2471906168, "node_id": "MDU6TGFiZWwyNDcxOTA2MTY4", "url": "https://api.github.com/repos/vercel/next.js/labels/bug", "name": "bug", "color": "fddf99", "default": true, "description": "Issue was opened via the bug report template."}, {"id": 4932840687, "node_id": "LA_kwDOBC3Cis8AAAABJgUs7w", "url": "https://api.github.com/repos/vercel/next.js/labels/linear:%20next", "name": "linear: next", "color": "A53EF5", "default": false, "description": "Confirmed issue that is tracked by the Next.js team."}, {"id": 5721224978, "node_id": "LA_kwDOBC3Cis8AAAABVQL3Eg", "url": "https://api.github.com/repos/vercel/next.js/labels/locked", "name": "locked", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignees": [], "milestone": null, "comments": 80, "created_at": "2023-09-26T13:10:14Z", "updated_at": "2024-02-14T00:03:45Z", "closed_at": "2024-01-30T17:01:43Z", "assignee": null, "author_association": "NONE", "type": null, "active_lock_reason": "resolved", "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### Link to the code that reproduces this issue\r\n\r\nhttps://github.com/kevineinarsson/next-revalidate-issue\r\n\r\n### To Reproduce\r\n\r\n1. Start the application in production mode (build & start)\r\n\r\n2. Curl one of the routes:\r\n```\r\ncurl -I http://localhost:3000 (static)\r\ncurl -I http://localhost:3000/1 (dynamic)\r\n```\r\nThese should return 200:s, no matter how many times you curl. Note the x-nextjs-cache header which indicates whether a revalidation of the content is performed (due to fetch options including `next: { revalidate: 5 }`)\r\n\r\n```\r\ncurl -I http://localhost:3000 -H 'If-None-Match: \"<etag from previous request>\"'\r\ncurl -I http://localhost:3000/1 -H 'If-None-Match: \"<etag from previous request>\"'\r\n```\r\nThis should return a 304, since we're matching against an ETag and the content matches.\r\n\r\nHowever, if a revalidation occurs from a request that includes a If-None-Match header, the `.meta` will now contain `status: 304`, causing subsequent requests without an ETag to return 304 not modified, which should not happen.\r\n\r\n### Current vs. Expected behavior\r\n\r\nCache updates should not store conditional headers such as 304. The result of the operations above should be a 200 in the metadata file.\r\n\r\n### Verify canary release\r\n\r\n- [X] I verified that the issue exists in the latest Next.js canary release\r\n\r\n### Provide environment information\r\n\r\n```bash\r\nOperating System:\r\n  Platform: linux\r\n  Arch: x64\r\n  Version: #1 SMP Fri Jan 27 02:56:13 UTC 2023\r\nBinaries:\r\n  Node: 20.6.1\r\n  npm: 10.1.0\r\n  Yarn: 1.22.19\r\n  pnpm: 8.7.5\r\nRelevant Packages:\r\n  next: 13.5.4\r\n  eslint-config-next: N/A\r\n  react: 18.2.0\r\n  react-dom: 18.2.0\r\n  typescript: 5.1.3\r\nNext.js Config:\r\n  output: N/A\r\n```\r\n\r\n\r\n### Which area(s) are affected? (Select all that apply)\r\n\r\nNot sure\r\n\r\n### Additional context\r\n\r\nIssue does not appear on 13.4.17.\r\n\r\nIn dynamic routes, removing `generateStaticParams()` makes the problem disappear, but doing so leads to a response without an ETag.\r\nUsing `export const dynamic = 'force-dynamic';` works for static pages, but of course makes them dynamic.\n\n<sub>[NEXT-1699](https://linear.app/vercel/issue/NEXT-1699/routes-using-data-fetching-methods-return-304-on-non-conditional)</sub>", "closed_by": {"login": "samcx", "id": 28912696, "node_id": "MDQ6VXNlcjI4OTEyNjk2", "avatar_url": "https://avatars.githubusercontent.com/u/28912696?v=4", "gravatar_id": "", "url": "https://api.github.com/users/samcx", "html_url": "https://github.com/samcx", "followers_url": "https://api.github.com/users/samcx/followers", "following_url": "https://api.github.com/users/samcx/following{/other_user}", "gists_url": "https://api.github.com/users/samcx/gists{/gist_id}", "starred_url": "https://api.github.com/users/samcx/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/samcx/subscriptions", "organizations_url": "https://api.github.com/users/samcx/orgs", "repos_url": "https://api.github.com/users/samcx/repos", "events_url": "https://api.github.com/users/samcx/events{/privacy}", "received_events_url": "https://api.github.com/users/samcx/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/vercel/next.js/issues/56018/reactions", "total_count": 66, "+1": 64, "-1": 0, "laugh": 0, "hooray": 0, "confused": 2, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/vercel/next.js/issues/56018/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/vercel/next.js/issues/49387", "repository_url": "https://api.github.com/repos/vercel/next.js", "labels_url": "https://api.github.com/repos/vercel/next.js/issues/49387/labels{/name}", "comments_url": "https://api.github.com/repos/vercel/next.js/issues/49387/comments", "events_url": "https://api.github.com/repos/vercel/next.js/issues/49387/events", "html_url": "https://github.com/vercel/next.js/issues/49387", "id": 1698886983, "node_id": "I_kwDOBC3Cis5lQvVH", "number": 49387, "title": "[NEXT-1186] revalidatePath not working for dynamic routes while res.revalidate works fine", "user": {"login": "roxizhauk", "id": 85798103, "node_id": "MDQ6VXNlcjg1Nzk4MTAz", "avatar_url": "https://avatars.githubusercontent.com/u/85798103?v=4", "gravatar_id": "", "url": "https://api.github.com/users/roxizhauk", "html_url": "https://github.com/roxizhauk", "followers_url": "https://api.github.com/users/roxizhauk/followers", "following_url": "https://api.github.com/users/roxizhauk/following{/other_user}", "gists_url": "https://api.github.com/users/roxizhauk/gists{/gist_id}", "starred_url": "https://api.github.com/users/roxizhauk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/roxizhauk/subscriptions", "organizations_url": "https://api.github.com/users/roxizhauk/orgs", "repos_url": "https://api.github.com/users/roxizhauk/repos", "events_url": "https://api.github.com/users/roxizhauk/events{/privacy}", "received_events_url": "https://api.github.com/users/roxizhauk/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 2471906168, "node_id": "MDU6TGFiZWwyNDcxOTA2MTY4", "url": "https://api.github.com/repos/vercel/next.js/labels/bug", "name": "bug", "color": "fddf99", "default": true, "description": "Issue was opened via the bug report template."}, {"id": 4932840687, "node_id": "LA_kwDOBC3Cis8AAAABJgUs7w", "url": "https://api.github.com/repos/vercel/next.js/labels/linear:%20next", "name": "linear: next", "color": "A53EF5", "default": false, "description": "Confirmed issue that is tracked by the Next.js team."}, {"id": 5721224978, "node_id": "LA_kwDOBC3Cis8AAAABVQL3Eg", "url": "https://api.github.com/repos/vercel/next.js/labels/locked", "name": "locked", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignees": [], "milestone": null, "comments": 76, "created_at": "2023-05-07T04:32:50Z", "updated_at": "2023-10-28T00:03:59Z", "closed_at": "2023-09-12T18:28:18Z", "assignee": null, "author_association": "NONE", "type": null, "active_lock_reason": "resolved", "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### Verify canary release\n\n* [X] I verified that the issue exists in the latest Next.js canary release\n\n### Provide environment information\n\n```\n    Operating System:\n      Platform: darwin\n      Arch: x64\n      Version: Darwin Kernel Version 22.5.0: Mon Apr 24 20:51:50 PDT 2023; root:xnu-8796.121.2~5/RELEASE_X86_64\n    Binaries:\n      Node: 16.17.1\n      npm: 8.19.2\n      Yarn: N/A\n      pnpm: N/A\n    Relevant packages:\n      next: 13.4.7-canary.1\n      eslint-config-next: N/A\n      react: 18.2.0\n      react-dom: 18.2.0\n      typescript: 5.1.3\n```\n\n### Which area(s) of Next.js are affected? (leave empty if unsure)\n\nApp directory (appDir: true)\n\n### Link to the code that reproduces this issue\n\n[https://github.com/roxizhauk/revalidate-path](https://github.com/roxizhauk/revalidate-path)\n[CodeSandBox](https://codesandbox.io/p/github/roxizhauk/revalidate-path/main?layout=%257B%2522sidebarPanel%2522%253A%2522EXPLORER%2522%252C%2522rootPanelGroup%2522%253A%257B%2522direction%2522%253A%2522horizontal%2522%252C%2522type%2522%253A%2522PANEL_GROUP%2522%252C%2522id%2522%253A%2522ROOT_LAYOUT%2522%252C%2522panels%2522%253A%255B%257B%2522type%2522%253A%2522PANEL_GROUP%2522%252C%2522direction%2522%253A%2522horizontal%2522%252C%2522id%2522%253A%2522EDITOR%2522%252C%2522panels%2522%253A%255B%257B%2522type%2522%253A%2522PANEL%2522%252C%2522panelType%2522%253A%2522TABS%2522%252C%2522id%2522%253A%2522clj2ntadl000b3b6maz3vfr5a%2522%257D%255D%252C%2522sizes%2522%253A%255B100%255D%257D%252C%257B%2522type%2522%253A%2522PANEL_GROUP%2522%252C%2522direction%2522%253A%2522horizontal%2522%252C%2522id%2522%253A%2522DEVTOOLS%2522%252C%2522panels%2522%253A%255B%257B%2522type%2522%253A%2522PANEL%2522%252C%2522panelType%2522%253A%2522TABS%2522%252C%2522id%2522%253A%2522clj2okkxn01fz3b6mc42extf2%2522%257D%255D%252C%2522sizes%2522%253A%255B100%255D%257D%255D%252C%2522sizes%2522%253A%255B50%252C50%255D%257D%252C%2522tabbedPanels%2522%253A%257B%2522clj2ntadl000b3b6maz3vfr5a%2522%253A%257B%2522id%2522%253A%2522clj2ntadl000b3b6maz3vfr5a%2522%252C%2522activeTabId%2522%253A%2522clj2os9v900tj3b6mte0hpxrj%2522%252C%2522tabs%2522%253A%255B%257B%2522id%2522%253A%2522clj2os9v900tj3b6mte0hpxrj%2522%252C%2522mode%2522%253A%2522permanent%2522%252C%2522type%2522%253A%2522TASK_LOG%2522%252C%2522taskId%2522%253A%2522build%2522%257D%255D%257D%252C%2522clj2okkxn01fz3b6mc42extf2%2522%253A%257B%2522id%2522%253A%2522clj2okkxn01fz3b6mc42extf2%2522%252C%2522activeTabId%2522%253A%2522clj2ovwh201li3b6mii003kwn%2522%252C%2522tabs%2522%253A%255B%257B%2522id%2522%253A%2522clj2ot82e017a3b6m59llreux%2522%252C%2522mode%2522%253A%2522permanent%2522%252C%2522type%2522%253A%2522TASK_LOG%2522%252C%2522taskId%2522%253A%2522start%2522%257D%252C%257B%2522type%2522%253A%2522TASK_PORT%2522%252C%2522taskId%2522%253A%2522start%2522%252C%2522port%2522%253A3000%252C%2522id%2522%253A%2522clj2ovwh201li3b6mii003kwn%2522%252C%2522mode%2522%253A%2522permanent%2522%252C%2522path%2522%253A%2522%252Fblog%252Ftest%2522%257D%255D%257D%257D%252C%2522showDevtools%2522%253Atrue%252C%2522showSidebar%2522%253Atrue%252C%2522sidebarPanelSize%2522%253A15%257D)\n\n### To Reproduce\n\nVisit `/blog/[anything]` (e.g. `/blog/test` ) to generate a dynamic page and check the time shown\n\nTo try \"unsuccessful\" app directory's `revalidatePath`:\n\n1. hit `/api/revalidate-path?path=/blog/[anything]` and you'll see \"revalidated\"\n2. refresh `/blog/[anything]` and you'll see the time not changed\n\nTo try \"successful\" pages directory's `res.revalidate`:\n\n1. hit `/api/revalidate?path=/blog/[anything]` and you'll see \"revalidated\"\n2. refresh `/blog/[anything]` and you'll see the time changed\n\n### Describe the Bug\n\nThe app directory's `revalidatePath` works fine for \"/\" or \"/blog\" but dynamic routes like \"/blog/1\" or \"/blog/test\" while pages directory's `res.revalidate` works fine for all\n\n### Expected Behavior\n\n`revalidatePath` works the same as `res.revalidate` for dynamic routes\n\n### Which browser are you using? (if relevant)\n\n*No response*\n\n### How are you deploying your application? (if relevant)\n\n*No response*\n\n<sub>From [SyncLinear.com](https://synclinear.com) | [NEXT-1186](https://linear.app/vercel/issue/NEXT-1186/revalidatepath-not-working-for-dynamic-routes-while-resrevalidate)</sub>", "closed_by": {"login": "ijjk", "id": 22380829, "node_id": "MDQ6VXNlcjIyMzgwODI5", "avatar_url": "https://avatars.githubusercontent.com/u/22380829?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ijjk", "html_url": "https://github.com/ijjk", "followers_url": "https://api.github.com/users/ijjk/followers", "following_url": "https://api.github.com/users/ijjk/following{/other_user}", "gists_url": "https://api.github.com/users/ijjk/gists{/gist_id}", "starred_url": "https://api.github.com/users/ijjk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ijjk/subscriptions", "organizations_url": "https://api.github.com/users/ijjk/orgs", "repos_url": "https://api.github.com/users/ijjk/repos", "events_url": "https://api.github.com/users/ijjk/events{/privacy}", "received_events_url": "https://api.github.com/users/ijjk/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/vercel/next.js/issues/49387/reactions", "total_count": 29, "+1": 29, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/vercel/next.js/issues/49387/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/vercel/next.js/issues/44062", "repository_url": "https://api.github.com/repos/vercel/next.js", "labels_url": "https://api.github.com/repos/vercel/next.js/issues/44062/labels{/name}", "comments_url": "https://api.github.com/repos/vercel/next.js/issues/44062/comments", "events_url": "https://api.github.com/repos/vercel/next.js/issues/44062/events", "html_url": "https://github.com/vercel/next.js/issues/44062", "id": 1498888464, "node_id": "I_kwDOBC3Cis5ZVzkQ", "number": 44062, "title": "[NEXT-1190]  TypeError: fetch failed in server componant since next 13.0.6", "user": {"login": "sylvain-guehria", "id": 51234823, "node_id": "MDQ6VXNlcjUxMjM0ODIz", "avatar_url": "https://avatars.githubusercontent.com/u/51234823?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sylvain-guehria", "html_url": "https://github.com/sylvain-guehria", "followers_url": "https://api.github.com/users/sylvain-guehria/followers", "following_url": "https://api.github.com/users/sylvain-guehria/following{/other_user}", "gists_url": "https://api.github.com/users/sylvain-guehria/gists{/gist_id}", "starred_url": "https://api.github.com/users/sylvain-guehria/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sylvain-guehria/subscriptions", "organizations_url": "https://api.github.com/users/sylvain-guehria/orgs", "repos_url": "https://api.github.com/users/sylvain-guehria/repos", "events_url": "https://api.github.com/users/sylvain-guehria/events{/privacy}", "received_events_url": "https://api.github.com/users/sylvain-guehria/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 2471906168, "node_id": "MDU6TGFiZWwyNDcxOTA2MTY4", "url": "https://api.github.com/repos/vercel/next.js/labels/bug", "name": "bug", "color": "fddf99", "default": true, "description": "Issue was opened via the bug report template."}, {"id": 4932840687, "node_id": "LA_kwDOBC3Cis8AAAABJgUs7w", "url": "https://api.github.com/repos/vercel/next.js/labels/linear:%20next", "name": "linear: next", "color": "A53EF5", "default": false, "description": "Confirmed issue that is tracked by the Next.js team."}, {"id": 5721224978, "node_id": "LA_kwDOBC3Cis8AAAABVQL3Eg", "url": "https://api.github.com/repos/vercel/next.js/labels/locked", "name": "locked", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": true, "assignees": [], "milestone": null, "comments": 75, "created_at": "2022-12-15T18:18:57Z", "updated_at": "2023-08-15T12:02:44Z", "closed_at": "2023-07-27T15:11:09Z", "assignee": null, "author_association": "NONE", "type": null, "active_lock_reason": "resolved", "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### Verify canary release\n\n- [X] I verified that the issue exists in the latest Next.js canary release\n\n### Provide environment information\n\nOperating System:\r\n      Platform: linux\r\n      Arch: x64\r\n      Version: #62-Ubuntu SMP Tue Nov 22 19:54:14 UTC 2022\r\n    Binaries:\r\n      Node: 18.12.0\r\n      npm: 8.19.2\r\n      Yarn: 1.22.19\r\n      pnpm: N/A\r\n    Relevant packages:\r\n      next: 13.0.6\r\n      eslint-config-next: 13.0.0\r\n      react: 18.2.0\r\n      react-dom: 18.2.0\r\n\n\n### Which area(s) of Next.js are affected? (leave empty if unsure)\n\nData fetching (gS(S)P, getInitialProps)\n\n### Link to the code that reproduces this issue\n\nhttps://github.com/sylvain-guehria/StockShop\n\n### To Reproduce\n\nI log here : https://inventory-market.vercel.app/ and that it's\n\n### Describe the Bug\n\nwhen I log, a server componant fetch data. This was working this morning but after installing next 13.0.6 I got this error only in prod :\r\n\r\nerror validating user TypeError: fetch failed\r\n    at Object.fetch (/var/task/node_modules/next/dist/compiled/undici/index.js:1:26684)\r\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)\r\n    at async validateUser (/var/task/.next/server/app/page.js:740:21)\r\n    at async HomePage (/var/task/.next/server/app/page.js:674:17) {\r\n  cause: TypeError: Cannot read properties of undefined (reading 'reason')\r\n      at makeAppropriateNetworkError (/var/task/node_modules/next/dist/compiled/undici/index.js:2:54604)\r\n      at schemeFetch (/var/task/node_modules/next/dist/compiled/undici/index.js:2:30000)\r\n      at /var/task/node_modules/next/dist/compiled/undici/index.js:2:28607\r\n      at mainFetch (/var/task/node_modules/next/dist/compiled/undici/index.js:2:29007)\r\n      at httpRedirectFetch (/var/task/node_modules/next/dist/compiled/undici/index.js:2:33708)\r\n      at httpFetch (/var/task/node_modules/next/dist/compiled/undici/index.js:2:32580)\r\n      at processTicksAndRejections (node:internal/process/task_queues:96:5)\r\n      at async schemeFetch (/var/task/node_modules/next/dist/compiled/undici/index.js:2:30793)\r\n      at async /var/task/node_modules/next/dist/compiled/undici/index.js:2:28601\r\n      at async mainFetch (/var/task/node_modules/next/dist/compiled/undici/index.js:2:28426)\r\n} \n\n### Expected Behavior\n\nno fetch error, either the result is null or a string. \n\n### Which browser are you using? (if relevant)\n\nchrome\n\n### How are you deploying your application? (if relevant)\n\nvercel\n\n<sub>[NEXT-1190](https://linear.app/vercel/issue/NEXT-1190/typeerror-fetch-failed-in-server-componant-since-next-1306)</sub>", "closed_by": {"login": "ztanner", "id": 1939140, "node_id": "MDQ6VXNlcjE5MzkxNDA=", "avatar_url": "https://avatars.githubusercontent.com/u/1939140?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ztanner", "html_url": "https://github.com/ztanner", "followers_url": "https://api.github.com/users/ztanner/followers", "following_url": "https://api.github.com/users/ztanner/following{/other_user}", "gists_url": "https://api.github.com/users/ztanner/gists{/gist_id}", "starred_url": "https://api.github.com/users/ztanner/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ztanner/subscriptions", "organizations_url": "https://api.github.com/users/ztanner/orgs", "repos_url": "https://api.github.com/users/ztanner/repos", "events_url": "https://api.github.com/users/ztanner/events{/privacy}", "received_events_url": "https://api.github.com/users/ztanner/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/vercel/next.js/issues/44062/reactions", "total_count": 16, "+1": 12, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 4}, "timeline_url": "https://api.github.com/repos/vercel/next.js/issues/44062/timeline", "performed_via_github_app": null, "state_reason": "not_planned", "pinned_comment": null}, {"url": "https://api.github.com/repos/vercel/next.js/issues/49087", "repository_url": "https://api.github.com/repos/vercel/next.js", "labels_url": "https://api.github.com/repos/vercel/next.js/issues/49087/labels{/name}", "comments_url": "https://api.github.com/repos/vercel/next.js/issues/49087/comments", "events_url": "https://api.github.com/repos/vercel/next.js/issues/49087/events", "html_url": "https://github.com/vercel/next.js/issues/49087", "id": 1692331646, "node_id": "I_kwDOBC3Cis5k3u5-", "number": 49087, "title": "[NEXT-1147] Scroll position is reset when search params are updated", "user": {"login": "benjaminwaterlot", "id": 32556322, "node_id": "MDQ6VXNlcjMyNTU2MzIy", "avatar_url": "https://avatars.githubusercontent.com/u/32556322?v=4", "gravatar_id": "", "url": "https://api.github.com/users/benjaminwaterlot", "html_url": "https://github.com/benjaminwaterlot", "followers_url": "https://api.github.com/users/benjaminwaterlot/followers", "following_url": "https://api.github.com/users/benjaminwaterlot/following{/other_user}", "gists_url": "https://api.github.com/users/benjaminwaterlot/gists{/gist_id}", "starred_url": "https://api.github.com/users/benjaminwaterlot/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/benjaminwaterlot/subscriptions", "organizations_url": "https://api.github.com/users/benjaminwaterlot/orgs", "repos_url": "https://api.github.com/users/benjaminwaterlot/repos", "events_url": "https://api.github.com/users/benjaminwaterlot/events{/privacy}", "received_events_url": "https://api.github.com/users/benjaminwaterlot/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 2471906168, "node_id": "MDU6TGFiZWwyNDcxOTA2MTY4", "url": "https://api.github.com/repos/vercel/next.js/labels/bug", "name": "bug", "color": "fddf99", "default": true, "description": "Issue was opened via the bug report template."}, {"id": 4932840687, "node_id": "LA_kwDOBC3Cis8AAAABJgUs7w", "url": "https://api.github.com/repos/vercel/next.js/labels/linear:%20next", "name": "linear: next", "color": "A53EF5", "default": false, "description": "Confirmed issue that is tracked by the Next.js team."}], "state": "closed", "locked": true, "assignees": [], "milestone": null, "comments": 73, "created_at": "2023-05-02T12:27:19Z", "updated_at": "2024-01-02T23:44:01Z", "closed_at": "2024-01-02T23:44:01Z", "assignee": null, "author_association": "NONE", "type": null, "active_lock_reason": "spam", "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### Verify canary release\r\n\r\n- [X] I verified that the issue exists in the latest Next.js canary release\r\n\r\n### Provide environment information\r\n\r\n```bash\r\nNext.js `13.3.5-canary.2`\r\n```\r\n\r\n\r\n### Link to the code that reproduces this issue\r\n\r\nhttps://codesandbox.io/p/sandbox/modest-gould-h4nlvd?file=%2Fapp%2Fpage.tsx&selection=%5B%7B%22endColumn%22%3A1%2C%22endLineNumber%22%3A7%2C%22startColumn%22%3A1%2C%22startLineNumber%22%3A7%7D%5D\r\n\r\n### To Reproduce\r\n\r\n* Click the counter to update client state. \r\n* Scroll a little.\r\n* Click the second button to update search params.\r\n* The client state is preserved, but the scroll position is lost.\r\n\r\n### Describe the Bug\r\n\r\n### Context\r\n\r\nIn Next <= 13.2.4, updating search params was working as intended : client state was kept, and scroll position was kept too.\r\n\r\nIn Next 13.2.5, a regression made the client components unmount and remount when search params were updated.\r\n\r\n@feedthejim fixed that unmounting in https://github.com/vercel/next.js/pull/49047 (it's testable on `13.3.5-canary.2`), but **there is still an issue now: scroll position is lost on search params updates**.\r\n\r\n**Problem**: persisting state in search params is very important with the App router - that's a clean way for client components to request updated data from the RSC.\r\n\r\n\r\n### Reproduction Codesandbox\r\n\r\nHere's a codesandbox reproducing the bug:\r\n\r\nhttps://codesandbox.io/p/sandbox/modest-gould-h4nlvd?file=%2Fapp%2Fpage.tsx&selection=%5B%7B%22endColumn%22%3A1%2C%22endLineNumber%22%3A7%2C%22startColumn%22%3A1%2C%22startLineNumber%22%3A7%7D%5D\r\n\r\n\r\n### In video\r\n\r\n\r\nhttps://user-images.githubusercontent.com/32556322/235664370-77bc7e4a-daaa-4615-9db7-094640873c33.mp4\r\n\r\n\r\n### A real-world example of the problem\r\n\r\n_Previously, the \"name for the fund\", kept in client state, was reset when updating the sliders. It's now better, but the scroll position reset is still awkward._\r\n\r\nhttps://user-images.githubusercontent.com/32556322/235666855-98472456-121a-4f80-a80d-c4e1eda70aaa.mp4\r\n\r\n\r\n\r\n### Expected Behavior\r\n\r\nWhen updating search params, the scroll position should be preserved.\r\n\r\n### Which browser are you using? (if relevant)\r\n\r\nLatest stable Google Chrome\r\n\r\n### How are you deploying your application? (if relevant)\r\n\r\n_No response_\n\n<sub>[NEXT-1147](https://linear.app/vercel/issue/NEXT-1147/scroll-position-is-reset-when-search-params-are-updated)</sub>", "closed_by": {"login": "leerob", "id": 9113740, "node_id": "MDQ6VXNlcjkxMTM3NDA=", "avatar_url": "https://avatars.githubusercontent.com/u/9113740?v=4", "gravatar_id": "", "url": "https://api.github.com/users/leerob", "html_url": "https://github.com/leerob", "followers_url": "https://api.github.com/users/leerob/followers", "following_url": "https://api.github.com/users/leerob/following{/other_user}", "gists_url": "https://api.github.com/users/leerob/gists{/gist_id}", "starred_url": "https://api.github.com/users/leerob/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/leerob/subscriptions", "organizations_url": "https://api.github.com/users/leerob/orgs", "repos_url": "https://api.github.com/users/leerob/repos", "events_url": "https://api.github.com/users/leerob/events{/privacy}", "received_events_url": "https://api.github.com/users/leerob/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/vercel/next.js/issues/49087/reactions", "total_count": 98, "+1": 81, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 17}, "timeline_url": "https://api.github.com/repos/vercel/next.js/issues/49087/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/vercel/next.js/issues/37825", "repository_url": "https://api.github.com/repos/vercel/next.js", "labels_url": "https://api.github.com/repos/vercel/next.js/issues/37825/labels{/name}", "comments_url": "https://api.github.com/repos/vercel/next.js/issues/37825/comments", "events_url": "https://api.github.com/repos/vercel/next.js/issues/37825/events", "html_url": "https://github.com/vercel/next.js/issues/37825", "id": 1276107008, "node_id": "I_kwDOBC3Cis5MD9kA", "number": 37825, "title": "Stuck on `Creating an optimized production build` forever when development server is running", "user": {"login": "YassinEldeeb", "id": 72823042, "node_id": "MDQ6VXNlcjcyODIzMDQy", "avatar_url": "https://avatars.githubusercontent.com/u/72823042?v=4", "gravatar_id": "", "url": "https://api.github.com/users/YassinEldeeb", "html_url": "https://github.com/YassinEldeeb", "followers_url": "https://api.github.com/users/YassinEldeeb/followers", "following_url": "https://api.github.com/users/YassinEldeeb/following{/other_user}", "gists_url": "https://api.github.com/users/YassinEldeeb/gists{/gist_id}", "starred_url": "https://api.github.com/users/YassinEldeeb/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/YassinEldeeb/subscriptions", "organizations_url": "https://api.github.com/users/YassinEldeeb/orgs", "repos_url": "https://api.github.com/users/YassinEldeeb/repos", "events_url": "https://api.github.com/users/YassinEldeeb/events{/privacy}", "received_events_url": "https://api.github.com/users/YassinEldeeb/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 2471906168, "node_id": "MDU6TGFiZWwyNDcxOTA2MTY4", "url": "https://api.github.com/repos/vercel/next.js/labels/bug", "name": "bug", "color": "fddf99", "default": true, "description": "Issue was opened via the bug report template."}], "state": "closed", "locked": true, "assignees": [], "milestone": null, "comments": 73, "created_at": "2022-06-19T16:20:41Z", "updated_at": "2024-01-02T23:58:10Z", "closed_at": "2024-01-02T23:58:10Z", "assignee": null, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### Verify canary release\n\n- [x] I verified that the issue exists in Next.js canary release\n\n### Provide environment information\n\n  Operating System:\r\n      Platform: win32\r\n      Arch: x64\r\n      Version: Windows 10 Pro\r\n    Binaries:\r\n      Node: 16.13.0\r\n      npm: N/A\r\n      Yarn: N/A\r\n      pnpm: 6.24.0-1\r\n    Relevant packages:\r\n      next: 12.1.4\r\n      react: 17.0.2\r\n      react-dom: 17.0.2\r\n\n\n### What browser are you using? (if relevant)\n\n_No response_\n\n### How are you deploying your application? (if relevant)\n\n_No response_\n\n### Describe the Bug\n\nI had my development server running in the background without me remembering and I wanted to build my app using `next build`, that's what I've got:\r\n```sh\r\n$ yarn next build\r\nyarn run v1.22.17\r\n$ C:\\development\\activity-builder\\node_modules\\.bin\\next build\r\ninfo  - Loaded env from C:\\development\\activity-builder\\.env\r\ninfo  - Checking validity of types  \r\nwarn  - The Next.js plugin was not detected in your ESLint configuration. See https://nextjs.org/docs/basic-features/eslint#migrating-existing-config\r\n\r\n./src/components/Activities/ActivityQuestions/DynamicQuestionTypes/MultipleChoice.tsx  \r\n68:40  Warning: Forbidden non-null assertion.  @typescript-eslint/no-non-null-assertion\r\n69:22  Warning: Forbidden non-null assertion.  @typescript-eslint/no-non-null-assertion\r\n\r\n./src/components/Activities/ActivityQuestions/Question.tsx\r\n102:13  Warning: Unexpected console statement.  no-console\r\n\r\ninfo  - Need to disable some ESLint rules? Learn more here: https://nextjs.org/docs/basic-features/eslint#disabling-rules\r\ninfo  - Creating an optimized production build  \r\n```\r\n\r\nAnd I was stuck for 30 minutes on `info  - Creating an optimized production build` without any indication of anything being wrong, I noticed that the development server was running, after I've shut it down and ran `next build` again It compiled successfully.\n\n### Expected Behavior\n\n- Run `next build` to compile the app for production even when I'm running the development server.\r\n\r\n     OR\r\n\r\n- Notify me that the development server is running and needs to be shut down before running `next build`, that's in case running `next build` when `next` is running isn't possible.\r\n\n\n### Link to reproduction\n\nhttps://github.com/YassinEldeeb/Next.js-starter\n\n### To Reproduce\n\n1. Run `next` for the development server.\r\n2. Then run `next build` while the development server is running.\r\n\r\nNote: It's not specific to the repository linked above.", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/vercel/next.js/issues/37825/reactions", "total_count": 30, "+1": 30, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/vercel/next.js/issues/37825/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/vercel/next.js/issues/51605", "repository_url": "https://api.github.com/repos/vercel/next.js", "labels_url": "https://api.github.com/repos/vercel/next.js/issues/51605/labels{/name}", "comments_url": "https://api.github.com/repos/vercel/next.js/issues/51605/comments", "events_url": "https://api.github.com/repos/vercel/next.js/issues/51605/events", "html_url": "https://github.com/vercel/next.js/issues/51605", "id": 1767224883, "node_id": "I_kwDOBC3Cis5pVbYz", "number": 51605, "title": "[Error 500] \"Socket Hang Up\" Randomly Occurring on any Routes in Production Mode", "user": {"login": "SebastienSusini", "id": 102793352, "node_id": "U_kgDOBiCAiA", "avatar_url": "https://avatars.githubusercontent.com/u/102793352?v=4", "gravatar_id": "", "url": "https://api.github.com/users/SebastienSusini", "html_url": "https://github.com/SebastienSusini", "followers_url": "https://api.github.com/users/SebastienSusini/followers", "following_url": "https://api.github.com/users/SebastienSusini/following{/other_user}", "gists_url": "https://api.github.com/users/SebastienSusini/gists{/gist_id}", "starred_url": "https://api.github.com/users/SebastienSusini/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/SebastienSusini/subscriptions", "organizations_url": "https://api.github.com/users/SebastienSusini/orgs", "repos_url": "https://api.github.com/users/SebastienSusini/repos", "events_url": "https://api.github.com/users/SebastienSusini/events{/privacy}", "received_events_url": "https://api.github.com/users/SebastienSusini/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 482888042, "node_id": "MDU6TGFiZWw0ODI4ODgwNDI=", "url": "https://api.github.com/repos/vercel/next.js/labels/please%20add%20a%20complete%20reproduction", "name": "please add a complete reproduction", "color": "fbca04", "default": false, "description": "Please add a complete reproduction."}, {"id": 2471906168, "node_id": "MDU6TGFiZWwyNDcxOTA2MTY4", "url": "https://api.github.com/repos/vercel/next.js/labels/bug", "name": "bug", "color": "fddf99", "default": true, "description": "Issue was opened via the bug report template."}], "state": "closed", "locked": true, "assignees": [], "milestone": null, "comments": 71, "created_at": "2023-06-21T09:57:16Z", "updated_at": "2024-01-03T00:12:41Z", "closed_at": "2024-01-03T00:12:41Z", "assignee": null, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### Verify canary release\n\n- [X] I verified that the issue exists in the latest Next.js canary release\n\n### Provide environment information\n\n```bash\nOperating System:\r\n      Platform: darwin\r\n      Arch: x64\r\n      Version: Darwin Kernel Version 21.6.0: Mon Aug 22 20:17:10 PDT 2022; root:xnu-8020.140.49~2/RELEASE_X86_64\r\n    Binaries:\r\n      Node: 16.14.2\r\n      npm: 8.5.0\r\n      Yarn: 1.22.15\r\n      pnpm: 6.11.0\r\n    Relevant packages:\r\n      next: 13.4.6\r\n      eslint-config-next: 13.4.2\r\n      react: 18.2.0\r\n      react-dom: 18.2.0\r\n      typescript: 4.9.5\n```\n\n\n### Which area(s) of Next.js are affected? (leave empty if unsure)\n\n_No response_\n\n### Link to the code that reproduces this issue or a replay of the bug\n\nnot possible confidential \n\n### To Reproduce\n\nthis our **package.json**\r\n```\r\n`{\r\n  \"name\": \"********\",\r\n  \"version\": \"0.1.0\",\r\n  \"private\": true,\r\n  \"scripts\": {\r\n    \"dev\": \"next dev\",\r\n    \"dev-https\": \"NODE_TLS_REJECT_UNAUTHORIZED='0' node server.js\",\r\n    \"ngrok\": \"ngrok http https://localhost:3000\",\r\n    \"build\": \"next build\",\r\n    \"postbuild\": \"next-sitemap\",\r\n    \"start\": \"next start\",\r\n    \"clean\": \"rimraf .next out\",\r\n    \"lint\": \"next lint\",\r\n    \"lint.fix\": \"next lint --fix\",\r\n    \"test\": \"jest --watch\",\r\n    \"prepare\": \"husky install\",\r\n    \"analyze\": \"ANALYZE=true next build\"\r\n  },\r\n  \"dependencies\": {\r\n    \"@everipedia/wagmi-magic-connector\": \"^0.12.1\",\r\n    \"@headlessui/react\": \"^1.7.15\",\r\n    \"@headlessui/tailwindcss\": \"^0.1.3\",\r\n    \"@heroicons/react\": \"^1.0.6\",\r\n    \"@next/bundle-analyzer\": \"^12.2.0\",\r\n    \"@next/env\": \"^13.1.5\",\r\n    \"@radix-ui/react-dropdown-menu\": \"^2.0.5\",\r\n    \"@rainbow-me/rainbowkit\": \"^0.12.15\",\r\n    \"@ramp-network/ramp-instant-sdk\": \"^4.0.2\",\r\n    \"@react-spring/web\": \"^9.6.1\",\r\n    \"@react-three/cannon\": \"^6.4.0\",\r\n    \"@react-three/drei\": \"^9.34.3\",\r\n    \"@react-three/fiber\": \"^8.8.10\",\r\n    \"@segment/analytics-next\": \"^1.52.0\",\r\n    \"@sentry/nextjs\": \"^7.54.0\",\r\n    \"@stripe/react-stripe-js\": \"^1.16.3\",\r\n    \"@stripe/stripe-js\": \"^1.46.0\",\r\n    \"@tanstack/react-table\": \"^8.5.13\",\r\n    \"@use-gesture/react\": \"^10.2.19\",\r\n    \"axios\": \"^1.4.0\",\r\n    \"clsx\": \"^1.2.1\",\r\n    \"cookies-next\": \"^2.1.1\",\r\n    \"date-fns\": \"^2.29.3\",\r\n    \"ethers\": \"^5.7.1\",\r\n    \"i18next\": \"^22.4.9\",\r\n    \"next\": \"^13.4.6\",\r\n    \"next-auth\": \"^4.21.1\",\r\n    \"next-axiom\": \"^0.17.0\",\r\n    \"next-i18next\": \"^11.3.0\",\r\n    \"next-password-protect\": \"^1.8.0\",\r\n    \"next-share\": \"^0.18.2\",\r\n    \"next-sitemap\": \"^3.1.47\",\r\n    \"nextjs-progressbar\": \"^0.0.14\",\r\n    \"react\": \"^18.2.0\",\r\n    \"react-canvas-confetti\": \"^1.3.0\",\r\n    \"react-countup\": \"^6.4.0\",\r\n    \"react-csv\": \"^2.2.2\",\r\n    \"react-currency-input-field\": \"^3.6.10\",\r\n    \"react-device-detect\": \"^2.2.3\",\r\n    \"react-div-100vh\": \"^0.7.0\",\r\n    \"react-dom\": \"^18.2.0\",\r\n    \"react-fast-marquee\": \"^1.3.5\",\r\n    \"react-hook-form\": \"^7.41.5\",\r\n    \"react-hot-toast\": \"^2.4.0\",\r\n    \"react-i18next\": \"^12.1.4\",\r\n    \"react-icons\": \"^4.8.0\",\r\n    \"react-infinite-scroll-component\": \"^6.1.0\",\r\n    \"react-intersection-observer\": \"^9.4.1\",\r\n    \"react-spring-bottom-sheet\": \"^3.5.0-alpha.0\",\r\n    \"react-type-animation\": \"^2.1.1\",\r\n    \"react-use-intercom\": \"^3.0.2\",\r\n    \"recharts\": \"2.5.0\",\r\n    \"sharp\": \"^0.30.7\",\r\n    \"swiper\": \"^9.1.1\",\r\n    \"swr\": \"1.3.0\",\r\n    \"tailwind-merge\": \"^1.13.1\",\r\n    \"tailwind-scrollbar\": \"^3.0.0\",\r\n    \"tailwind-scrollbar-hide\": \"^1.1.7\",\r\n    \"tailwindcss\": \"^3.1.4\",\r\n    \"three\": \"^0.144.0\",\r\n    \"uuid\": \"^9.0.0\",\r\n    \"wagmi\": \"^0.12.12\"\r\n  },\r\n  \"devDependencies\": {\r\n    \"@commitlint/cli\": \"^17.0.3\",\r\n    \"@commitlint/config-conventional\": \"^17.3.0\",\r\n    \"@testing-library/jest-dom\": \"^5.16.4\",\r\n    \"@testing-library/react\": \"^13.3.0\",\r\n    \"@types/jest\": \"^28.1.4\",\r\n    \"@types/node\": \"18.0.0\",\r\n    \"@types/react\": \"18.0.14\",\r\n    \"@types/react-csv\": \"^1.1.3\",\r\n    \"@types/react-dom\": \"18.0.5\",\r\n    \"@types/react-stripe-elements\": \"^6.0.6\",\r\n    \"@types/three\": \"^0.143.0\",\r\n    \"@types/uuid\": \"^8.3.4\",\r\n    \"@typescript-eslint/eslint-plugin\": \"^5.30.0\",\r\n    \"@typescript-eslint/parser\": \"^5.30.0\",\r\n    \"autoprefixer\": \"^10.4.7\",\r\n    \"commitizen\": \"^4.2.6\",\r\n    \"commitlint\": \"^11.0.0\",\r\n    \"commitlint-config-gitmoji\": \"2.2.5\",\r\n    \"cssnano\": \"^5.1.12\",\r\n    \"cz-conventional-changelog\": \"^3.3.0\",\r\n    \"eslint\": \"8.18.0\",\r\n    \"eslint-config-airbnb-base\": \"^15.0.0\",\r\n    \"eslint-config-airbnb-typescript\": \"^17.0.0\",\r\n    \"eslint-config-next\": \"^13.3.0\",\r\n    \"eslint-config-prettier\": \"^8.5.0\",\r\n    \"eslint-plugin-import\": \"^2.26.0\",\r\n    \"eslint-plugin-jsx-a11y\": \"^6.6.0\",\r\n    \"eslint-plugin-prettier\": \"^4.1.0\",\r\n    \"eslint-plugin-react\": \"^7.30.1\",\r\n    \"eslint-plugin-react-hooks\": \"^4.6.0\",\r\n    \"eslint-plugin-simple-import-sort\": \"^7.0.0\",\r\n    \"eslint-plugin-tailwindcss\": \"^3.6.0\",\r\n    \"eslint-plugin-unused-imports\": \"^2.0.0\",\r\n    \"husky\": \"^8.0.0\",\r\n    \"jest\": \"^28.1.2\",\r\n    \"jest-environment-jsdom\": \"^28.1.2\",\r\n    \"lint-staged\": \"^13.0.3\",\r\n    \"postcss\": \"^8.4.14\",\r\n    \"prettier\": \"^2.7.1\",\r\n    \"rimraf\": \"^3.0.2\",\r\n    \"typescript\": \"^4.9.5\"\r\n  },\r\n  \"config\": {\r\n    \"commitizen\": {\r\n      \"path\": \"./node_modules/cz-conventional-changelog\"\r\n    }\r\n  }\r\n}`\r\n```\r\n\r\nour next.config.js :\r\n```\r\n`/** @type {import('next').NextConfig} */\r\n\r\nconst { withSentryConfig } = require('@sentry/nextjs');\r\nconst { withAxiom } = require('next-axiom');\r\nconst withBundleAnalyzer = require('@next/bundle-analyzer')({\r\n  enabled: process.env.ANALYZE === 'true',\r\n});\r\n\r\nconst { i18n } = require('./next-i18next.config');\r\n\r\nconst IS_PROTECTED = process.env.NEXT_PUBLIC_NODE_ENV === 'staging';\r\n\r\nconst securityHeaders = [\r\n  {\r\n    key: 'X-XSS-Protection',\r\n    value: '1; mode=block',\r\n  },\r\n  {\r\n    key: 'X-Content-Type-Options',\r\n    value: 'nosniff',\r\n  },\r\n  {\r\n    key: 'Referrer-Policy',\r\n    value: 'origin-when-cross-origin',\r\n  },\r\n  {\r\n    key: 'X-DNS-Prefetch-Control',\r\n    value: 'on',\r\n  },\r\n  {\r\n    key: 'Strict-Transport-Security',\r\n    value: 'max-age=63072000; includeSubDomains; preload',\r\n  },\r\n];\r\n\r\nconst nextConfig = withAxiom(\r\n  withBundleAnalyzer({\r\n    reactStrictMode: true,\r\n    swcMinify: false,\r\n    i18n,\r\n    env: {\r\n      PASSWORD_PROTECT: IS_PROTECTED,\r\n    },\r\n    images: {\r\n      domains: ['lh3.googleusercontent.com', 'i.scdn.co'],\r\n    },\r\n    sentry: {\r\n      widenClientFileUpload: true,\r\n      hideSourceMaps: true,\r\n      automaticVercelMonitors: false,\r\n    },\r\n    // transpilePackages: ['react-native'],\r\n    async redirects() {\r\n      return [\r\n        {\r\n          source: '/login',\r\n          destination: '/auth/login',\r\n          permanent: true,\r\n        },\r\n        {\r\n          source: '/signup',\r\n          destination: '/auth/signup',\r\n          permanent: true,\r\n        },\r\n        {\r\n          source: '/dashboard',\r\n          destination: '/users/dashboard',\r\n          permanent: true,\r\n        },\r\n        {\r\n          source: '/backstage',\r\n          destination: '/artists/backstage',\r\n          permanent: true,\r\n        },\r\n        {\r\n          source: '/explore',\r\n          destination: '/search',\r\n          permanent: true,\r\n        },\r\n        {\r\n          source: '/faqs',\r\n          destination: '/faq',\r\n          permanent: true,\r\n        },\r\n        {\r\n          source: '/users/reward-tasks',\r\n          destination: '/users/game/explain',\r\n          permanent: true,\r\n        },\r\n      ];\r\n    },\r\n    async headers() {\r\n      return [\r\n        {\r\n          source: '/:path*',\r\n          headers: securityHeaders,\r\n        },\r\n        {\r\n          source: '/.well-known/apple-developer-merchantid-domain-association',\r\n          headers: [{ key: 'Content-Type', value: 'application/json' }],\r\n        },\r\n      ];\r\n    },\r\n    webpack: (config) => {\r\n      config.module.rules.push({\r\n        test: /\\.pdf$/,\r\n        use: {\r\n          loader: 'file-loader',\r\n          options: {\r\n            name: '[path][name].[ext]',\r\n          },\r\n        },\r\n      });\r\n      // config.externals.push('react-native');\r\n      return config;\r\n    },\r\n  })\r\n);\r\n\r\nconst sentryWebpackPluginOptions = {\r\n  org: '*****-*****',\r\n  project: '*****-nextjs',\r\n  silent: true, // Suppresses all logs\r\n  // For all available options, see:\r\n  // https://github.com/getsentry/sentry-webpack-plugin#options.\r\n};\r\n\r\nmodule.exports = withSentryConfig(nextConfig, sentryWebpackPluginOptions);\r\n```\r\nour **middleware.ts**\r\n```\r\n/* eslint-disable consistent-return */\r\nimport type { NextRequest } from 'next/server';\r\nimport { NextResponse } from 'next/server';\r\nimport { withAuth } from 'next-auth/middleware';\r\n\r\nconst ROLES_ALLOWED_TO_AUTH = new Set<any>(['artist', 'user']);\r\n\r\nexport default withAuth(\r\n  function middleware(req: NextRequest & { nextauth: { token: any } }) {s\r\n    // Redirect if they don't have the appropriate role\r\n    if (\r\n      req.nextUrl.pathname.startsWith('/artists/backstage') ||\r\n      req.nextUrl.pathname.startsWith('/artists/onboarding') ||\r\n      req.nextUrl.pathname.startsWith('/artists/new')\r\n    ) {\r\n      if (!ROLES_ALLOWED_TO_AUTH.has(req.nextauth.token?.userRole)) {\r\n        return NextResponse.redirect(new URL('/auth/login', req.url));\r\n      }\r\n      if (req.nextauth.token?.userRole === 'user' && req.nextauth.token?.userRole !== 'artist') {\r\n        return NextResponse.redirect(new URL('/users/dashboard', req.url));\r\n      }\r\n      if (req.nextauth.token?.userRole === 'artist') {\r\n        return NextResponse.next();\r\n      }\r\n    }\r\n  },\r\n  {\r\n    callbacks: {\r\n      authorized: ({ token }) =>\r\n        token?.userRole !== undefined && ROLES_ALLOWED_TO_AUTH.has(token.userRole),\r\n    },\r\n  }\r\n);\r\n\r\nexport const config = {\r\n  matcher: [\r\n    '/feed',\r\n    '/artists/new/:path*',\r\n    '/artists/backstage/:path*',\r\n    '/artists/onboarding/:path*',\r\n    '/users/dashboard/:path*',\r\n    '/users/game/:path*',\r\n    '/users/settings',\r\n  ],\r\n};\r\n```\n\n### Describe the Bug\n\nWe are experiencing a bug that occurs randomly for some of our users, only in production, on any route of the site, and it has never been reported on Sentry. We can only see it in the Vercel logs.\r\n\r\nThe full error message is as follows:\r\n `Uncaught Exception \t{\"errorType\":\"Error\",\"errorMessage\":\"socket hang up\",\"code\":\"ECONNRESET\",\"stack\":[\"Error: socket hang up\",\"    at connResetException (node:internal/errors:717:14)\",\"    at TLSSocket.socketOnEnd (node:_http_client:526:23)\",\"    at TLSSocket.emit (node:events:525:35)\",\"    at TLSSocket.emit (node:domain:489:12)\",\"    at endReadableNT (node:internal/streams/readable:1359:12)\",\"    at process.processTicksAndRejections (node:internal/process/task_queues:82:21)\"]}\r\nUnknown application error occurred\r\nRuntime.Unknown.` \r\n\r\nWe think (but can't verify) that this bug appeared when we updated to Next.js 13. However, none of our pages use appRouter; we're still using Page Router for the time being. We've seen that rewrites can cause socket hangs, but as you can see in our next.config.js, we don't use rewrites.\r\n\r\nThis can happen on SSG (Static Site Generation), SSR (Server-Side Rendering), or Client-side rendered pages.\r\nIt can also happen on any browser or device.\r\n\r\nHonestly, we have no clue or way of reproducing this problem because even in our development environment, we don't encounter any problems.\n\n### Expected Behavior\n\nI expect the application to work seamlessly without any errors or disruptions. Specifically, I anticipate that the mentioned \"Socket Hang Up\" error will not occur randomly in production mode on any route of the site. Additionally, I hope that better error handling mechanisms will be implemented to address any potential issues that may arise.\n\n### Which browser are you using? (if relevant)\n\n_No response_\n\n### How are you deploying your application? (if relevant)\n\nVercel", "closed_by": null, "reactions": {"url": "https://api.github.com/repos/vercel/next.js/issues/51605/reactions", "total_count": 37, "+1": 36, "-1": 0, "laugh": 0, "hooray": 0, "confused": 1, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/vercel/next.js/issues/51605/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/vercel/next.js/issues/21679", "repository_url": "https://api.github.com/repos/vercel/next.js", "labels_url": "https://api.github.com/repos/vercel/next.js/issues/21679/labels{/name}", "comments_url": "https://api.github.com/repos/vercel/next.js/issues/21679/comments", "events_url": "https://api.github.com/repos/vercel/next.js/issues/21679/events", "html_url": "https://github.com/vercel/next.js/issues/21679", "id": 797329860, "node_id": "MDU6SXNzdWU3OTczMjk4NjA=", "number": 21679, "title": "Error: Cannot find module 'webpack'", "user": {"login": "josecgarm", "id": 66883269, "node_id": "MDQ6VXNlcjY2ODgzMjY5", "avatar_url": "https://avatars.githubusercontent.com/u/66883269?v=4", "gravatar_id": "", "url": "https://api.github.com/users/josecgarm", "html_url": "https://github.com/josecgarm", "followers_url": "https://api.github.com/users/josecgarm/followers", "following_url": "https://api.github.com/users/josecgarm/following{/other_user}", "gists_url": "https://api.github.com/users/josecgarm/gists{/gist_id}", "starred_url": "https://api.github.com/users/josecgarm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/josecgarm/subscriptions", "organizations_url": "https://api.github.com/users/josecgarm/orgs", "repos_url": "https://api.github.com/users/josecgarm/repos", "events_url": "https://api.github.com/users/josecgarm/events{/privacy}", "received_events_url": "https://api.github.com/users/josecgarm/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 2471906168, "node_id": "MDU6TGFiZWwyNDcxOTA2MTY4", "url": "https://api.github.com/repos/vercel/next.js/labels/bug", "name": "bug", "color": "fddf99", "default": true, "description": "Issue was opened via the bug report template."}], "state": "closed", "locked": true, "assignees": [], "milestone": null, "comments": 71, "created_at": "2021-01-30T04:08:56Z", "updated_at": "2022-02-09T12:05:35Z", "closed_at": "2021-02-27T06:19:36Z", "assignee": null, "author_association": "NONE", "type": null, "active_lock_reason": "resolved", "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "**What version of Next.js are you using?**\r\n\r\n10.0.6\r\n\r\n**What version of Node.js are you using?**\r\n\r\n14.15.4\r\n\r\n**What browser are you using?**\r\n\r\nSafari\r\n\r\n**What operating system are you using?**\r\n\r\nmacOS\r\n\r\n**How are you deploying your application?**\r\n\r\nyarn build locally\r\n\r\n**Describe the Bug**\r\n\r\nI just updated to 10.0.6 version from 10.0.5 and im getting the next error: Error: Cannot find module 'webpack'.\r\n\r\nI found out that if I remove next-pwa it works, and the terminal output while building all of the errors came form next-pwa.\r\n\r\n**Expected Behavior**\r\n\r\nIf I downgrade to 10.0.5 my project builds in dev and prod.\r\n\r\n**To Reproduce**\r\n\r\nInstall the latest version of next and install next-pwa.\r\n\r\n`\r\nyarn install v1.22.10\r\ninfo No lockfile found.\r\n[1/4] \ud83d\udd0d  Resolving packages...\r\nwarning next-pwa > workbox-webpack-plugin > workbox-build > rollup > fsevents@2.1.3: \"Please update to latest v2.3 or v2.2\"\r\nwarning next-pwa > workbox-webpack-plugin > workbox-build > @hapi/joi@16.1.8: Switch to 'npm install joi'\r\nwarning next-pwa > workbox-webpack-plugin > workbox-build > @hapi/joi > @hapi/hoek@8.5.1: This version has been deprecated and is no longer supported or maintained\r\nwarning next-pwa > workbox-webpack-plugin > workbox-build > @hapi/joi > @hapi/address@2.1.4: Moved to 'npm install @sideway/address'\r\nwarning next-pwa > workbox-webpack-plugin > workbox-build > @hapi/joi > @hapi/formula@1.2.0: Moved to 'npm install @sideway/formula'\r\nwarning next-pwa > workbox-webpack-plugin > workbox-build > @hapi/joi > @hapi/topo@3.1.6: This version has been deprecated and is no longer supported or maintained\r\nwarning next-pwa > workbox-webpack-plugin > workbox-build > @hapi/joi > @hapi/topo > @hapi/hoek@8.5.1: This version has been deprecated and is no longer supported or maintained\r\nwarning next-pwa > workbox-webpack-plugin > workbox-build > @hapi/joi > @hapi/pinpoint@1.0.2: Moved to 'npm install @sideway/pinpoint'\r\n[2/4] \ud83d\ude9a  Fetching packages...\r\n[3/4] \ud83d\udd17  Linking dependencies...\r\nwarning \" > next-pwa@5.0.4\" has unmet peer dependency \"webpack@>=4.0.0\".\r\nwarning \"next-pwa > babel-loader@8.2.2\" has unmet peer dependency \"@babel/core@^7.0.0\".\r\nwarning \"next-pwa > babel-loader@8.2.2\" has unmet peer dependency \"webpack@>=2\".\r\nwarning \"next-pwa > workbox-webpack-plugin@6.1.0\" has unmet peer dependency \"webpack@^4.4.0 || ^5.9.0\".\r\nwarning \"next-pwa > clean-webpack-plugin@3.0.0\" has unmet peer dependency \"webpack@*\".\r\nwarning \" > tailwindcss-font-inter@2.0.0\" has incorrect peer dependency \"tailwindcss@^1.9.0\".\r\n[4/4] \ud83d\udd28  Building fresh packages...\r\nsuccess Saved lockfile.\r\n\u2728  Done in 23.34s.\r\njcgm@JoseloG-Macbook-Pro landing-site % yarn build          \r\nyarn run v1.22.10\r\n$ next build\r\nLoaded env from /Users/jcgm/Dev/Kapital/landing-site/.env.local\r\n\r\n> Build error occurred\r\nError: Cannot find module 'webpack'\r\nRequire stack:\r\n- /Users/jcgm/Dev/Kapital/landing-site/node_modules/workbox-webpack-plugin/build/generate-sw.js\r\n- /Users/jcgm/Dev/Kapital/landing-site/node_modules/workbox-webpack-plugin/build/index.js\r\n- /Users/jcgm/Dev/Kapital/landing-site/node_modules/next-pwa/index.js\r\n- /Users/jcgm/Dev/Kapital/landing-site/next.config.js\r\n- /Users/jcgm/Dev/Kapital/landing-site/node_modules/next/dist/next-server/server/config.js\r\n- /Users/jcgm/Dev/Kapital/landing-site/node_modules/next/dist/build/index.js\r\n- /Users/jcgm/Dev/Kapital/landing-site/node_modules/next/dist/cli/next-build.js\r\n- /Users/jcgm/Dev/Kapital/landing-site/node_modules/next/dist/bin/next\r\n    at Function.Module._resolveFilename (internal/modules/cjs/loader.js:880:15)\r\n    at Function.Module._load (internal/modules/cjs/loader.js:725:27)\r\n    at Module.require (internal/modules/cjs/loader.js:952:19)\r\n    at require (internal/modules/cjs/helpers.js:88:18)\r\n    at Object.<anonymous> (/Users/jcgm/Dev/Kapital/landing-site/node_modules/workbox-webpack-plugin/build/generate-sw.js:18:17)\r\n    at Module._compile (internal/modules/cjs/loader.js:1063:30)\r\n    at Object.Module._extensions..js (internal/modules/cjs/loader.js:1092:10)\r\n    at Module.load (internal/modules/cjs/loader.js:928:32)\r\n    at Function.Module._load (internal/modules/cjs/loader.js:769:14)\r\n    at Module.require (internal/modules/cjs/loader.js:952:19)\r\n    at require (internal/modules/cjs/helpers.js:88:18)\r\n    at Object.<anonymous> (/Users/jcgm/Dev/Kapital/landing-site/node_modules/workbox-webpack-plugin/build/index.js:10:20)\r\n    at Module._compile (internal/modules/cjs/loader.js:1063:30)\r\n    at Object.Module._extensions..js (internal/modules/cjs/loader.js:1092:10)\r\n    at Module.load (internal/modules/cjs/loader.js:928:32)\r\n    at Function.Module._load (internal/modules/cjs/loader.js:769:14) {\r\n  code: 'MODULE_NOT_FOUND',\r\n  requireStack: [\r\n    '/Users/jcgm/Dev/Kapital/landing-site/node_modules/workbox-webpack-plugin/build/generate-sw.js',\r\n    '/Users/jcgm/Dev/Kapital/landing-site/node_modules/workbox-webpack-plugin/build/index.js',\r\n    '/Users/jcgm/Dev/Kapital/landing-site/node_modules/next-pwa/index.js',\r\n    '/Users/jcgm/Dev/Kapital/landing-site/next.config.js',\r\n    '/Users/jcgm/Dev/Kapital/landing-site/node_modules/next/dist/next-server/server/config.js',\r\n    '/Users/jcgm/Dev/Kapital/landing-site/node_modules/next/dist/build/index.js',\r\n    '/Users/jcgm/Dev/Kapital/landing-site/node_modules/next/dist/cli/next-build.js',\r\n    '/Users/jcgm/Dev/Kapital/landing-site/node_modules/next/dist/bin/next'\r\n  ]\r\n}\r\nerror Command failed with exit code 1.\r\n`", "closed_by": {"login": "kodiakhq[bot]", "id": 49736102, "node_id": "MDM6Qm90NDk3MzYxMDI=", "avatar_url": "https://avatars.githubusercontent.com/in/29196?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kodiakhq%5Bbot%5D", "html_url": "https://github.com/apps/kodiakhq", "followers_url": "https://api.github.com/users/kodiakhq%5Bbot%5D/followers", "following_url": "https://api.github.com/users/kodiakhq%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/kodiakhq%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/kodiakhq%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kodiakhq%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/kodiakhq%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/kodiakhq%5Bbot%5D/repos", "events_url": "https://api.github.com/users/kodiakhq%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/kodiakhq%5Bbot%5D/received_events", "type": "Bot", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/vercel/next.js/issues/21679/reactions", "total_count": 118, "+1": 110, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 8}, "timeline_url": "https://api.github.com/repos/vercel/next.js/issues/21679/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/vercel/next.js/issues/55960", "repository_url": "https://api.github.com/repos/vercel/next.js", "labels_url": "https://api.github.com/repos/vercel/next.js/issues/55960/labels{/name}", "comments_url": "https://api.github.com/repos/vercel/next.js/issues/55960/comments", "events_url": "https://api.github.com/repos/vercel/next.js/issues/55960/events", "html_url": "https://github.com/vercel/next.js/issues/55960", "id": 1911519293, "node_id": "I_kwDOBC3Cis5x73g9", "number": 55960, "title": "revalidateTag() works unpredictable", "user": {"login": "thedevdavid", "id": 15244882, "node_id": "MDQ6VXNlcjE1MjQ0ODgy", "avatar_url": "https://avatars.githubusercontent.com/u/15244882?v=4", "gravatar_id": "", "url": "https://api.github.com/users/thedevdavid", "html_url": "https://github.com/thedevdavid", "followers_url": "https://api.github.com/users/thedevdavid/followers", "following_url": "https://api.github.com/users/thedevdavid/following{/other_user}", "gists_url": "https://api.github.com/users/thedevdavid/gists{/gist_id}", "starred_url": "https://api.github.com/users/thedevdavid/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/thedevdavid/subscriptions", "organizations_url": "https://api.github.com/users/thedevdavid/orgs", "repos_url": "https://api.github.com/users/thedevdavid/repos", "events_url": "https://api.github.com/users/thedevdavid/events{/privacy}", "received_events_url": "https://api.github.com/users/thedevdavid/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 2471906168, "node_id": "MDU6TGFiZWwyNDcxOTA2MTY4", "url": "https://api.github.com/repos/vercel/next.js/labels/bug", "name": "bug", "color": "fddf99", "default": true, "description": "Issue was opened via the bug report template."}, {"id": 4862060773, "node_id": "LA_kwDOBC3Cis8AAAABIc0o5Q", "url": "https://api.github.com/repos/vercel/next.js/labels/Pages%20Router", "name": "Pages Router", "color": "D63F85", "default": false, "description": "Related to Pages Router."}], "state": "closed", "locked": true, "assignees": [], "milestone": null, "comments": 70, "created_at": "2023-09-25T13:30:21Z", "updated_at": "2023-12-21T21:01:36Z", "closed_at": "2023-11-29T22:36:03Z", "assignee": null, "author_association": "NONE", "type": null, "active_lock_reason": "resolved", "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### Link to the code that reproduces this issue\r\n\r\nhttps://github.com/thedevdavid/productengineerjobs\r\n\r\n### To Reproduce\r\n\r\n1. set up nextjs\r\n2. set up sanity\r\n3. set up webhook to revaldiateTag\r\n\r\n### Current vs. Expected behavior\r\n\r\nI\u2019m trying to get next app router + `revalidateTag()` to work with Sanity but it\u2019s either completely unpredictable or I totally misunderstood something.\r\n\r\nI now spent 5 full days trying to make it work and build multiple projects. Here\u2019s what I can tell now:\r\n\r\n**Project 1:** This is the most basic, simple setup (posts, pages, categories, [slug] dynamic pages). I think this works. https://github.com/thedevdavid/sanity-revalidate-debug\r\n\r\n**Project 2:** Almost the same setup (posts, pages, categories, [slug] dynamic pages + subpages [with extra tags](https://github.com/thedevdavid/productengineerjobs/blob/develop/app/(site)/post-a-job/page.tsx)). Here, the simple tags: [`job`] or tags: [`benefit`] requests are never getting revalidated on the `/` and `/post-a-job` routes. But in (for example) `/contract/[slug]` route. And the complex tags, like [`job:${params.slug}`] or [`page:${params.slug}`] are all working well.\r\n\r\n**Projects 3 & 4:** Very similar to project 2. posts, pages, and categories with extra schema types, like team members, navigation links, testimonials, and more. Here I can\u2019t even tell the exact problems. Probably similar to project 2 but I\u2019m not sure anymore.\r\n\r\nAlthough there\u2019s 1 thing I know that\u2019s extra. There\u2019s a `homepage` type with the fetch tag, `homepage`. This type has the navigation links. There\u2019s a fetch tagged with `homepage` on `(site)/page.tsx` and in 2 components (`Navbar` & `Footer`). Both are rendered from `(site)/layout.tsx`. The fetch from the components gets revalidated and I can see the new data on all pages, except the `/` route, aka. `(site)/page.tsx`. That route never gets revalidated. Although the page and 2 components inside have tagged requests.\r\n\r\nIn all 4 projects, the Sanity webhook calls the revalidate API route. The function always succeeds. Params are what they are supposed to be, so I guess the `revalidateTag()` gets called with the right parameters. _(Although I have not figured out how to debug the actual function calls yet)_\r\n\r\nSoooo I feel totally lost and I haven\u2019t even tried to include previews and draft mode yet.\r\n\r\nI'm not sure if it's a bug with Sanity, Next.js, or it's just me doing something wrong.\r\n\r\n### Verify canary release\r\n\r\n- [X] I verified that the issue exists in the latest Next.js canary release\r\n\r\n### Provide environment information\r\n\r\n```bash\r\nOperating System:\r\n      Platform: darwin\r\n      Arch: arm64\r\n      Version: Darwin Kernel Version 22.6.0: Wed Jul  5 22:22:05 PDT 2023; root:xnu-8796.141.3~6/RELEASE_ARM64_T6000\r\n    Binaries:\r\n      Node: 18.17.1\r\n      npm: 9.6.7\r\n      Yarn: N/A\r\n      pnpm: 8.7.6\r\n    Relevant Packages:\r\n      next: 13.5.2\r\n      eslint-config-next: N/A\r\n      react: 18.2.0\r\n      react-dom: 18.2.0\r\n      typescript: N/A\r\n    Next.js Config:\r\n      output: N/A\r\n```\r\n\r\n\r\n### Which area(s) are affected? (Select all that apply)\r\n\r\nApp Router, Data fetching (gS(S)P, getInitialProps)\r\n\r\n### Additional context\r\n\r\nExample fetch call (fails to revalidate, on / route):\r\n```\r\n  const jobs = await sanityFetch<Job[]>({\r\n    query: jobsQuery,\r\n    tags: [`job`],\r\n  });\r\n```\r\n\r\nExample fetch call (revalidates. /[slug] route):\r\n```\r\nconst page = await sanityFetch<Page>({\r\n    query: pagesBySlugQuery,\r\n    params: { slug: params.slug },\r\n    tags: [`page:${params.slug}`],\r\n  });\r\n  ```\r\n  \r\nsanityFetch function:\r\n```\r\nexport async function sanityFetch<QueryResponse>({\r\n  query,\r\n  params = DEFAULT_PARAMS,\r\n  tags = DEFAULT_TAGS,\r\n}: {\r\n  query: string;\r\n  params?: QueryParams;\r\n  tags: string[];\r\n}): Promise<QueryResponse> {\r\n  return client.fetch<QueryResponse>(query, params, {\r\n    // We only cache if there's a revalidation webhook setup\r\n    cache: revalidateSecret ? \"force-cache\" : \"no-store\",\r\n    next: {\r\n      //revalidate: 30, // for simple, time-based revalidation\r\n      tags, // for tag-based revalidation\r\n    },\r\n  });\r\n}\r\n```\r\n\r\nRevalidate route handler:\r\n```\r\nimport { revalidateTag } from \"next/cache\";\r\nimport { NextResponse, type NextRequest } from \"next/server\";\r\nimport { parseBody } from \"next-sanity/webhook\";\r\n\r\nimport { revalidateSecret } from \"@/lib/sanity.api\";\r\n\r\nexport async function POST(req: NextRequest) {\r\n  try {\r\n    const { body, isValidSignature } = await parseBody<{\r\n      _type: string;\r\n      slug?: string | undefined;\r\n    }>(req, revalidateSecret);\r\n    if (!isValidSignature) {\r\n      const message = \"Invalid signature\";\r\n      return new Response(message, { status: 401 });\r\n    }\r\n\r\n    if (!body?._type) {\r\n      return new Response(\"Bad Request\", { status: 400 });\r\n    }\r\n\r\n    revalidateTag(body._type);\r\n    if (body.slug) {\r\n      revalidateTag(`${body._type}:${body.slug}`);\r\n    }\r\n    return NextResponse.json({\r\n      status: 200,\r\n      revalidated: true,\r\n      now: Date.now(),\r\n      body,\r\n    });\r\n  } catch (err: any) {\r\n    console.error(err);\r\n    return new Response(err.message, { status: 500 });\r\n  }\r\n}\r\n\r\n```", "closed_by": {"login": "ztanner", "id": 1939140, "node_id": "MDQ6VXNlcjE5MzkxNDA=", "avatar_url": "https://avatars.githubusercontent.com/u/1939140?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ztanner", "html_url": "https://github.com/ztanner", "followers_url": "https://api.github.com/users/ztanner/followers", "following_url": "https://api.github.com/users/ztanner/following{/other_user}", "gists_url": "https://api.github.com/users/ztanner/gists{/gist_id}", "starred_url": "https://api.github.com/users/ztanner/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ztanner/subscriptions", "organizations_url": "https://api.github.com/users/ztanner/orgs", "repos_url": "https://api.github.com/users/ztanner/repos", "events_url": "https://api.github.com/users/ztanner/events{/privacy}", "received_events_url": "https://api.github.com/users/ztanner/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/vercel/next.js/issues/55960/reactions", "total_count": 28, "+1": 28, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/vercel/next.js/issues/55960/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/vercel/next.js/issues/54961", "repository_url": "https://api.github.com/repos/vercel/next.js", "labels_url": "https://api.github.com/repos/vercel/next.js/issues/54961/labels{/name}", "comments_url": "https://api.github.com/repos/vercel/next.js/issues/54961/comments", "events_url": "https://api.github.com/repos/vercel/next.js/issues/54961/events", "html_url": "https://github.com/vercel/next.js/issues/54961", "id": 1879732964, "node_id": "I_kwDOBC3Cis5wCnLk", "number": 54961, "title": "next js 13 server error \" TypeError: fetch failed \"", "user": {"login": "AhmedShehata98", "id": 11885072, "node_id": "MDQ6VXNlcjExODg1MDcy", "avatar_url": "https://avatars.githubusercontent.com/u/11885072?v=4", "gravatar_id": "", "url": "https://api.github.com/users/AhmedShehata98", "html_url": "https://github.com/AhmedShehata98", "followers_url": "https://api.github.com/users/AhmedShehata98/followers", "following_url": "https://api.github.com/users/AhmedShehata98/following{/other_user}", "gists_url": "https://api.github.com/users/AhmedShehata98/gists{/gist_id}", "starred_url": "https://api.github.com/users/AhmedShehata98/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/AhmedShehata98/subscriptions", "organizations_url": "https://api.github.com/users/AhmedShehata98/orgs", "repos_url": "https://api.github.com/users/AhmedShehata98/repos", "events_url": "https://api.github.com/users/AhmedShehata98/events{/privacy}", "received_events_url": "https://api.github.com/users/AhmedShehata98/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 482888042, "node_id": "MDU6TGFiZWw0ODI4ODgwNDI=", "url": "https://api.github.com/repos/vercel/next.js/labels/please%20add%20a%20complete%20reproduction", "name": "please add a complete reproduction", "color": "fbca04", "default": false, "description": "Please add a complete reproduction."}, {"id": 2471906168, "node_id": "MDU6TGFiZWwyNDcxOTA2MTY4", "url": "https://api.github.com/repos/vercel/next.js/labels/bug", "name": "bug", "color": "fddf99", "default": true, "description": "Issue was opened via the bug report template."}, {"id": 4242292938, "node_id": "LA_kwDOBC3Cis783EDK", "url": "https://api.github.com/repos/vercel/next.js/labels/please%20verify%20canary", "name": "please verify canary", "color": "fbca04", "default": false, "description": "Please verify the issue with the latest canary branch."}], "state": "closed", "locked": true, "assignees": [], "milestone": null, "comments": 68, "created_at": "2023-09-04T08:02:35Z", "updated_at": "2023-10-04T14:49:32Z", "closed_at": "2023-10-04T14:49:23Z", "assignee": null, "author_association": "NONE", "type": null, "active_lock_reason": "resolved", "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### Link to the code that reproduces this issue or a replay of the bug\n\nhttps://github.com/AhmedShehata98/shoperz\n\n### To Reproduce\n\n1. Start the application with npm run dev\r\n2. After many re-render or refresh \r\n3. Facing  500 Internal Server Error page\r\n4. in terminal get this error : \r\n\r\nTypeError: fetch failed\r\n    at Object.fetch (node:internal/deps/undici/undici:11576:11)\r\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\r\n    at async invokeRequest (D:\\my-work\\Progo-soft\\libya-zon\\node_modules\\next\\dist\\server\\lib\\server-ipc\\invoke-request.js:17:12)\r\n    at async invokeRender (D:\\my-work\\Progo-soft\\libya-zon\\node_modules\\next\\dist\\server\\lib\\router-server.js:254:29)\r\n    at async handleRequest (D:\\my-work\\Progo-soft\\libya-zon\\node_modules\\next\\dist\\server\\lib\\router-server.js:447:24)\r\n    at async requestHandler (D:\\my-work\\Progo-soft\\libya-zon\\node_modules\\next\\dist\\server\\lib\\router-server.js:464:13)\r\n    at async Server.<anonymous> (D:\\my-work\\Progo-soft\\libya-zon\\node_modules\\next\\dist\\server\\lib\\start-server.js:117:13) {\r\n  cause: Error: connect ECONNREFUSED ::1:58392\r\n      at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1495:16) {\r\n    errno: -4078,\r\n    code: 'ECONNREFUSED',\r\n    syscall: 'connect',\r\n    address: '::1',\r\n    port: 58392\r\n  }\r\n}\n\n### Current vs. Expected behavior\n\ni followed the server start instractions by \" npm run dev \" I expected its works fine without error but got error \r\nTypeError: fetch failed\r\n    at Object.fetch (node:internal/deps/undici/undici:11576:11)\r\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\r\n    at async invokeRequest (D:\\my-work\\Progo-soft\\libya-zon\\node_modules\\next\\dist\\server\\lib\\server-ipc\\invoke-request.js:17:12)\r\n    at async invokeRender (D:\\my-work\\Progo-soft\\libya-zon\\node_modules\\next\\dist\\server\\lib\\router-server.js:254:29)\r\n    at async handleRequest (D:\\my-work\\Progo-soft\\libya-zon\\node_modules\\next\\dist\\server\\lib\\router-server.js:447:24)\r\n    at async requestHandler (D:\\my-work\\Progo-soft\\libya-zon\\node_modules\\next\\dist\\server\\lib\\router-server.js:464:13)\r\n    at async Server.<anonymous> (D:\\my-work\\Progo-soft\\libya-zon\\node_modules\\next\\dist\\server\\lib\\start-server.js:117:13) {\r\n  cause: Error: connect ECONNREFUSED ::1:58392\r\n      at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1495:16) {\r\n    errno: -4078,\r\n    code: 'ECONNREFUSED',\r\n    syscall: 'connect',\r\n    address: '::1',\r\n    port: 58392\r\n  }\r\n}\n\n### Verify canary release\n\n- [X] I verified that the issue exists in the latest Next.js canary release\n\n### Provide environment information\n\n```bash\nOperating System:\r\n      Platform: win32\r\n      Arch: x64\r\n      Version: Windows 10 Pro\r\n    Binaries:\r\n      Node: 18.17.1\r\n      npm: N/A\r\n      Yarn: N/A\r\n      pnpm: N/A\r\n    Relevant Packages:\r\n      next: 13.4.19\r\n      eslint-config-next: 13.4.19\r\n      react: 18.2.0\r\n      react-dom: 18.2.0\r\n      typescript: 5.2.2\r\n    Next.js Config:\r\n      output: N/A\n```\n\n\n### Which area(s) are affected? (Select all that apply)\n\nNot sure\n\n### Additional context\n\n_No response_", "closed_by": {"login": "balazsorban44", "id": 18369201, "node_id": "MDQ6VXNlcjE4MzY5MjAx", "avatar_url": "https://avatars.githubusercontent.com/u/18369201?v=4", "gravatar_id": "", "url": "https://api.github.com/users/balazsorban44", "html_url": "https://github.com/balazsorban44", "followers_url": "https://api.github.com/users/balazsorban44/followers", "following_url": "https://api.github.com/users/balazsorban44/following{/other_user}", "gists_url": "https://api.github.com/users/balazsorban44/gists{/gist_id}", "starred_url": "https://api.github.com/users/balazsorban44/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/balazsorban44/subscriptions", "organizations_url": "https://api.github.com/users/balazsorban44/orgs", "repos_url": "https://api.github.com/users/balazsorban44/repos", "events_url": "https://api.github.com/users/balazsorban44/events{/privacy}", "received_events_url": "https://api.github.com/users/balazsorban44/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/vercel/next.js/issues/54961/reactions", "total_count": 37, "+1": 37, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/vercel/next.js/issues/54961/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/vercel/next.js/issues/42514", "repository_url": "https://api.github.com/repos/vercel/next.js", "labels_url": "https://api.github.com/repos/vercel/next.js/issues/42514/labels{/name}", "comments_url": "https://api.github.com/repos/vercel/next.js/issues/42514/comments", "events_url": "https://api.github.com/repos/vercel/next.js/issues/42514/events", "html_url": "https://github.com/vercel/next.js/issues/42514", "id": 1437066191, "node_id": "I_kwDOBC3Cis5Vp-PP", "number": 42514, "title": "Bug: extremely high memory usage with `next dev`", "user": {"login": "budchirp", "id": 80613396, "node_id": "MDQ6VXNlcjgwNjEzMzk2", "avatar_url": "https://avatars.githubusercontent.com/u/80613396?v=4", "gravatar_id": "", "url": "https://api.github.com/users/budchirp", "html_url": "https://github.com/budchirp", "followers_url": "https://api.github.com/users/budchirp/followers", "following_url": "https://api.github.com/users/budchirp/following{/other_user}", "gists_url": "https://api.github.com/users/budchirp/gists{/gist_id}", "starred_url": "https://api.github.com/users/budchirp/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/budchirp/subscriptions", "organizations_url": "https://api.github.com/users/budchirp/orgs", "repos_url": "https://api.github.com/users/budchirp/repos", "events_url": "https://api.github.com/users/budchirp/events{/privacy}", "received_events_url": "https://api.github.com/users/budchirp/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 2471906168, "node_id": "MDU6TGFiZWwyNDcxOTA2MTY4", "url": "https://api.github.com/repos/vercel/next.js/labels/bug", "name": "bug", "color": "fddf99", "default": true, "description": "Issue was opened via the bug report template."}], "state": "closed", "locked": true, "assignees": [], "milestone": null, "comments": 68, "created_at": "2022-11-05T15:13:20Z", "updated_at": "2023-02-22T12:01:36Z", "closed_at": "2023-01-23T09:13:26Z", "assignee": null, "author_association": "NONE", "type": null, "active_lock_reason": "resolved", "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### Verify canary release\n\n- [X] I verified that the issue exists in the latest Next.js canary release\n\n### Provide environment information\n\n\r\n    Operating System:\r\n      Platform: android\r\n      Arch: arm64\r\n      Version: #2 SMP PREEMPT Fri Aug 5 15:52:33 AST 2022\r\n    Binaries:\r\n      Node: 18.10.0\r\n      npm: 8.19.2\r\n      Yarn: 1.22.19\r\n      pnpm: N/A\r\n    Relevant packages:\r\n      next: 13.0.3-canary.0\r\n      eslint-config-next: 13.0.2\r\n      react: 18.2.0\r\n      react-dom: 18.2.0\r\n\n\n### What browser are you using? (if relevant)\n\nChrome Canary v109.0.5400.0 (Android)\n\n### How are you deploying your application? (if relevant)\n\nVercel\n\n### Describe the Bug\n\nThe memory usage on the last next 13 (13.0.3-canary.0 and 13.0.2) releases are too high. `next dev` command uses about 1gb of ram. Next 12 is using about 300mb-500mb's of ram.\r\n\r\n![Screenshot_20221104-225938_Termux](https://user-images.githubusercontent.com/80613396/200126555-a1868f4f-ed90-4345-b6ce-82468f662952.png)\r\n\n\n### Expected Behavior\n\n`next dev` should use less ram.\n\n### Link to reproduction\n\n.\n\n### To Reproduce\n\n1. Create project with Next 13\r\n2. Run `next dev`\r\n3. Check the ram usage", "closed_by": {"login": "feedthejim", "id": 11064311, "node_id": "MDQ6VXNlcjExMDY0MzEx", "avatar_url": "https://avatars.githubusercontent.com/u/11064311?v=4", "gravatar_id": "", "url": "https://api.github.com/users/feedthejim", "html_url": "https://github.com/feedthejim", "followers_url": "https://api.github.com/users/feedthejim/followers", "following_url": "https://api.github.com/users/feedthejim/following{/other_user}", "gists_url": "https://api.github.com/users/feedthejim/gists{/gist_id}", "starred_url": "https://api.github.com/users/feedthejim/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/feedthejim/subscriptions", "organizations_url": "https://api.github.com/users/feedthejim/orgs", "repos_url": "https://api.github.com/users/feedthejim/repos", "events_url": "https://api.github.com/users/feedthejim/events{/privacy}", "received_events_url": "https://api.github.com/users/feedthejim/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/vercel/next.js/issues/42514/reactions", "total_count": 37, "+1": 37, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/vercel/next.js/issues/42514/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}]}