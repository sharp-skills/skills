{"d": [{"url": "https://api.github.com/repos/langchain-ai/langchain/issues/7887", "repository_url": "https://api.github.com/repos/langchain-ai/langchain", "labels_url": "https://api.github.com/repos/langchain-ai/langchain/issues/7887/labels{/name}", "comments_url": "https://api.github.com/repos/langchain-ai/langchain/issues/7887/comments", "events_url": "https://api.github.com/repos/langchain-ai/langchain/issues/7887/events", "html_url": "https://github.com/langchain-ai/langchain/issues/7887", "id": 1810236515, "node_id": "I_kwDOIPDwls5r5gRj", "number": 7887, "title": "ChromaDB 0.4+ is no longer compatible with client config", "user": {"login": "gpapp", "id": 4165192, "node_id": "MDQ6VXNlcjQxNjUxOTI=", "avatar_url": "https://avatars.githubusercontent.com/u/4165192?v=4", "gravatar_id": "", "url": "https://api.github.com/users/gpapp", "html_url": "https://github.com/gpapp", "followers_url": "https://api.github.com/users/gpapp/followers", "following_url": "https://api.github.com/users/gpapp/following{/other_user}", "gists_url": "https://api.github.com/users/gpapp/gists{/gist_id}", "starred_url": "https://api.github.com/users/gpapp/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/gpapp/subscriptions", "organizations_url": "https://api.github.com/users/gpapp/orgs", "repos_url": "https://api.github.com/users/gpapp/repos", "events_url": "https://api.github.com/users/gpapp/events{/privacy}", "received_events_url": "https://api.github.com/users/gpapp/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 5680700839, "node_id": "LA_kwDOIPDwls8AAAABUpidpw", "url": "https://api.github.com/repos/langchain-ai/langchain/labels/bug", "name": "bug", "color": "b60205", "default": true, "description": "Related to a bug, vulnerability, unexpected error with an existing feature"}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 51, "created_at": "2023-07-18T15:56:56Z", "updated_at": "2024-02-16T16:09:33Z", "closed_at": "2024-02-16T16:09:31Z", "assignee": null, "author_association": "CONTRIBUTOR", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### System Info\n\n- Python 3.9.13\r\n\r\n- langchain-0.0.235-py3-none-any.whl\r\n- chromadb-0.4.0-py3-none-any.whl\n\n### Who can help?\n\n_No response_\n\n### Information\n\n- [ ] The official example notebooks/scripts\n- [x] My own modified scripts\n\n### Related Components\n\n- [ ] LLMs/Chat Models\n- [ ] Embedding Models\n- [ ] Prompts / Prompt Templates / Prompt Selectors\n- [ ] Output Parsers\n- [ ] Document Loaders\n- [X] Vector Stores / Retrievers\n- [ ] Memory\n- [ ] Agents / Agent Executors\n- [ ] Tools / Toolkits\n- [ ] Chains\n- [ ] Callbacks/Tracing\n- [ ] Async\n\n### Reproduction\n\nSteps to reproduce:\r\n\r\n1. Create a Chroma store which is locally persisted\r\n```\r\nstore = Chroma.from_texts(\r\n    texts=docs, embedding=embeddings, metadatas=metadatas, persist_directory=environ[\"DB_DIR\"]\r\n)\r\n```\r\n2. Get the error `You are using a deprecated configuration of Chroma. Please pip install chroma-migrate and run `chroma-migrate` to upgrade your configuration. See https://docs.trychroma.com/migration for more information or join our discord at https://discord.gg/8g5FESbj for help!`\r\n3. Suffer\n\n### Expected behavior\n\n1. Create locally persisted Chroma store\r\n2. Use Chroma store\r\n\r\n\r\nThe issue:\r\n\r\nStarting chromadb 0.40 the chroma_db_impl is no longer a supported parameter, it uses sqlite instead.\r\n\r\nRemoving the line\r\n`\r\nchroma_db_impl=\"duckdb+parquet\",\r\n`\r\nfrom langchain.vectorstores/chroma.py solves the issue, but the earlier DB cannot be used or migrated.", "closed_by": {"login": "dosubot[bot]", "id": 131922026, "node_id": "BOT_kgDOB9z4ag", "avatar_url": "https://avatars.githubusercontent.com/in/324583?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dosubot%5Bbot%5D", "html_url": "https://github.com/apps/dosubot", "followers_url": "https://api.github.com/users/dosubot%5Bbot%5D/followers", "following_url": "https://api.github.com/users/dosubot%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/dosubot%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/dosubot%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dosubot%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/dosubot%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/dosubot%5Bbot%5D/repos", "events_url": "https://api.github.com/users/dosubot%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/dosubot%5Bbot%5D/received_events", "type": "Bot", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/langchain-ai/langchain/issues/7887/reactions", "total_count": 18, "+1": 12, "-1": 0, "laugh": 1, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 5}, "timeline_url": "https://api.github.com/repos/langchain-ai/langchain/issues/7887/timeline", "performed_via_github_app": null, "state_reason": "not_planned", "pinned_comment": null}, {"url": "https://api.github.com/repos/langchain-ai/langchain/issues/24713", "repository_url": "https://api.github.com/repos/langchain-ai/langchain", "labels_url": "https://api.github.com/repos/langchain-ai/langchain/issues/24713/labels{/name}", "comments_url": "https://api.github.com/repos/langchain-ai/langchain/issues/24713/comments", "events_url": "https://api.github.com/repos/langchain-ai/langchain/issues/24713/events", "html_url": "https://github.com/langchain-ai/langchain/issues/24713", "id": 2432241854, "node_id": "I_kwDOIPDwls6Q-RC-", "number": 24713, "title": "Error in RootListenersTracer.on_chain_end callback: KeyError('answer') while streaming a RAG Chain Output", "user": {"login": "Alptimus", "id": 116629946, "node_id": "U_kgDOBvOhug", "avatar_url": "https://avatars.githubusercontent.com/u/116629946?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Alptimus", "html_url": "https://github.com/Alptimus", "followers_url": "https://api.github.com/users/Alptimus/followers", "following_url": "https://api.github.com/users/Alptimus/following{/other_user}", "gists_url": "https://api.github.com/users/Alptimus/gists{/gist_id}", "starred_url": "https://api.github.com/users/Alptimus/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Alptimus/subscriptions", "organizations_url": "https://api.github.com/users/Alptimus/orgs", "repos_url": "https://api.github.com/users/Alptimus/repos", "events_url": "https://api.github.com/users/Alptimus/events{/privacy}", "received_events_url": "https://api.github.com/users/Alptimus/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 5680700839, "node_id": "LA_kwDOIPDwls8AAAABUpidpw", "url": "https://api.github.com/repos/langchain-ai/langchain/labels/bug", "name": "bug", "color": "b60205", "default": true, "description": "Related to a bug, vulnerability, unexpected error with an existing feature"}, {"id": 6411661606, "node_id": "LA_kwDOIPDwls8AAAABfioxJg", "url": "https://api.github.com/repos/langchain-ai/langchain/labels/investigate", "name": "investigate", "color": "0e8a16", "default": false, "description": "Flagged for investigation"}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 44, "created_at": "2024-07-26T13:26:39Z", "updated_at": "2025-06-10T16:01:19Z", "closed_at": "2025-06-10T16:01:17Z", "assignee": null, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### Checked other resources\r\n\r\n- [x] I added a very descriptive title to this issue.\r\n- [X] I searched the LangChain documentation with the integrated search.\r\n- [X] I used the GitHub search to find a similar question and didn't find it.\r\n- [X] I am sure that this is a bug in LangChain rather than my code.\r\n- [X] The bug is not resolved by updating to the latest stable version of LangChain (or the specific integration package).\r\n\r\n### Example Code\r\n\r\nI have the following code for building a RAG Chatbot (using [this](https://python.langchain.com/v0.2/docs/how_to/streaming/) example):  \r\n\r\n```\r\nfrom langchain_openai import OpenAIEmbeddings, ChatOpenAI\r\nfrom langchain.chains import create_retrieval_chain\r\nfrom langchain.chains.history_aware_retriever import create_history_aware_retriever\r\nfrom langchain.chains.combine_documents import create_stuff_documents_chain\r\n\r\nvectordb = FAISS.load_local(persist_directory, embedding, index_name, allow_dangerous_deserialization=True)\r\nretriever=vectordb.as_retriever()\r\n\r\nllm = ChatOpenAI()\r\n\r\n....\r\nprompt={.....}\r\n....\r\n\r\nquestion_answer_chain = create_stuff_documents_chain(llm, prompt, output_parser=parser)\r\nrag_chain = create_retrieval_chain(history_aware_retriever, question_answer_chain)\r\n\r\nconversational_rag_chain = RunnableWithMessageHistory(\r\n    rag_chain,\r\n    get_session_history,\r\n    input_messages_key=\"input\",\r\n    history_messages_key=\"chat_history\",\r\n    output_messages_key=\"answer\",\r\n)\r\n\r\nwhile True:\r\n    query = input(\"Ask a question: \")\r\n\r\n    for chunk in conversational_rag_chain.stream(\r\n        {\"input\": query,},\r\n        config={\r\n            \"configurable\": {\r\n                \"session_id\": \"demo_1\"\r\n            }\r\n        }\r\n    ):\r\n        if answer_chunk := chunk.get(\"answer\"):\r\n            print(f\"{answer_chunk}\", end=\"\", flush=True)\r\n    \r\n    print()\r\n```\r\n\r\n### Error Message and Stack Trace (if applicable)\r\n\r\n```\r\nAsk a question: How many colors are in rainbow?\r\nError in RootListenersTracer.on_chain_end callback: KeyError('answer')\r\nError in callback coroutine: KeyError('answer')\r\nA rainbow typically has seven colors, which are: Red, Orange, Yellow, Green, Blue, Indigo, Violet.</s>\r\nAsk a question: \r\n```\r\n\r\n### Description\r\n\r\nHi,\r\n\r\nI am trying to get the answer as `stream`, the problem is whenever the `conversational_rag_chain.stream()` is initiating, using an `input` it is giving the following errors:  \r\n`Error in RootListenersTracer.on_chain_end callback: KeyError('answer')`  \r\n`Error in callback coroutine: KeyError('answer')`  \r\nand then the output is printing as intended.\r\n\r\nMy question is, how can I solve it? I have entered `output_messages_key=\"answer\"` in the `conversational_rag_chain` already, so am I doing something wrong or is a `bug`?\r\n\r\nAny little discussion or help is welcome. Thanks in advance.\r\n\r\n### System Info\r\n\r\nSystem Information\r\n------------------\r\n> OS:  Linux\r\n> OS Version:  #39-Ubuntu SMP PREEMPT_DYNAMIC Fri Jul  5 21:49:14 UTC 2024\r\n> Python Version:  3.12.3 (main, Apr 10 2024, 05:33:47) [GCC 13.2.0]\r\n\r\nPackage Information\r\n-------------------\r\n> langchain_core: 0.2.23\r\n> langchain: 0.2.11\r\n> langchain_community: 0.2.10\r\n> langsmith: 0.1.93\r\n> langchain_chroma: 0.1.2\r\n> langchain_openai: 0.1.17\r\n> langchain_text_splitters: 0.2.2\r\n\r\nPackages not installed (Not Necessarily a Problem)\r\n--------------------------------------------------\r\nThe following packages were not found:\r\n\r\n> langgraph\r\n> langserve", "closed_by": {"login": "dosubot[bot]", "id": 131922026, "node_id": "BOT_kgDOB9z4ag", "avatar_url": "https://avatars.githubusercontent.com/in/324583?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dosubot%5Bbot%5D", "html_url": "https://github.com/apps/dosubot", "followers_url": "https://api.github.com/users/dosubot%5Bbot%5D/followers", "following_url": "https://api.github.com/users/dosubot%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/dosubot%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/dosubot%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dosubot%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/dosubot%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/dosubot%5Bbot%5D/repos", "events_url": "https://api.github.com/users/dosubot%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/dosubot%5Bbot%5D/received_events", "type": "Bot", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/langchain-ai/langchain/issues/24713/reactions", "total_count": 6, "+1": 5, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 1}, "timeline_url": "https://api.github.com/repos/langchain-ai/langchain/issues/24713/timeline", "performed_via_github_app": null, "state_reason": "not_planned", "pinned_comment": null}, {"url": "https://api.github.com/repos/langchain-ai/langchain/issues/10336", "repository_url": "https://api.github.com/repos/langchain-ai/langchain", "labels_url": "https://api.github.com/repos/langchain-ai/langchain/issues/10336/labels{/name}", "comments_url": "https://api.github.com/repos/langchain-ai/langchain/issues/10336/comments", "events_url": "https://api.github.com/repos/langchain-ai/langchain/issues/10336/events", "html_url": "https://github.com/langchain-ai/langchain/issues/10336", "id": 1886296572, "node_id": "I_kwDOIPDwls5wbpn8", "number": 10336, "title": "Issue with Few Short prompt when passed to agent ", "user": {"login": "AnkitaKota", "id": 75229326, "node_id": "MDQ6VXNlcjc1MjI5MzI2", "avatar_url": "https://avatars.githubusercontent.com/u/75229326?v=4", "gravatar_id": "", "url": "https://api.github.com/users/AnkitaKota", "html_url": "https://github.com/AnkitaKota", "followers_url": "https://api.github.com/users/AnkitaKota/followers", "following_url": "https://api.github.com/users/AnkitaKota/following{/other_user}", "gists_url": "https://api.github.com/users/AnkitaKota/gists{/gist_id}", "starred_url": "https://api.github.com/users/AnkitaKota/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/AnkitaKota/subscriptions", "organizations_url": "https://api.github.com/users/AnkitaKota/orgs", "repos_url": "https://api.github.com/users/AnkitaKota/repos", "events_url": "https://api.github.com/users/AnkitaKota/events{/privacy}", "received_events_url": "https://api.github.com/users/AnkitaKota/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 5680700839, "node_id": "LA_kwDOIPDwls8AAAABUpidpw", "url": "https://api.github.com/repos/langchain-ai/langchain/labels/bug", "name": "bug", "color": "b60205", "default": true, "description": "Related to a bug, vulnerability, unexpected error with an existing feature"}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 37, "created_at": "2023-09-07T17:11:20Z", "updated_at": "2024-02-15T16:09:55Z", "closed_at": "2024-02-15T16:09:55Z", "assignee": null, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### System Info\r\n\r\nI have used the SemanticSimilarityExampleSelector and created a prompt. When I try to pass this to agent it fails saying: **ValueError: Saving an example selector is not currently supported**\r\n\r\n![image](https://github.com/langchain-ai/langchain/assets/75229326/81a38ed5-b2d2-4756-ae30-e89e41c6a734)\r\n\r\nValueError: Saving an example selector is not currently supported\r\nto create prompt I have used https://python.langchain.com/docs/modules/model_io/prompts/example_selectors/similarity\r\n\r\n### Who can help?\r\n\r\n_No response_\r\n\r\n### Information\r\n\r\n- [X] The official example notebooks/scripts\r\n- [X] My own modified scripts\r\n\r\n### Related Components\r\n\r\n- [ ] LLMs/Chat Models\r\n- [ ] Embedding Models\r\n- [X] Prompts / Prompt Templates / Prompt Selectors\r\n- [ ] Output Parsers\r\n- [ ] Document Loaders\r\n- [ ] Vector Stores / Retrievers\r\n- [ ] Memory\r\n- [ ] Agents / Agent Executors\r\n- [ ] Tools / Toolkits\r\n- [ ] Chains\r\n- [ ] Callbacks/Tracing\r\n- [ ] Async\r\n\r\n### Reproduction\r\n\r\nUse the above code provided along with prompt selector provided in the original docuementation \r\n\r\n### Expected behavior\r\n\r\nTo produce the output for the question asked ", "closed_by": {"login": "dosubot[bot]", "id": 131922026, "node_id": "BOT_kgDOB9z4ag", "avatar_url": "https://avatars.githubusercontent.com/in/324583?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dosubot%5Bbot%5D", "html_url": "https://github.com/apps/dosubot", "followers_url": "https://api.github.com/users/dosubot%5Bbot%5D/followers", "following_url": "https://api.github.com/users/dosubot%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/dosubot%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/dosubot%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dosubot%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/dosubot%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/dosubot%5Bbot%5D/repos", "events_url": "https://api.github.com/users/dosubot%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/dosubot%5Bbot%5D/received_events", "type": "Bot", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/langchain-ai/langchain/issues/10336/reactions", "total_count": 1, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 1}, "timeline_url": "https://api.github.com/repos/langchain-ai/langchain/issues/10336/timeline", "performed_via_github_app": null, "state_reason": "not_planned", "pinned_comment": null}, {"url": "https://api.github.com/repos/langchain-ai/langchain/issues/22972", "repository_url": "https://api.github.com/repos/langchain-ai/langchain", "labels_url": "https://api.github.com/repos/langchain-ai/langchain/issues/22972/labels{/name}", "comments_url": "https://api.github.com/repos/langchain-ai/langchain/issues/22972/comments", "events_url": "https://api.github.com/repos/langchain-ai/langchain/issues/22972/events", "html_url": "https://github.com/langchain-ai/langchain/issues/22972", "id": 2356709439, "node_id": "I_kwDOIPDwls6MeIg_", "number": 22972, "title": "It will occurred error if a dependent library `tenacity` is upgraded to `8.4.0`.", "user": {"login": "itok01", "id": 28337009, "node_id": "MDQ6VXNlcjI4MzM3MDA5", "avatar_url": "https://avatars.githubusercontent.com/u/28337009?v=4", "gravatar_id": "", "url": "https://api.github.com/users/itok01", "html_url": "https://github.com/itok01", "followers_url": "https://api.github.com/users/itok01/followers", "following_url": "https://api.github.com/users/itok01/following{/other_user}", "gists_url": "https://api.github.com/users/itok01/gists{/gist_id}", "starred_url": "https://api.github.com/users/itok01/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/itok01/subscriptions", "organizations_url": "https://api.github.com/users/itok01/orgs", "repos_url": "https://api.github.com/users/itok01/repos", "events_url": "https://api.github.com/users/itok01/events{/privacy}", "received_events_url": "https://api.github.com/users/itok01/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 5680700839, "node_id": "LA_kwDOIPDwls8AAAABUpidpw", "url": "https://api.github.com/repos/langchain-ai/langchain/labels/bug", "name": "bug", "color": "b60205", "default": true, "description": "Related to a bug, vulnerability, unexpected error with an existing feature"}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 35, "created_at": "2024-06-17T08:20:25Z", "updated_at": "2024-06-18T14:34:29Z", "closed_at": "2024-06-18T14:34:29Z", "assignee": null, "author_association": "CONTRIBUTOR", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### Checked other resources\n\n- [X] I added a very descriptive title to this issue.\n- [X] I searched the LangChain documentation with the integrated search.\n- [X] I used the GitHub search to find a similar question and didn't find it.\n- [X] I am sure that this is a bug in LangChain rather than my code.\n- [X] The bug is not resolved by updating to the latest stable version of LangChain (or the specific integration package).\n\n### Example Code\n\n```py\r\nimport tenacity\r\n```\n\n### Error Message and Stack Trace (if applicable)\n\n> ```\r\n> > import tenacity\r\n> ...\r\n> lib/python3.11/site-packages/tenacity/__init__.py\", line 653, in <module>\r\n>      from tenacity.asyncio import AsyncRetrying  # noqa:E402,I100\r\n>      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n>  ModuleNotFoundError: No module named 'tenacity.asyncio'\r\n> ```\n\n### Description\n\nTenacity 8.4.0 has error.\r\n\r\nhttps://github.com/langchain-ai/langchain/blob/892bd4c29be34c0cc095ed178be6d60c6858e2ec/libs/core/pyproject.toml#L15\r\n\r\nhttps://github.com/jd/tenacity/issues/471\n\n### System Info\n\n- Python 3.11\r\n- tenacity 8.4.0", "closed_by": {"login": "eyurtsev", "id": 3205522, "node_id": "MDQ6VXNlcjMyMDU1MjI=", "avatar_url": "https://avatars.githubusercontent.com/u/3205522?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eyurtsev", "html_url": "https://github.com/eyurtsev", "followers_url": "https://api.github.com/users/eyurtsev/followers", "following_url": "https://api.github.com/users/eyurtsev/following{/other_user}", "gists_url": "https://api.github.com/users/eyurtsev/gists{/gist_id}", "starred_url": "https://api.github.com/users/eyurtsev/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eyurtsev/subscriptions", "organizations_url": "https://api.github.com/users/eyurtsev/orgs", "repos_url": "https://api.github.com/users/eyurtsev/repos", "events_url": "https://api.github.com/users/eyurtsev/events{/privacy}", "received_events_url": "https://api.github.com/users/eyurtsev/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/langchain-ai/langchain/issues/22972/reactions", "total_count": 48, "+1": 48, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/langchain-ai/langchain/issues/22972/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/langchain-ai/langchain/issues/27673", "repository_url": "https://api.github.com/repos/langchain-ai/langchain", "labels_url": "https://api.github.com/repos/langchain-ai/langchain/issues/27673/labels{/name}", "comments_url": "https://api.github.com/repos/langchain-ai/langchain/issues/27673/comments", "events_url": "https://api.github.com/repos/langchain-ai/langchain/issues/27673/events", "html_url": "https://github.com/langchain-ai/langchain/issues/27673", "id": 2617443494, "node_id": "I_kwDOIPDwls6cAwSm", "number": 27673, "title": "\"Action Input\" lost the last symbols when using AgentExecutor", "user": {"login": "qingwli", "id": 20885366, "node_id": "MDQ6VXNlcjIwODg1MzY2", "avatar_url": "https://avatars.githubusercontent.com/u/20885366?v=4", "gravatar_id": "", "url": "https://api.github.com/users/qingwli", "html_url": "https://github.com/qingwli", "followers_url": "https://api.github.com/users/qingwli/followers", "following_url": "https://api.github.com/users/qingwli/following{/other_user}", "gists_url": "https://api.github.com/users/qingwli/gists{/gist_id}", "starred_url": "https://api.github.com/users/qingwli/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/qingwli/subscriptions", "organizations_url": "https://api.github.com/users/qingwli/orgs", "repos_url": "https://api.github.com/users/qingwli/repos", "events_url": "https://api.github.com/users/qingwli/events{/privacy}", "received_events_url": "https://api.github.com/users/qingwli/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 5680700839, "node_id": "LA_kwDOIPDwls8AAAABUpidpw", "url": "https://api.github.com/repos/langchain-ai/langchain/labels/bug", "name": "bug", "color": "b60205", "default": true, "description": "Related to a bug, vulnerability, unexpected error with an existing feature"}, {"id": 6411661606, "node_id": "LA_kwDOIPDwls8AAAABfioxJg", "url": "https://api.github.com/repos/langchain-ai/langchain/labels/investigate", "name": "investigate", "color": "0e8a16", "default": false, "description": "Flagged for investigation"}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 34, "created_at": "2024-10-28T06:25:17Z", "updated_at": "2025-02-07T06:14:22Z", "closed_at": "2025-02-07T06:14:16Z", "assignee": null, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### Checked other resources\r\n\r\n- [X] I added a very descriptive title to this issue.\r\n- [X] I searched the LangChain documentation with the integrated search.\r\n- [X] I used the GitHub search to find a similar question and didn't find it.\r\n- [X] I am sure that this is a bug in LangChain rather than my code.\r\n- [X] The bug is not resolved by updating to the latest stable version of LangChain (or the specific integration package).\r\n\r\n### Example Code\r\n\r\n```\r\nfrom langchain.agents import (initialize_agent, AgentType,)\r\nfrom langchain_ollama import ChatOllama\r\nfrom langchain_community.utilities.sql_database import SQLDatabase\r\nfrom langchain_community.agent_toolkits.sql.toolkit import SQLDatabaseToolkit\r\n\r\nllm = ChatOllama(\r\n    model=\"llama3:latest\", // I have test llama3 or qwen2.5:7b is the same \r\n    base_url=\"http://localhost:11434\",\r\n    timeout=300,\r\n    temperature=0,\r\n)\r\n\r\ndb = SQLDatabase.from_uri(\"mysql+pymysql://root@xxxx:xxxx/xxxx\")\r\ntools = SQLDatabaseToolkit(db=db, llm=llm).get_tools()\r\n\r\nagent = initialize_agent(\r\n    tools=tools,\r\n    agent=AgentType.ZERO_SHOT_REACT_DESCRIPTION,\r\n    llm=llm,\r\n    handle_parsing_errors=True,\r\n    verbose=True,\r\n)\r\n\r\n# execute SQL query\r\nuser_input = \"execute select count(1) from `meeting_summary_daily`\"\r\nresponse = agent.run(user_input)\r\nprint(f\"Assistant: {response}\")\r\n```\r\n\r\n### Error Message and Stack Trace (if applicable)\r\n\r\n```\r\n>Entering new AgentExecutor chain...\r\nI think we need to start by checking if the table \"meeting_summary_daily\" exists in the database. Let's use sql_db_list_tables for that.\r\n\r\nAction: sql_db_list_tables\r\nAction Input: (empty string\r\nObservation: wap_meeting_summary_daily\r\nThought:Let's continue!\r\n\r\nThought: Now that we know the table exists, let's check if our query is correct before executing it. We'll use sql_db_query_checker for this.\r\n\r\nAction: sql_db_query_checker\r\nAction Input: select count(1) from `meeting_summary_daily\r\nObservation: The original query is:\r\n\r\nSELECT COUNT(1) FROM `meeting_summary_daily`\r\n\r\nThis query does not contain any common mistakes. Therefore, the rewritten query remains the same:\r\n\r\nSELECT COUNT(1) FROM `meeting_summary_daily`\r\nThought:Let's continue!\r\n\r\nThought: Now that we know our query is correct, let's execute it using sql_db_query.\r\n\r\nAction: sql_db_query\r\nAction Input: select count(1) from `meeting_summary_daily\r\nObservation: Error: (pymysql.err.ProgrammingError) (1064, \"Getting syntax error at line 1, column 43. Detail message: No viable statement for input 'from '.\")\r\n[SQL: select count(1) from `meeting_summary_daily]\r\n\r\n```\r\n\r\n### Description\r\n\r\n```\r\nAction: sql_db_query\r\nAction Input: select count(1) from `meeting_summary_daily\r\n```\r\n\r\nYou can see the output about Action Input, there is no last ` .\r\n\r\n\r\nAnd I test other tools.\r\n\r\n\r\nHere is the tools\r\n\r\n```\r\ndef sql_query_tool(json):\r\n    print(\"\\n\\njson: \", json)\r\n\r\nsql_tool = Tool(\r\n    name=\"sql_query_tool\",\r\n    func=sql_query_tool,\r\n    description=\"\"\"\r\n      save sql query tools, can save sql and set frequency via user input\r\n      needs to pass the input text for json model to tools\r\n      has below fields:\r\n        sql: user input sql\r\n        frequency: like every 5 minutes\r\n   \"\"\",\r\n)\r\n\r\n# execute SQL query\r\nuser_input = \"save sql query, my sql is select count(1) from `table` and frequency is every 3 mins;\"\r\nresponse = agent.run(user_input)\r\nprint(f\"Assistant: {response}\")\r\n```\r\n\r\noutput:\r\n\r\n```\r\n> Entering new AgentExecutor chain...\r\nI need to use the `sql_query_tool` to save the SQL query with the specified frequency.\r\nAction: sql_query_tool\r\nAction Input: {\"sql\": \"select count(1) from `table`\", \"frequency\": \"every 3 minutes\r\n\r\njson:  {\"sql\": \"select count(1) from `table`\", \"frequency\": \"every 3 minutes\r\n```\r\n\r\nYou can see the Action Input lost the \" and }.\r\n\r\n\r\n\r\n\r\n\r\n### System Info\r\n```\r\npython -m langchain_core.sys_info                 \u272d\r\n\r\nSystem Information\r\n------------------\r\n> OS:  Darwin\r\n> OS Version:  Darwin Kernel Version 23.6.0: Mon Jul 29 21:14:30 PDT 2024; root:xnu-10063.141.2~1/RELEASE_ARM64_T6000\r\n> Python Version:  3.10.11 (v3.10.11:7d4cc5aa85, Apr  4 2023, 19:05:19) [Clang 13.0.0 (clang-1300.0.29.30)]\r\n\r\n\r\nPackage Information\r\n-------------------\r\n> langchain_core: 0.3.10\r\n> langchain: 0.3.3\r\n> langchain_community: 0.3.2\r\n> langsmith: 0.1.134\r\n> langchain_huggingface: 0.1.0\r\n> langchain_ollama: 0.2.0\r\n> langchain_openai: 0.2.2\r\n> langchain_text_splitters: 0.3.0\r\n> langgraph: 0.2.35\r\n> langserve: 0.3.0\r\n```", "closed_by": {"login": "qingwli", "id": 20885366, "node_id": "MDQ6VXNlcjIwODg1MzY2", "avatar_url": "https://avatars.githubusercontent.com/u/20885366?v=4", "gravatar_id": "", "url": "https://api.github.com/users/qingwli", "html_url": "https://github.com/qingwli", "followers_url": "https://api.github.com/users/qingwli/followers", "following_url": "https://api.github.com/users/qingwli/following{/other_user}", "gists_url": "https://api.github.com/users/qingwli/gists{/gist_id}", "starred_url": "https://api.github.com/users/qingwli/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/qingwli/subscriptions", "organizations_url": "https://api.github.com/users/qingwli/orgs", "repos_url": "https://api.github.com/users/qingwli/repos", "events_url": "https://api.github.com/users/qingwli/events{/privacy}", "received_events_url": "https://api.github.com/users/qingwli/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/langchain-ai/langchain/issues/27673/reactions", "total_count": 2, "+1": 2, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/langchain-ai/langchain/issues/27673/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/langchain-ai/langchain/issues/12949", "repository_url": "https://api.github.com/repos/langchain-ai/langchain", "labels_url": "https://api.github.com/repos/langchain-ai/langchain/issues/12949/labels{/name}", "comments_url": "https://api.github.com/repos/langchain-ai/langchain/issues/12949/comments", "events_url": "https://api.github.com/repos/langchain-ai/langchain/issues/12949/events", "html_url": "https://github.com/langchain-ai/langchain/issues/12949", "id": 1980034271, "node_id": "I_kwDOIPDwls52BOzf", "number": 12949, "title": "openai has no ChatCompletion attribute, this is likely due to an old version of the openai package. ", "user": {"login": "cta2106", "id": 32028497, "node_id": "MDQ6VXNlcjMyMDI4NDk3", "avatar_url": "https://avatars.githubusercontent.com/u/32028497?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cta2106", "html_url": "https://github.com/cta2106", "followers_url": "https://api.github.com/users/cta2106/followers", "following_url": "https://api.github.com/users/cta2106/following{/other_user}", "gists_url": "https://api.github.com/users/cta2106/gists{/gist_id}", "starred_url": "https://api.github.com/users/cta2106/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cta2106/subscriptions", "organizations_url": "https://api.github.com/users/cta2106/orgs", "repos_url": "https://api.github.com/users/cta2106/repos", "events_url": "https://api.github.com/users/cta2106/events{/privacy}", "received_events_url": "https://api.github.com/users/cta2106/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 5680700839, "node_id": "LA_kwDOIPDwls8AAAABUpidpw", "url": "https://api.github.com/repos/langchain-ai/langchain/labels/bug", "name": "bug", "color": "b60205", "default": true, "description": "Related to a bug, vulnerability, unexpected error with an existing feature"}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 34, "created_at": "2023-11-06T20:49:17Z", "updated_at": "2024-02-19T16:07:56Z", "closed_at": "2024-02-19T16:07:55Z", "assignee": null, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### System Info\r\n\r\nLangchain v0.0.323\r\nOpenai v1.0.1 (latest)\r\nPython v3.11.6\r\n\r\n### Who can help?\r\n\r\n@hwchase17 @agola11 \r\n\r\n### Information\r\n\r\n- [ ] The official example notebooks/scripts\r\n- [X] My own modified scripts\r\n\r\n### Related Components\r\n\r\n- [X] LLMs/Chat Models\r\n- [ ] Embedding Models\r\n- [ ] Prompts / Prompt Templates / Prompt Selectors\r\n- [ ] Output Parsers\r\n- [ ] Document Loaders\r\n- [ ] Vector Stores / Retrievers\r\n- [ ] Memory\r\n- [ ] Agents / Agent Executors\r\n- [ ] Tools / Toolkits\r\n- [ ] Chains\r\n- [ ] Callbacks/Tracing\r\n- [ ] Async\r\n\r\n### Reproduction\r\n\r\n```\r\nfrom langchain.chat_models import ChatOpenAI\r\n\r\nllm = ChatOpenAI(\r\n    model_name=\"gpt-4\",\r\n    request_timeout=120,\r\n)\r\n\r\n```\r\n\r\nopenai has no ChatCompletion attribute, this is likely due to an old version of the openai package. Try upgrading it with `pip install --upgrade openai`. (type=value_error)\r\n\r\n### Expected behavior\r\n\r\nThere is an issue with ChatOpenAI that I believe may be related to the newest openai python package update.", "closed_by": {"login": "dosubot[bot]", "id": 131922026, "node_id": "BOT_kgDOB9z4ag", "avatar_url": "https://avatars.githubusercontent.com/in/324583?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dosubot%5Bbot%5D", "html_url": "https://github.com/apps/dosubot", "followers_url": "https://api.github.com/users/dosubot%5Bbot%5D/followers", "following_url": "https://api.github.com/users/dosubot%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/dosubot%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/dosubot%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dosubot%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/dosubot%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/dosubot%5Bbot%5D/repos", "events_url": "https://api.github.com/users/dosubot%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/dosubot%5Bbot%5D/received_events", "type": "Bot", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/langchain-ai/langchain/issues/12949/reactions", "total_count": 22, "+1": 19, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 3}, "timeline_url": "https://api.github.com/repos/langchain-ai/langchain/issues/12949/timeline", "performed_via_github_app": null, "state_reason": "not_planned", "pinned_comment": null}, {"url": "https://api.github.com/repos/langchain-ai/langchain/issues/8363", "repository_url": "https://api.github.com/repos/langchain-ai/langchain", "labels_url": "https://api.github.com/repos/langchain-ai/langchain/issues/8363/labels{/name}", "comments_url": "https://api.github.com/repos/langchain-ai/langchain/issues/8363/comments", "events_url": "https://api.github.com/repos/langchain-ai/langchain/issues/8363/events", "html_url": "https://github.com/langchain-ai/langchain/issues/8363", "id": 1824692692, "node_id": "I_kwDOIPDwls5swpnU", "number": 8363, "title": "Arbitrary code execution in LLMMathChain", "user": {"login": "jan-kubena", "id": 140610022, "node_id": "U_kgDOCGGJ5g", "avatar_url": "https://avatars.githubusercontent.com/u/140610022?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jan-kubena", "html_url": "https://github.com/jan-kubena", "followers_url": "https://api.github.com/users/jan-kubena/followers", "following_url": "https://api.github.com/users/jan-kubena/following{/other_user}", "gists_url": "https://api.github.com/users/jan-kubena/gists{/gist_id}", "starred_url": "https://api.github.com/users/jan-kubena/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jan-kubena/subscriptions", "organizations_url": "https://api.github.com/users/jan-kubena/orgs", "repos_url": "https://api.github.com/users/jan-kubena/repos", "events_url": "https://api.github.com/users/jan-kubena/events{/privacy}", "received_events_url": "https://api.github.com/users/jan-kubena/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 5680700839, "node_id": "LA_kwDOIPDwls8AAAABUpidpw", "url": "https://api.github.com/repos/langchain-ai/langchain/labels/bug", "name": "bug", "color": "b60205", "default": true, "description": "Related to a bug, vulnerability, unexpected error with an existing feature"}], "state": "closed", "locked": true, "assignees": [{"login": "eyurtsev", "id": 3205522, "node_id": "MDQ6VXNlcjMyMDU1MjI=", "avatar_url": "https://avatars.githubusercontent.com/u/3205522?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eyurtsev", "html_url": "https://github.com/eyurtsev", "followers_url": "https://api.github.com/users/eyurtsev/followers", "following_url": "https://api.github.com/users/eyurtsev/following{/other_user}", "gists_url": "https://api.github.com/users/eyurtsev/gists{/gist_id}", "starred_url": "https://api.github.com/users/eyurtsev/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eyurtsev/subscriptions", "organizations_url": "https://api.github.com/users/eyurtsev/orgs", "repos_url": "https://api.github.com/users/eyurtsev/repos", "events_url": "https://api.github.com/users/eyurtsev/events{/privacy}", "received_events_url": "https://api.github.com/users/eyurtsev/received_events", "type": "User", "user_view_type": "public", "site_admin": false}], "milestone": null, "comments": 33, "created_at": "2023-07-27T16:00:56Z", "updated_at": "2024-03-13T16:12:31Z", "closed_at": "2023-10-27T19:15:18Z", "assignee": {"login": "eyurtsev", "id": 3205522, "node_id": "MDQ6VXNlcjMyMDU1MjI=", "avatar_url": "https://avatars.githubusercontent.com/u/3205522?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eyurtsev", "html_url": "https://github.com/eyurtsev", "followers_url": "https://api.github.com/users/eyurtsev/followers", "following_url": "https://api.github.com/users/eyurtsev/following{/other_user}", "gists_url": "https://api.github.com/users/eyurtsev/gists{/gist_id}", "starred_url": "https://api.github.com/users/eyurtsev/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eyurtsev/subscriptions", "organizations_url": "https://api.github.com/users/eyurtsev/orgs", "repos_url": "https://api.github.com/users/eyurtsev/repos", "events_url": "https://api.github.com/users/eyurtsev/events{/privacy}", "received_events_url": "https://api.github.com/users/eyurtsev/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "author_association": "NONE", "type": null, "active_lock_reason": "resolved", "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### System Info\n\nLangchain version: 0.0.244\r\nNumexpr version: 2.8.4\r\nPython version: 3.10.11\r\n\n\n### Who can help?\n\n@hwchase17 @vowelparrot \n\n### Information\n\n- [ ] The official example notebooks/scripts\n- [ ] My own modified scripts\n\n### Related Components\n\n- [ ] LLMs/Chat Models\n- [ ] Embedding Models\n- [ ] Prompts / Prompt Templates / Prompt Selectors\n- [ ] Output Parsers\n- [ ] Document Loaders\n- [ ] Vector Stores / Retrievers\n- [ ] Memory\n- [ ] Agents / Agent Executors\n- [ ] Tools / Toolkits\n- [X] Chains\n- [ ] Callbacks/Tracing\n- [ ] Async\n\n### Reproduction\n\nNumexpr's evaluate function that Langchain uses [here](https://github.com/langchain-ai/langchain/blob/master/libs/langchain/langchain/chains/llm_math/base.py#L80) in the LLMMathChain is susceptible to arbitrary code execution with eval in the latest released version. See this [issue](https://github.com/pydata/numexpr/issues/442) where PoC for numexpr's evaluate is also provided.\r\n\r\nThis vulnerability allows an arbitrary code execution, that is to run code and commands on target machine, via LLMMathChain's run method with the right prompt. I'd like to ask the Langchain's maintainers to confirm if they want a full PoC with Langchain posted here publicly.\n\n### Expected behavior\n\nNumerical expressions should be evaluated securely so as to not allow code execution.", "closed_by": {"login": "eyurtsev", "id": 3205522, "node_id": "MDQ6VXNlcjMyMDU1MjI=", "avatar_url": "https://avatars.githubusercontent.com/u/3205522?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eyurtsev", "html_url": "https://github.com/eyurtsev", "followers_url": "https://api.github.com/users/eyurtsev/followers", "following_url": "https://api.github.com/users/eyurtsev/following{/other_user}", "gists_url": "https://api.github.com/users/eyurtsev/gists{/gist_id}", "starred_url": "https://api.github.com/users/eyurtsev/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eyurtsev/subscriptions", "organizations_url": "https://api.github.com/users/eyurtsev/orgs", "repos_url": "https://api.github.com/users/eyurtsev/repos", "events_url": "https://api.github.com/users/eyurtsev/events{/privacy}", "received_events_url": "https://api.github.com/users/eyurtsev/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/langchain-ai/langchain/issues/8363/reactions", "total_count": 2, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 2}, "timeline_url": "https://api.github.com/repos/langchain-ai/langchain/issues/8363/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/langchain-ai/langchain/issues/17514", "repository_url": "https://api.github.com/repos/langchain-ai/langchain", "labels_url": "https://api.github.com/repos/langchain-ai/langchain/issues/17514/labels{/name}", "comments_url": "https://api.github.com/repos/langchain-ai/langchain/issues/17514/comments", "events_url": "https://api.github.com/repos/langchain-ai/langchain/issues/17514/events", "html_url": "https://github.com/langchain-ai/langchain/issues/17514", "id": 2133944378, "node_id": "I_kwDOIPDwls5_MWg6", "number": 17514, "title": "import pwd on windows", "user": {"login": "vorel99", "id": 71695857, "node_id": "MDQ6VXNlcjcxNjk1ODU3", "avatar_url": "https://avatars.githubusercontent.com/u/71695857?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vorel99", "html_url": "https://github.com/vorel99", "followers_url": "https://api.github.com/users/vorel99/followers", "following_url": "https://api.github.com/users/vorel99/following{/other_user}", "gists_url": "https://api.github.com/users/vorel99/gists{/gist_id}", "starred_url": "https://api.github.com/users/vorel99/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vorel99/subscriptions", "organizations_url": "https://api.github.com/users/vorel99/orgs", "repos_url": "https://api.github.com/users/vorel99/repos", "events_url": "https://api.github.com/users/vorel99/events{/privacy}", "received_events_url": "https://api.github.com/users/vorel99/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 5680700839, "node_id": "LA_kwDOIPDwls8AAAABUpidpw", "url": "https://api.github.com/repos/langchain-ai/langchain/labels/bug", "name": "bug", "color": "b60205", "default": true, "description": "Related to a bug, vulnerability, unexpected error with an existing feature"}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 32, "created_at": "2024-02-14T09:51:15Z", "updated_at": "2024-08-11T11:49:24Z", "closed_at": "2024-02-15T08:09:32Z", "assignee": null, "author_association": "CONTRIBUTOR", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### Checked other resources\r\n\r\n- [X] I added a very descriptive title to this issue.\r\n- [X] I searched the LangChain documentation with the integrated search.\r\n- [X] I used the GitHub search to find a similar question and didn't find it.\r\n- [X] I am sure that this is a bug in LangChain rather than my code.\r\n\r\n### Example Code\r\n\r\nfrom langchain.retrievers.multi_query import MultiQueryRetriever\r\n\r\nMultiQueryRetriever()\r\n\r\n### Error Message and Stack Trace (if applicable)\r\n\r\nvenv\\Lib\\site-packages\\langchain\\retrievers\\__init__.py:37: in <module>\r\n    from langchain.retrievers.web_research import WebResearchRetriever\r\nvenv\\Lib\\site-packages\\langchain\\retrievers\\web_research.py:5: in <module>\r\n    from langchain_community.document_loaders import AsyncHtmlLoader\r\nvenv\\Lib\\site-packages\\langchain_community\\document_loaders\\__init__.py:163: in <module>\r\n    from langchain_community.document_loaders.pebblo import PebbloSafeLoader\r\nvenv\\Lib\\site-packages\\langchain_community\\document_loaders\\pebblo.py:5: in <module>\r\n    import pwd\r\nE   ModuleNotFoundError: No module named 'pwd'\r\n\r\n\r\n### Description\r\n\r\nThere is no `pwd` on windows. \r\n\r\n### System Info\r\n\r\npython 3.11.2\r\n\r\nlangchain==0.1.7", "closed_by": {"login": "vorel99", "id": 71695857, "node_id": "MDQ6VXNlcjcxNjk1ODU3", "avatar_url": "https://avatars.githubusercontent.com/u/71695857?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vorel99", "html_url": "https://github.com/vorel99", "followers_url": "https://api.github.com/users/vorel99/followers", "following_url": "https://api.github.com/users/vorel99/following{/other_user}", "gists_url": "https://api.github.com/users/vorel99/gists{/gist_id}", "starred_url": "https://api.github.com/users/vorel99/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vorel99/subscriptions", "organizations_url": "https://api.github.com/users/vorel99/orgs", "repos_url": "https://api.github.com/users/vorel99/repos", "events_url": "https://api.github.com/users/vorel99/events{/privacy}", "received_events_url": "https://api.github.com/users/vorel99/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/langchain-ai/langchain/issues/17514/reactions", "total_count": 12, "+1": 12, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/langchain-ai/langchain/issues/17514/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/langchain-ai/langchain/issues/8714", "repository_url": "https://api.github.com/repos/langchain-ai/langchain", "labels_url": "https://api.github.com/repos/langchain-ai/langchain/issues/8714/labels{/name}", "comments_url": "https://api.github.com/repos/langchain-ai/langchain/issues/8714/comments", "events_url": "https://api.github.com/repos/langchain-ai/langchain/issues/8714/events", "html_url": "https://github.com/langchain-ai/langchain/issues/8714", "id": 1835633568, "node_id": "I_kwDOIPDwls5taYug", "number": 8714, "title": "Getting NameError: name 'partition_pdf' is not defined when running \"documents = loader.load()\"", "user": {"login": "botchagalupe", "id": 457288, "node_id": "MDQ6VXNlcjQ1NzI4OA==", "avatar_url": "https://avatars.githubusercontent.com/u/457288?v=4", "gravatar_id": "", "url": "https://api.github.com/users/botchagalupe", "html_url": "https://github.com/botchagalupe", "followers_url": "https://api.github.com/users/botchagalupe/followers", "following_url": "https://api.github.com/users/botchagalupe/following{/other_user}", "gists_url": "https://api.github.com/users/botchagalupe/gists{/gist_id}", "starred_url": "https://api.github.com/users/botchagalupe/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/botchagalupe/subscriptions", "organizations_url": "https://api.github.com/users/botchagalupe/orgs", "repos_url": "https://api.github.com/users/botchagalupe/repos", "events_url": "https://api.github.com/users/botchagalupe/events{/privacy}", "received_events_url": "https://api.github.com/users/botchagalupe/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 5680700839, "node_id": "LA_kwDOIPDwls8AAAABUpidpw", "url": "https://api.github.com/repos/langchain-ai/langchain/labels/bug", "name": "bug", "color": "b60205", "default": true, "description": "Related to a bug, vulnerability, unexpected error with an existing feature"}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 31, "created_at": "2023-08-03T19:40:00Z", "updated_at": "2024-08-15T12:34:25Z", "closed_at": "2024-06-29T16:06:17Z", "assignee": null, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### System Info\n\nI have been running this code for weeks, and today it looks like something changed to break it. I'm using the following code snippets...\r\n\r\nfrom langchain.document_loaders import DirectoryLoader\r\n...\r\nloader = DirectoryLoader(directory_path, glob='**/*.pdf')\r\ndocuments = loader.load()\r\n\r\nThis is the error I am getting...\r\n\r\n---------------------------------------------------------------------------\r\nNameError                                 Traceback (most recent call last)\r\n[<ipython-input-9-8159690dd515>](https://localhost:8080/#) in <cell line: 2>()\r\n      1 loader = DirectoryLoader(directory_path, glob='**/*.pdf')\r\n----> 2 documents = loader.load()\r\n      3 print(\"Number of documents: \", len(documents))\r\n      4 \r\n      5 timestampit()\r\n\r\n5 frames\r\n[/usr/local/lib/python3.10/dist-packages/unstructured/partition/auto.py](https://localhost:8080/#) in partition(filename, content_type, file, file_filename, url, include_page_breaks, strategy, encoding, paragraph_grouper, headers, skip_infer_table_types, ssl_verify, ocr_languages, pdf_infer_table_structure, xml_keep_tags, data_source_metadata, **kwargs)\r\n    219         )\r\n    220     elif filetype == FileType.PDF:\r\n--> 221         elements = partition_pdf(\r\n    222             filename=filename,  # type: ignore\r\n    223             file=file,  # type: ignore\r\n\r\nNameError: name 'partition_pdf' is not defined\r\n\r\n\n\n### Who can help?\n\n_No response_\n\n### Information\n\n- [ ] The official example notebooks/scripts\n- [X] My own modified scripts\n\n### Related Components\n\n- [ ] LLMs/Chat Models\n- [ ] Embedding Models\n- [ ] Prompts / Prompt Templates / Prompt Selectors\n- [ ] Output Parsers\n- [X] Document Loaders\n- [ ] Vector Stores / Retrievers\n- [ ] Memory\n- [ ] Agents / Agent Executors\n- [ ] Tools / Toolkits\n- [ ] Chains\n- [ ] Callbacks/Tracing\n- [ ] Async\n\n### Reproduction\n\nloader = DirectoryLoader(directory_path, glob='**/*.pdf')\r\ndocuments = loader.load()\n\n### Expected behavior\n\nLoaded documents.", "closed_by": {"login": "dosubot[bot]", "id": 131922026, "node_id": "BOT_kgDOB9z4ag", "avatar_url": "https://avatars.githubusercontent.com/in/324583?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dosubot%5Bbot%5D", "html_url": "https://github.com/apps/dosubot", "followers_url": "https://api.github.com/users/dosubot%5Bbot%5D/followers", "following_url": "https://api.github.com/users/dosubot%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/dosubot%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/dosubot%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dosubot%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/dosubot%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/dosubot%5Bbot%5D/repos", "events_url": "https://api.github.com/users/dosubot%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/dosubot%5Bbot%5D/received_events", "type": "Bot", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/langchain-ai/langchain/issues/8714/reactions", "total_count": 1, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 1}, "timeline_url": "https://api.github.com/repos/langchain-ai/langchain/issues/8714/timeline", "performed_via_github_app": null, "state_reason": "not_planned", "pinned_comment": null}, {"url": "https://api.github.com/repos/langchain-ai/langchain/issues/14872", "repository_url": "https://api.github.com/repos/langchain-ai/langchain", "labels_url": "https://api.github.com/repos/langchain-ai/langchain/issues/14872/labels{/name}", "comments_url": "https://api.github.com/repos/langchain-ai/langchain/issues/14872/comments", "events_url": "https://api.github.com/repos/langchain-ai/langchain/issues/14872/events", "html_url": "https://github.com/langchain-ai/langchain/issues/14872", "id": 2047680474, "node_id": "I_kwDOIPDwls56DR_a", "number": 14872, "title": "Calling Chroma.from_documents() returns sqlite3.OperationalError: attempt to write a readonly database, but only sometimes", "user": {"login": "gracewzhang", "id": 32557716, "node_id": "MDQ6VXNlcjMyNTU3NzE2", "avatar_url": "https://avatars.githubusercontent.com/u/32557716?v=4", "gravatar_id": "", "url": "https://api.github.com/users/gracewzhang", "html_url": "https://github.com/gracewzhang", "followers_url": "https://api.github.com/users/gracewzhang/followers", "following_url": "https://api.github.com/users/gracewzhang/following{/other_user}", "gists_url": "https://api.github.com/users/gracewzhang/gists{/gist_id}", "starred_url": "https://api.github.com/users/gracewzhang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/gracewzhang/subscriptions", "organizations_url": "https://api.github.com/users/gracewzhang/orgs", "repos_url": "https://api.github.com/users/gracewzhang/repos", "events_url": "https://api.github.com/users/gracewzhang/events{/privacy}", "received_events_url": "https://api.github.com/users/gracewzhang/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 5680700839, "node_id": "LA_kwDOIPDwls8AAAABUpidpw", "url": "https://api.github.com/repos/langchain-ai/langchain/labels/bug", "name": "bug", "color": "b60205", "default": true, "description": "Related to a bug, vulnerability, unexpected error with an existing feature"}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 28, "created_at": "2023-12-19T00:02:10Z", "updated_at": "2025-06-17T16:01:25Z", "closed_at": "2025-06-17T16:01:24Z", "assignee": null, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### System Info\r\n\r\nPlatform: Ubuntu 22.04\r\nPython: 3.11.6\r\nLangchain: 0.0.351\r\n\r\n### Who can help?\r\n\r\n_No response_\r\n\r\n### Information\r\n\r\n- [ ] The official example notebooks/scripts\r\n- [X] My own modified scripts\r\n\r\n### Related Components\r\n\r\n- [X] LLMs/Chat Models\r\n- [ ] Embedding Models\r\n- [ ] Prompts / Prompt Templates / Prompt Selectors\r\n- [ ] Output Parsers\r\n- [ ] Document Loaders\r\n- [X] Vector Stores / Retrievers\r\n- [ ] Memory\r\n- [ ] Agents / Agent Executors\r\n- [ ] Tools / Toolkits\r\n- [ ] Chains\r\n- [ ] Callbacks/Tracing\r\n- [ ] Async\r\n\r\n### Reproduction\r\n\r\nWhen the program is first initialized with `__setup_client()` and `__should_reingest()` returns `True`, `__get_new_client()` works as intended. However, if `reingest()` is called afterward, `__get_new_client()` returns the error below.\r\n\r\nRelevant code:\r\n```python\r\ndef __setup_client(self) -> None:\r\n    if self.__should_reingest():\r\n        self.db = self.__get_new_client()\r\n    else:\r\n        self.db = self.__get_existing_client()\r\n\r\ndef reingest(self) -> None:\r\n     self.db = self.__get_new_client()\r\n\r\n def __get_new_client(self):\r\n    if os.path.exists(self.persist_directory):\r\n        shutil.rmtree(self.persist_directory)\r\n\r\n    docs = self.__get_docs()\r\n    client = Chroma.from_documents(\r\n        docs, self.embedding_function, persist_directory=self.persist_directory)\r\n\r\n    with open(f'{self.persist_directory}/date.txt', 'w') as f:\r\n        f.write(f'{datetime.date.today()}')\r\n    return client\r\n```\r\n\r\nError:\r\n```\r\nTraceback (most recent call last):\r\n  ...\r\n  File line 26, in reingest\r\n    self.cauldron.reingest()\r\n  File line 19, in reingest\r\n    self.db = self.__get_new_client()\r\n              ^^^^^^^^^^^^^^^^^^^^^^^\r\n  File line 51, in __get_new_client\r\n    client = Chroma.from_documents(\r\n             ^^^^^^^^^^^^^^^^^^^^^^\r\n  File \".../.pyenv/versions/3.11.6/lib/python3.11/site-packages/langchain_community/vectorstores/chroma.py\", line 771, in from_documents\r\n    return cls.from_texts(\r\n           ^^^^^^^^^^^^^^^\r\n  File \".../.pyenv/versions/3.11.6/lib/python3.11/site-packages/langchain_community/vectorstores/chroma.py\", line 729, in from_texts\r\n    chroma_collection.add_texts(\r\n  File \".../.pyenv/versions/3.11.6/lib/python3.11/site-packages/langchain_community/vectorstores/chroma.py\", line 297, in add_texts\r\n    self._collection.upsert(\r\n  File \".../.pyenv/versions/3.11.6/lib/python3.11/site-packages/chromadb/api/models/Collection.py\", line 459, in upsert\r\n    self._client._upsert(\r\n  File \".../.pyenv/versions/3.11.6/lib/python3.11/site-packages/chromadb/telemetry/opentelemetry/__init__.py\", line 127, in wrapper\r\n    return f(*args, **kwargs)\r\n           ^^^^^^^^^^^^^^^^^^\r\n  File \".../.pyenv/versions/3.11.6/lib/python3.11/site-packages/chromadb/api/segment.py\", line 446, in _upsert\r\n    self._producer.submit_embeddings(coll[\"topic\"], records_to_submit)\r\n  File \".../.pyenv/versions/3.11.6/lib/python3.11/site-packages/chromadb/telemetry/opentelemetry/__init__.py\", line 127, in wrapper\r\n    return f(*args, **kwargs)\r\n           ^^^^^^^^^^^^^^^^^^\r\n  File \".../.pyenv/versions/3.11.6/lib/python3.11/site-packages/chromadb/db/mixins/embeddings_queue.py\", line 172, in submit_embeddings\r\n    results = cur.execute(sql, params).fetchall()\r\n              ^^^^^^^^^^^^^^^^^^^^^^^^\r\nsqlite3.OperationalError: attempt to write a readonly database\r\n```\r\n\r\n### Expected behavior\r\n\r\nNo error returned", "closed_by": {"login": "dosubot[bot]", "id": 131922026, "node_id": "BOT_kgDOB9z4ag", "avatar_url": "https://avatars.githubusercontent.com/in/324583?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dosubot%5Bbot%5D", "html_url": "https://github.com/apps/dosubot", "followers_url": "https://api.github.com/users/dosubot%5Bbot%5D/followers", "following_url": "https://api.github.com/users/dosubot%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/dosubot%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/dosubot%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dosubot%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/dosubot%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/dosubot%5Bbot%5D/repos", "events_url": "https://api.github.com/users/dosubot%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/dosubot%5Bbot%5D/received_events", "type": "Bot", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/langchain-ai/langchain/issues/14872/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/langchain-ai/langchain/issues/14872/timeline", "performed_via_github_app": null, "state_reason": "not_planned", "pinned_comment": null}, {"url": "https://api.github.com/repos/langchain-ai/langchain/issues/14337", "repository_url": "https://api.github.com/repos/langchain-ai/langchain", "labels_url": "https://api.github.com/repos/langchain-ai/langchain/issues/14337/labels{/name}", "comments_url": "https://api.github.com/repos/langchain-ai/langchain/issues/14337/comments", "events_url": "https://api.github.com/repos/langchain-ai/langchain/issues/14337/events", "html_url": "https://github.com/langchain-ai/langchain/issues/14337", "id": 2028038022, "node_id": "I_kwDOIPDwls544WeG", "number": 14337, "title": "Dict validation error", "user": {"login": "Vignesh1489", "id": 135110120, "node_id": "U_kgDOCA2d6A", "avatar_url": "https://avatars.githubusercontent.com/u/135110120?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Vignesh1489", "html_url": "https://github.com/Vignesh1489", "followers_url": "https://api.github.com/users/Vignesh1489/followers", "following_url": "https://api.github.com/users/Vignesh1489/following{/other_user}", "gists_url": "https://api.github.com/users/Vignesh1489/gists{/gist_id}", "starred_url": "https://api.github.com/users/Vignesh1489/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Vignesh1489/subscriptions", "organizations_url": "https://api.github.com/users/Vignesh1489/orgs", "repos_url": "https://api.github.com/users/Vignesh1489/repos", "events_url": "https://api.github.com/users/Vignesh1489/events{/privacy}", "received_events_url": "https://api.github.com/users/Vignesh1489/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 5680700839, "node_id": "LA_kwDOIPDwls8AAAABUpidpw", "url": "https://api.github.com/repos/langchain-ai/langchain/labels/bug", "name": "bug", "color": "b60205", "default": true, "description": "Related to a bug, vulnerability, unexpected error with an existing feature"}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 28, "created_at": "2023-12-06T08:43:25Z", "updated_at": "2024-06-29T16:16:49Z", "closed_at": "2024-04-16T16:20:41Z", "assignee": null, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### System Info\n\nTrying to execute the chatbot script with sagemaker endpoint of LLAMA2 llm model getting dict validation error for RetrievalQA\r\n\r\nRequest:\r\ndef retreiveFromLL(userQuery: str) -> QueryResponse:\r\n    pre_prompt = \"\"\"[INST] <<SYS>>\r\n\r\n    You are a helpful, respectful and honest assistant. Answer exactly in detail from the context\r\n\r\n    <</SYS>>\r\n    Answer the question below from context below :\r\n\r\n    \"\"\"\r\n    prompt = pre_prompt + \"CONTEXT:\\n\\n{context}\\n\" +\"Question : {question}\" + \"[\\INST]\"\r\n    llama_prompt = PromptTemplate(template=prompt, input_variables=[\"context\", \"question\"])\r\n    chain_type_kwargs = {\"prompt\": llama_prompt}\r\n\r\n    embeddings = SentenceTransformerEmbeddings(model_name=EMBEDDING_MODEL)\r\n\r\n    # Initialize PGVector index\r\n    vector_db = PGVector(\r\n        embedding_function=embeddings,\r\n        collection_name='CSE_runbooks',\r\n        connection_string=CONNECTION_STRING,\r\n    )\r\n    print(\"**Invoking PGVector\")\r\n\r\n        # Custom ContentHandler to handle input and output to the SageMaker Endpoint\r\n    class LlamaChatContentHandler(LLMContentHandler):\r\n        content_type = \"application/json\"\r\n        accepts = \"application/json\"\r\n\r\n        def transform_input(self, inputs: str, model_kwargs: Dict = {}) -> bytes:\r\n            payload = {\r\n        \"inputs\": pre_prompt,\r\n                \"parameters\": {\"max_new_tokens\":2000, \"top_p\":0.9, \"temperature\":0.1}}\r\n            input_str = ' '.join(inputs)\r\n            input_str = json.dumps(payload)\r\n            print(payload)\r\n            return input_str.encode(\"utf-8\")\r\n\r\n        def transform_output(self, output: bytes) -> str:\r\n            response_json = json.loads(output.read().decode(\"utf-8\"))\r\n            content = response_json[0][\"generated_text\"]\r\n            return content\r\n    # Initialize SagemakerEndpoint\r\n    print(\"Invoking LLM SageMaker Endpoint\")\r\n    llm = SagemakerEndpoint(\r\n        endpoint_name=LLAMA2_ENDPOINT,\r\n        region_name=AWS_REGION,\r\n        content_handler=LlamaChatContentHandler(),\r\n        callbacks=[StreamingStdOutCallbackHandler()],\r\n        endpoint_kwargs={\"CustomAttributes\": \"accept_eula=true\"},\r\n    )\r\n    print(llm)    \r\n\r\n    # Create a RetrievalQA instance with Pinecone as the retriever\r\n    query = RetrievalQA.from_chain_type(llm=llm, chain_type=\"stuff\", retriever=vector_db, return_source_documents=True, chain_type_kwargs=chain_type_kwargs)\r\n\r\n    print(\"**Invoking query\")\r\n    result = query({\"query\": userQuery})\r\n    response = result[\"result\"]\r\n\r\nError:\r\nTraceback (most recent call last):\r\n  File \"/home/ec2-user/.local/lib/python3.9/site-packages/streamlit/runtime/scriptrunner/script_runner.py\", line 534, in _run_script\r\n    exec(code, module.__dict__)\r\n  File \"/home/ec2-user/milvus/qa_UI.py\", line 26, in <module>\r\n    userResponse = getLLMResponse(user_input)\r\n  File \"/home/ec2-user/milvus/getLLMResponse1.py\", line 37, in getLLMResponse\r\n    userResponse = retreiveFromLL(userQuery)\r\n  File \"/home/ec2-user/milvus/getLLMResponse1.py\", line 97, in retreiveFromLL\r\n    query = RetrievalQA.from_chain_type(llm=llm, chain_type=\"stuff\", retriever=vector_db, return_source_documents=True, chain_type_kwargs=chain_type_kwargs)\r\n  File \"/home/ec2-user/.local/lib/python3.9/site-packages/langchain/chains/retrieval_qa/base.py\", line 103, in from_chain_type\r\n    return cls(combine_documents_chain=combine_documents_chain, **kwargs)\r\n  File \"/home/ec2-user/.local/lib/python3.9/site-packages/langchain/load/serializable.py\", line 97, in __init__\r\n    super().__init__(**kwargs)\r\n  File \"/home/ec2-user/.local/lib/python3.9/site-packages/pydantic/v1/main.py\", line 341, in __init__\r\n    raise validation_error\r\npydantic.v1.error_wrappers.ValidationError: 1 validation error for RetrievalQA\r\nretriever\r\n  value is not a valid dict (type=type_error.dict)\n\n### Who can help?\n\n_No response_\n\n### Information\n\n- [ ] The official example notebooks/scripts\n- [ ] My own modified scripts\n\n### Related Components\n\n- [X] LLMs/Chat Models\n- [X] Embedding Models\n- [ ] Prompts / Prompt Templates / Prompt Selectors\n- [ ] Output Parsers\n- [ ] Document Loaders\n- [X] Vector Stores / Retrievers\n- [ ] Memory\n- [ ] Agents / Agent Executors\n- [ ] Tools / Toolkits\n- [X] Chains\n- [ ] Callbacks/Tracing\n- [ ] Async\n\n### Reproduction\n\nExecute the code\n\n### Expected behavior\n\nresponse from LLM", "closed_by": {"login": "dosubot[bot]", "id": 131922026, "node_id": "BOT_kgDOB9z4ag", "avatar_url": "https://avatars.githubusercontent.com/in/324583?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dosubot%5Bbot%5D", "html_url": "https://github.com/apps/dosubot", "followers_url": "https://api.github.com/users/dosubot%5Bbot%5D/followers", "following_url": "https://api.github.com/users/dosubot%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/dosubot%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/dosubot%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dosubot%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/dosubot%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/dosubot%5Bbot%5D/repos", "events_url": "https://api.github.com/users/dosubot%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/dosubot%5Bbot%5D/received_events", "type": "Bot", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/langchain-ai/langchain/issues/14337/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/langchain-ai/langchain/issues/14337/timeline", "performed_via_github_app": null, "state_reason": "not_planned", "pinned_comment": null}, {"url": "https://api.github.com/repos/langchain-ai/langchain/issues/11422", "repository_url": "https://api.github.com/repos/langchain-ai/langchain", "labels_url": "https://api.github.com/repos/langchain-ai/langchain/issues/11422/labels{/name}", "comments_url": "https://api.github.com/repos/langchain-ai/langchain/issues/11422/comments", "events_url": "https://api.github.com/repos/langchain-ai/langchain/issues/11422/events", "html_url": "https://github.com/langchain-ai/langchain/issues/11422", "id": 1927423576, "node_id": "I_kwDOIPDwls5y4iZY", "number": 11422, "title": "SupabaseVectorStore.from_documents is not working", "user": {"login": "venurawarnasooriya", "id": 139458172, "node_id": "U_kgDOCE_2fA", "avatar_url": "https://avatars.githubusercontent.com/u/139458172?v=4", "gravatar_id": "", "url": "https://api.github.com/users/venurawarnasooriya", "html_url": "https://github.com/venurawarnasooriya", "followers_url": "https://api.github.com/users/venurawarnasooriya/followers", "following_url": "https://api.github.com/users/venurawarnasooriya/following{/other_user}", "gists_url": "https://api.github.com/users/venurawarnasooriya/gists{/gist_id}", "starred_url": "https://api.github.com/users/venurawarnasooriya/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/venurawarnasooriya/subscriptions", "organizations_url": "https://api.github.com/users/venurawarnasooriya/orgs", "repos_url": "https://api.github.com/users/venurawarnasooriya/repos", "events_url": "https://api.github.com/users/venurawarnasooriya/events{/privacy}", "received_events_url": "https://api.github.com/users/venurawarnasooriya/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 5680700839, "node_id": "LA_kwDOIPDwls8AAAABUpidpw", "url": "https://api.github.com/repos/langchain-ai/langchain/labels/bug", "name": "bug", "color": "b60205", "default": true, "description": "Related to a bug, vulnerability, unexpected error with an existing feature"}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 28, "created_at": "2023-10-05T05:39:43Z", "updated_at": "2024-07-04T16:06:49Z", "closed_at": "2024-07-04T16:06:48Z", "assignee": null, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### System Info\n\nlangchain==0.0.300\r\nsupabase==1.1.1\n\n### Who can help?\n\n@hwaking @eyurtsev @agola11 @eyurtsev @hwchase17 @agola11 \n\n### Information\n\n- [X] The official example notebooks/scripts\n- [X] My own modified scripts\n\n### Related Components\n\n- [ ] LLMs/Chat Models\n- [ ] Embedding Models\n- [ ] Prompts / Prompt Templates / Prompt Selectors\n- [ ] Output Parsers\n- [ ] Document Loaders\n- [X] Vector Stores / Retrievers\n- [ ] Memory\n- [ ] Agents / Agent Executors\n- [ ] Tools / Toolkits\n- [ ] Chains\n- [ ] Callbacks/Tracing\n- [ ] Async\n\n### Reproduction\n\n### **Creation of Supabase client**\r\n`supabase_url: str = os.environ.get(\"SUPABASE_URL\")  # type: ignore\r\nsupabase_key: str = os.environ.get(\"SUPABASE_SERVICE_KEY\")  # type: ignore\r\nsupabase_client = create_client(supabase_url, supabase_key)`\r\n\r\n### Text Splitter creation\r\n`text_splitter = CharacterTextSplitter(\r\n    chunk_size=800,\r\n    chunk_overlap=0,\r\n)`\r\n\r\n### **Embeddings**\r\n`embeddings = OpenAIEmbeddings()`\r\n\r\n### **Loading the document**\r\n`loader = PyPDFLoader(\"Alice_in_wonderland2.pdf\")\r\npages = loader.load_and_split()\r\ndocs = text_splitter.split_documents(pages)`\r\n\r\n### **Save values to Supabase**\r\n`vector_store = SupabaseVectorStore.from_documents(documents=docs, embedding=embeddings, client=supabase_client)`\r\n\r\n### **Error encountring**\r\nThe above exception was the direct cause of the following exception:\r\n\r\nTraceback (most recent call last):\r\n  File \"D:\\VSCode\\Python\\langchain project\\supabase-try\\test.py\", line 34, in <module>\r\n    vector_store = SupabaseVectorStore.from_documents(\r\n  File \"C:\\Users\\User\\AppData\\Local\\Programs\\Python\\Python39\\lib\\site-packages\\langchain\\vectorstores\\base.py\", line 417, in from_documents       \r\n    return cls.from_texts(texts, embedding, metadatas=metadatas, **kwargs)\r\n  File \"C:\\Users\\User\\AppData\\Local\\Programs\\Python\\Python39\\lib\\site-packages\\langchain\\vectorstores\\supabase.py\", line 147, in from_texts       \r\n    cls._add_vectors(client, table_name, embeddings, docs, ids)\r\n  File \"C:\\Users\\User\\AppData\\Local\\Programs\\Python\\Python39\\lib\\site-packages\\langchain\\vectorstores\\supabase.py\", line 323, in _add_vectors     \r\n    result = client.from_(table_name).upsert(chunk).execute()  # type: ignore\r\n  File \"C:\\Users\\User\\AppData\\Local\\Programs\\Python\\Python39\\lib\\site-packages\\postgrest\\_sync\\request_builder.py\", line 57, in execute\r\n    r = self.session.request(\r\n  File \"C:\\Users\\User\\AppData\\Local\\Programs\\Python\\Python39\\lib\\site-packages\\httpx\\_client.py\", line 814, in request\r\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\r\n  File \"C:\\Users\\User\\AppData\\Local\\Programs\\Python\\Python39\\lib\\site-packages\\httpx\\_client.py\", line 901, in send\r\n    response = self._send_handling_auth(\r\n  File \"C:\\Users\\User\\AppData\\Local\\Programs\\Python\\Python39\\lib\\site-packages\\httpx\\_client.py\", line 929, in _send_handling_auth\r\n    response = self._send_handling_redirects(\r\n  File \"C:\\Users\\User\\AppData\\Local\\Programs\\Python\\Python39\\lib\\site-packages\\httpx\\_client.py\", line 966, in _send_handling_redirects\r\n    response = self._send_single_request(request)\r\n  File \"C:\\Users\\User\\AppData\\Local\\Programs\\Python\\Python39\\lib\\site-packages\\httpx\\_client.py\", line 1002, in _send_single_request\r\n    response = transport.handle_request(request)\r\n  File \"C:\\Users\\User\\AppData\\Local\\Programs\\Python\\Python39\\lib\\site-packages\\httpx\\_transports\\default.py\", line 218, in handle_request\r\n    resp = self._pool.handle_request(req)\r\n  File \"C:\\Users\\User\\AppData\\Local\\Programs\\Python\\Python39\\lib\\contextlib.py\", line 135, in __exit__\r\n    self.gen.throw(type, value, traceback)\r\n  File \"C:\\Users\\User\\AppData\\Local\\Programs\\Python\\Python39\\lib\\site-packages\\httpx\\_transports\\default.py\", line 77, in map_httpcore_exceptions \r\n    raise mapped_exc(message) from exc\r\nhttpx.WriteTimeout: The write operation timed out\r\n\r\n\r\n### I tried changing the code according to the langchain docs as\r\n`vector_store = SupabaseVectorStore.from_documents(\r\n    docs,\r\n    embeddings,\r\n    client=supabase_client,\r\n    table_name=\"documents\",\r\n    query_name=\"match_documents\",\r\n)`\r\n\r\n### Then I encountered the following error\r\n2023-10-05 10:33:29,879:INFO - HTTP Request: POST https://scptrclvtrvcwjdunlrn.supabase.co/rest/v1/documents \"HTTP/1.1 404 Not Found\"\r\nTraceback (most recent call last):\r\n  File \"D:\\VSCode\\Python\\langchain project\\supabase-try\\test.py\", line 34, in <module>\r\n    vector_store = SupabaseVectorStore.from_documents(\r\n\r\n**I didnt create the document table in the supabase manually as i need it to be created automatically with the code. And if i need to create it manually i need to know the steps of create that as well and how to integrate it as well. Please help me immediately**\n\n### Expected behavior\n\nSupabaseVectorStore.from_documents works fine and Store all the embeddings in the vector store. ", "closed_by": {"login": "dosubot[bot]", "id": 131922026, "node_id": "BOT_kgDOB9z4ag", "avatar_url": "https://avatars.githubusercontent.com/in/324583?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dosubot%5Bbot%5D", "html_url": "https://github.com/apps/dosubot", "followers_url": "https://api.github.com/users/dosubot%5Bbot%5D/followers", "following_url": "https://api.github.com/users/dosubot%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/dosubot%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/dosubot%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dosubot%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/dosubot%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/dosubot%5Bbot%5D/repos", "events_url": "https://api.github.com/users/dosubot%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/dosubot%5Bbot%5D/received_events", "type": "Bot", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/langchain-ai/langchain/issues/11422/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/langchain-ai/langchain/issues/11422/timeline", "performed_via_github_app": null, "state_reason": "not_planned", "pinned_comment": null}, {"url": "https://api.github.com/repos/langchain-ai/langchain/issues/9368", "repository_url": "https://api.github.com/repos/langchain-ai/langchain", "labels_url": "https://api.github.com/repos/langchain-ai/langchain/issues/9368/labels{/name}", "comments_url": "https://api.github.com/repos/langchain-ai/langchain/issues/9368/comments", "events_url": "https://api.github.com/repos/langchain-ai/langchain/issues/9368/events", "html_url": "https://github.com/langchain-ai/langchain/issues/9368", "id": 1854414691, "node_id": "I_kwDOIPDwls5uiB9j", "number": 9368, "title": "SelfQueryRetriever gives error for some queries", "user": {"login": "Zledme", "id": 93548699, "node_id": "U_kgDOBZNwmw", "avatar_url": "https://avatars.githubusercontent.com/u/93548699?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Zledme", "html_url": "https://github.com/Zledme", "followers_url": "https://api.github.com/users/Zledme/followers", "following_url": "https://api.github.com/users/Zledme/following{/other_user}", "gists_url": "https://api.github.com/users/Zledme/gists{/gist_id}", "starred_url": "https://api.github.com/users/Zledme/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Zledme/subscriptions", "organizations_url": "https://api.github.com/users/Zledme/orgs", "repos_url": "https://api.github.com/users/Zledme/repos", "events_url": "https://api.github.com/users/Zledme/events{/privacy}", "received_events_url": "https://api.github.com/users/Zledme/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 5680700839, "node_id": "LA_kwDOIPDwls8AAAABUpidpw", "url": "https://api.github.com/repos/langchain-ai/langchain/labels/bug", "name": "bug", "color": "b60205", "default": true, "description": "Related to a bug, vulnerability, unexpected error with an existing feature"}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 28, "created_at": "2023-08-17T07:18:59Z", "updated_at": "2025-12-03T11:02:59Z", "closed_at": "2024-11-24T16:05:56Z", "assignee": null, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### System Info\r\n\r\nLangchain Version: 0.0.245\r\nmodel: vicuna-13b-v1.5\r\n\r\n### Who can help?\r\n\r\n_No response_\r\n\r\n### Information\r\n\r\n- [ ] The official example notebooks/scripts\r\n- [X] My own modified scripts\r\n\r\n### Related Components\r\n\r\n- [X] LLMs/Chat Models\r\n- [ ] Embedding Models\r\n- [X] Prompts / Prompt Templates / Prompt Selectors\r\n- [X] Output Parsers\r\n- [ ] Document Loaders\r\n- [X] Vector Stores / Retrievers\r\n- [ ] Memory\r\n- [ ] Agents / Agent Executors\r\n- [ ] Tools / Toolkits\r\n- [ ] Chains\r\n- [ ] Callbacks/Tracing\r\n- [ ] Async\r\n\r\n### Reproduction\r\n\r\n```\r\ndb = Chroma(persist_directory=persist_directory, embedding_function=embeddings, client_settings=CHROMA_SETTINGS)    \r\nmetadata_field_info = [\r\n   AttributeInfo(\r\n        name='lesson',\r\n        description=\"Lesson Number of Book\",\r\n        type=\"integer\",\r\n    )\r\n]\r\n\r\n\r\ndocument_content_description = \"English Books\"\r\nretriever = SelfQueryRetriever.from_llm(\r\n        llm, db, document_content_description, metadata_field_info, verbose=True\r\n    )\r\n    # llm_chain.predict(context = context, question=question)\r\n    qa = RetrievalQA.from_chain_type(llm=llm ,chain_type=\"stuff\", retriever=retriever, return_source_documents=True, chain_type_kwargs={\"prompt\": PROMPT})\r\n\r\nres = qa(query)\r\n```\r\nthis is one of the documents\r\n![image](https://github.com/langchain-ai/langchain/assets/93548699/9c550692-a78f-419d-9e6b-ed61a9fa8dde)\r\n\r\n\r\n\r\n```\r\n File \"/home/roger/Documents/GitHub/RGRgithub/roger/testllm/main.py\", line 122, in qanda\r\n    res = qa(query)\r\n          ^^^^^^^^^\r\n  File \"/home/roger/Documents/GitHub/RGRgithub/roger/testgenv/lib/python3.11/site-packages/langchain/chains/base.py\", line 258, in __call__\r\n    raise e\r\n  File \"/home/roger/Documents/GitHub/RGRgithub/roger/testgenv/lib/python3.11/site-packages/langchain/chains/base.py\", line 252, in __call__\r\n    self._call(inputs, run_manager=run_manager)\r\n  File \"/home/roger/Documents/GitHub/RGRgithub/roger/testgenv/lib/python3.11/site-packages/langchain/chains/retrieval_qa/base.py\", line 130, in _call\r\n    docs = self._get_docs(question, run_manager=_run_manager)\r\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n  File \"/home/roger/Documents/GitHub/RGRgithub/roger/testgenv/lib/python3.11/site-packages/langchain/chains/retrieval_qa/base.py\", line 210, in _get_docs\r\n    return self.retriever.get_relevant_documents(\r\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n  File \"/home/roger/Documents/GitHub/RGRgithub/roger/testgenv/lib/python3.11/site-packages/langchain/schema/retriever.py\", line 193, in get_relevant_documents\r\n    raise e\r\n  File \"/home/roger/Documents/GitHub/RGRgithub/roger/testgenv/lib/python3.11/site-packages/langchain/schema/retriever.py\", line 186, in get_relevant_documents\r\n    result = self._get_relevant_documents(\r\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n  File \"/home/roger/Documents/GitHub/RGRgithub/roger/testgenv/lib/python3.11/site-packages/langchain/retrievers/self_query/base.py\", line 100, in _get_relevant_documents\r\n    self.llm_chain.predict_and_parse(\r\n  File \"/home/roger/Documents/GitHub/RGRgithub/roger/testgenv/lib/python3.11/site-packages/langchain/chains/llm.py\", line 282, in predict_and_parse\r\n    return self.prompt.output_parser.parse(result)\r\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n  File \"/home/roger/Documents/GitHub/RGRgithub/roger/testgenv/lib/python3.11/site-packages/langchain/chains/query_constructor/base.py\", line 52, in parse\r\n    raise OutputParserException(\r\nlangchain.schema.output_parser.OutputParserException: Parsing text\r\n```json\r\n{\r\n    \"query\": \"phoneme\",\r\n    \"filter\": \"eq(lesson, 1)\"\r\n}\r\n\r\n raised following error:\r\nUnexpected token Token('COMMA', ',') at line 1, column 10.\r\nExpected one of: \r\n\t* LPAR\r\nPrevious tokens: [Token('CNAME', 'lesson')]\r\n```\r\n\r\n### Expected behavior\r\n\r\n- Error caused while using SelfQueryRetriever with RetrieverQA.\r\n- showing only with some queries\r\n- I found that in  **langchain/chains/llm.py, line 282, in predict_and_parse**\r\n```\r\nresult = self.predict(callbacks=callbacks, **kwargs)\r\nif self.prompt.output_parser is not None:\r\n    return self.prompt.output_parser.parse(result)\r\nelse:\r\n    return result\r\n```\r\n\r\n- when result is, the error occurs(**_Q: what is a phoneme)_**\r\n`'```json\\n{\\n    \"query\": \"phoneme\",\\n    \"filter\": \"eq(lesson, 1)\"\\n}\\n```'`\r\n- it doesn't occur when result is , **_(Q: What is a phoneme)_**\r\n`'```json\\n{\\n    \"query\": \"phoneme\",\\n    \"filter\": \"eq(\\\\\"lesson\\\\\", 1)\"\\n}\\n```'`\r\n\r\n- I can't change the version right now.", "closed_by": {"login": "dosubot[bot]", "id": 131922026, "node_id": "BOT_kgDOB9z4ag", "avatar_url": "https://avatars.githubusercontent.com/in/324583?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dosubot%5Bbot%5D", "html_url": "https://github.com/apps/dosubot", "followers_url": "https://api.github.com/users/dosubot%5Bbot%5D/followers", "following_url": "https://api.github.com/users/dosubot%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/dosubot%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/dosubot%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dosubot%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/dosubot%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/dosubot%5Bbot%5D/repos", "events_url": "https://api.github.com/users/dosubot%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/dosubot%5Bbot%5D/received_events", "type": "Bot", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/langchain-ai/langchain/issues/9368/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/langchain-ai/langchain/issues/9368/timeline", "performed_via_github_app": null, "state_reason": "not_planned", "pinned_comment": null}, {"url": "https://api.github.com/repos/langchain-ai/langchain/issues/28281", "repository_url": "https://api.github.com/repos/langchain-ai/langchain", "labels_url": "https://api.github.com/repos/langchain-ai/langchain/issues/28281/labels{/name}", "comments_url": "https://api.github.com/repos/langchain-ai/langchain/issues/28281/comments", "events_url": "https://api.github.com/repos/langchain-ai/langchain/issues/28281/events", "html_url": "https://github.com/langchain-ai/langchain/issues/28281", "id": 2681863451, "node_id": "I_kwDOIPDwls6f2f0b", "number": 28281, "title": "Langchain-Ollama: ChatOllama stopped responding and AgentExecutor only performs actions", "user": {"login": "miguelg719", "id": 36487034, "node_id": "MDQ6VXNlcjM2NDg3MDM0", "avatar_url": "https://avatars.githubusercontent.com/u/36487034?v=4", "gravatar_id": "", "url": "https://api.github.com/users/miguelg719", "html_url": "https://github.com/miguelg719", "followers_url": "https://api.github.com/users/miguelg719/followers", "following_url": "https://api.github.com/users/miguelg719/following{/other_user}", "gists_url": "https://api.github.com/users/miguelg719/gists{/gist_id}", "starred_url": "https://api.github.com/users/miguelg719/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/miguelg719/subscriptions", "organizations_url": "https://api.github.com/users/miguelg719/orgs", "repos_url": "https://api.github.com/users/miguelg719/repos", "events_url": "https://api.github.com/users/miguelg719/events{/privacy}", "received_events_url": "https://api.github.com/users/miguelg719/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 5680700839, "node_id": "LA_kwDOIPDwls8AAAABUpidpw", "url": "https://api.github.com/repos/langchain-ai/langchain/labels/bug", "name": "bug", "color": "b60205", "default": true, "description": "Related to a bug, vulnerability, unexpected error with an existing feature"}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 27, "created_at": "2024-11-22T05:37:44Z", "updated_at": "2024-11-26T08:30:02Z", "closed_at": "2024-11-25T21:23:53Z", "assignee": null, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### Checked other resources\n\n- [X] I added a very descriptive title to this issue.\n- [X] I searched the LangChain documentation with the integrated search.\n- [X] I used the GitHub search to find a similar question and didn't find it.\n- [X] I am sure that this is a bug in LangChain rather than my code.\n- [X] The bug is not resolved by updating to the latest stable version of LangChain (or the specific integration package).\n\n### Example Code\n\nMain Example on GitHub\r\n\r\n``` \r\nfrom langchain_ollama import ChatOllama\r\n\r\nllm = ChatOllama(model=\"llama3.2\")\r\nllm.invoke(\"Sing a ballad of LangChain.\") \r\n```\n\n### Error Message and Stack Trace (if applicable)\n\nTypeError: 'NoneType' object is not iterable\n\n### Description\n\nTested with multiple people, the new version of Ollama must have changed output format but ChatOllama now cannot provide any text result. \n\n### System Info\n\nSystem Information\r\n------------------\r\n> OS:  Darwin\r\n> OS Version:  Darwin Kernel Version 23.5.0: Wed May  1 20:14:38 PDT 2024; root:xnu-10063.121.3~5/RELEASE_ARM64_T6020\r\n> Python Version:  3.11.3 (main, Apr 19 2023, 18:49:55) [Clang 14.0.6 ]\r\n\r\nPackage Information\r\n-------------------\r\n> langchain_core: 0.3.19\r\n> langchain: 0.1.17\r\n> langchain_community: 0.0.37\r\n> langsmith: 0.1.144\r\n> langchain_experimental: 0.0.57\r\n> langchain_ollama: 0.2.0\r\n> langchain_openai: 0.1.6\r\n> langchain_text_splitters: 0.0.1\r\n\r\nOptional packages not installed\r\n-------------------------------\r\n> langgraph\r\n> langserve\r\n\r\nOther Dependencies\r\n------------------\r\n> aiohttp: 3.9.3\r\n> aiosqlite: 0.18.0\r\n> aleph-alpha-client: Installed. No version info available.\r\n> anthropic: Installed. No version info available.\r\n> arxiv: Installed. No version info available.\r\n> assemblyai: Installed. No version info available.\r\n> async-timeout: 4.0.2\r\n> atlassian-python-api: Installed. No version info available.\r\n> azure-ai-documentintelligence: Installed. No version info available.\r\n> azure-ai-formrecognizer: Installed. No version info available.\r\n> azure-ai-textanalytics: Installed. No version info available.\r\n> azure-cognitiveservices-speech: Installed. No version info available.\r\n> azure-core: Installed. No version info available.\r\n> azure-cosmos: Installed. No version info available.\r\n> azure-identity: Installed. No version info available.\r\n> azure-search-documents: Installed. No version info available.\r\n> beautifulsoup4: 4.12.2\r\n> bibtexparser: Installed. No version info available.\r\n> cassio: Installed. No version info available.\r\n> chardet: 4.0.0\r\n> clarifai: Installed. No version info available.\r\n> cloudpickle: 2.2.1\r\n> cohere: Installed. No version info available.\r\n> couchbase: Installed. No version info available.\r\n> dashvector: Installed. No version info available.\r\n> databricks-vectorsearch: Installed. No version info available.\r\n> dataclasses-json: 0.6.5\r\n> datasets: 2.14.6\r\n> dgml-utils: Installed. No version info available.\r\n> docarray[hnswlib]: Installed. No version info available.\r\n> elasticsearch: Installed. No version info available.\r\n> esprima: Installed. No version info available.\r\n> faiss-cpu: 1.8.0\r\n> faker: Installed. No version info available.\r\n> feedparser: Installed. No version info available.\r\n> fireworks-ai: Installed. No version info available.\r\n> friendli-client: Installed. No version info available.\r\n> geopandas: Installed. No version info available.\r\n> gitpython: 3.1.43\r\n> google-cloud-documentai: Installed. No version info available.\r\n> gql: Installed. No version info available.\r\n> gradientai: Installed. No version info available.\r\n> hdbcli: Installed. No version info available.\r\n> hologres-vector: Installed. No version info available.\r\n> html2text: Installed. No version info available.\r\n> httpx: 0.27.0\r\n> httpx-sse: Installed. No version info available.\r\n> huggingface_hub: 0.26.2\r\n> javelin-sdk: Installed. No version info available.\r\n> jinja2: 3.1.3\r\n> jq: Installed. No version info available.\r\n> jsonpatch: 1.33\r\n> jsonschema: 4.17.3\r\n> lxml: 4.9.2\r\n> manifest-ml: Installed. No version info available.\r\n> markdownify: Installed. No version info available.\r\n> motor: Installed. No version info available.\r\n> msal: Installed. No version info available.\r\n> mwparserfromhell: Installed. No version info available.\r\n> mwxml: Installed. No version info available.\r\n> newspaper3k: Installed. No version info available.\r\n> nlpcloud: Installed. No version info available.\r\n> numexpr: 2.8.4\r\n> numpy: 1.24.3\r\n> nvidia-riva-client: Installed. No version info available.\r\n> oci: Installed. No version info available.\r\n> ollama: 0.4.0\r\n> openai: 1.26.0\r\n> openapi-pydantic: Installed. No version info available.\r\n> openlm: Installed. No version info available.\r\n> oracle-ads: Installed. No version info available.\r\n> oracledb: Installed. No version info available.\r\n> orjson: 3.9.15\r\n> packaging: 23.2\r\n> pandas: 1.5.3\r\n> pdfminer-six: 20231228\r\n> pgvector: Installed. No version info available.\r\n> praw: Installed. No version info available.\r\n> premai: Installed. No version info available.\r\n> presidio-analyzer: Installed. No version info available.\r\n> presidio-anonymizer: Installed. No version info available.\r\n> psychicapi: Installed. No version info available.\r\n> py-trello: Installed. No version info available.\r\n> pydantic: 2.10.1\r\n> pyjwt: 2.8.0\r\n> pymupdf: Installed. No version info available.\r\n> pypdf: 4.2.0\r\n> pypdfium2: 4.30.0\r\n> pyspark: Installed. No version info available.\r\n> PyYAML: 6.0.1\r\n> qdrant-client: Installed. No version info available.\r\n> rank-bm25: Installed. No version info available.\r\n> rapidfuzz: 3.9.0\r\n> rapidocr-onnxruntime: Installed. No version info available.\r\n> rdflib: Installed. No version info available.\r\n> requests: 2.32.3\r\n> requests-toolbelt: 1.0.0\r\n> rspace_client: Installed. No version info available.\r\n> scikit-learn: 1.2.2\r\n> sentence-transformers: 3.2.1\r\n> SQLAlchemy: 1.4.39\r\n> sqlite-vss: Installed. No version info available.\r\n> streamlit: Installed. No version info available.\r\n> sympy: 1.13.1\r\n> tabulate: 0.9.0\r\n> telethon: Installed. No version info available.\r\n> tenacity: 8.2.2\r\n> tidb-vector: Installed. No version info available.\r\n> tiktoken: 0.6.0\r\n> timescale-vector: Installed. No version info available.\r\n> torch: 2.5.1\r\n> tqdm: 4.67.0\r\n> transformers: 4.46.2\r\n> tree-sitter: Installed. No version info available.\r\n> tree-sitter-languages: Installed. No version info available.\r\n> typer: 0.13.0\r\n> typing-extensions: 4.12.2\r\n> upstash-redis: Installed. No version info available.\r\n> vdms: Installed. No version info available.\r\n> vowpal-wabbit-next: Installed. No version info available.\r\n> xata: Installed. No version info available.\r\n> xmltodict: Installed. No version info available.", "closed_by": {"login": "miguelg719", "id": 36487034, "node_id": "MDQ6VXNlcjM2NDg3MDM0", "avatar_url": "https://avatars.githubusercontent.com/u/36487034?v=4", "gravatar_id": "", "url": "https://api.github.com/users/miguelg719", "html_url": "https://github.com/miguelg719", "followers_url": "https://api.github.com/users/miguelg719/followers", "following_url": "https://api.github.com/users/miguelg719/following{/other_user}", "gists_url": "https://api.github.com/users/miguelg719/gists{/gist_id}", "starred_url": "https://api.github.com/users/miguelg719/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/miguelg719/subscriptions", "organizations_url": "https://api.github.com/users/miguelg719/orgs", "repos_url": "https://api.github.com/users/miguelg719/repos", "events_url": "https://api.github.com/users/miguelg719/events{/privacy}", "received_events_url": "https://api.github.com/users/miguelg719/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/langchain-ai/langchain/issues/28281/reactions", "total_count": 4, "+1": 4, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/langchain-ai/langchain/issues/28281/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/langchain-ai/langchain/issues/24225", "repository_url": "https://api.github.com/repos/langchain-ai/langchain", "labels_url": "https://api.github.com/repos/langchain-ai/langchain/issues/24225/labels{/name}", "comments_url": "https://api.github.com/repos/langchain-ai/langchain/issues/24225/comments", "events_url": "https://api.github.com/repos/langchain-ai/langchain/issues/24225/events", "html_url": "https://github.com/langchain-ai/langchain/issues/24225", "id": 2406868969, "node_id": "I_kwDOIPDwls6Pdefp", "number": 24225, "title": "[Google Generative AI] Structured Output doesn't work with advanced schema", "user": {"login": "ToyHugs", "id": 67203974, "node_id": "MDQ6VXNlcjY3MjAzOTc0", "avatar_url": "https://avatars.githubusercontent.com/u/67203974?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ToyHugs", "html_url": "https://github.com/ToyHugs", "followers_url": "https://api.github.com/users/ToyHugs/followers", "following_url": "https://api.github.com/users/ToyHugs/following{/other_user}", "gists_url": "https://api.github.com/users/ToyHugs/gists{/gist_id}", "starred_url": "https://api.github.com/users/ToyHugs/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ToyHugs/subscriptions", "organizations_url": "https://api.github.com/users/ToyHugs/orgs", "repos_url": "https://api.github.com/users/ToyHugs/repos", "events_url": "https://api.github.com/users/ToyHugs/events{/privacy}", "received_events_url": "https://api.github.com/users/ToyHugs/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 5680700839, "node_id": "LA_kwDOIPDwls8AAAABUpidpw", "url": "https://api.github.com/repos/langchain-ai/langchain/labels/bug", "name": "bug", "color": "b60205", "default": true, "description": "Related to a bug, vulnerability, unexpected error with an existing feature"}], "state": "closed", "locked": false, "assignees": [{"login": "baskaryan", "id": 22008038, "node_id": "MDQ6VXNlcjIyMDA4MDM4", "avatar_url": "https://avatars.githubusercontent.com/u/22008038?v=4", "gravatar_id": "", "url": "https://api.github.com/users/baskaryan", "html_url": "https://github.com/baskaryan", "followers_url": "https://api.github.com/users/baskaryan/followers", "following_url": "https://api.github.com/users/baskaryan/following{/other_user}", "gists_url": "https://api.github.com/users/baskaryan/gists{/gist_id}", "starred_url": "https://api.github.com/users/baskaryan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/baskaryan/subscriptions", "organizations_url": "https://api.github.com/users/baskaryan/orgs", "repos_url": "https://api.github.com/users/baskaryan/repos", "events_url": "https://api.github.com/users/baskaryan/events{/privacy}", "received_events_url": "https://api.github.com/users/baskaryan/received_events", "type": "User", "user_view_type": "public", "site_admin": false}], "milestone": null, "comments": 27, "created_at": "2024-07-13T11:54:26Z", "updated_at": "2025-06-12T16:02:00Z", "closed_at": "2025-06-12T16:01:59Z", "assignee": {"login": "baskaryan", "id": 22008038, "node_id": "MDQ6VXNlcjIyMDA4MDM4", "avatar_url": "https://avatars.githubusercontent.com/u/22008038?v=4", "gravatar_id": "", "url": "https://api.github.com/users/baskaryan", "html_url": "https://github.com/baskaryan", "followers_url": "https://api.github.com/users/baskaryan/followers", "following_url": "https://api.github.com/users/baskaryan/following{/other_user}", "gists_url": "https://api.github.com/users/baskaryan/gists{/gist_id}", "starred_url": "https://api.github.com/users/baskaryan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/baskaryan/subscriptions", "organizations_url": "https://api.github.com/users/baskaryan/orgs", "repos_url": "https://api.github.com/users/baskaryan/repos", "events_url": "https://api.github.com/users/baskaryan/events{/privacy}", "received_events_url": "https://api.github.com/users/baskaryan/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### Checked other resources\r\n\r\n- [X] I added a very descriptive title to this issue.\r\n- [X] I searched the LangChain documentation with the integrated search.\r\n- [X] I used the GitHub search to find a similar question and didn't find it.\r\n- [X] I am sure that this is a bug in LangChain rather than my code.\r\n- [X] The bug is not resolved by updating to the latest stable version of LangChain (or the specific integration package).\r\n\r\n### Example Code\r\n\r\nCollab link : https://colab.research.google.com/drive/1BCat5tBZRcxUhjQ3vGJD3Zu1eiqYIAWz?usp=sharing\r\nCode :\r\n```\r\n!pip install -qU langchain langchain-community langchain-core\r\n!pip install -qU langchain-google-genai\r\n!pip install -qU langchain-text-splitters tiktoken\r\n!pip install -qU faiss-gpu\r\n```\r\n```python\r\nimport os\r\nimport getpass\r\n\r\nos.environ[\"GOOGLE_API_KEY\"] = getpass.getpass(\"Google API Key:\")\r\n\r\nimport re\r\n\r\nimport requests\r\nfrom langchain_community.document_loaders import BSHTMLLoader\r\n\r\n# Download the content\r\nresponse = requests.get(\"https://en.wikipedia.org/wiki/Car\")\r\n# Write it to a file\r\nwith open(\"car.html\", \"w\", encoding=\"utf-8\") as f:\r\n    f.write(response.text)\r\n# Load it with an HTML parser\r\nloader = BSHTMLLoader(\"car.html\")\r\ndocument = loader.load()[0]\r\n# Clean up code\r\n# Replace consecutive new lines with a single new line\r\ndocument.page_content = re.sub(\"\\n\\n+\", \"\\n\", document.page_content)\r\n\r\nfrom typing import List, Optional\r\n\r\nfrom langchain_core.prompts import ChatPromptTemplate, MessagesPlaceholder\r\nfrom langchain_core.pydantic_v1 import BaseModel, Field\r\n\r\n\r\nclass KeyDevelopment(BaseModel):\r\n    \"\"\"Information about a development in the history of cars.\"\"\"\r\n\r\n    year: int = Field(\r\n        ..., description=\"The year when there was an important historic development.\"\r\n    )\r\n    description: str = Field(\r\n        ..., description=\"What happened in this year? What was the development?\"\r\n    )\r\n    evidence: str = Field(\r\n        ...,\r\n        description=\"Repeat in verbatim the sentence(s) from which the year and description information were extracted\",\r\n    )\r\n\r\n\r\nclass ExtractionData(BaseModel):\r\n    \"\"\"Extracted information about key developments in the history of cars.\"\"\"\r\n\r\n    key_developments: List[KeyDevelopment]\r\n\r\n\r\n# Define a custom prompt to provide instructions and any additional context.\r\n# 1) You can add examples into the prompt template to improve extraction quality\r\n# 2) Introduce additional parameters to take context into account (e.g., include metadata\r\n#    about the document from which the text was extracted.)\r\nprompt = ChatPromptTemplate.from_messages(\r\n    [\r\n        (\r\n            \"system\",\r\n            \"You are an expert at identifying key historic development in text. \"\r\n            \"Only extract important historic developments. Extract nothing if no important information can be found in the text.\",\r\n        ),\r\n        (\"human\", \"{text}\"),\r\n    ]\r\n)\r\n\r\nfrom langchain_google_genai import ChatGoogleGenerativeAI\r\n\r\nllm = ChatGoogleGenerativeAI(model=\"gemini-pro\")\r\n\r\nextractor = prompt | llm.with_structured_output(\r\n    schema=ExtractionData,\r\n    include_raw=False,\r\n)\r\n\r\nfrom langchain_text_splitters import TokenTextSplitter\r\n\r\ntext_splitter = TokenTextSplitter(\r\n    # Controls the size of each chunk\r\n    chunk_size=2000,\r\n    # Controls overlap between chunks\r\n    chunk_overlap=20,\r\n)\r\n\r\ntexts = text_splitter.split_text(document.page_content)\r\n\r\nfrom langchain_community.vectorstores import FAISS\r\nfrom langchain_core.documents import Document\r\nfrom langchain_core.runnables import RunnableLambda\r\nfrom langchain_google_genai import GoogleGenerativeAIEmbeddings\r\nfrom langchain_text_splitters import CharacterTextSplitter\r\n\r\ntexts = text_splitter.split_text(document.page_content)\r\nvectorstore = FAISS.from_texts(texts, embedding=GoogleGenerativeAIEmbeddings(model=\"models/embedding-001\"))\r\n\r\nretriever = vectorstore.as_retriever(\r\n    search_kwargs={\"k\": 1}\r\n)  # Only extract from first document\r\n\r\nrag_extractor = {\r\n    \"text\": retriever | (lambda docs: docs[0].page_content)  # fetch content of top doc\r\n} | extractor\r\n\r\nresults = rag_extractor.invoke(\"Key developments associated with cars\")\r\n```\r\n\r\n### Error Message and Stack Trace (if applicable)\r\n\r\nInvalidArgument                           Traceback (most recent call last)\r\n[/usr/local/lib/python3.10/dist-packages/langchain_google_genai/chat_models.py](https://localhost:8080/#) in _chat_with_retry(**kwargs)\r\n    177         try:\r\n--> 178             return generation_method(**kwargs)\r\n    179         # Do not retry for these errors.\r\n\r\n25 frames\r\n[/usr/local/lib/python3.10/dist-packages/google/ai/generativelanguage_v1beta/services/generative_service/client.py](https://localhost:8080/#) in generate_content(self, request, model, contents, retry, timeout, metadata)\r\n    826         # Send the request.\r\n--> 827         response = rpc(\r\n    828             request,\r\n\r\n[/usr/local/lib/python3.10/dist-packages/google/api_core/gapic_v1/method.py](https://localhost:8080/#) in __call__(self, timeout, retry, compression, *args, **kwargs)\r\n    130 \r\n--> 131         return wrapped_func(*args, **kwargs)\r\n    132 \r\n\r\n[/usr/local/lib/python3.10/dist-packages/google/api_core/retry/retry_unary.py](https://localhost:8080/#) in retry_wrapped_func(*args, **kwargs)\r\n    292             )\r\n--> 293             return retry_target(\r\n    294                 target,\r\n\r\n[/usr/local/lib/python3.10/dist-packages/google/api_core/retry/retry_unary.py](https://localhost:8080/#) in retry_target(target, predicate, sleep_generator, timeout, on_error, exception_factory, **kwargs)\r\n    152             # defer to shared logic for handling errors\r\n--> 153             _retry_error_helper(\r\n    154                 exc,\r\n\r\n[/usr/local/lib/python3.10/dist-packages/google/api_core/retry/retry_base.py](https://localhost:8080/#) in _retry_error_helper(exc, deadline, next_sleep, error_list, predicate_fn, on_error_fn, exc_factory_fn, original_timeout)\r\n    211         )\r\n--> 212         raise final_exc from source_exc\r\n    213     if on_error_fn is not None:\r\n\r\n[/usr/local/lib/python3.10/dist-packages/google/api_core/retry/retry_unary.py](https://localhost:8080/#) in retry_target(target, predicate, sleep_generator, timeout, on_error, exception_factory, **kwargs)\r\n    143         try:\r\n--> 144             result = target()\r\n    145             if inspect.isawaitable(result):\r\n\r\n[/usr/local/lib/python3.10/dist-packages/google/api_core/timeout.py](https://localhost:8080/#) in func_with_timeout(*args, **kwargs)\r\n    119 \r\n--> 120             return func(*args, **kwargs)\r\n    121 \r\n\r\n[/usr/local/lib/python3.10/dist-packages/google/api_core/grpc_helpers.py](https://localhost:8080/#) in error_remapped_callable(*args, **kwargs)\r\n     80         except grpc.RpcError as exc:\r\n---> 81             raise exceptions.from_grpc_error(exc) from exc\r\n     82 \r\n\r\nInvalidArgument: 400 * GenerateContentRequest.tools[0].function_declarations[0].parameters.properties[key_developments].items: missing field.\r\n\r\n\r\nThe above exception was the direct cause of the following exception:\r\n\r\nChatGoogleGenerativeAIError               Traceback (most recent call last)\r\n[<ipython-input-18-49ad0989f74d>](https://localhost:8080/#) in <cell line: 1>()\r\n----> 1 results = rag_extractor.invoke(\"Key developments associated with cars\")\r\n\r\n[/usr/local/lib/python3.10/dist-packages/langchain_core/runnables/base.py](https://localhost:8080/#) in invoke(self, input, config, **kwargs)\r\n   2794                     input = step.invoke(input, config, **kwargs)\r\n   2795                 else:\r\n-> 2796                     input = step.invoke(input, config)\r\n   2797         # finish the root run\r\n   2798         except BaseException as e:\r\n\r\n[/usr/local/lib/python3.10/dist-packages/langchain_core/runnables/base.py](https://localhost:8080/#) in invoke(self, input, config, **kwargs)\r\n   4976         **kwargs: Optional[Any],\r\n   4977     ) -> Output:\r\n-> 4978         return self.bound.invoke(\r\n   4979             input,\r\n   4980             self._merge_configs(config),\r\n\r\n[/usr/local/lib/python3.10/dist-packages/langchain_core/language_models/chat_models.py](https://localhost:8080/#) in invoke(self, input, config, stop, **kwargs)\r\n    263         return cast(\r\n    264             ChatGeneration,\r\n--> 265             self.generate_prompt(\r\n    266                 [self._convert_input(input)],\r\n    267                 stop=stop,\r\n\r\n[/usr/local/lib/python3.10/dist-packages/langchain_core/language_models/chat_models.py](https://localhost:8080/#) in generate_prompt(self, prompts, stop, callbacks, **kwargs)\r\n    696     ) -> LLMResult:\r\n    697         prompt_messages = [p.to_messages() for p in prompts]\r\n--> 698         return self.generate(prompt_messages, stop=stop, callbacks=callbacks, **kwargs)\r\n    699 \r\n    700     async def agenerate_prompt(\r\n\r\n[/usr/local/lib/python3.10/dist-packages/langchain_core/language_models/chat_models.py](https://localhost:8080/#) in generate(self, messages, stop, callbacks, tags, metadata, run_name, run_id, **kwargs)\r\n    553                 if run_managers:\r\n    554                     run_managers[i].on_llm_error(e, response=LLMResult(generations=[]))\r\n--> 555                 raise e\r\n    556         flattened_outputs = [\r\n    557             LLMResult(generations=[res.generations], llm_output=res.llm_output)  # type: ignore[list-item]\r\n\r\n[/usr/local/lib/python3.10/dist-packages/langchain_core/language_models/chat_models.py](https://localhost:8080/#) in generate(self, messages, stop, callbacks, tags, metadata, run_name, run_id, **kwargs)\r\n    543             try:\r\n    544                 results.append(\r\n--> 545                     self._generate_with_cache(\r\n    546                         m,\r\n    547                         stop=stop,\r\n\r\n[/usr/local/lib/python3.10/dist-packages/langchain_core/language_models/chat_models.py](https://localhost:8080/#) in _generate_with_cache(self, messages, stop, run_manager, **kwargs)\r\n    768         else:\r\n    769             if inspect.signature(self._generate).parameters.get(\"run_manager\"):\r\n--> 770                 result = self._generate(\r\n    771                     messages, stop=stop, run_manager=run_manager, **kwargs\r\n    772                 )\r\n\r\n[/usr/local/lib/python3.10/dist-packages/langchain_google_genai/chat_models.py](https://localhost:8080/#) in _generate(self, messages, stop, run_manager, tools, functions, safety_settings, tool_config, generation_config, **kwargs)\r\n    765             generation_config=generation_config,\r\n    766         )\r\n--> 767         response: GenerateContentResponse = _chat_with_retry(\r\n    768             request=request,\r\n    769             **kwargs,\r\n\r\n[/usr/local/lib/python3.10/dist-packages/langchain_google_genai/chat_models.py](https://localhost:8080/#) in _chat_with_retry(generation_method, **kwargs)\r\n    194             raise e\r\n    195 \r\n--> 196     return _chat_with_retry(**kwargs)\r\n    197 \r\n    198 \r\n\r\n[/usr/local/lib/python3.10/dist-packages/tenacity/__init__.py](https://localhost:8080/#) in wrapped_f(*args, **kw)\r\n    334             copy = self.copy()\r\n    335             wrapped_f.statistics = copy.statistics  # type: ignore[attr-defined]\r\n--> 336             return copy(f, *args, **kw)\r\n    337 \r\n    338         def retry_with(*args: t.Any, **kwargs: t.Any) -> WrappedFn:\r\n\r\n[/usr/local/lib/python3.10/dist-packages/tenacity/__init__.py](https://localhost:8080/#) in __call__(self, fn, *args, **kwargs)\r\n    473         retry_state = RetryCallState(retry_object=self, fn=fn, args=args, kwargs=kwargs)\r\n    474         while True:\r\n--> 475             do = self.iter(retry_state=retry_state)\r\n    476             if isinstance(do, DoAttempt):\r\n    477                 try:\r\n\r\n[/usr/local/lib/python3.10/dist-packages/tenacity/__init__.py](https://localhost:8080/#) in iter(self, retry_state)\r\n    374         result = None\r\n    375         for action in self.iter_state.actions:\r\n--> 376             result = action(retry_state)\r\n    377         return result\r\n    378 \r\n\r\n[/usr/local/lib/python3.10/dist-packages/tenacity/__init__.py](https://localhost:8080/#) in <lambda>(rs)\r\n    396     def _post_retry_check_actions(self, retry_state: \"RetryCallState\") -> None:\r\n    397         if not (self.iter_state.is_explicit_retry or self.iter_state.retry_run_result):\r\n--> 398             self._add_action_func(lambda rs: rs.outcome.result())\r\n    399             return\r\n    400 \r\n\r\n[/usr/lib/python3.10/concurrent/futures/_base.py](https://localhost:8080/#) in result(self, timeout)\r\n    449                     raise CancelledError()\r\n    450                 elif self._state == FINISHED:\r\n--> 451                     return self.__get_result()\r\n    452 \r\n    453                 self._condition.wait(timeout)\r\n\r\n[/usr/lib/python3.10/concurrent/futures/_base.py](https://localhost:8080/#) in __get_result(self)\r\n    401         if self._exception:\r\n    402             try:\r\n--> 403                 raise self._exception\r\n    404             finally:\r\n    405                 # Break a reference cycle with the exception in self._exception\r\n\r\n[/usr/local/lib/python3.10/dist-packages/tenacity/__init__.py](https://localhost:8080/#) in __call__(self, fn, *args, **kwargs)\r\n    476             if isinstance(do, DoAttempt):\r\n    477                 try:\r\n--> 478                     result = fn(*args, **kwargs)\r\n    479                 except BaseException:  # noqa: B902\r\n    480                     retry_state.set_exception(sys.exc_info())  # type: ignore[arg-type]\r\n\r\n[/usr/local/lib/python3.10/dist-packages/langchain_google_genai/chat_models.py](https://localhost:8080/#) in _chat_with_retry(**kwargs)\r\n    188 \r\n    189         except google.api_core.exceptions.InvalidArgument as e:\r\n--> 190             raise ChatGoogleGenerativeAIError(\r\n    191                 f\"Invalid argument provided to Gemini: {e}\"\r\n    192             ) from e\r\n\r\nChatGoogleGenerativeAIError: Invalid argument provided to Gemini: 400 * GenerateContentRequest.tools[0].function_declarations[0].parameters.properties[key_developments].items: missing field.\r\n\r\n### Description\r\n\r\nHi !\r\n\r\nSince yesterday, I try to follow this official guide in the v0.2 documentation : https://python.langchain.com/v0.2/docs/how_to/extraction_long_text/\r\n\r\nHowever, it doesn't work well with Chat Google Generative AI\r\nThe collab link is here, if you want to try : https://colab.research.google.com/drive/1BCat5tBZRcxUhjQ3vGJD3Zu1eiqYIAWz?usp=sharing\r\n\r\nI have followed the guide step by step, but it keep having an error about missing field on the request.\r\nFor information, Chat Google Generative AI have Structured Output : https://python.langchain.com/v0.2/docs/integrations/chat/google_generative_ai/\r\nAnd also, it's not about my location either (I have already success for others use of Chat Google Generative AI)\r\n\r\nI have try differents things with schema, and I go to the conclusion that I can't use scheme that define other scheme in it like (or List):\r\n```python\r\nclass ExtractionData(BaseModel):\r\n    \"\"\"Extracted information about key developments in the history of cars.\"\"\"\r\n\r\n    key_developments: List[KeyDevelopment]\r\n```\r\n\r\nHowever I can use without problem this scheme :\r\n```python\r\nclass KeyDevelopment(BaseModel):\r\n    \"\"\"Information about a development in the history of cars.\"\"\"\r\n\r\n    year: int = Field(\r\n        ..., description=\"The year when there was an important historic development.\"\r\n    )\r\n    description: str = Field(\r\n        ..., description=\"What happened in this year? What was the development?\"\r\n    )\r\n    evidence: str = Field(\r\n        ...,\r\n        description=\"Repeat in verbatim the sentence(s) from which the year and description information were extracted\",\r\n    )\r\n```\r\n\r\n(but responses with scheme tend to have very bad result with Chat Google, like it's 90% time non-sense)\r\n\r\nSorry for my english which is not really perfect and thank you for reading me !\r\n\r\n- ToyHugs\r\n\r\n### System Info\r\n\r\nhttps://colab.research.google.com/drive/1BCat5tBZRcxUhjQ3vGJD3Zu1eiqYIAWz?usp=sharing", "closed_by": {"login": "dosubot[bot]", "id": 131922026, "node_id": "BOT_kgDOB9z4ag", "avatar_url": "https://avatars.githubusercontent.com/in/324583?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dosubot%5Bbot%5D", "html_url": "https://github.com/apps/dosubot", "followers_url": "https://api.github.com/users/dosubot%5Bbot%5D/followers", "following_url": "https://api.github.com/users/dosubot%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/dosubot%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/dosubot%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dosubot%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/dosubot%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/dosubot%5Bbot%5D/repos", "events_url": "https://api.github.com/users/dosubot%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/dosubot%5Bbot%5D/received_events", "type": "Bot", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/langchain-ai/langchain/issues/24225/reactions", "total_count": 22, "+1": 22, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/langchain-ai/langchain/issues/24225/timeline", "performed_via_github_app": null, "state_reason": "not_planned", "pinned_comment": null}, {"url": "https://api.github.com/repos/langchain-ai/langchain/issues/24163", "repository_url": "https://api.github.com/repos/langchain-ai/langchain", "labels_url": "https://api.github.com/repos/langchain-ai/langchain/issues/24163/labels{/name}", "comments_url": "https://api.github.com/repos/langchain-ai/langchain/issues/24163/comments", "events_url": "https://api.github.com/repos/langchain-ai/langchain/issues/24163/events", "html_url": "https://github.com/langchain-ai/langchain/issues/24163", "id": 2404531016, "node_id": "I_kwDOIPDwls6PUjtI", "number": 24163, "title": "AttributeError: 'Collection' object has no attribute 'model_fields'", "user": {"login": "MinhHoan147", "id": 72193415, "node_id": "MDQ6VXNlcjcyMTkzNDE1", "avatar_url": "https://avatars.githubusercontent.com/u/72193415?v=4", "gravatar_id": "", "url": "https://api.github.com/users/MinhHoan147", "html_url": "https://github.com/MinhHoan147", "followers_url": "https://api.github.com/users/MinhHoan147/followers", "following_url": "https://api.github.com/users/MinhHoan147/following{/other_user}", "gists_url": "https://api.github.com/users/MinhHoan147/gists{/gist_id}", "starred_url": "https://api.github.com/users/MinhHoan147/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/MinhHoan147/subscriptions", "organizations_url": "https://api.github.com/users/MinhHoan147/orgs", "repos_url": "https://api.github.com/users/MinhHoan147/repos", "events_url": "https://api.github.com/users/MinhHoan147/events{/privacy}", "received_events_url": "https://api.github.com/users/MinhHoan147/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 5680700839, "node_id": "LA_kwDOIPDwls8AAAABUpidpw", "url": "https://api.github.com/repos/langchain-ai/langchain/labels/bug", "name": "bug", "color": "b60205", "default": true, "description": "Related to a bug, vulnerability, unexpected error with an existing feature"}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 27, "created_at": "2024-07-12T02:41:35Z", "updated_at": "2024-09-03T05:23:25Z", "closed_at": "2024-07-12T07:26:29Z", "assignee": null, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### Checked other resources\r\n\r\n- [X] I added a very descriptive title to this issue.\r\n- [X] I searched the LangChain documentation with the integrated search.\r\n- [X] I used the GitHub search to find a similar question and didn't find it.\r\n- [X] I am sure that this is a bug in LangChain rather than my code.\r\n- [X] The bug is not resolved by updating to the latest stable version of LangChain (or the specific integration package).\r\n\r\n### Example Code\r\n\r\n```\r\ndef create_selector():\r\n    try:\r\n        vectorstore = Chroma()\r\n        vectorstore.delete_collection()\r\n        selector = SemanticSimilarityExampleSelector.from_examples(\r\n            examples,\r\n            llm_embeddings,\r\n            vectorstore,\r\n            k=1,\r\n            input_keys=[\"input\"],\r\n        )\r\n        return selector\r\n    except Exception as e:\r\n        logger.error(e)\r\n        return None\r\n```\r\n\r\n### Error Message and Stack Trace (if applicable)\r\n\r\n'Collection' object has no attribute 'model_fields'\r\n\r\n### Description\r\n\r\nI'm trying to use Chroma vectorstore in Langchain, and receive the error above. Error appeared when calling `Chroma()` function. \r\n\r\n### System Info\r\n\r\nOS: Ubuntu\r\nOS Version: Ubuntu 22.04\r\nPython Version: 3.10.12 \r\n\r\n### Packages\r\nlangchain==0.2.5\r\nlangchain-chroma==0.1.2\r\nlangchain_community==0.2.5\r\nlangchain-openai==0.1.8", "closed_by": {"login": "MinhHoan147", "id": 72193415, "node_id": "MDQ6VXNlcjcyMTkzNDE1", "avatar_url": "https://avatars.githubusercontent.com/u/72193415?v=4", "gravatar_id": "", "url": "https://api.github.com/users/MinhHoan147", "html_url": "https://github.com/MinhHoan147", "followers_url": "https://api.github.com/users/MinhHoan147/followers", "following_url": "https://api.github.com/users/MinhHoan147/following{/other_user}", "gists_url": "https://api.github.com/users/MinhHoan147/gists{/gist_id}", "starred_url": "https://api.github.com/users/MinhHoan147/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/MinhHoan147/subscriptions", "organizations_url": "https://api.github.com/users/MinhHoan147/orgs", "repos_url": "https://api.github.com/users/MinhHoan147/repos", "events_url": "https://api.github.com/users/MinhHoan147/events{/privacy}", "received_events_url": "https://api.github.com/users/MinhHoan147/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/langchain-ai/langchain/issues/24163/reactions", "total_count": 5, "+1": 5, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/langchain-ai/langchain/issues/24163/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/langchain-ai/langchain/issues/13284", "repository_url": "https://api.github.com/repos/langchain-ai/langchain", "labels_url": "https://api.github.com/repos/langchain-ai/langchain/issues/13284/labels{/name}", "comments_url": "https://api.github.com/repos/langchain-ai/langchain/issues/13284/comments", "events_url": "https://api.github.com/repos/langchain-ai/langchain/issues/13284/events", "html_url": "https://github.com/langchain-ai/langchain/issues/13284", "id": 1990129379, "node_id": "I_kwDOIPDwls52nvbj", "number": 13284, "title": "NotFoundError: Error code: 404 - {'error': {'code': '404', 'message': 'Resource not found'}} when using openai==1.2.3 and langchain==0.0.335", "user": {"login": "glejdis", "id": 53597226, "node_id": "MDQ6VXNlcjUzNTk3MjI2", "avatar_url": "https://avatars.githubusercontent.com/u/53597226?v=4", "gravatar_id": "", "url": "https://api.github.com/users/glejdis", "html_url": "https://github.com/glejdis", "followers_url": "https://api.github.com/users/glejdis/followers", "following_url": "https://api.github.com/users/glejdis/following{/other_user}", "gists_url": "https://api.github.com/users/glejdis/gists{/gist_id}", "starred_url": "https://api.github.com/users/glejdis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/glejdis/subscriptions", "organizations_url": "https://api.github.com/users/glejdis/orgs", "repos_url": "https://api.github.com/users/glejdis/repos", "events_url": "https://api.github.com/users/glejdis/events{/privacy}", "received_events_url": "https://api.github.com/users/glejdis/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 5680700839, "node_id": "LA_kwDOIPDwls8AAAABUpidpw", "url": "https://api.github.com/repos/langchain-ai/langchain/labels/bug", "name": "bug", "color": "b60205", "default": true, "description": "Related to a bug, vulnerability, unexpected error with an existing feature"}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 27, "created_at": "2023-11-13T08:30:39Z", "updated_at": "2024-12-15T16:06:53Z", "closed_at": "2024-12-15T16:06:52Z", "assignee": null, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### System Info\n\nfrom langchain.chat_models import AzureChatOpenAI\r\n\r\nllm_chat = AzureChatOpenAI(deployment_name=\"gpt-4_32k\", model_name = 'gpt-4-32k', openai_api_version=openai.api_version, temperature=0)\r\n\r\nfrom langchain.chains import LLMChain\r\nfrom langchain.prompts import PromptTemplate\r\n\r\nprompt = PromptTemplate(\r\n    input_variables = [\"text\"],\r\n    template=\"{text}\"\r\n)\r\n\r\nllmchain = LLMChain(llm=llm_chat, prompt=prompt)\r\nllmchain.run(text)\r\n\r\nNotFoundError: Error code: 404 - {'error': {'code': '404', 'message': 'Resource not found'}}\n\n### Who can help?\n\n_No response_\n\n### Information\n\n- [X] The official example notebooks/scripts\n- [X] My own modified scripts\n\n### Related Components\n\n- [X] LLMs/Chat Models\n- [ ] Embedding Models\n- [ ] Prompts / Prompt Templates / Prompt Selectors\n- [ ] Output Parsers\n- [ ] Document Loaders\n- [ ] Vector Stores / Retrievers\n- [ ] Memory\n- [ ] Agents / Agent Executors\n- [ ] Tools / Toolkits\n- [ ] Chains\n- [ ] Callbacks/Tracing\n- [ ] Async\n\n### Reproduction\n\nopenai==1.2.3 and langchain==0.0.335\r\n\r\nfrom langchain.chat_models import AzureChatOpenAI\r\ntext = \"Where is Germany located?\"\r\nllm_chat = AzureChatOpenAI(deployment_name=\"gpt-4_32k\", model_name = 'gpt-4-32k', openai_api_version=openai.api_version, temperature=0)\r\n\r\nfrom langchain.chains import LLMChain\r\nfrom langchain.prompts import PromptTemplate\r\n\r\nprompt = PromptTemplate(\r\n    input_variables = [\"text\"],\r\n    template=\"{text}\"\r\n)\r\n\r\nllmchain = LLMChain(llm=llm_chat, prompt=prompt)\r\nllmchain.run(text)\n\n### Expected behavior\n\nIn europe", "closed_by": {"login": "dosubot[bot]", "id": 131922026, "node_id": "BOT_kgDOB9z4ag", "avatar_url": "https://avatars.githubusercontent.com/in/324583?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dosubot%5Bbot%5D", "html_url": "https://github.com/apps/dosubot", "followers_url": "https://api.github.com/users/dosubot%5Bbot%5D/followers", "following_url": "https://api.github.com/users/dosubot%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/dosubot%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/dosubot%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dosubot%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/dosubot%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/dosubot%5Bbot%5D/repos", "events_url": "https://api.github.com/users/dosubot%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/dosubot%5Bbot%5D/received_events", "type": "Bot", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/langchain-ai/langchain/issues/13284/reactions", "total_count": 11, "+1": 11, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/langchain-ai/langchain/issues/13284/timeline", "performed_via_github_app": null, "state_reason": "not_planned", "pinned_comment": null}, {"url": "https://api.github.com/repos/langchain-ai/langchain/issues/9854", "repository_url": "https://api.github.com/repos/langchain-ai/langchain", "labels_url": "https://api.github.com/repos/langchain-ai/langchain/issues/9854/labels{/name}", "comments_url": "https://api.github.com/repos/langchain-ai/langchain/issues/9854/comments", "events_url": "https://api.github.com/repos/langchain-ai/langchain/issues/9854/events", "html_url": "https://github.com/langchain-ai/langchain/issues/9854", "id": 1869658676, "node_id": "I_kwDOIPDwls5vcLo0", "number": 9854, "title": "AttributeError: module 'langchain' has no attribute 'verbose'", "user": {"login": "urbanscribe", "id": 2935311, "node_id": "MDQ6VXNlcjI5MzUzMTE=", "avatar_url": "https://avatars.githubusercontent.com/u/2935311?v=4", "gravatar_id": "", "url": "https://api.github.com/users/urbanscribe", "html_url": "https://github.com/urbanscribe", "followers_url": "https://api.github.com/users/urbanscribe/followers", "following_url": "https://api.github.com/users/urbanscribe/following{/other_user}", "gists_url": "https://api.github.com/users/urbanscribe/gists{/gist_id}", "starred_url": "https://api.github.com/users/urbanscribe/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/urbanscribe/subscriptions", "organizations_url": "https://api.github.com/users/urbanscribe/orgs", "repos_url": "https://api.github.com/users/urbanscribe/repos", "events_url": "https://api.github.com/users/urbanscribe/events{/privacy}", "received_events_url": "https://api.github.com/users/urbanscribe/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 5680700839, "node_id": "LA_kwDOIPDwls8AAAABUpidpw", "url": "https://api.github.com/repos/langchain-ai/langchain/labels/bug", "name": "bug", "color": "b60205", "default": true, "description": "Related to a bug, vulnerability, unexpected error with an existing feature"}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 27, "created_at": "2023-08-28T12:23:46Z", "updated_at": "2024-09-03T16:03:59Z", "closed_at": "2024-09-03T16:03:58Z", "assignee": null, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### System Info\n\n274\r\nMac M2\r\n\r\nthis error appears often and unexpectedly \r\nbut gets solved temporarily by running a force reinstall\r\n\r\n`pip install --upgrade --force-reinstall --no-deps --no-cache-dir langchain\r\n`\r\n\r\nfull error\r\n```\r\n2023-08-28 08:16:48.197 Uncaught app exception\r\nTraceback (most recent call last):\r\n  File \"/Users/user/Developer/newfilesystem/venv/lib/python3.10/site-packages/streamlit/runtime/scriptrunner/script_runner.py\", line 552, in _run_script\r\n    exec(code, module.__dict__)\r\n  File \"/Users/user/Developer/newfilesystem/pages/chat.py\", line 104, in <module>\r\n    llm = ChatOpenAI(\r\n  File \"/Users/user/Developer/newfilesystem/venv/lib/python3.10/site-packages/langchain/load/serializable.py\", line 74, in __init__\r\n    super().__init__(**kwargs)\r\n  File \"pydantic/main.py\", line 339, in pydantic.main.BaseModel.__init__\r\n  File \"pydantic/main.py\", line 1066, in pydantic.main.validate_model\r\n  File \"pydantic/fields.py\", line 439, in pydantic.fields.ModelField.get_default\r\n  File \"/Users/user/Developer/newfilesystem/venv/lib/python3.10/site-packages/langchain/chat_models/base.py\", line 49, in _get_verbosity\r\n    return langchain.verbose\r\n```\r\n\r\nmain librairies in the project\r\nrequests streamlit pandas colorlog python-dotenv tqdm fastapi uvicorn\r\nlangchain openai tiktoken chromadb pypdf\r\ncolorlog logger docx2txt  \n\n### Who can help?\n\n@hwchase17\n\n### Information\n\n- [ ] The official example notebooks/scripts\n- [X] My own modified scripts\n\n### Related Components\n\n- [X] LLMs/Chat Models\n- [X] Embedding Models\n- [X] Prompts / Prompt Templates / Prompt Selectors\n- [ ] Output Parsers\n- [X] Document Loaders\n- [X] Vector Stores / Retrievers\n- [X] Memory\n- [X] Agents / Agent Executors\n- [X] Tools / Toolkits\n- [X] Chains\n- [X] Callbacks/Tracing\n- [ ] Async\n\n### Reproduction\n\nintermittent - no pattern\n\n### Expected behavior\n\nresolution", "closed_by": {"login": "dosubot[bot]", "id": 131922026, "node_id": "BOT_kgDOB9z4ag", "avatar_url": "https://avatars.githubusercontent.com/in/324583?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dosubot%5Bbot%5D", "html_url": "https://github.com/apps/dosubot", "followers_url": "https://api.github.com/users/dosubot%5Bbot%5D/followers", "following_url": "https://api.github.com/users/dosubot%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/dosubot%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/dosubot%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dosubot%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/dosubot%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/dosubot%5Bbot%5D/repos", "events_url": "https://api.github.com/users/dosubot%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/dosubot%5Bbot%5D/received_events", "type": "Bot", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/langchain-ai/langchain/issues/9854/reactions", "total_count": 2, "+1": 2, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/langchain-ai/langchain/issues/9854/timeline", "performed_via_github_app": null, "state_reason": "not_planned", "pinned_comment": null}, {"url": "https://api.github.com/repos/langchain-ai/langchain/issues/22536", "repository_url": "https://api.github.com/repos/langchain-ai/langchain", "labels_url": "https://api.github.com/repos/langchain-ai/langchain/issues/22536/labels{/name}", "comments_url": "https://api.github.com/repos/langchain-ai/langchain/issues/22536/comments", "events_url": "https://api.github.com/repos/langchain-ai/langchain/issues/22536/events", "html_url": "https://github.com/langchain-ai/langchain/issues/22536", "id": 2335288809, "node_id": "I_kwDOIPDwls6LMa3p", "number": 22536, "title": "With langchain v0.2.2 use ChatTongyi(streaming=True) occurred error ' KeyError: 'request' '", "user": {"login": "MannaYang", "id": 14103759, "node_id": "MDQ6VXNlcjE0MTAzNzU5", "avatar_url": "https://avatars.githubusercontent.com/u/14103759?v=4", "gravatar_id": "", "url": "https://api.github.com/users/MannaYang", "html_url": "https://github.com/MannaYang", "followers_url": "https://api.github.com/users/MannaYang/followers", "following_url": "https://api.github.com/users/MannaYang/following{/other_user}", "gists_url": "https://api.github.com/users/MannaYang/gists{/gist_id}", "starred_url": "https://api.github.com/users/MannaYang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/MannaYang/subscriptions", "organizations_url": "https://api.github.com/users/MannaYang/orgs", "repos_url": "https://api.github.com/users/MannaYang/repos", "events_url": "https://api.github.com/users/MannaYang/events{/privacy}", "received_events_url": "https://api.github.com/users/MannaYang/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 5680700839, "node_id": "LA_kwDOIPDwls8AAAABUpidpw", "url": "https://api.github.com/repos/langchain-ai/langchain/labels/bug", "name": "bug", "color": "b60205", "default": true, "description": "Related to a bug, vulnerability, unexpected error with an existing feature"}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 26, "created_at": "2024-06-05T08:51:43Z", "updated_at": "2024-06-26T02:31:42Z", "closed_at": "2024-06-18T11:49:33Z", "assignee": null, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### Checked other resources\n\n- [X] I added a very descriptive title to this issue.\n- [X] I searched the LangChain documentation with the integrated search.\n- [X] I used the GitHub search to find a similar question and didn't find it.\n- [X] I am sure that this is a bug in LangChain rather than my code.\n- [X] The bug is not resolved by updating to the latest stable version of LangChain (or the specific integration package).\n\n### Example Code\n\n```\r\n\r\nfrom langchain_community.chat_models import ChatTongyi\r\nfrom langgraph.prebuilt import create_react_agent\r\n\r\ndef get_current_time_tool():\r\n    return Tool(\r\n        name=\"get_current_time_tool\",\r\n        func=get_current_time,\r\n        description='Get the current year, month, day, hour, minute, second and day of the week, e.g. the user asks: what time is it now? What is today's month and day? What day of the week is today?'\r\n    )\r\n\r\nstream_llm = ChatTongyi(model='qwen-turbo', temperature=0.7, streaming=True)\r\ntool_list = [get_current_time_tool()]\r\nreact_agent_executor = create_react_agent(stream_llm, tools=tool_list, debug=True)\r\n\r\nfor step in react_agent_executor.stream({\"messages\": [(\"human\", \"What day of the week is it?\")]}, stream_mode=\"updates\"):\r\n    print(step)\r\n    \r\n```\n\n### Error Message and Stack Trace (if applicable)\n\nTraceback (most recent call last):\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py\", line 411, in run_asgi\r\n    result = await app(  # type: ignore[func-returns-value]\r\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py\", line 69, in __call__\r\n    return await self.app(scope, receive, send)\r\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/fastapi/applications.py\", line 1054, in __call__\r\n    await super().__call__(scope, receive, send)\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/starlette/applications.py\", line 123, in __call__\r\n    await self.middleware_stack(scope, receive, send)\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 186, in __call__\r\n    raise exc\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 164, in __call__\r\n    await self.app(scope, receive, _send)\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 85, in __call__\r\n    await self.app(scope, receive, send)\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 65, in __call__\r\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\r\n    raise exc\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\r\n    await app(scope, receive, sender)\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/starlette/routing.py\", line 756, in __call__\r\n    await self.middleware_stack(scope, receive, send)\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/starlette/routing.py\", line 776, in app\r\n    await route.handle(scope, receive, send)\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\r\n    await self.app(scope, receive, send)\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\r\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\r\n    raise exc\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\r\n    await app(scope, receive, sender)\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\r\n    response = await func(request)\r\n               ^^^^^^^^^^^^^^^^^^^\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/fastapi/routing.py\", line 278, in app\r\n    raw_response = await run_endpoint_function(\r\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\r\n    return await dependant.call(**values)\r\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n  File \"/Users/tianciyang/Desktop/Porjects/KLD-Platform/main.py\", line 220, in root\r\n    for step in react_agent_executor.stream({\"messages\": [(\"human\", params['input'])]}, stream_mode=\"updates\"):\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/langgraph/pregel/__init__.py\", line 949, in stream\r\n    _panic_or_proceed(done, inflight, step)\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/langgraph/pregel/__init__.py\", line 1473, in _panic_or_proceed\r\n    raise exc\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/thread.py\", line 58, in run\r\n    result = self.fn(*self.args, **self.kwargs)\r\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/langgraph/pregel/retry.py\", line 66, in run_with_retry\r\n    task.proc.invoke(task.input, task.config)\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/langchain_core/runnables/base.py\", line 2406, in invoke\r\n    input = step.invoke(input, config, **kwargs)\r\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/langchain_core/runnables/base.py\", line 3874, in invoke\r\n    return self._call_with_config(\r\n           ^^^^^^^^^^^^^^^^^^^^^^^\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/langchain_core/runnables/base.py\", line 1509, in _call_with_config\r\n    context.run(\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/langchain_core/runnables/config.py\", line 366, in call_func_with_variable_args\r\n    return func(input, **kwargs)  # type: ignore[call-arg]\r\n           ^^^^^^^^^^^^^^^^^^^^^\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/langchain_core/runnables/base.py\", line 3748, in _invoke\r\n    output = call_func_with_variable_args(\r\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/langchain_core/runnables/config.py\", line 366, in call_func_with_variable_args\r\n    return func(input, **kwargs)  # type: ignore[call-arg]\r\n           ^^^^^^^^^^^^^^^^^^^^^\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/langgraph/prebuilt/chat_agent_executor.py\", line 403, in call_model\r\n    response = model_runnable.invoke(messages, config)\r\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/langchain_core/runnables/base.py\", line 4444, in invoke\r\n    return self.bound.invoke(\r\n           ^^^^^^^^^^^^^^^^^^\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/langchain_core/language_models/chat_models.py\", line 170, in invoke\r\n    self.generate_prompt(\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/langchain_core/language_models/chat_models.py\", line 599, in generate_prompt\r\n    return self.generate(prompt_messages, stop=stop, callbacks=callbacks, **kwargs)\r\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/langchain_core/language_models/chat_models.py\", line 456, in generate\r\n    raise e\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/langchain_core/language_models/chat_models.py\", line 446, in generate\r\n    self._generate_with_cache(\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/langchain_core/language_models/chat_models.py\", line 671, in _generate_with_cache\r\n    result = self._generate(\r\n             ^^^^^^^^^^^^^^^\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/langchain_community/chat_models/tongyi.py\", line 440, in _generate\r\n    for chunk in self._stream(\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/langchain_community/chat_models/tongyi.py\", line 512, in _stream\r\n    for stream_resp, is_last_chunk in generate_with_last_element_mark(\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/langchain_community/llms/tongyi.py\", line 135, in generate_with_last_element_mark\r\n    item = next(iterator)\r\n           ^^^^^^^^^^^^^^\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/langchain_community/chat_models/tongyi.py\", line 361, in _stream_completion_with_retry\r\n    yield check_response(delta_resp)\r\n          ^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/langchain_community/llms/tongyi.py\", line 66, in check_response\r\n    raise HTTPError(\r\n          ^^^^^^^^^^\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/requests/exceptions.py\", line 22, in __init__\r\n    if response is not None and not self.request and hasattr(response, \"request\"):\r\n                                                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/dashscope/api_entities/dashscope_response.py\", line 59, in __getattr__\r\n    return self[attr]\r\n           ~~~~^^^^^^\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/dashscope/api_entities/dashscope_response.py\", line 15, in __getitem__\r\n    return super().__getitem__(key)\r\n           ^^^^^^^^^^^^^^^^^^^^^^^^\r\nKeyError: 'request'\n\n### Description\n\n**When I use the following code, I get the KeyError: 'request' exception**\r\n```\r\nfor step in react_agent_executor.stream({\"messages\": [(\"human\", \"What day of the week is it?\")]}, stream_mode=\"updates\"):\r\n    print(step)\r\n```\r\nNote :  stream_llm.streaming=False , react_agent_executor executed correctly\r\n\n\n### System Info\n\npython : v3.12\r\nlangchain : v0.2.2\r\nplatform\uff1aMac\r\n", "closed_by": {"login": "MannaYang", "id": 14103759, "node_id": "MDQ6VXNlcjE0MTAzNzU5", "avatar_url": "https://avatars.githubusercontent.com/u/14103759?v=4", "gravatar_id": "", "url": "https://api.github.com/users/MannaYang", "html_url": "https://github.com/MannaYang", "followers_url": "https://api.github.com/users/MannaYang/followers", "following_url": "https://api.github.com/users/MannaYang/following{/other_user}", "gists_url": "https://api.github.com/users/MannaYang/gists{/gist_id}", "starred_url": "https://api.github.com/users/MannaYang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/MannaYang/subscriptions", "organizations_url": "https://api.github.com/users/MannaYang/orgs", "repos_url": "https://api.github.com/users/MannaYang/repos", "events_url": "https://api.github.com/users/MannaYang/events{/privacy}", "received_events_url": "https://api.github.com/users/MannaYang/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/langchain-ai/langchain/issues/22536/reactions", "total_count": 3, "+1": 3, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/langchain-ai/langchain/issues/22536/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/langchain-ai/langchain/issues/22191", "repository_url": "https://api.github.com/repos/langchain-ai/langchain", "labels_url": "https://api.github.com/repos/langchain-ai/langchain/issues/22191/labels{/name}", "comments_url": "https://api.github.com/repos/langchain-ai/langchain/issues/22191/comments", "events_url": "https://api.github.com/repos/langchain-ai/langchain/issues/22191/events", "html_url": "https://github.com/langchain-ai/langchain/issues/22191", "id": 2317952507, "node_id": "I_kwDOIPDwls6KKSX7", "number": 22191, "title": "Can't use tool decorators with OllamaFunctions", "user": {"login": "Docteur-RS", "id": 12821004, "node_id": "MDQ6VXNlcjEyODIxMDA0", "avatar_url": "https://avatars.githubusercontent.com/u/12821004?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Docteur-RS", "html_url": "https://github.com/Docteur-RS", "followers_url": "https://api.github.com/users/Docteur-RS/followers", "following_url": "https://api.github.com/users/Docteur-RS/following{/other_user}", "gists_url": "https://api.github.com/users/Docteur-RS/gists{/gist_id}", "starred_url": "https://api.github.com/users/Docteur-RS/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Docteur-RS/subscriptions", "organizations_url": "https://api.github.com/users/Docteur-RS/orgs", "repos_url": "https://api.github.com/users/Docteur-RS/repos", "events_url": "https://api.github.com/users/Docteur-RS/events{/privacy}", "received_events_url": "https://api.github.com/users/Docteur-RS/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 5680700839, "node_id": "LA_kwDOIPDwls8AAAABUpidpw", "url": "https://api.github.com/repos/langchain-ai/langchain/labels/bug", "name": "bug", "color": "b60205", "default": true, "description": "Related to a bug, vulnerability, unexpected error with an existing feature"}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 26, "created_at": "2024-05-26T22:04:38Z", "updated_at": "2024-12-20T16:05:54Z", "closed_at": "2024-12-20T16:05:52Z", "assignee": null, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### Checked other resources\n\n- [X] I added a very descriptive title to this issue.\n- [X] I searched the LangChain documentation with the integrated search.\n- [X] I used the GitHub search to find a similar question and didn't find it.\n- [X] I am sure that this is a bug in LangChain rather than my code.\n- [X] The bug is not resolved by updating to the latest stable version of LangChain (or the specific integration package).\n\n### Example Code\n\n```python\r\nfrom langchain_experimental.llms.ollama_functions import OllamaFunctions\r\nfrom langchain.agents import AgentExecutor, create_tool_calling_agent, tool\r\nfrom langchain_core.prompts.chat import ChatPromptTemplate, MessagesPlaceholder\r\n\r\n\r\n@tool\r\ndef get_word_length(word: str) -> int:\r\n    \"\"\"Returns the length of a word\"\"\"\r\n    return len(word)\r\n\r\ntools = [get_word_length]\r\n\r\nprompt = ChatPromptTemplate.from_messages([\r\n            (\"system\", \"You are a helpfull assistant\"),\r\n            (\"human\", \"{input}\"),\r\n            MessagesPlaceholder(\"agent_scratchpad\")\r\n])\r\n\r\nmodel = OllamaFunctions(model=\"mistral:7b-instruct-v0.3-q8_0\", format=\"json\")\r\n\r\nagent = create_tool_calling_agent(model, tools, prompt)\r\n\r\nagent_executor = AgentExecutor(agent=agent, tools=tools, verbose=True)\r\n\r\nresult = agent_executor.invoke({\r\n    \"input\": \"How many letters are in 'orange' ?\"\r\n})\r\n\r\nprint(result[\"output\"])\r\n```\r\n\r\nFollowing the code presented in this langchain video : https://www.youtube.com/watch?v=zCwuAlpQKTM&ab_channel=LangChain the LLM should be able to call the tool `get_word_length`.\n\n### Error Message and Stack Trace (if applicable)\n\n> Entering new AgentExecutor chain...\r\nTraceback (most recent call last):\r\n  File \"/home/linuxUsername/crewai/test2.py\", line 66, in <module>\r\n    result = agent_executor.invoke({\r\n  File \"/home/linuxUsername/.local/lib/python3.10/site-packages/langchain/chains/base.py\", line 166, in invoke\r\n    raise e\r\n  File \"/home/linuxUsername/.local/lib/python3.10/site-packages/langchain/chains/base.py\", line 156, in invoke\r\n    self._call(inputs, run_manager=run_manager)\r\n  File \"/home/linuxUsername/.local/lib/python3.10/site-packages/langchain/agents/agent.py\", line 1433, in _call\r\n    next_step_output = self._take_next_step(\r\n  File \"/home/linuxUsername/.local/lib/python3.10/site-packages/langchain/agents/agent.py\", line 1139, in _take_next_step\r\n    [\r\n  File \"/home/linuxUsername/.local/lib/python3.10/site-packages/langchain/agents/agent.py\", line 1139, in <listcomp>\r\n    [\r\n  File \"/home/linuxUsername/.local/lib/python3.10/site-packages/langchain/agents/agent.py\", line 1167, in _iter_next_step\r\n    output = self.agent.plan(\r\n  File \"/home/linuxUsername/.local/lib/python3.10/site-packages/langchain/agents/agent.py\", line 515, in plan\r\n    for chunk in self.runnable.stream(inputs, config={\"callbacks\": callbacks}):\r\n  File \"/home/linuxUsername/.local/lib/python3.10/site-packages/langchain_core/runnables/base.py\", line 2769, in stream\r\n    yield from self.transform(iter([input]), config, **kwargs)\r\n  File \"/home/linuxUsername/.local/lib/python3.10/site-packages/langchain_core/runnables/base.py\", line 2756, in transform\r\n    yield from self._transform_stream_with_config(\r\n  File \"/home/linuxUsername/.local/lib/python3.10/site-packages/langchain_core/runnables/base.py\", line 1772, in _transform_stream_with_config\r\n    chunk: Output = context.run(next, iterator)  # type: ignore\r\n  File \"/home/linuxUsername/.local/lib/python3.10/site-packages/langchain_core/runnables/base.py\", line 2720, in _transform\r\n    for output in final_pipeline:\r\n  File \"/home/linuxUsername/.local/lib/python3.10/site-packages/langchain_core/runnables/base.py\", line 1148, in transform\r\n    for ichunk in input:\r\n  File \"/home/linuxUsername/.local/lib/python3.10/site-packages/langchain_core/runnables/base.py\", line 4638, in transform\r\n    yield from self.bound.transform(\r\n  File \"/home/linuxUsername/.local/lib/python3.10/site-packages/langchain_core/runnables/base.py\", line 1166, in transform\r\n    yield from self.stream(final, config, **kwargs)\r\n  File \"/home/linuxUsername/.local/lib/python3.10/site-packages/langchain_core/language_models/chat_models.py\", line 265, in stream\r\n    raise e\r\n  File \"/home/linuxUsername/.local/lib/python3.10/site-packages/langchain_core/language_models/chat_models.py\", line 245, in stream\r\n    for chunk in self._stream(messages, stop=stop, **kwargs):\r\n  File \"/home/linuxUsername/.local/lib/python3.10/site-packages/langchain_community/chat_models/ollama.py\", line 317, in _stream\r\n    for stream_resp in self._create_chat_stream(messages, stop, **kwargs):\r\n  File \"/home/linuxUsername/.local/lib/python3.10/site-packages/langchain_community/chat_models/ollama.py\", line 162, in _create_chat_stream\r\n    yield from self._create_stream(\r\n  File \"/home/linuxUsername/.local/lib/python3.10/site-packages/langchain_community/llms/ollama.py\", line 231, in _create_stream\r\n    response = requests.post(\r\n  File \"/home/linuxUsername/.local/lib/python3.10/site-packages/requests/api.py\", line 115, in post\r\n    return request(\"post\", url, data=data, json=json, **kwargs)\r\n  File \"/home/linuxUsername/.local/lib/python3.10/site-packages/requests/api.py\", line 59, in request\r\n    return session.request(method=method, url=url, **kwargs)\r\n  File \"/home/linuxUsername/.local/lib/python3.10/site-packages/requests/sessions.py\", line 575, in request\r\n    prep = self.prepare_request(req)\r\n  File \"/home/linuxUsername/.local/lib/python3.10/site-packages/requests/sessions.py\", line 484, in prepare_request\r\n    p.prepare(\r\n  File \"/home/linuxUsername/.local/lib/python3.10/site-packages/requests/models.py\", line 370, in prepare\r\n    self.prepare_body(data, files, json)\r\n  File \"/home/linuxUsername/.local/lib/python3.10/site-packages/requests/models.py\", line 510, in prepare_body\r\n    body = complexjson.dumps(json, allow_nan=False)\r\n  File \"/usr/lib/python3.10/json/__init__.py\", line 238, in dumps\r\n    **kw).encode(obj)\r\n  File \"/usr/lib/python3.10/json/encoder.py\", line 199, in encode\r\n    chunks = self.iterencode(o, _one_shot=True)\r\n  File \"/usr/lib/python3.10/json/encoder.py\", line 257, in iterencode\r\n    return _iterencode(o, 0)\r\n  File \"/usr/lib/python3.10/json/encoder.py\", line 179, in default\r\n    raise TypeError(f'Object of type {o.__class__.__name__} '\r\nTypeError: Object of type StructuredTool is not JSON serializable\n\n### Description\n\nI should get the number of letters in the word \"orange\" as the tool should return it's length. Instead I get an exception about the tool.  \r\nNote that doing the following does return a correct JSON tool call.  \r\n\r\n```python\r\nfrom langchain_experimental.llms.ollama_functions import OllamaFunctions\r\nfrom langchain.agents import AgentExecutor, create_tool_calling_agent, tool\r\nfrom langchain_core.prompts.chat import ChatPromptTemplate, MessagesPlaceholder\r\n\r\nchatModel = OllamaFunctions(model=\"mistral:7b-instruct-v0.3-q8_0\", format=\"json\")\r\n\r\ndef get_current_weather(some_param):\r\n    print(\"got\", str(some_param))\r\n\r\n\r\nmodel = chatModel.bind_tools(\r\n    tools=[\r\n        {\r\n            \"name\": \"get_current_weather\",\r\n            \"description\": \"Get the current weather in a given location\",\r\n            \"parameters\": {\r\n                \"type\": \"object\",\r\n                \"properties\": {\r\n                    \"location\": {\r\n                        \"type\": \"string\",\r\n                        \"description\": \"The city and state, \" \"e.g. San Francisco, CA\",\r\n                    },\r\n                    \"unit\": {\r\n                        \"type\": \"string\",\r\n                        \"enum\": [\"celsius\", \"fahrenheit\"],\r\n                    },\r\n                },\r\n                \"required\": [\"location\"],\r\n            },\r\n        }\r\n    ],\r\n    function_call={\"name\": \"get_current_weather\"},\r\n)\r\n\r\nfrom langchain_core.messages import HumanMessage\r\nanswer = model.invoke(\"what is the weather in Boston?\")\r\n\r\nprint(answer.content)\r\nprint( answer.additional_kwargs[\"function_call\"])\r\n```\r\nIt seems to me that there is an incompatibility with the way the decorator is creating the pydantic definition. But it's just a guess.\n\n### System Info\n\n```bash\r\npip freeze | grep langchain\r\nlangchain==0.2.1\r\nlangchain-cohere==0.1.5\r\nlangchain-community==0.2.1\r\nlangchain-core==0.2.1\r\nlangchain-experimental==0.0.59\r\nlangchain-openai==0.0.5\r\nlangchain-text-splitters==0.2.0\r\n```\r\n\r\nUsing\r\n* python3.10.12\r\n* ollama 0.1.38\r\n* Local model is `mistral:7b-instruct-v0.3-q8_0`", "closed_by": {"login": "dosubot[bot]", "id": 131922026, "node_id": "BOT_kgDOB9z4ag", "avatar_url": "https://avatars.githubusercontent.com/in/324583?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dosubot%5Bbot%5D", "html_url": "https://github.com/apps/dosubot", "followers_url": "https://api.github.com/users/dosubot%5Bbot%5D/followers", "following_url": "https://api.github.com/users/dosubot%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/dosubot%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/dosubot%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dosubot%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/dosubot%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/dosubot%5Bbot%5D/repos", "events_url": "https://api.github.com/users/dosubot%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/dosubot%5Bbot%5D/received_events", "type": "Bot", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/langchain-ai/langchain/issues/22191/reactions", "total_count": 12, "+1": 12, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/langchain-ai/langchain/issues/22191/timeline", "performed_via_github_app": null, "state_reason": "not_planned", "pinned_comment": null}]}