{"d": [{"url": "https://api.github.com/repos/sindresorhus/ky/issues/689", "repository_url": "https://api.github.com/repos/sindresorhus/ky", "labels_url": "https://api.github.com/repos/sindresorhus/ky/issues/689/labels{/name}", "comments_url": "https://api.github.com/repos/sindresorhus/ky/issues/689/comments", "events_url": "https://api.github.com/repos/sindresorhus/ky/issues/689/events", "html_url": "https://github.com/sindresorhus/ky/issues/689", "id": 2970555000, "node_id": "I_kwDOCMjFuM6xDxJ4", "number": 689, "title": "regression: ky aborting in 1.8.0", "user": {"login": "curtdept", "id": 23644717, "node_id": "MDQ6VXNlcjIzNjQ0NzE3", "avatar_url": "https://avatars.githubusercontent.com/u/23644717?v=4", "gravatar_id": "", "url": "https://api.github.com/users/curtdept", "html_url": "https://github.com/curtdept", "followers_url": "https://api.github.com/users/curtdept/followers", "following_url": "https://api.github.com/users/curtdept/following{/other_user}", "gists_url": "https://api.github.com/users/curtdept/gists{/gist_id}", "starred_url": "https://api.github.com/users/curtdept/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/curtdept/subscriptions", "organizations_url": "https://api.github.com/users/curtdept/orgs", "repos_url": "https://api.github.com/users/curtdept/repos", "events_url": "https://api.github.com/users/curtdept/events{/privacy}", "received_events_url": "https://api.github.com/users/curtdept/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 1045483930, "node_id": "MDU6TGFiZWwxMDQ1NDgzOTMw", "url": "https://api.github.com/repos/sindresorhus/ky/labels/bug", "name": "bug", "color": "d73a4a", "default": true, "description": "Something isn't working"}, {"id": 1045483934, "node_id": "MDU6TGFiZWwxMDQ1NDgzOTM0", "url": "https://api.github.com/repos/sindresorhus/ky/labels/help%20wanted", "name": "help wanted", "color": "008672", "default": true, "description": "Extra attention is needed"}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 53, "created_at": "2025-04-03T20:04:24Z", "updated_at": "2026-02-23T11:49:41Z", "closed_at": "2026-02-23T11:49:38Z", "assignee": null, "author_association": "NONE", "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "When using options ky seems to abort, provide no return and wont process any further requests.\n\nexample:\n```\nimport HttpRequestMock from \"http-request-mock\";\nimport ky from \"ky\";\n\nconst mockHttp = HttpRequestMock.setupForFetch();\n\nmockHttp.post(\"https://api.site.test/call\", {\n  data: { payload: \"testing\" },\n});\n\nasync function test() {\n  const test1 = await ky.post(`https://api.site.test/call`, {\n    json: { testBody: \"test\" },\n  });\n  console.log(\"test1\", test1);\n\n  //   const test2 = await ky.post(`https://api.site.test/call`);\n  //   console.log(\"test2:\", test2);\n}\n\ntest()\n  .then(() => {\n    process.exit(0);\n  })\n  .catch((err) => {\n    console.error(err);\n    process.exit(1);\n  });\n```\n\nScenarios:\n- when running test1 alone, no return, seem to just skip\n- when running test1 and test2, no return, both skip\n- when running test2 alone, returns as expected\n\nif I comment this out, all scenarios work\nhttps://github.com/sindresorhus/ky/blob/main/source/core/Ky.ts#L70-L72", "closed_by": {"login": "sindresorhus", "id": 170270, "node_id": "MDQ6VXNlcjE3MDI3MA==", "avatar_url": "https://avatars.githubusercontent.com/u/170270?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sindresorhus", "html_url": "https://github.com/sindresorhus", "followers_url": "https://api.github.com/users/sindresorhus/followers", "following_url": "https://api.github.com/users/sindresorhus/following{/other_user}", "gists_url": "https://api.github.com/users/sindresorhus/gists{/gist_id}", "starred_url": "https://api.github.com/users/sindresorhus/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sindresorhus/subscriptions", "organizations_url": "https://api.github.com/users/sindresorhus/orgs", "repos_url": "https://api.github.com/users/sindresorhus/repos", "events_url": "https://api.github.com/users/sindresorhus/events{/privacy}", "received_events_url": "https://api.github.com/users/sindresorhus/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/sindresorhus/ky/issues/689/reactions", "total_count": 10, "+1": 9, "-1": 0, "laugh": 0, "hooray": 0, "confused": 1, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/sindresorhus/ky/issues/689/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/sindresorhus/ky/issues/340", "repository_url": "https://api.github.com/repos/sindresorhus/ky", "labels_url": "https://api.github.com/repos/sindresorhus/ky/issues/340/labels{/name}", "comments_url": "https://api.github.com/repos/sindresorhus/ky/issues/340/comments", "events_url": "https://api.github.com/repos/sindresorhus/ky/issues/340/events", "html_url": "https://github.com/sindresorhus/ky/issues/340", "id": 876408477, "node_id": "MDU6SXNzdWU4NzY0MDg0Nzc=", "number": 340, "title": "Module not found: Can't resolve 'ky' with version 0.28", "user": {"login": "LoiKos", "id": 9548473, "node_id": "MDQ6VXNlcjk1NDg0NzM=", "avatar_url": "https://avatars.githubusercontent.com/u/9548473?v=4", "gravatar_id": "", "url": "https://api.github.com/users/LoiKos", "html_url": "https://github.com/LoiKos", "followers_url": "https://api.github.com/users/LoiKos/followers", "following_url": "https://api.github.com/users/LoiKos/following{/other_user}", "gists_url": "https://api.github.com/users/LoiKos/gists{/gist_id}", "starred_url": "https://api.github.com/users/LoiKos/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/LoiKos/subscriptions", "organizations_url": "https://api.github.com/users/LoiKos/orgs", "repos_url": "https://api.github.com/users/LoiKos/repos", "events_url": "https://api.github.com/users/LoiKos/events{/privacy}", "received_events_url": "https://api.github.com/users/LoiKos/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 1045483930, "node_id": "MDU6TGFiZWwxMDQ1NDgzOTMw", "url": "https://api.github.com/repos/sindresorhus/ky/labels/bug", "name": "bug", "color": "d73a4a", "default": true, "description": "Something isn't working"}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 18, "created_at": "2021-05-05T12:41:17Z", "updated_at": "2021-05-25T19:34:23Z", "closed_at": "2021-05-25T19:34:23Z", "assignee": null, "author_association": "NONE", "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "Upgrading to ky@0.28, i get `Module not found: Can't resolve 'ky'`.\r\n\r\nWhen i open vs code and look at the 'ky' module it refers to `index.d.ts` and load typescript definition instead of index.js.\r\n\r\nI use create-react-app i don't know if that help you but it works perfectly fine with ky@0.27", "closed_by": {"login": "sholladay", "id": 3674950, "node_id": "MDQ6VXNlcjM2NzQ5NTA=", "avatar_url": "https://avatars.githubusercontent.com/u/3674950?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sholladay", "html_url": "https://github.com/sholladay", "followers_url": "https://api.github.com/users/sholladay/followers", "following_url": "https://api.github.com/users/sholladay/following{/other_user}", "gists_url": "https://api.github.com/users/sholladay/gists{/gist_id}", "starred_url": "https://api.github.com/users/sholladay/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sholladay/subscriptions", "organizations_url": "https://api.github.com/users/sholladay/orgs", "repos_url": "https://api.github.com/users/sholladay/repos", "events_url": "https://api.github.com/users/sholladay/events{/privacy}", "received_events_url": "https://api.github.com/users/sholladay/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/sindresorhus/ky/issues/340/reactions", "total_count": 17, "+1": 17, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/sindresorhus/ky/issues/340/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/sindresorhus/ky/issues/338", "repository_url": "https://api.github.com/repos/sindresorhus/ky", "labels_url": "https://api.github.com/repos/sindresorhus/ky/issues/338/labels{/name}", "comments_url": "https://api.github.com/repos/sindresorhus/ky/issues/338/comments", "events_url": "https://api.github.com/repos/sindresorhus/ky/issues/338/events", "html_url": "https://github.com/sindresorhus/ky/issues/338", "id": 875401999, "node_id": "MDU6SXNzdWU4NzU0MDE5OTk=", "number": 338, "title": "POST request doesn't have body for Tizen 2017", "user": {"login": "Beraliv", "id": 2991847, "node_id": "MDQ6VXNlcjI5OTE4NDc=", "avatar_url": "https://avatars.githubusercontent.com/u/2991847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Beraliv", "html_url": "https://github.com/Beraliv", "followers_url": "https://api.github.com/users/Beraliv/followers", "following_url": "https://api.github.com/users/Beraliv/following{/other_user}", "gists_url": "https://api.github.com/users/Beraliv/gists{/gist_id}", "starred_url": "https://api.github.com/users/Beraliv/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Beraliv/subscriptions", "organizations_url": "https://api.github.com/users/Beraliv/orgs", "repos_url": "https://api.github.com/users/Beraliv/repos", "events_url": "https://api.github.com/users/Beraliv/events{/privacy}", "received_events_url": "https://api.github.com/users/Beraliv/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 1045483930, "node_id": "MDU6TGFiZWwxMDQ1NDgzOTMw", "url": "https://api.github.com/repos/sindresorhus/ky/labels/bug", "name": "bug", "color": "d73a4a", "default": true, "description": "Something isn't working"}, {"id": 1045483934, "node_id": "MDU6TGFiZWwxMDQ1NDgzOTM0", "url": "https://api.github.com/repos/sindresorhus/ky/labels/help%20wanted", "name": "help wanted", "color": "008672", "default": true, "description": "Extra attention is needed"}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 15, "created_at": "2021-05-04T12:15:26Z", "updated_at": "2021-05-15T00:55:28Z", "closed_at": "2021-05-10T11:25:07Z", "assignee": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "I have options like this one:\r\n\r\n```ts\r\n\r\nconst kyOptions = {\r\n    headers: {\r\n        'Authorization': \"Bearer <token>\",\r\n    },\r\n    json: {\r\n        content_id: \"<id>\"\r\n        content_type: \"<type>\"\r\n    },\r\n    method: \"post\"\r\n};\r\n```\r\n\r\nThen I call `ky`:\r\n\r\n```ts\r\nconst response = ky(uri, kyOptions);\r\n```\r\n\r\nAnd I have error as somehow `fetch` was called without `body`. If I replace the call with `fetch` itself, the request will be sent correctly as expected:\r\n\r\n```ts\r\nconst response = await fetch(uri, {\r\n   body: JSON.stringify(kyOptions.json),\r\n   headers: {\r\n      'Content-Type': 'application/json',\r\n      ...kyOptions.headers,\r\n   },\r\n   method: 'POST'\r\n});\r\n```\r\n\r\nDo you know why this can happen?\r\n\r\nI use `whatwg-fetch` and `core-js`, maybe also something is missed?", "closed_by": {"login": "Beraliv", "id": 2991847, "node_id": "MDQ6VXNlcjI5OTE4NDc=", "avatar_url": "https://avatars.githubusercontent.com/u/2991847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Beraliv", "html_url": "https://github.com/Beraliv", "followers_url": "https://api.github.com/users/Beraliv/followers", "following_url": "https://api.github.com/users/Beraliv/following{/other_user}", "gists_url": "https://api.github.com/users/Beraliv/gists{/gist_id}", "starred_url": "https://api.github.com/users/Beraliv/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Beraliv/subscriptions", "organizations_url": "https://api.github.com/users/Beraliv/orgs", "repos_url": "https://api.github.com/users/Beraliv/repos", "events_url": "https://api.github.com/users/Beraliv/events{/privacy}", "received_events_url": "https://api.github.com/users/Beraliv/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/sindresorhus/ky/issues/338/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/sindresorhus/ky/issues/338/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/sindresorhus/ky/issues/312", "repository_url": "https://api.github.com/repos/sindresorhus/ky", "labels_url": "https://api.github.com/repos/sindresorhus/ky/issues/312/labels{/name}", "comments_url": "https://api.github.com/repos/sindresorhus/ky/issues/312/comments", "events_url": "https://api.github.com/repos/sindresorhus/ky/issues/312/events", "html_url": "https://github.com/sindresorhus/ky/issues/312", "id": 776542877, "node_id": "MDU6SXNzdWU3NzY1NDI4Nzc=", "number": 312, "title": "[Feature request] Typing JSON response using TS generics", "user": {"login": "nielsdB97", "id": 11021818, "node_id": "MDQ6VXNlcjExMDIxODE4", "avatar_url": "https://avatars.githubusercontent.com/u/11021818?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nielsdB97", "html_url": "https://github.com/nielsdB97", "followers_url": "https://api.github.com/users/nielsdB97/followers", "following_url": "https://api.github.com/users/nielsdB97/following{/other_user}", "gists_url": "https://api.github.com/users/nielsdB97/gists{/gist_id}", "starred_url": "https://api.github.com/users/nielsdB97/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nielsdB97/subscriptions", "organizations_url": "https://api.github.com/users/nielsdB97/orgs", "repos_url": "https://api.github.com/users/nielsdB97/repos", "events_url": "https://api.github.com/users/nielsdB97/events{/privacy}", "received_events_url": "https://api.github.com/users/nielsdB97/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 1045483930, "node_id": "MDU6TGFiZWwxMDQ1NDgzOTMw", "url": "https://api.github.com/repos/sindresorhus/ky/labels/bug", "name": "bug", "color": "d73a4a", "default": true, "description": "Something isn't working"}, {"id": 1045483934, "node_id": "MDU6TGFiZWwxMDQ1NDgzOTM0", "url": "https://api.github.com/repos/sindresorhus/ky/labels/help%20wanted", "name": "help wanted", "color": "008672", "default": true, "description": "Extra attention is needed"}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 15, "created_at": "2020-12-30T16:45:15Z", "updated_at": "2024-08-13T22:11:01Z", "closed_at": "2022-06-23T12:53:48Z", "assignee": null, "author_association": "NONE", "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "I'm considering a move from `axios` to `ky` in order to leverage the Fetch API, which seems to be relatively easy because of the clear APIs and documentation for them in ky. \ud83d\ude42 \r\nHowever I'm running into a limitation of the types, where I would like to be able to pass a generic for the Response type.\r\n\r\nThis is currently [possible in Axios](https://github.com/axios/axios/blob/59ab559386273a185be18857a12ab0305b753e50/index.d.ts#L140) and I would like to keep the same syntax, rather than having to resort to typecasting (i.e. `await response.json() as MyResponse`).\r\n\r\nIs this something you would consider adding support for as well?", "closed_by": {"login": "sindresorhus", "id": 170270, "node_id": "MDQ6VXNlcjE3MDI3MA==", "avatar_url": "https://avatars.githubusercontent.com/u/170270?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sindresorhus", "html_url": "https://github.com/sindresorhus", "followers_url": "https://api.github.com/users/sindresorhus/followers", "following_url": "https://api.github.com/users/sindresorhus/following{/other_user}", "gists_url": "https://api.github.com/users/sindresorhus/gists{/gist_id}", "starred_url": "https://api.github.com/users/sindresorhus/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sindresorhus/subscriptions", "organizations_url": "https://api.github.com/users/sindresorhus/orgs", "repos_url": "https://api.github.com/users/sindresorhus/repos", "events_url": "https://api.github.com/users/sindresorhus/events{/privacy}", "received_events_url": "https://api.github.com/users/sindresorhus/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/sindresorhus/ky/issues/312/reactions", "total_count": 9, "+1": 9, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/sindresorhus/ky/issues/312/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/sindresorhus/ky/issues/131", "repository_url": "https://api.github.com/repos/sindresorhus/ky", "labels_url": "https://api.github.com/repos/sindresorhus/ky/issues/131/labels{/name}", "comments_url": "https://api.github.com/repos/sindresorhus/ky/issues/131/comments", "events_url": "https://api.github.com/repos/sindresorhus/ky/issues/131/events", "html_url": "https://github.com/sindresorhus/ky/issues/131", "id": 436246533, "node_id": "MDU6SXNzdWU0MzYyNDY1MzM=", "number": 131, "title": "Expected a Promise rejection for option errors", "user": {"login": "szmarczak", "id": 36894700, "node_id": "MDQ6VXNlcjM2ODk0NzAw", "avatar_url": "https://avatars.githubusercontent.com/u/36894700?v=4", "gravatar_id": "", "url": "https://api.github.com/users/szmarczak", "html_url": "https://github.com/szmarczak", "followers_url": "https://api.github.com/users/szmarczak/followers", "following_url": "https://api.github.com/users/szmarczak/following{/other_user}", "gists_url": "https://api.github.com/users/szmarczak/gists{/gist_id}", "starred_url": "https://api.github.com/users/szmarczak/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/szmarczak/subscriptions", "organizations_url": "https://api.github.com/users/szmarczak/orgs", "repos_url": "https://api.github.com/users/szmarczak/repos", "events_url": "https://api.github.com/users/szmarczak/events{/privacy}", "received_events_url": "https://api.github.com/users/szmarczak/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 1045483930, "node_id": "MDU6TGFiZWwxMDQ1NDgzOTMw", "url": "https://api.github.com/repos/sindresorhus/ky/labels/bug", "name": "bug", "color": "d73a4a", "default": true, "description": "Something isn't working"}, {"id": 1045483934, "node_id": "MDU6TGFiZWwxMDQ1NDgzOTM0", "url": "https://api.github.com/repos/sindresorhus/ky/labels/help%20wanted", "name": "help wanted", "color": "008672", "default": true, "description": "Extra attention is needed"}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 13, "created_at": "2019-04-23T15:18:15Z", "updated_at": "2024-06-25T14:14:38Z", "closed_at": "2024-06-25T14:14:38Z", "assignee": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "#### Expected behavior\r\n\r\nA Promise rejection.\r\n\r\n#### Current behavior\r\n\r\nErrors are thrown directly.\r\n\r\n#### Code to reproduce\r\n\r\n```js\r\nky('/', {\r\n\tprefixUrl: 'https://example.com/'\r\n});\r\n```", "closed_by": {"login": "sholladay", "id": 3674950, "node_id": "MDQ6VXNlcjM2NzQ5NTA=", "avatar_url": "https://avatars.githubusercontent.com/u/3674950?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sholladay", "html_url": "https://github.com/sholladay", "followers_url": "https://api.github.com/users/sholladay/followers", "following_url": "https://api.github.com/users/sholladay/following{/other_user}", "gists_url": "https://api.github.com/users/sholladay/gists{/gist_id}", "starred_url": "https://api.github.com/users/sholladay/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sholladay/subscriptions", "organizations_url": "https://api.github.com/users/sholladay/orgs", "repos_url": "https://api.github.com/users/sholladay/repos", "events_url": "https://api.github.com/users/sholladay/events{/privacy}", "received_events_url": "https://api.github.com/users/sholladay/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/sindresorhus/ky/issues/131/reactions", "total_count": 2, "+1": 0, "-1": 2, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/sindresorhus/ky/issues/131/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/sindresorhus/ky/issues/486", "repository_url": "https://api.github.com/repos/sindresorhus/ky", "labels_url": "https://api.github.com/repos/sindresorhus/ky/issues/486/labels{/name}", "comments_url": "https://api.github.com/repos/sindresorhus/ky/issues/486/comments", "events_url": "https://api.github.com/repos/sindresorhus/ky/issues/486/events", "html_url": "https://github.com/sindresorhus/ky/issues/486", "id": 1557299061, "node_id": "I_kwDOCMjFuM5c0n91", "number": 486, "title": "Error in Next.js 13 Server APIs: Cannot construct a Request with a Request object that has already been used", "user": {"login": "FaizanShaikh45", "id": 51155658, "node_id": "MDQ6VXNlcjUxMTU1NjU4", "avatar_url": "https://avatars.githubusercontent.com/u/51155658?v=4", "gravatar_id": "", "url": "https://api.github.com/users/FaizanShaikh45", "html_url": "https://github.com/FaizanShaikh45", "followers_url": "https://api.github.com/users/FaizanShaikh45/followers", "following_url": "https://api.github.com/users/FaizanShaikh45/following{/other_user}", "gists_url": "https://api.github.com/users/FaizanShaikh45/gists{/gist_id}", "starred_url": "https://api.github.com/users/FaizanShaikh45/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/FaizanShaikh45/subscriptions", "organizations_url": "https://api.github.com/users/FaizanShaikh45/orgs", "repos_url": "https://api.github.com/users/FaizanShaikh45/repos", "events_url": "https://api.github.com/users/FaizanShaikh45/events{/privacy}", "received_events_url": "https://api.github.com/users/FaizanShaikh45/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 1045483930, "node_id": "MDU6TGFiZWwxMDQ1NDgzOTMw", "url": "https://api.github.com/repos/sindresorhus/ky/labels/bug", "name": "bug", "color": "d73a4a", "default": true, "description": "Something isn't working"}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 12, "created_at": "2023-01-25T21:31:14Z", "updated_at": "2025-10-13T12:30:31Z", "closed_at": "2025-10-13T12:30:31Z", "assignee": null, "author_association": "NONE", "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "Hi Guys,\r\n\r\nConfig:\r\n```\r\nKY Version: ^0.33.2\r\nNode Version: 18.13.0\r\nNextJS Version: latest (13)\r\nReact: 18.2.0\r\n```\r\n\r\nI'm trying to use KY to retrieve data from backend services. I'm using KY in the NextJS APIs folder to call down-stream services. However, I am receiving the error mentioned below. \r\n\r\n```\r\nTypeError: Cannot construct a Request with a Request object that has already been used.\r\n    at Object.fetch (node:internal/deps/undici/undici:14062:11)\r\n    at async fn (webpack-internal:///(api)/./node_modules/ky/distribution/core/Ky.js:29:28)\r\n    at async result.<computed> [as json] (webpack-internal:///(api)/./node_modules/ky/distribution/core/Ky.js:65:39)\r\n    at async handler (webpack-internal:///(api)/./pages/api/user/recommended-user-list.ts:13:30)\r\n    at async Object.apiResolver (folder/node_modules/next/dist/server/api-utils/node.js:372:9)\r\n    at async DevServer.runApi (folder/node_modules/next/dist/server/next-server.js:488:9)\r\n    at async Object.fn (folder/node_modules/next/dist/server/next-server.js:751:37)\r\n    at async Router.execute (folder/node_modules/next/dist/server/router.js:253:36)\r\n    at async DevServer.run (folder/node_modules/next/dist/server/base-server.js:384:29)\r\n    at async DevServer.run (folder/node_modules/next/dist/server/dev/next-dev-server.js:741:20)\r\n    at async DevServer.handleRequest (folder/node_modules/next/dist/server/base-server.js:322:20)\r\n```\r\n\r\nHTTP Client Code Ref: <img width=\"538\" alt=\"image\" src=\"https://user-images.githubusercontent.com/51155658/214694127-813af5e9-b6ae-4734-a9a5-0cd4605cca92.png\">\r\n\r\nThe structure I'm attempting to set up for the http client is seen above. So I'm trying to create an HTTP client and passing it to the service as arguments to the function, and then with that client service is calling downstream APIs to get data.\r\n\r\nService Code Ref: \r\n<img width=\"243\" alt=\"image\" src=\"https://user-images.githubusercontent.com/51155658/214695290-1fdb8c05-9a4c-4698-8d45-1553bfa12007.png\">\r\n\r\n\r\nIt works perfectly with NextJS 12, however when I try to implement it with NextJS 13, I get this problem. Could someone please assist me with this? \r\n\r\nThanks", "closed_by": {"login": "sindresorhus", "id": 170270, "node_id": "MDQ6VXNlcjE3MDI3MA==", "avatar_url": "https://avatars.githubusercontent.com/u/170270?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sindresorhus", "html_url": "https://github.com/sindresorhus", "followers_url": "https://api.github.com/users/sindresorhus/followers", "following_url": "https://api.github.com/users/sindresorhus/following{/other_user}", "gists_url": "https://api.github.com/users/sindresorhus/gists{/gist_id}", "starred_url": "https://api.github.com/users/sindresorhus/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sindresorhus/subscriptions", "organizations_url": "https://api.github.com/users/sindresorhus/orgs", "repos_url": "https://api.github.com/users/sindresorhus/repos", "events_url": "https://api.github.com/users/sindresorhus/events{/privacy}", "received_events_url": "https://api.github.com/users/sindresorhus/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/sindresorhus/ky/issues/486/reactions", "total_count": 5, "+1": 5, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/sindresorhus/ky/issues/486/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/sindresorhus/ky/issues/233", "repository_url": "https://api.github.com/repos/sindresorhus/ky", "labels_url": "https://api.github.com/repos/sindresorhus/ky/issues/233/labels{/name}", "comments_url": "https://api.github.com/repos/sindresorhus/ky/issues/233/comments", "events_url": "https://api.github.com/repos/sindresorhus/ky/issues/233/events", "html_url": "https://github.com/sindresorhus/ky/issues/233", "id": 558586059, "node_id": "MDU6SXNzdWU1NTg1ODYwNTk=", "number": 233, "title": "Duplicate retries when using Chromium", "user": {"login": "szmarczak", "id": 36894700, "node_id": "MDQ6VXNlcjM2ODk0NzAw", "avatar_url": "https://avatars.githubusercontent.com/u/36894700?v=4", "gravatar_id": "", "url": "https://api.github.com/users/szmarczak", "html_url": "https://github.com/szmarczak", "followers_url": "https://api.github.com/users/szmarczak/followers", "following_url": "https://api.github.com/users/szmarczak/following{/other_user}", "gists_url": "https://api.github.com/users/szmarczak/gists{/gist_id}", "starred_url": "https://api.github.com/users/szmarczak/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/szmarczak/subscriptions", "organizations_url": "https://api.github.com/users/szmarczak/orgs", "repos_url": "https://api.github.com/users/szmarczak/repos", "events_url": "https://api.github.com/users/szmarczak/events{/privacy}", "received_events_url": "https://api.github.com/users/szmarczak/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 1045483930, "node_id": "MDU6TGFiZWwxMDQ1NDgzOTMw", "url": "https://api.github.com/repos/sindresorhus/ky/labels/bug", "name": "bug", "color": "d73a4a", "default": true, "description": "Something isn't working"}, {"id": 1045483934, "node_id": "MDU6TGFiZWwxMDQ1NDgzOTM0", "url": "https://api.github.com/repos/sindresorhus/ky/labels/help%20wanted", "name": "help wanted", "color": "008672", "default": true, "description": "Extra attention is needed"}, {"id": 1821650136, "node_id": "MDU6TGFiZWwxODIxNjUwMTM2", "url": "https://api.github.com/repos/sindresorhus/ky/labels/external", "name": "external", "color": "f79a67", "default": false, "description": ""}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 12, "created_at": "2020-02-01T19:32:45Z", "updated_at": "2025-10-13T15:33:24Z", "closed_at": "2025-10-13T15:33:24Z", "assignee": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "Test:\r\n\r\n```js\r\ntest.only('retry with body', withPage, async (t, page) => {\r\n\tlet requestCount = 0;\r\n\r\n\tconst server = await createTestServer();\r\n\tserver.get('/', (request, response) => {\r\n\t\tresponse.end('zebra');\r\n\t});\r\n\r\n\tserver.put('/test', async (request, response) => {\r\n\t\tconsole.log(Date.now());\r\n\t\trequestCount++;\r\n\t\tawait pBody(request);\r\n\t\tresponse.sendStatus(408);\r\n\t});\r\n\r\n\tawait page.goto(server.url);\r\n\tawait page.addScriptTag({path: './umd.js'});\r\n\r\n\tawait new Promise(resolve => page.on('close', resolve));\r\n\tt.is(requestCount, 1);\r\n\r\n\tawait server.close();\r\n});\r\n```\r\n\r\n`with-page.js`:\r\n\r\n```js\r\nexport default async function withPage(t, run) {\r\n\tconst browser = await puppeteer.launch({\r\n\t\theadless: false\r\n\t});\r\n\tconst page = await browser.newPage();\r\n\ttry {\r\n\t\tawait run(t, page);\r\n\t} finally {\r\n\t\tawait page.close().catch(() => {});\r\n\t\tawait browser.close().catch(() => {});\r\n\t}\r\n}\r\n```\r\n\r\nWhen you run the following code, you will notice that it will receive three requests (3 different timestamps, there is a ~5ms difference between them). Seems like Chromium (including Google Chrome) is doing retries too.\r\n\r\n```js\r\nglobalThis.fetch(`${location.href}test`, {\r\n\tmethod: 'PUT',\r\n\tbody: 'a'\r\n});\r\n```\r\n\r\nRelated:\r\n- https://www.bennadel.com/blog/3257-google-chrome-will-automatically-retry-requests-on-certain-error-responses.htm\r\n- https://groups.google.com/a/chromium.org/forum/#!topic/chromium-dev/urswDsm6Pe0\r\n- https://medium.com/@lighthopper/connection-retry-schedule-in-chrome-browser-a9c814b7dc20", "closed_by": {"login": "sindresorhus", "id": 170270, "node_id": "MDQ6VXNlcjE3MDI3MA==", "avatar_url": "https://avatars.githubusercontent.com/u/170270?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sindresorhus", "html_url": "https://github.com/sindresorhus", "followers_url": "https://api.github.com/users/sindresorhus/followers", "following_url": "https://api.github.com/users/sindresorhus/following{/other_user}", "gists_url": "https://api.github.com/users/sindresorhus/gists{/gist_id}", "starred_url": "https://api.github.com/users/sindresorhus/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sindresorhus/subscriptions", "organizations_url": "https://api.github.com/users/sindresorhus/orgs", "repos_url": "https://api.github.com/users/sindresorhus/repos", "events_url": "https://api.github.com/users/sindresorhus/events{/privacy}", "received_events_url": "https://api.github.com/users/sindresorhus/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/sindresorhus/ky/issues/233/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/sindresorhus/ky/issues/233/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/sindresorhus/ky/issues/260", "repository_url": "https://api.github.com/repos/sindresorhus/ky", "labels_url": "https://api.github.com/repos/sindresorhus/ky/issues/260/labels{/name}", "comments_url": "https://api.github.com/repos/sindresorhus/ky/issues/260/comments", "events_url": "https://api.github.com/repos/sindresorhus/ky/issues/260/events", "html_url": "https://github.com/sindresorhus/ky/issues/260", "id": 641989368, "node_id": "MDU6SXNzdWU2NDE5ODkzNjg=", "number": 260, "title": "Edge <= 18 Invalid argument exception", "user": {"login": "JosNun", "id": 7729878, "node_id": "MDQ6VXNlcjc3Mjk4Nzg=", "avatar_url": "https://avatars.githubusercontent.com/u/7729878?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JosNun", "html_url": "https://github.com/JosNun", "followers_url": "https://api.github.com/users/JosNun/followers", "following_url": "https://api.github.com/users/JosNun/following{/other_user}", "gists_url": "https://api.github.com/users/JosNun/gists{/gist_id}", "starred_url": "https://api.github.com/users/JosNun/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JosNun/subscriptions", "organizations_url": "https://api.github.com/users/JosNun/orgs", "repos_url": "https://api.github.com/users/JosNun/repos", "events_url": "https://api.github.com/users/JosNun/events{/privacy}", "received_events_url": "https://api.github.com/users/JosNun/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 1045483930, "node_id": "MDU6TGFiZWwxMDQ1NDgzOTMw", "url": "https://api.github.com/repos/sindresorhus/ky/labels/bug", "name": "bug", "color": "d73a4a", "default": true, "description": "Something isn't working"}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 9, "created_at": "2020-06-19T13:57:00Z", "updated_at": "2020-07-16T17:51:23Z", "closed_at": "2020-07-16T17:51:23Z", "assignee": null, "author_association": "NONE", "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "Pre-Chromium Microsoft Edge blows up when `undefined` is passed as an argument to the `window.Headers` constructor. As such, ky blows up when trying to make a request due to [these lines](https://github.com/sindresorhus/ky/blob/2c5d6dda8ac889048408a337c3f5d068769981b2/index.js#L52).", "closed_by": {"login": "sholladay", "id": 3674950, "node_id": "MDQ6VXNlcjM2NzQ5NTA=", "avatar_url": "https://avatars.githubusercontent.com/u/3674950?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sholladay", "html_url": "https://github.com/sholladay", "followers_url": "https://api.github.com/users/sholladay/followers", "following_url": "https://api.github.com/users/sholladay/following{/other_user}", "gists_url": "https://api.github.com/users/sholladay/gists{/gist_id}", "starred_url": "https://api.github.com/users/sholladay/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sholladay/subscriptions", "organizations_url": "https://api.github.com/users/sholladay/orgs", "repos_url": "https://api.github.com/users/sholladay/repos", "events_url": "https://api.github.com/users/sholladay/events{/privacy}", "received_events_url": "https://api.github.com/users/sholladay/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/sindresorhus/ky/issues/260/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/sindresorhus/ky/issues/260/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/sindresorhus/ky/issues/660", "repository_url": "https://api.github.com/repos/sindresorhus/ky", "labels_url": "https://api.github.com/repos/sindresorhus/ky/issues/660/labels{/name}", "comments_url": "https://api.github.com/repos/sindresorhus/ky/issues/660/comments", "events_url": "https://api.github.com/repos/sindresorhus/ky/issues/660/events", "html_url": "https://github.com/sindresorhus/ky/issues/660", "id": 2720526489, "node_id": "I_kwDOCMjFuM6iJ_CZ", "number": 660, "title": "If request starts after the signal has already been aborted, it won't throw an error", "user": {"login": "purpurplr", "id": 54118358, "node_id": "MDQ6VXNlcjU0MTE4MzU4", "avatar_url": "https://avatars.githubusercontent.com/u/54118358?v=4", "gravatar_id": "", "url": "https://api.github.com/users/purpurplr", "html_url": "https://github.com/purpurplr", "followers_url": "https://api.github.com/users/purpurplr/followers", "following_url": "https://api.github.com/users/purpurplr/following{/other_user}", "gists_url": "https://api.github.com/users/purpurplr/gists{/gist_id}", "starred_url": "https://api.github.com/users/purpurplr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/purpurplr/subscriptions", "organizations_url": "https://api.github.com/users/purpurplr/orgs", "repos_url": "https://api.github.com/users/purpurplr/repos", "events_url": "https://api.github.com/users/purpurplr/events{/privacy}", "received_events_url": "https://api.github.com/users/purpurplr/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 1045483930, "node_id": "MDU6TGFiZWwxMDQ1NDgzOTMw", "url": "https://api.github.com/repos/sindresorhus/ky/labels/bug", "name": "bug", "color": "d73a4a", "default": true, "description": "Something isn't working"}, {"id": 1045483934, "node_id": "MDU6TGFiZWwxMDQ1NDgzOTM0", "url": "https://api.github.com/repos/sindresorhus/ky/labels/help%20wanted", "name": "help wanted", "color": "008672", "default": true, "description": "Extra attention is needed"}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 8, "created_at": "2024-12-05T14:11:19Z", "updated_at": "2024-12-18T01:43:11Z", "closed_at": "2024-12-18T01:43:11Z", "assignee": null, "author_association": "NONE", "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "If request starts after the signal has already been aborted, it won't throw an error, although it probably should.\r\n\r\n```\r\nconst controller = new AbortController();\r\n\r\ncontroller.abort('no reason');\r\n\r\nky.get('https://jsonplaceholder.typicode.com/todos/1', { signal: controller.signal })\r\n  .json()\r\n  .then((json) => console.log(json));\r\n```", "closed_by": {"login": "sholladay", "id": 3674950, "node_id": "MDQ6VXNlcjM2NzQ5NTA=", "avatar_url": "https://avatars.githubusercontent.com/u/3674950?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sholladay", "html_url": "https://github.com/sholladay", "followers_url": "https://api.github.com/users/sholladay/followers", "following_url": "https://api.github.com/users/sholladay/following{/other_user}", "gists_url": "https://api.github.com/users/sholladay/gists{/gist_id}", "starred_url": "https://api.github.com/users/sholladay/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sholladay/subscriptions", "organizations_url": "https://api.github.com/users/sholladay/orgs", "repos_url": "https://api.github.com/users/sholladay/repos", "events_url": "https://api.github.com/users/sholladay/events{/privacy}", "received_events_url": "https://api.github.com/users/sholladay/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/sindresorhus/ky/issues/660/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/sindresorhus/ky/issues/660/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/sindresorhus/ky/issues/240", "repository_url": "https://api.github.com/repos/sindresorhus/ky", "labels_url": "https://api.github.com/repos/sindresorhus/ky/issues/240/labels{/name}", "comments_url": "https://api.github.com/repos/sindresorhus/ky/issues/240/comments", "events_url": "https://api.github.com/repos/sindresorhus/ky/issues/240/events", "html_url": "https://github.com/sindresorhus/ky/issues/240", "id": 572200815, "node_id": "MDU6SXNzdWU1NzIyMDA4MTU=", "number": 240, "title": "NormalizedOptions interface giving wrong Headers type", "user": {"login": "geoff-harper", "id": 7593910, "node_id": "MDQ6VXNlcjc1OTM5MTA=", "avatar_url": "https://avatars.githubusercontent.com/u/7593910?v=4", "gravatar_id": "", "url": "https://api.github.com/users/geoff-harper", "html_url": "https://github.com/geoff-harper", "followers_url": "https://api.github.com/users/geoff-harper/followers", "following_url": "https://api.github.com/users/geoff-harper/following{/other_user}", "gists_url": "https://api.github.com/users/geoff-harper/gists{/gist_id}", "starred_url": "https://api.github.com/users/geoff-harper/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/geoff-harper/subscriptions", "organizations_url": "https://api.github.com/users/geoff-harper/orgs", "repos_url": "https://api.github.com/users/geoff-harper/repos", "events_url": "https://api.github.com/users/geoff-harper/events{/privacy}", "received_events_url": "https://api.github.com/users/geoff-harper/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 1045483930, "node_id": "MDU6TGFiZWwxMDQ1NDgzOTMw", "url": "https://api.github.com/repos/sindresorhus/ky/labels/bug", "name": "bug", "color": "d73a4a", "default": true, "description": "Something isn't working"}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 8, "created_at": "2020-02-27T16:31:33Z", "updated_at": "2020-04-15T18:52:57Z", "closed_at": "2020-04-15T18:52:57Z", "assignee": null, "author_association": "NONE", "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "The issue I'm experience specifically is the options param in the hook functions. I'm trying to set the `Authorization` header with `options.headers['Authorization'] = token` but `NormalizedOptions.headers` claims to be a `Headers` class, when it's actually just a Record of key/value strings like in the `create`/`extend` options.", "closed_by": {"login": "sholladay", "id": 3674950, "node_id": "MDQ6VXNlcjM2NzQ5NTA=", "avatar_url": "https://avatars.githubusercontent.com/u/3674950?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sholladay", "html_url": "https://github.com/sholladay", "followers_url": "https://api.github.com/users/sholladay/followers", "following_url": "https://api.github.com/users/sholladay/following{/other_user}", "gists_url": "https://api.github.com/users/sholladay/gists{/gist_id}", "starred_url": "https://api.github.com/users/sholladay/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sholladay/subscriptions", "organizations_url": "https://api.github.com/users/sholladay/orgs", "repos_url": "https://api.github.com/users/sholladay/repos", "events_url": "https://api.github.com/users/sholladay/events{/privacy}", "received_events_url": "https://api.github.com/users/sholladay/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/sindresorhus/ky/issues/240/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/sindresorhus/ky/issues/240/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/sindresorhus/ky/issues/64", "repository_url": "https://api.github.com/repos/sindresorhus/ky", "labels_url": "https://api.github.com/repos/sindresorhus/ky/issues/64/labels{/name}", "comments_url": "https://api.github.com/repos/sindresorhus/ky/issues/64/comments", "events_url": "https://api.github.com/repos/sindresorhus/ky/issues/64/events", "html_url": "https://github.com/sindresorhus/ky/issues/64", "id": 384835758, "node_id": "MDU6SXNzdWUzODQ4MzU3NTg=", "number": 64, "title": "React native reference error in 0.5.1", "user": {"login": "RemyLivewall", "id": 23557749, "node_id": "MDQ6VXNlcjIzNTU3NzQ5", "avatar_url": "https://avatars.githubusercontent.com/u/23557749?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RemyLivewall", "html_url": "https://github.com/RemyLivewall", "followers_url": "https://api.github.com/users/RemyLivewall/followers", "following_url": "https://api.github.com/users/RemyLivewall/following{/other_user}", "gists_url": "https://api.github.com/users/RemyLivewall/gists{/gist_id}", "starred_url": "https://api.github.com/users/RemyLivewall/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RemyLivewall/subscriptions", "organizations_url": "https://api.github.com/users/RemyLivewall/orgs", "repos_url": "https://api.github.com/users/RemyLivewall/repos", "events_url": "https://api.github.com/users/RemyLivewall/events{/privacy}", "received_events_url": "https://api.github.com/users/RemyLivewall/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 1045483930, "node_id": "MDU6TGFiZWwxMDQ1NDgzOTMw", "url": "https://api.github.com/repos/sindresorhus/ky/labels/bug", "name": "bug", "color": "d73a4a", "default": true, "description": "Something isn't working"}, {"id": 1045483934, "node_id": "MDU6TGFiZWwxMDQ1NDgzOTM0", "url": "https://api.github.com/repos/sindresorhus/ky/labels/help%20wanted", "name": "help wanted", "color": "008672", "default": true, "description": "Extra attention is needed"}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 8, "created_at": "2018-11-27T14:59:43Z", "updated_at": "2019-01-07T01:17:13Z", "closed_at": "2019-01-07T01:17:13Z", "assignee": null, "author_association": "NONE", "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "I have been using this library on version 0.4.1 for some time and that works in react-native when running on the simulator with a debugger attached. Running on device results in Reference Error: self is not defined. This should be fixed in issue #53 (With commit f107e7b92d90e4b0287846a49ba3f30d9b9ca648) which is available from version 0.5.0. After upgrading ky to 0.5.0 or 0.5.1 Running on a simulator with a debugger attached or a device results in Reference Error: document is not defined.\r\n\r\nI import ky and export an instance as follows:\r\n```\r\nimport ky from \"ky\";\r\nexport const api = ky.extend({prefixUrl: BASE_URL});\r\n```\r\n\r\nThe error shown in the console is as follows:\r\n```\r\nPossible Unhandled Promise Rejection (id: 0):\r\nReferenceError: document is not defined\r\nReferenceError: document is not defined\r\n    at new Ky (blob:file:///58581b4b-dc99-4126-b9a9-cb3f918e33f0:111478:76)\r\n    at Function.ky.(anonymous function) [as post] (blob:file:///58581b4b-dc99-4126-b9a9-cb3f918e33f0:111772:16)\r\n    at _callee3$ (blob:file:///58581b4b-dc99-4126-b9a9-cb3f918e33f0:115504:24)\r\n    at tryCatch (blob:file:///58581b4b-dc99-4126-b9a9-cb3f918e33f0:2081:19)\r\n    at Generator.invoke [as _invoke] (blob:file:///58581b4b-dc99-4126-b9a9-cb3f918e33f0:2256:24)\r\n    at Generator.prototype.(anonymous function) [as next] (blob:file:///58581b4b-dc99-4126-b9a9-cb3f918e33f0:2124:23)\r\n    at tryCatch (blob:file:///58581b4b-dc99-4126-b9a9-cb3f918e33f0:2081:19)\r\n    at invoke (blob:file:///58581b4b-dc99-4126-b9a9-cb3f918e33f0:2157:22)\r\n    at blob:file:///58581b4b-dc99-4126-b9a9-cb3f918e33f0:2167:15\r\n    at tryCallOne (blob:file:///58581b4b-dc99-4126-b9a9-cb3f918e33f0:6115:14)\r\n```\r\n\r\n", "closed_by": {"login": "sindresorhus", "id": 170270, "node_id": "MDQ6VXNlcjE3MDI3MA==", "avatar_url": "https://avatars.githubusercontent.com/u/170270?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sindresorhus", "html_url": "https://github.com/sindresorhus", "followers_url": "https://api.github.com/users/sindresorhus/followers", "following_url": "https://api.github.com/users/sindresorhus/following{/other_user}", "gists_url": "https://api.github.com/users/sindresorhus/gists{/gist_id}", "starred_url": "https://api.github.com/users/sindresorhus/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sindresorhus/subscriptions", "organizations_url": "https://api.github.com/users/sindresorhus/orgs", "repos_url": "https://api.github.com/users/sindresorhus/repos", "events_url": "https://api.github.com/users/sindresorhus/events{/privacy}", "received_events_url": "https://api.github.com/users/sindresorhus/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/sindresorhus/ky/issues/64/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/sindresorhus/ky/issues/64/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/sindresorhus/ky/issues/694", "repository_url": "https://api.github.com/repos/sindresorhus/ky", "labels_url": "https://api.github.com/repos/sindresorhus/ky/issues/694/labels{/name}", "comments_url": "https://api.github.com/repos/sindresorhus/ky/issues/694/comments", "events_url": "https://api.github.com/repos/sindresorhus/ky/issues/694/events", "html_url": "https://github.com/sindresorhus/ky/issues/694", "id": 3007780473, "node_id": "I_kwDOCMjFuM6zRxZ5", "number": 694, "title": "Upload progress is super fast, but it's fake.", "user": {"login": "recsater", "id": 16009827, "node_id": "MDQ6VXNlcjE2MDA5ODI3", "avatar_url": "https://avatars.githubusercontent.com/u/16009827?v=4", "gravatar_id": "", "url": "https://api.github.com/users/recsater", "html_url": "https://github.com/recsater", "followers_url": "https://api.github.com/users/recsater/followers", "following_url": "https://api.github.com/users/recsater/following{/other_user}", "gists_url": "https://api.github.com/users/recsater/gists{/gist_id}", "starred_url": "https://api.github.com/users/recsater/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/recsater/subscriptions", "organizations_url": "https://api.github.com/users/recsater/orgs", "repos_url": "https://api.github.com/users/recsater/repos", "events_url": "https://api.github.com/users/recsater/events{/privacy}", "received_events_url": "https://api.github.com/users/recsater/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 1045483930, "node_id": "MDU6TGFiZWwxMDQ1NDgzOTMw", "url": "https://api.github.com/repos/sindresorhus/ky/labels/bug", "name": "bug", "color": "d73a4a", "default": true, "description": "Something isn't working"}, {"id": 1045483934, "node_id": "MDU6TGFiZWwxMDQ1NDgzOTM0", "url": "https://api.github.com/repos/sindresorhus/ky/labels/help%20wanted", "name": "help wanted", "color": "008672", "default": true, "description": "Extra attention is needed"}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 7, "created_at": "2025-04-21T07:21:47Z", "updated_at": "2025-09-26T21:07:22Z", "closed_at": "2025-09-26T21:07:22Z", "assignee": null, "author_association": "NONE", "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "I tested with Chrome's Developer Tools -> Network tab, throttling the network to Fast 4G.\n\nWhen uploading via XHR:\n\n![Image](https://github.com/user-attachments/assets/dc25d427-a694-43f5-ad11-655ed6afb526)\n![Image](https://github.com/user-attachments/assets/673ac3be-b11d-4d1e-9a2a-bfa7ea374f72)\n\nWhen using Ky's uploadProgress:\n\n![Image](https://github.com/user-attachments/assets/2115a253-ccc4-4423-866e-7f4f3b15fdae)\n![Image](https://github.com/user-attachments/assets/f0e6c97e-0110-48f2-8425-9a274bd222ef)\n\nThe transfer speed of XHR is correct.", "closed_by": {"login": "sholladay", "id": 3674950, "node_id": "MDQ6VXNlcjM2NzQ5NTA=", "avatar_url": "https://avatars.githubusercontent.com/u/3674950?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sholladay", "html_url": "https://github.com/sholladay", "followers_url": "https://api.github.com/users/sholladay/followers", "following_url": "https://api.github.com/users/sholladay/following{/other_user}", "gists_url": "https://api.github.com/users/sholladay/gists{/gist_id}", "starred_url": "https://api.github.com/users/sholladay/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sholladay/subscriptions", "organizations_url": "https://api.github.com/users/sholladay/orgs", "repos_url": "https://api.github.com/users/sholladay/repos", "events_url": "https://api.github.com/users/sholladay/events{/privacy}", "received_events_url": "https://api.github.com/users/sholladay/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/sindresorhus/ky/issues/694/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/sindresorhus/ky/issues/694/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/sindresorhus/ky/issues/204", "repository_url": "https://api.github.com/repos/sindresorhus/ky", "labels_url": "https://api.github.com/repos/sindresorhus/ky/issues/204/labels{/name}", "comments_url": "https://api.github.com/repos/sindresorhus/ky/issues/204/comments", "events_url": "https://api.github.com/repos/sindresorhus/ky/issues/204/events", "html_url": "https://github.com/sindresorhus/ky/issues/204", "id": 523363871, "node_id": "MDU6SXNzdWU1MjMzNjM4NzE=", "number": 204, "title": "Error: The `content-type` header cannot be used with a FormData body. It will be set automatically.", "user": {"login": "alanshaw", "id": 152863, "node_id": "MDQ6VXNlcjE1Mjg2Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/152863?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alanshaw", "html_url": "https://github.com/alanshaw", "followers_url": "https://api.github.com/users/alanshaw/followers", "following_url": "https://api.github.com/users/alanshaw/following{/other_user}", "gists_url": "https://api.github.com/users/alanshaw/gists{/gist_id}", "starred_url": "https://api.github.com/users/alanshaw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alanshaw/subscriptions", "organizations_url": "https://api.github.com/users/alanshaw/orgs", "repos_url": "https://api.github.com/users/alanshaw/repos", "events_url": "https://api.github.com/users/alanshaw/events{/privacy}", "received_events_url": "https://api.github.com/users/alanshaw/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 1045483930, "node_id": "MDU6TGFiZWwxMDQ1NDgzOTMw", "url": "https://api.github.com/repos/sindresorhus/ky/labels/bug", "name": "bug", "color": "d73a4a", "default": true, "description": "Something isn't working"}], "state": "closed", "locked": false, "assignees": [{"login": "sholladay", "id": 3674950, "node_id": "MDQ6VXNlcjM2NzQ5NTA=", "avatar_url": "https://avatars.githubusercontent.com/u/3674950?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sholladay", "html_url": "https://github.com/sholladay", "followers_url": "https://api.github.com/users/sholladay/followers", "following_url": "https://api.github.com/users/sholladay/following{/other_user}", "gists_url": "https://api.github.com/users/sholladay/gists{/gist_id}", "starred_url": "https://api.github.com/users/sholladay/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sholladay/subscriptions", "organizations_url": "https://api.github.com/users/sholladay/orgs", "repos_url": "https://api.github.com/users/sholladay/repos", "events_url": "https://api.github.com/users/sholladay/events{/privacy}", "received_events_url": "https://api.github.com/users/sholladay/received_events", "type": "User", "user_view_type": "public", "site_admin": false}], "milestone": null, "comments": 7, "created_at": "2019-11-15T09:44:08Z", "updated_at": "2019-11-26T05:49:54Z", "closed_at": "2019-11-26T05:49:54Z", "assignee": {"login": "sholladay", "id": 3674950, "node_id": "MDQ6VXNlcjM2NzQ5NTA=", "avatar_url": "https://avatars.githubusercontent.com/u/3674950?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sholladay", "html_url": "https://github.com/sholladay", "followers_url": "https://api.github.com/users/sholladay/followers", "following_url": "https://api.github.com/users/sholladay/following{/other_user}", "gists_url": "https://api.github.com/users/sholladay/gists{/gist_id}", "starred_url": "https://api.github.com/users/sholladay/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sholladay/subscriptions", "organizations_url": "https://api.github.com/users/sholladay/orgs", "repos_url": "https://api.github.com/users/sholladay/repos", "events_url": "https://api.github.com/users/sholladay/events{/privacy}", "received_events_url": "https://api.github.com/users/sholladay/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "author_association": "NONE", "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "In the browser:\r\n\r\n```js\r\nconst req = new Request('http://google.com', { method: 'POST', body: new FormData() })\r\nreq.headers.has('content-type')\r\n// true\r\n```\r\n\r\nIt means we cannot pass this check even when no `content-type` header has explicitly been set.\r\n\r\nhttps://github.com/sindresorhus/ky/blob/1a86d5bf16f9282e00cd35b149d2ec00826dbef7/index.js#L246-L248\r\n\r\nSo my call to ky is erroring in v0.16:\r\n\r\n```js\r\n    const res = await ky.post('dag/put', {\r\n      timeout: options.timeout,\r\n      signal: options.signal,\r\n      headers: options.headers,\r\n      searchParams,\r\n      body: toFormData(serialized)\r\n    }).json()\r\n```\r\n\r\nhttps://github.com/ipfs/js-ipfs-http-client/pull/1159", "closed_by": {"login": "sindresorhus", "id": 170270, "node_id": "MDQ6VXNlcjE3MDI3MA==", "avatar_url": "https://avatars.githubusercontent.com/u/170270?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sindresorhus", "html_url": "https://github.com/sindresorhus", "followers_url": "https://api.github.com/users/sindresorhus/followers", "following_url": "https://api.github.com/users/sindresorhus/following{/other_user}", "gists_url": "https://api.github.com/users/sindresorhus/gists{/gist_id}", "starred_url": "https://api.github.com/users/sindresorhus/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sindresorhus/subscriptions", "organizations_url": "https://api.github.com/users/sindresorhus/orgs", "repos_url": "https://api.github.com/users/sindresorhus/repos", "events_url": "https://api.github.com/users/sindresorhus/events{/privacy}", "received_events_url": "https://api.github.com/users/sindresorhus/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/sindresorhus/ky/issues/204/reactions", "total_count": 5, "+1": 5, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/sindresorhus/ky/issues/204/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/sindresorhus/ky/issues/246", "repository_url": "https://api.github.com/repos/sindresorhus/ky", "labels_url": "https://api.github.com/repos/sindresorhus/ky/issues/246/labels{/name}", "comments_url": "https://api.github.com/repos/sindresorhus/ky/issues/246/comments", "events_url": "https://api.github.com/repos/sindresorhus/ky/issues/246/events", "html_url": "https://github.com/sindresorhus/ky/issues/246", "id": 583145223, "node_id": "MDU6SXNzdWU1ODMxNDUyMjM=", "number": 246, "title": "throwHttpErrors: false suppresses ky.TimeoutError", "user": {"login": "ghost", "id": 10137, "node_id": "MDQ6VXNlcjEwMTM3", "avatar_url": "https://avatars.githubusercontent.com/u/10137?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ghost", "html_url": "https://github.com/ghost", "followers_url": "https://api.github.com/users/ghost/followers", "following_url": "https://api.github.com/users/ghost/following{/other_user}", "gists_url": "https://api.github.com/users/ghost/gists{/gist_id}", "starred_url": "https://api.github.com/users/ghost/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ghost/subscriptions", "organizations_url": "https://api.github.com/users/ghost/orgs", "repos_url": "https://api.github.com/users/ghost/repos", "events_url": "https://api.github.com/users/ghost/events{/privacy}", "received_events_url": "https://api.github.com/users/ghost/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 1045483930, "node_id": "MDU6TGFiZWwxMDQ1NDgzOTMw", "url": "https://api.github.com/repos/sindresorhus/ky/labels/bug", "name": "bug", "color": "d73a4a", "default": true, "description": "Something isn't working"}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 6, "created_at": "2020-03-17T16:37:01Z", "updated_at": "2021-05-04T04:53:21Z", "closed_at": "2021-05-04T04:53:21Z", "assignee": null, "author_association": "NONE", "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "I could have sworn that this did not use to be the case, but it's not useful to not throw on non-200 codes and lose TimeoutErrors, which have nothing to do with HTTP errors.\r\n\r\n```html\r\n<script type=\"module\">\r\n    import ky from 'https://cdn.jsdelivr.net/npm/ky@latest/index.js';\r\n\r\n    (async () => {\r\n\r\n        const r = await ky('https://example.com', {timeout: 1, throwHttpErrors: false});\r\n\r\n        console.log(r)\r\n\r\n    })();\r\n</script>\r\n```\r\n\r\nThe response above is undefined. Which leaves me unable to tell why it's undefined.\r\n\r\nHow else are we expected to determine if a response timed out but we want to handle HTTP errors manually?", "closed_by": {"login": "sindresorhus", "id": 170270, "node_id": "MDQ6VXNlcjE3MDI3MA==", "avatar_url": "https://avatars.githubusercontent.com/u/170270?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sindresorhus", "html_url": "https://github.com/sindresorhus", "followers_url": "https://api.github.com/users/sindresorhus/followers", "following_url": "https://api.github.com/users/sindresorhus/following{/other_user}", "gists_url": "https://api.github.com/users/sindresorhus/gists{/gist_id}", "starred_url": "https://api.github.com/users/sindresorhus/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sindresorhus/subscriptions", "organizations_url": "https://api.github.com/users/sindresorhus/orgs", "repos_url": "https://api.github.com/users/sindresorhus/repos", "events_url": "https://api.github.com/users/sindresorhus/events{/privacy}", "received_events_url": "https://api.github.com/users/sindresorhus/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/sindresorhus/ky/issues/246/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/sindresorhus/ky/issues/246/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/sindresorhus/ky/issues/187", "repository_url": "https://api.github.com/repos/sindresorhus/ky", "labels_url": "https://api.github.com/repos/sindresorhus/ky/issues/187/labels{/name}", "comments_url": "https://api.github.com/repos/sindresorhus/ky/issues/187/comments", "events_url": "https://api.github.com/repos/sindresorhus/ky/issues/187/events", "html_url": "https://github.com/sindresorhus/ky/issues/187", "id": 511883166, "node_id": "MDU6SXNzdWU1MTE4ODMxNjY=", "number": 187, "title": "`document` is not available in WebWorkers on Safari which leads to TypeError", "user": {"login": "fgreinus", "id": 1236785, "node_id": "MDQ6VXNlcjEyMzY3ODU=", "avatar_url": "https://avatars.githubusercontent.com/u/1236785?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fgreinus", "html_url": "https://github.com/fgreinus", "followers_url": "https://api.github.com/users/fgreinus/followers", "following_url": "https://api.github.com/users/fgreinus/following{/other_user}", "gists_url": "https://api.github.com/users/fgreinus/gists{/gist_id}", "starred_url": "https://api.github.com/users/fgreinus/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fgreinus/subscriptions", "organizations_url": "https://api.github.com/users/fgreinus/orgs", "repos_url": "https://api.github.com/users/fgreinus/repos", "events_url": "https://api.github.com/users/fgreinus/events{/privacy}", "received_events_url": "https://api.github.com/users/fgreinus/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 1045483930, "node_id": "MDU6TGFiZWwxMDQ1NDgzOTMw", "url": "https://api.github.com/repos/sindresorhus/ky/labels/bug", "name": "bug", "color": "d73a4a", "default": true, "description": "Something isn't working"}], "state": "closed", "locked": false, "assignees": [{"login": "sholladay", "id": 3674950, "node_id": "MDQ6VXNlcjM2NzQ5NTA=", "avatar_url": "https://avatars.githubusercontent.com/u/3674950?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sholladay", "html_url": "https://github.com/sholladay", "followers_url": "https://api.github.com/users/sholladay/followers", "following_url": "https://api.github.com/users/sholladay/following{/other_user}", "gists_url": "https://api.github.com/users/sholladay/gists{/gist_id}", "starred_url": "https://api.github.com/users/sholladay/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sholladay/subscriptions", "organizations_url": "https://api.github.com/users/sholladay/orgs", "repos_url": "https://api.github.com/users/sholladay/repos", "events_url": "https://api.github.com/users/sholladay/events{/privacy}", "received_events_url": "https://api.github.com/users/sholladay/received_events", "type": "User", "user_view_type": "public", "site_admin": false}], "milestone": null, "comments": 6, "created_at": "2019-10-24T11:28:03Z", "updated_at": "2019-11-07T16:19:22Z", "closed_at": "2019-11-07T16:19:22Z", "assignee": {"login": "sholladay", "id": 3674950, "node_id": "MDQ6VXNlcjM2NzQ5NTA=", "avatar_url": "https://avatars.githubusercontent.com/u/3674950?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sholladay", "html_url": "https://github.com/sholladay", "followers_url": "https://api.github.com/users/sholladay/followers", "following_url": "https://api.github.com/users/sholladay/following{/other_user}", "gists_url": "https://api.github.com/users/sholladay/gists{/gist_id}", "starred_url": "https://api.github.com/users/sholladay/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sholladay/subscriptions", "organizations_url": "https://api.github.com/users/sholladay/orgs", "repos_url": "https://api.github.com/users/sholladay/repos", "events_url": "https://api.github.com/users/sholladay/events{/privacy}", "received_events_url": "https://api.github.com/users/sholladay/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "author_association": "NONE", "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "Hello folks,\r\n\r\nI stumbled upon a really strange bug, that only occurred in WebWorkers when using Safari (Desktop).\r\nAt this point https://github.com/sindresorhus/ky/blob/master/index.js#L262 ky accesses the document object. There is a check for it, but in case it is not present, `globals.document && globals.document.baseURI` returns false. But i think Safari expects a string or undefined, because it throws a Type Error at exactly this position. https://developer.mozilla.org/en-US/docs/Web/API/URL/URL this is the documentation for the URL class.\r\n\r\nAm i right with my findings? If so, i'd be willing to submit a PR.\r\n\r\nThanks for the awesome package and for your help in advance!\r\n\r\nEdit: I just realized, that `globals.document && globals.document.baseURI` returns undefined in case of globals.document not being existant. So I really have no idea now why Safari throws a TypeError.", "closed_by": {"login": "szmarczak", "id": 36894700, "node_id": "MDQ6VXNlcjM2ODk0NzAw", "avatar_url": "https://avatars.githubusercontent.com/u/36894700?v=4", "gravatar_id": "", "url": "https://api.github.com/users/szmarczak", "html_url": "https://github.com/szmarczak", "followers_url": "https://api.github.com/users/szmarczak/followers", "following_url": "https://api.github.com/users/szmarczak/following{/other_user}", "gists_url": "https://api.github.com/users/szmarczak/gists{/gist_id}", "starred_url": "https://api.github.com/users/szmarczak/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/szmarczak/subscriptions", "organizations_url": "https://api.github.com/users/szmarczak/orgs", "repos_url": "https://api.github.com/users/szmarczak/repos", "events_url": "https://api.github.com/users/szmarczak/events{/privacy}", "received_events_url": "https://api.github.com/users/szmarczak/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/sindresorhus/ky/issues/187/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/sindresorhus/ky/issues/187/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/sindresorhus/ky/issues/138", "repository_url": "https://api.github.com/repos/sindresorhus/ky", "labels_url": "https://api.github.com/repos/sindresorhus/ky/issues/138/labels{/name}", "comments_url": "https://api.github.com/repos/sindresorhus/ky/issues/138/comments", "events_url": "https://api.github.com/repos/sindresorhus/ky/issues/138/events", "html_url": "https://github.com/sindresorhus/ky/issues/138", "id": 454649964, "node_id": "MDU6SXNzdWU0NTQ2NDk5NjQ=", "number": 138, "title": "delay causes node process to hang", "user": {"login": "jamime", "id": 2328042, "node_id": "MDQ6VXNlcjIzMjgwNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/2328042?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jamime", "html_url": "https://github.com/jamime", "followers_url": "https://api.github.com/users/jamime/followers", "following_url": "https://api.github.com/users/jamime/following{/other_user}", "gists_url": "https://api.github.com/users/jamime/gists{/gist_id}", "starred_url": "https://api.github.com/users/jamime/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jamime/subscriptions", "organizations_url": "https://api.github.com/users/jamime/orgs", "repos_url": "https://api.github.com/users/jamime/repos", "events_url": "https://api.github.com/users/jamime/events{/privacy}", "received_events_url": "https://api.github.com/users/jamime/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 1045483930, "node_id": "MDU6TGFiZWwxMDQ1NDgzOTMw", "url": "https://api.github.com/repos/sindresorhus/ky/labels/bug", "name": "bug", "color": "d73a4a", "default": true, "description": "Something isn't working"}, {"id": 1045483934, "node_id": "MDU6TGFiZWwxMDQ1NDgzOTM0", "url": "https://api.github.com/repos/sindresorhus/ky/labels/help%20wanted", "name": "help wanted", "color": "008672", "default": true, "description": "Extra attention is needed"}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 6, "created_at": "2019-06-11T12:05:35Z", "updated_at": "2019-07-26T23:51:43Z", "closed_at": "2019-07-26T23:51:43Z", "assignee": null, "author_association": "NONE", "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "This package and [ky-universal](https://github.com/sindresorhus/ky-universal) is used in [danger-js](https://github.com/danger/danger-js) via the [node-gitlab](https://github.com/jdalrymple/node-gitlab) project.\r\n\r\nWhen ky is used, the node process will not exit until the `setTimout` has completed. \r\n\r\nhttps://github.com/sindresorhus/ky/blob/07838c79e66b74f4d365b4c5ac82c5c9c18039b8/index.js#L122\r\n\r\nI suggest changing the `delay(ms)` function to accept a promise `delay(ms, promise)` when the promise is resolved the timeout can be cancelled. In this instance the promise needs to be the promise copied into timeout.\r\n\r\nhttps://github.com/sindresorhus/ky/blob/07838c79e66b74f4d365b4c5ac82c5c9c18039b8/index.js#L127\r\n\r\nThis bug was introduced in #122 ", "closed_by": {"login": "sindresorhus", "id": 170270, "node_id": "MDQ6VXNlcjE3MDI3MA==", "avatar_url": "https://avatars.githubusercontent.com/u/170270?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sindresorhus", "html_url": "https://github.com/sindresorhus", "followers_url": "https://api.github.com/users/sindresorhus/followers", "following_url": "https://api.github.com/users/sindresorhus/following{/other_user}", "gists_url": "https://api.github.com/users/sindresorhus/gists{/gist_id}", "starred_url": "https://api.github.com/users/sindresorhus/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sindresorhus/subscriptions", "organizations_url": "https://api.github.com/users/sindresorhus/orgs", "repos_url": "https://api.github.com/users/sindresorhus/repos", "events_url": "https://api.github.com/users/sindresorhus/events{/privacy}", "received_events_url": "https://api.github.com/users/sindresorhus/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/sindresorhus/ky/issues/138/reactions", "total_count": 2, "+1": 2, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/sindresorhus/ky/issues/138/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/sindresorhus/ky/issues/290", "repository_url": "https://api.github.com/repos/sindresorhus/ky", "labels_url": "https://api.github.com/repos/sindresorhus/ky/issues/290/labels{/name}", "comments_url": "https://api.github.com/repos/sindresorhus/ky/issues/290/comments", "events_url": "https://api.github.com/repos/sindresorhus/ky/issues/290/events", "html_url": "https://github.com/sindresorhus/ky/issues/290", "id": 724809272, "node_id": "MDU6SXNzdWU3MjQ4MDkyNzI=", "number": 290, "title": "Broken ky.stop", "user": {"login": "jabuj", "id": 44489753, "node_id": "MDQ6VXNlcjQ0NDg5NzUz", "avatar_url": "https://avatars.githubusercontent.com/u/44489753?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jabuj", "html_url": "https://github.com/jabuj", "followers_url": "https://api.github.com/users/jabuj/followers", "following_url": "https://api.github.com/users/jabuj/following{/other_user}", "gists_url": "https://api.github.com/users/jabuj/gists{/gist_id}", "starred_url": "https://api.github.com/users/jabuj/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jabuj/subscriptions", "organizations_url": "https://api.github.com/users/jabuj/orgs", "repos_url": "https://api.github.com/users/jabuj/repos", "events_url": "https://api.github.com/users/jabuj/events{/privacy}", "received_events_url": "https://api.github.com/users/jabuj/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 1045483930, "node_id": "MDU6TGFiZWwxMDQ1NDgzOTMw", "url": "https://api.github.com/repos/sindresorhus/ky/labels/bug", "name": "bug", "color": "d73a4a", "default": true, "description": "Something isn't working"}, {"id": 1045483934, "node_id": "MDU6TGFiZWwxMDQ1NDgzOTM0", "url": "https://api.github.com/repos/sindresorhus/ky/labels/help%20wanted", "name": "help wanted", "color": "008672", "default": true, "description": "Extra attention is needed"}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 4, "created_at": "2020-10-19T17:12:48Z", "updated_at": "2021-01-08T08:13:06Z", "closed_at": "2021-01-08T08:13:06Z", "assignee": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "This line causes causes `TypeError: cannot read property \"clone\" of undefined`, when returning `ky.stop` from `beforeRetry` hook\r\n\r\nhttps://github.com/sindresorhus/ky/blob/764bc1cdabdb65bbcd9830b0f8bfbd95fed3179a/index.js#L344\r\n\r\nPossible solution would be to throw error here instead of returning nothing, but I'm not sure if this is how it's supposed to work:\r\n\r\nhttps://github.com/sindresorhus/ky/blob/764bc1cdabdb65bbcd9830b0f8bfbd95fed3179a/index.js#L429", "closed_by": {"login": "sindresorhus", "id": 170270, "node_id": "MDQ6VXNlcjE3MDI3MA==", "avatar_url": "https://avatars.githubusercontent.com/u/170270?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sindresorhus", "html_url": "https://github.com/sindresorhus", "followers_url": "https://api.github.com/users/sindresorhus/followers", "following_url": "https://api.github.com/users/sindresorhus/following{/other_user}", "gists_url": "https://api.github.com/users/sindresorhus/gists{/gist_id}", "starred_url": "https://api.github.com/users/sindresorhus/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sindresorhus/subscriptions", "organizations_url": "https://api.github.com/users/sindresorhus/orgs", "repos_url": "https://api.github.com/users/sindresorhus/repos", "events_url": "https://api.github.com/users/sindresorhus/events{/privacy}", "received_events_url": "https://api.github.com/users/sindresorhus/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/sindresorhus/ky/issues/290/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/sindresorhus/ky/issues/290/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/sindresorhus/ky/issues/221", "repository_url": "https://api.github.com/repos/sindresorhus/ky", "labels_url": "https://api.github.com/repos/sindresorhus/ky/issues/221/labels{/name}", "comments_url": "https://api.github.com/repos/sindresorhus/ky/issues/221/comments", "events_url": "https://api.github.com/repos/sindresorhus/ky/issues/221/events", "html_url": "https://github.com/sindresorhus/ky/issues/221", "id": 550542990, "node_id": "MDU6SXNzdWU1NTA1NDI5OTA=", "number": 221, "title": "Request not cancelled when timeout occurs", "user": {"login": "fruitraccoon", "id": 13607075, "node_id": "MDQ6VXNlcjEzNjA3MDc1", "avatar_url": "https://avatars.githubusercontent.com/u/13607075?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fruitraccoon", "html_url": "https://github.com/fruitraccoon", "followers_url": "https://api.github.com/users/fruitraccoon/followers", "following_url": "https://api.github.com/users/fruitraccoon/following{/other_user}", "gists_url": "https://api.github.com/users/fruitraccoon/gists{/gist_id}", "starred_url": "https://api.github.com/users/fruitraccoon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fruitraccoon/subscriptions", "organizations_url": "https://api.github.com/users/fruitraccoon/orgs", "repos_url": "https://api.github.com/users/fruitraccoon/repos", "events_url": "https://api.github.com/users/fruitraccoon/events{/privacy}", "received_events_url": "https://api.github.com/users/fruitraccoon/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 1045483930, "node_id": "MDU6TGFiZWwxMDQ1NDgzOTMw", "url": "https://api.github.com/repos/sindresorhus/ky/labels/bug", "name": "bug", "color": "d73a4a", "default": true, "description": "Something isn't working"}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 4, "created_at": "2020-01-16T02:54:25Z", "updated_at": "2020-02-22T08:48:42Z", "closed_at": "2020-02-22T08:48:42Z", "assignee": null, "author_association": "NONE", "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "When a Ky request times out AND no explicit signal was passed in the options, the request is not being cancelled.\r\n\r\n[Reproduction stackblitz here](https://stackblitz.com/edit/react-ts-udrt4s?file=index.tsx) - when the code runs it makes two requests to GET root.  In Chrome's dev tools, the first request is shown to be cancelled, but the second is not.\r\n\r\nLooking at the code, it appears the issue is with [this line](https://github.com/sindresorhus/ky/blob/v0.16.1/index.js#L233-L233). The `this._options.signal` is only set if there's already a signal set on the options.\r\n\r\nThis initial PR that added the cancel functionality [had this coded differently](https://github.com/sindresorhus/ky/pull/27/files#diff-168726dbe96b3ce427e7fedce31bb0bcR149-R157) but it was changed in [PR 180](https://github.com/sindresorhus/ky/pull/180/files#diff-168726dbe96b3ce427e7fedce31bb0bcL280-L283).  It does not appear that the change in behaviour was intended?\r\n\r\nI've worked around this issue for now by setting a (never used) signal in the default options for ky, but I thought it worth reporting.\r\n\r\nEdit: Tested Ky version: 0.16.1", "closed_by": {"login": "sindresorhus", "id": 170270, "node_id": "MDQ6VXNlcjE3MDI3MA==", "avatar_url": "https://avatars.githubusercontent.com/u/170270?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sindresorhus", "html_url": "https://github.com/sindresorhus", "followers_url": "https://api.github.com/users/sindresorhus/followers", "following_url": "https://api.github.com/users/sindresorhus/following{/other_user}", "gists_url": "https://api.github.com/users/sindresorhus/gists{/gist_id}", "starred_url": "https://api.github.com/users/sindresorhus/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sindresorhus/subscriptions", "organizations_url": "https://api.github.com/users/sindresorhus/orgs", "repos_url": "https://api.github.com/users/sindresorhus/repos", "events_url": "https://api.github.com/users/sindresorhus/events{/privacy}", "received_events_url": "https://api.github.com/users/sindresorhus/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/sindresorhus/ky/issues/221/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/sindresorhus/ky/issues/221/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/sindresorhus/ky/issues/784", "repository_url": "https://api.github.com/repos/sindresorhus/ky", "labels_url": "https://api.github.com/repos/sindresorhus/ky/issues/784/labels{/name}", "comments_url": "https://api.github.com/repos/sindresorhus/ky/issues/784/comments", "events_url": "https://api.github.com/repos/sindresorhus/ky/issues/784/events", "html_url": "https://github.com/sindresorhus/ky/issues/784", "id": 3582511807, "node_id": "I_kwDOCMjFuM7ViMq_", "number": 784, "title": "Timeout doesn't behave like documented", "user": {"login": "michal-billtech", "id": 94702944, "node_id": "U_kgDOBaUNYA", "avatar_url": "https://avatars.githubusercontent.com/u/94702944?v=4", "gravatar_id": "", "url": "https://api.github.com/users/michal-billtech", "html_url": "https://github.com/michal-billtech", "followers_url": "https://api.github.com/users/michal-billtech/followers", "following_url": "https://api.github.com/users/michal-billtech/following{/other_user}", "gists_url": "https://api.github.com/users/michal-billtech/gists{/gist_id}", "starred_url": "https://api.github.com/users/michal-billtech/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/michal-billtech/subscriptions", "organizations_url": "https://api.github.com/users/michal-billtech/orgs", "repos_url": "https://api.github.com/users/michal-billtech/repos", "events_url": "https://api.github.com/users/michal-billtech/events{/privacy}", "received_events_url": "https://api.github.com/users/michal-billtech/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 1045483930, "node_id": "MDU6TGFiZWwxMDQ1NDgzOTMw", "url": "https://api.github.com/repos/sindresorhus/ky/labels/bug", "name": "bug", "color": "d73a4a", "default": true, "description": "Something isn't working"}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 3, "created_at": "2025-11-03T15:15:35Z", "updated_at": "2026-02-21T19:26:30Z", "closed_at": "2026-02-21T19:26:30Z", "assignee": null, "author_association": "NONE", "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "```\ntry {\n    await Promise.race([\n        new Promise((resolve, reject) => setTimeout(() => reject(new Error(\"my timeout\")), 2000)),\n        ky(\"https://pie.dev/status/429\", {\n            retry: {\n                limit: 15,\n            },\n            timeout: 1000,\n        }),\n    ]);\n} catch (err: unknown) {\n    console.log(err); // Error: my timeout\n}\n```\n\nThe documentation says: \n> Timeout in milliseconds for getting a response, including any retries. Can not be greater than 2147483647. If set to false, there will be no timeout.\n\nReading this, I expected the code above to throw TimeoutError after 1000 ms, but rather it throws \"my timeout\" after 2000 ms.\n\nWhat was the real intention here?", "closed_by": {"login": "sindresorhus", "id": 170270, "node_id": "MDQ6VXNlcjE3MDI3MA==", "avatar_url": "https://avatars.githubusercontent.com/u/170270?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sindresorhus", "html_url": "https://github.com/sindresorhus", "followers_url": "https://api.github.com/users/sindresorhus/followers", "following_url": "https://api.github.com/users/sindresorhus/following{/other_user}", "gists_url": "https://api.github.com/users/sindresorhus/gists{/gist_id}", "starred_url": "https://api.github.com/users/sindresorhus/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sindresorhus/subscriptions", "organizations_url": "https://api.github.com/users/sindresorhus/orgs", "repos_url": "https://api.github.com/users/sindresorhus/repos", "events_url": "https://api.github.com/users/sindresorhus/events{/privacy}", "received_events_url": "https://api.github.com/users/sindresorhus/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/sindresorhus/ky/issues/784/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/sindresorhus/ky/issues/784/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/sindresorhus/ky/issues/58", "repository_url": "https://api.github.com/repos/sindresorhus/ky", "labels_url": "https://api.github.com/repos/sindresorhus/ky/issues/58/labels{/name}", "comments_url": "https://api.github.com/repos/sindresorhus/ky/issues/58/comments", "events_url": "https://api.github.com/repos/sindresorhus/ky/issues/58/events", "html_url": "https://github.com/sindresorhus/ky/issues/58", "id": 377146532, "node_id": "MDU6SXNzdWUzNzcxNDY1MzI=", "number": 58, "title": "TypeError relative URL after upgrading to 0.5.0", "user": {"login": "peterbe", "id": 26739, "node_id": "MDQ6VXNlcjI2NzM5", "avatar_url": "https://avatars.githubusercontent.com/u/26739?v=4", "gravatar_id": "", "url": "https://api.github.com/users/peterbe", "html_url": "https://github.com/peterbe", "followers_url": "https://api.github.com/users/peterbe/followers", "following_url": "https://api.github.com/users/peterbe/following{/other_user}", "gists_url": "https://api.github.com/users/peterbe/gists{/gist_id}", "starred_url": "https://api.github.com/users/peterbe/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/peterbe/subscriptions", "organizations_url": "https://api.github.com/users/peterbe/orgs", "repos_url": "https://api.github.com/users/peterbe/repos", "events_url": "https://api.github.com/users/peterbe/events{/privacy}", "received_events_url": "https://api.github.com/users/peterbe/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 1045483930, "node_id": "MDU6TGFiZWwxMDQ1NDgzOTMw", "url": "https://api.github.com/repos/sindresorhus/ky/labels/bug", "name": "bug", "color": "d73a4a", "default": true, "description": "Something isn't working"}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 3, "created_at": "2018-11-04T12:13:19Z", "updated_at": "2018-11-06T05:12:52Z", "closed_at": "2018-11-06T05:12:52Z", "assignee": null, "author_association": "NONE", "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "I've got this code:\r\n\r\n```javascript\r\n  fetchHomeCards = async () => {\r\n    this.setState({ loading: true });\r\n    const response = await ky(\"/api/cards/\");\r\n    if (response.ok) {\r\n...\r\n```\r\nit used to work just fine in 0.4.1, but busted now. \r\n\r\nIn Firefox I get `TypeError: /api/cards/ is not a valid URL.` on this line:\r\n```javascript\r\nvar url = new _globalThis.URL(this._options.prefixUrl + this._input);\r\n```\r\n\r\nIn Chrome I get a lot more helpful error:\r\n```\r\nindex.js:181 Uncaught (in promise) TypeError: Failed to construct 'URL': Invalid URL\r\n    at new Ky (index.js:181)\r\n    at ky (index.js:518)\r\n    at CardsContainer._callee$ (State.js:15)\r\n    at tryCatch (runtime.js:62)\r\n    at Generator.invoke [as _invoke] (runtime.js:288)\r\n    at Generator.prototype.(:3000/anonymous function) [as next] (http://localhost:3000/static/js/1.chunk.js:941:21)\r\n    at asyncGeneratorStep (asyncToGenerator.js:3)\r\n    at _next (asyncToGenerator.js:25)\r\n    at asyncToGenerator.js:32\r\n    at new Promise (<anonymous>)\r\n    at CardsContainer.fetchHomeCards (asyncToGenerator.js:21)\r\n    at Home._callee$ (Home.js:9)\r\n    at tryCatch (runtime.js:62)\r\n    at Generator.invoke [as _invoke] (runtime.js:288)\r\n    at Generator.prototype.(:3000/anonymous function) [as next] (http://localhost:3000/static/js/1.chunk.js:941:21)\r\n    at asyncGeneratorStep (asyncToGenerator.js:3)\r\n    at _next (asyncToGenerator.js:25)\r\n    at asyncToGenerator.js:32\r\n    at new Promise (<anonymous>)\r\n    at Home.<anonymous> (asyncToGenerator.js:21)\r\n    at Home.componentDidMount (Home.js:12)\r\n    at commitLifeCycles (react-dom.development.js:15986)\r\n    at commitAllLifeCycles (react-dom.development.js:17388)\r\n    at HTMLUnknownElement.callCallback (react-dom.development.js:147)\r\n    at Object.invokeGuardedCallbackDev (react-dom.development.js:196)\r\n    at invokeGuardedCallback (react-dom.development.js:250)\r\n    at commitRoot (react-dom.development.js:17549)\r\n    at completeRoot (react-dom.development.js:19002)\r\n    at performWorkOnRoot (react-dom.development.js:18924)\r\n    at performWork (react-dom.development.js:18826)\r\n    at performSyncWork (react-dom.development.js:18799)\r\n    at requestWork (react-dom.development.js:18676)\r\n    at scheduleWork (react-dom.development.js:18480)\r\n    at scheduleRootUpdate (react-dom.development.js:19186)\r\n    at updateContainerAtExpirationTime (react-dom.development.js:19212)\r\n    at updateContainer (react-dom.development.js:19280)\r\n    at ReactRoot.push../node_modules/react-dom/cjs/react-dom.development.js.ReactRoot.render (react-dom.development.js:19559)\r\n    at react-dom.development.js:19713\r\n    at unbatchedUpdates (react-dom.development.js:19064)\r\n    at legacyRenderSubtreeIntoContainer (react-dom.development.js:19709)\r\n    at Object.render (react-dom.development.js:19776)\r\n    at Module../src/index.js (index.js:8)\r\n    at __webpack_require__ (bootstrap:782)\r\n    at fn (bootstrap:150)\r\n    at Object.0 (serviceWorker.js:131)\r\n    at __webpack_require__ (bootstrap:782)\r\n    at checkDeferredModules (bootstrap:45)\r\n    at Array.webpackJsonpCallback [as push] (bootstrap:32)\r\n    at main.chunk.js:1\r\n```", "closed_by": {"login": "sindresorhus", "id": 170270, "node_id": "MDQ6VXNlcjE3MDI3MA==", "avatar_url": "https://avatars.githubusercontent.com/u/170270?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sindresorhus", "html_url": "https://github.com/sindresorhus", "followers_url": "https://api.github.com/users/sindresorhus/followers", "following_url": "https://api.github.com/users/sindresorhus/following{/other_user}", "gists_url": "https://api.github.com/users/sindresorhus/gists{/gist_id}", "starred_url": "https://api.github.com/users/sindresorhus/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sindresorhus/subscriptions", "organizations_url": "https://api.github.com/users/sindresorhus/orgs", "repos_url": "https://api.github.com/users/sindresorhus/repos", "events_url": "https://api.github.com/users/sindresorhus/events{/privacy}", "received_events_url": "https://api.github.com/users/sindresorhus/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/sindresorhus/ky/issues/58/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/sindresorhus/ky/issues/58/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}]}