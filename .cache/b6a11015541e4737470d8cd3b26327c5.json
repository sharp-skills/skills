{"d": [{"url": "https://api.github.com/repos/chroma-core/chroma/issues/640", "repository_url": "https://api.github.com/repos/chroma-core/chroma", "labels_url": "https://api.github.com/repos/chroma-core/chroma/issues/640/labels{/name}", "comments_url": "https://api.github.com/repos/chroma-core/chroma/issues/640/comments", "events_url": "https://api.github.com/repos/chroma-core/chroma/issues/640/events", "html_url": "https://github.com/chroma-core/chroma/issues/640", "id": 1732695123, "node_id": "I_kwDOII5zmM5nRtRT", "number": 640, "title": "[Bug]: querying a persisted index returns an empty array", "user": {"login": "dankolesnikov", "id": 10562358, "node_id": "MDQ6VXNlcjEwNTYyMzU4", "avatar_url": "https://avatars.githubusercontent.com/u/10562358?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dankolesnikov", "html_url": "https://github.com/dankolesnikov", "followers_url": "https://api.github.com/users/dankolesnikov/followers", "following_url": "https://api.github.com/users/dankolesnikov/following{/other_user}", "gists_url": "https://api.github.com/users/dankolesnikov/gists{/gist_id}", "starred_url": "https://api.github.com/users/dankolesnikov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dankolesnikov/subscriptions", "organizations_url": "https://api.github.com/users/dankolesnikov/orgs", "repos_url": "https://api.github.com/users/dankolesnikov/repos", "events_url": "https://api.github.com/users/dankolesnikov/events{/privacy}", "received_events_url": "https://api.github.com/users/dankolesnikov/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 4620187878, "node_id": "LA_kwDOII5zmM8AAAABE2J45g", "url": "https://api.github.com/repos/chroma-core/chroma/labels/bug", "name": "bug", "color": "E99695", "default": true, "description": "Something isn't working"}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 30, "created_at": "2023-05-30T17:38:53Z", "updated_at": "2024-06-12T01:57:53Z", "closed_at": "2023-09-05T23:21:53Z", "assignee": null, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### What happened?\n\nThe following example uses langchain to successfully load documents into chroma and to successfully persist the data. Querying works as expected. \r\n\r\nHowever, when we restart the notebook and attempt to query again without ingesting data and instead reading the persisted directory, we get [] when querying both using the langchain wrapper's method and chromadb's client (accessed from langchain wrapper). I've concluded that there is either a deep bug in chromadb or I am doing something wrong. Please help! \r\n\r\n### Code to reproduce\r\nIn the notebook paste: \r\n\r\n```\r\nfrom langchain.embeddings.openai import OpenAIEmbeddings\r\nfrom langchain.vectorstores import Chroma\r\nimport json\r\n\r\nassembly_ai_output_file = \"data_auto_chapters.json\"\r\n\r\n# Read the JSON file\r\nwith open(assembly_ai_output_file, \"r\") as json_file:\r\n    json_data = json.load(json_file)\r\n\r\nutterances = json_data['utterances']\r\ndata = list(map(lambda x: {key: value for key, value in x.items() if key != \"words\"}, utterances))\r\ntranscription_id = json_data['id']\r\ndocs = list(map(lambda x: Document(page_content=x['text'], \r\n                                   metadata={\"transcription_id\": transcription_id,\"confidence\": x['confidence'], \"start\": x['start'], \"end\": x['end'], \"speaker\": x['speaker']}),\r\n                            utterances))\r\n\r\nembedding = OpenAIEmbeddings()\r\n\r\npersist_directory = 'db'\r\nvectordb = Chroma.from_documents(documents=docs, embedding=embedding, persist_directory=persist_directory, collection_name=\"condense_demo\")\r\nvectordb.persist()\r\n\r\nquery = \"what does the speaker say about raytheon?\"\r\n\r\nretrieved_docs = vectordb.similarity_search(query) # filter={\"speaker\": \"B\"}\r\nretrieved_docs # data comes back\r\n```\r\n\r\nNow lets restart the notebook, and run the following code which I believe should work.\r\n\r\n```\r\nfrom langchain.embeddings.openai import OpenAIEmbeddings\r\nfrom langchain.vectorstores import Chroma\r\nembedding = OpenAIEmbeddings()\r\n\r\nvectordb = Chroma(persist_directory=\"db\", embedding_function=embedding, collection_name=\"condense_demo\")\r\nquery = \"what does the speaker say about raytheon?\"\r\n\r\nretrieved_docs = vectordb.similarity_search(query) # filter={\"speaker\": \"B\"}\r\nretrieved_docs # returns []\r\n```\r\nTo make sure its not langchain issue, lets get the chroma client from the Chroma class and query the data at a lower level.\r\n```\r\nvectordb._client.list_collections() # looks good\r\nvectordb._client.get_collection(\"condense_demo\").peek() # yes there is data there!\r\nquery_vector = embedding.embed_query(query) # use langchain implementation of openai embedding algorithm\r\nvectordb._client.get_collection(\"condense_demo\").query(query_texts=[query], n_results=4) \r\n# returns {'ids': [[]],\r\n# 'embeddings': None,\r\n# 'documents': [[]],\r\n# 'metadatas': [[]],\r\n# 'distances': [[]]}\r\n```\r\n\r\nAm I doing something wrong? \r\nI am attaching the JSON that is fed into the data as a zip file because GitHub doesn't allow json to make it easier to reproduce but i believe you can reproduce using any document (my assumption).\r\n\r\n[data_auto_chapters.json.zip](https://github.com/chroma-core/chroma/files/11602843/data_auto_chapters.json.zip)\r\n\n\n### Versions\n\nPython 3.8.8\r\nlangchain 0.0.184\r\nchroma 0.3.25\n\n### Relevant log output\n\n_No response_", "closed_by": {"login": "jeffchuber", "id": 891664, "node_id": "MDQ6VXNlcjg5MTY2NA==", "avatar_url": "https://avatars.githubusercontent.com/u/891664?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jeffchuber", "html_url": "https://github.com/jeffchuber", "followers_url": "https://api.github.com/users/jeffchuber/followers", "following_url": "https://api.github.com/users/jeffchuber/following{/other_user}", "gists_url": "https://api.github.com/users/jeffchuber/gists{/gist_id}", "starred_url": "https://api.github.com/users/jeffchuber/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jeffchuber/subscriptions", "organizations_url": "https://api.github.com/users/jeffchuber/orgs", "repos_url": "https://api.github.com/users/jeffchuber/repos", "events_url": "https://api.github.com/users/jeffchuber/events{/privacy}", "received_events_url": "https://api.github.com/users/jeffchuber/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/chroma-core/chroma/issues/640/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/chroma-core/chroma/issues/640/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/chroma-core/chroma/issues/4217", "repository_url": "https://api.github.com/repos/chroma-core/chroma", "labels_url": "https://api.github.com/repos/chroma-core/chroma/issues/4217/labels{/name}", "comments_url": "https://api.github.com/repos/chroma-core/chroma/issues/4217/comments", "events_url": "https://api.github.com/repos/chroma-core/chroma/issues/4217/events", "html_url": "https://github.com/chroma-core/chroma/issues/4217", "id": 2979508830, "node_id": "I_kwDOII5zmM6xl7Je", "number": 4217, "title": "[Bug]: Using v1.0.3 client/server with a database created by v0.6.3 client/server causes `chromadb.errors.InternalError`", "user": {"login": "Davidyz", "id": 30951234, "node_id": "MDQ6VXNlcjMwOTUxMjM0", "avatar_url": "https://avatars.githubusercontent.com/u/30951234?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Davidyz", "html_url": "https://github.com/Davidyz", "followers_url": "https://api.github.com/users/Davidyz/followers", "following_url": "https://api.github.com/users/Davidyz/following{/other_user}", "gists_url": "https://api.github.com/users/Davidyz/gists{/gist_id}", "starred_url": "https://api.github.com/users/Davidyz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Davidyz/subscriptions", "organizations_url": "https://api.github.com/users/Davidyz/orgs", "repos_url": "https://api.github.com/users/Davidyz/repos", "events_url": "https://api.github.com/users/Davidyz/events{/privacy}", "received_events_url": "https://api.github.com/users/Davidyz/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 4620187878, "node_id": "LA_kwDOII5zmM8AAAABE2J45g", "url": "https://api.github.com/repos/chroma-core/chroma/labels/bug", "name": "bug", "color": "E99695", "default": true, "description": "Something isn't working"}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 27, "created_at": "2025-04-08T11:35:26Z", "updated_at": "2025-07-03T04:32:07Z", "closed_at": "2025-06-30T21:39:51Z", "assignee": null, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### What happened?\n\nA `collection.get()` call using v1.0.3 client and v1.0.3 server on a collection created by v0.6.3 chromadb produced a `chromadb.errors.InternalError: Error executing plan: Error sending backfill request to compactor`.\n\nThis is the relevant code snippet:\n```python\nawait collection.get(\n    where={\"path\": full_path_str},\n    include=[\"metadatas\"],\n)\n```\n\nAside from this error, I'm wondering whether a database created by 0.x.x chromadb is supposed to \"just work\"? Also, what's the expected outcome if a user has a mismatched chromadb client and server? I'm experiencing errors, and at the same time, I couldn't find many useful guides on what to expect over the upgrade (from 0.x.x to 1.x.x). The Discord channel (migrations) hasn't been updated for a few months. I'm a bit lost at this point because I don't know what to expect when [trying to bump the chromadb version for my project](https://github.com/davidyz/vectorcode).\n\n### Versions\n\nCollection created by chromadb v0.6.3 and accessed by chromadb v1.0.3, on python 3.13, arch Linux\n\n### Relevant log output\n\n```shell\nTraceback (most recent call last):\n  File \"/home/davidyz/git/VectorCode/src/vectorcode/main.py\", line 85, in async_main\n    return_val = await vectorise(final_configs)\n                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/davidyz/git/VectorCode/src/vectorcode/subcommands/vectorise.py\", line 192, in vectorise\n    await task\n  File \"/usr/lib/python3.13/asyncio/tasks.py\", line 634, in _wait_for_one\n    return f.result() if resolve else f\n           ~~~~~~~~^^\n  File \"/home/davidyz/git/VectorCode/src/vectorcode/subcommands/vectorise.py\", line 43, in chunked_add\n    await collection.get(\n    ...<2 lines>...\n    )\n  File \"/home/davidyz/git/VectorCode/.venv/lib/python3.13/site-packages/chromadb/api/models/AsyncCollection.py\", line 127, in get\n    get_results = await self._client._get(\n                  ^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<10 lines>...\n    )\n    ^\n  File \"/home/davidyz/git/VectorCode/.venv/lib/python3.13/site-packages/chromadb/telemetry/opentelemetry/__init__.py\", line 134, in async_wrapper\n    return await f(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/davidyz/git/VectorCode/.venv/lib/python3.13/site-packages/chromadb/api/async_fastapi.py\", line 471, in _get\n    resp_json = await self._make_request(\n                ^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<11 lines>...\n    )\n    ^\n  File \"/home/davidyz/git/VectorCode/.venv/lib/python3.13/site-packages/chromadb/api/async_fastapi.py\", line 149, in _make_request\n    BaseHTTPClient._raise_chroma_error(response)\n    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^\n  File \"/home/davidyz/git/VectorCode/.venv/lib/python3.13/site-packages/chromadb/api/base_http_client.py\", line 96, in _raise_chroma_error\n    raise chroma_error\nchromadb.errors.InternalError: Error executing plan: Error sending backfill request to compactor\n```", "closed_by": {"login": "jairad26", "id": 55522316, "node_id": "MDQ6VXNlcjU1NTIyMzE2", "avatar_url": "https://avatars.githubusercontent.com/u/55522316?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jairad26", "html_url": "https://github.com/jairad26", "followers_url": "https://api.github.com/users/jairad26/followers", "following_url": "https://api.github.com/users/jairad26/following{/other_user}", "gists_url": "https://api.github.com/users/jairad26/gists{/gist_id}", "starred_url": "https://api.github.com/users/jairad26/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jairad26/subscriptions", "organizations_url": "https://api.github.com/users/jairad26/orgs", "repos_url": "https://api.github.com/users/jairad26/repos", "events_url": "https://api.github.com/users/jairad26/events{/privacy}", "received_events_url": "https://api.github.com/users/jairad26/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/chroma-core/chroma/issues/4217/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/chroma-core/chroma/issues/4217/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/chroma-core/chroma/issues/1379", "repository_url": "https://api.github.com/repos/chroma-core/chroma", "labels_url": "https://api.github.com/repos/chroma-core/chroma/issues/1379/labels{/name}", "comments_url": "https://api.github.com/repos/chroma-core/chroma/issues/1379/comments", "events_url": "https://api.github.com/repos/chroma-core/chroma/issues/1379/events", "html_url": "https://github.com/chroma-core/chroma/issues/1379", "id": 1987591009, "node_id": "I_kwDOII5zmM52eDth", "number": 1379, "title": "[Bug]: OSError: [Errno 24] Too many open files: ", "user": {"login": "meteor260", "id": 680977, "node_id": "MDQ6VXNlcjY4MDk3Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/680977?v=4", "gravatar_id": "", "url": "https://api.github.com/users/meteor260", "html_url": "https://github.com/meteor260", "followers_url": "https://api.github.com/users/meteor260/followers", "following_url": "https://api.github.com/users/meteor260/following{/other_user}", "gists_url": "https://api.github.com/users/meteor260/gists{/gist_id}", "starred_url": "https://api.github.com/users/meteor260/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/meteor260/subscriptions", "organizations_url": "https://api.github.com/users/meteor260/orgs", "repos_url": "https://api.github.com/users/meteor260/repos", "events_url": "https://api.github.com/users/meteor260/events{/privacy}", "received_events_url": "https://api.github.com/users/meteor260/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 4620187878, "node_id": "LA_kwDOII5zmM8AAAABE2J45g", "url": "https://api.github.com/repos/chroma-core/chroma/labels/bug", "name": "bug", "color": "E99695", "default": true, "description": "Something isn't working"}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 27, "created_at": "2023-11-10T13:04:31Z", "updated_at": "2025-07-08T00:58:58Z", "closed_at": "2024-07-26T11:32:47Z", "assignee": null, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### What happened?\n\nI use Django and host it as a service.\r\nAfter a long time, the following issue happened\r\nOSError: [Errno 24] Too many open files: \r\n\r\nIs there some close() function that should be called after a query or a collection is established?\n\n### Versions\n\nchroma-hnswlib==0.7.3\r\nchromadb==0.4.15\r\n\r\nPython: 3.11.4\n\n### Relevant log output\n\n_No response_", "closed_by": {"login": "tazarov", "id": 1157440, "node_id": "MDQ6VXNlcjExNTc0NDA=", "avatar_url": "https://avatars.githubusercontent.com/u/1157440?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tazarov", "html_url": "https://github.com/tazarov", "followers_url": "https://api.github.com/users/tazarov/followers", "following_url": "https://api.github.com/users/tazarov/following{/other_user}", "gists_url": "https://api.github.com/users/tazarov/gists{/gist_id}", "starred_url": "https://api.github.com/users/tazarov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tazarov/subscriptions", "organizations_url": "https://api.github.com/users/tazarov/orgs", "repos_url": "https://api.github.com/users/tazarov/repos", "events_url": "https://api.github.com/users/tazarov/events{/privacy}", "received_events_url": "https://api.github.com/users/tazarov/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/chroma-core/chroma/issues/1379/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/chroma-core/chroma/issues/1379/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/chroma-core/chroma/issues/506", "repository_url": "https://api.github.com/repos/chroma-core/chroma", "labels_url": "https://api.github.com/repos/chroma-core/chroma/issues/506/labels{/name}", "comments_url": "https://api.github.com/repos/chroma-core/chroma/issues/506/comments", "events_url": "https://api.github.com/repos/chroma-core/chroma/issues/506/events", "html_url": "https://github.com/chroma-core/chroma/issues/506", "id": 1703196947, "node_id": "I_kwDOII5zmM5lhLkT", "number": 506, "title": "[Bug]:  Illegal instruction (core dumped)", "user": {"login": "Moneshs", "id": 58931303, "node_id": "MDQ6VXNlcjU4OTMxMzAz", "avatar_url": "https://avatars.githubusercontent.com/u/58931303?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Moneshs", "html_url": "https://github.com/Moneshs", "followers_url": "https://api.github.com/users/Moneshs/followers", "following_url": "https://api.github.com/users/Moneshs/following{/other_user}", "gists_url": "https://api.github.com/users/Moneshs/gists{/gist_id}", "starred_url": "https://api.github.com/users/Moneshs/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Moneshs/subscriptions", "organizations_url": "https://api.github.com/users/Moneshs/orgs", "repos_url": "https://api.github.com/users/Moneshs/repos", "events_url": "https://api.github.com/users/Moneshs/events{/privacy}", "received_events_url": "https://api.github.com/users/Moneshs/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 4620187878, "node_id": "LA_kwDOII5zmM8AAAABE2J45g", "url": "https://api.github.com/repos/chroma-core/chroma/labels/bug", "name": "bug", "color": "E99695", "default": true, "description": "Something isn't working"}, {"id": 5928863211, "node_id": "LA_kwDOII5zmM8AAAABYWNF6w", "url": "https://api.github.com/repos/chroma-core/chroma/labels/prioritized-bug", "name": "prioritized-bug", "color": "8E2AAE", "default": false, "description": ""}], "state": "closed", "locked": false, "assignees": [{"login": "tazarov", "id": 1157440, "node_id": "MDQ6VXNlcjExNTc0NDA=", "avatar_url": "https://avatars.githubusercontent.com/u/1157440?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tazarov", "html_url": "https://github.com/tazarov", "followers_url": "https://api.github.com/users/tazarov/followers", "following_url": "https://api.github.com/users/tazarov/following{/other_user}", "gists_url": "https://api.github.com/users/tazarov/gists{/gist_id}", "starred_url": "https://api.github.com/users/tazarov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tazarov/subscriptions", "organizations_url": "https://api.github.com/users/tazarov/orgs", "repos_url": "https://api.github.com/users/tazarov/repos", "events_url": "https://api.github.com/users/tazarov/events{/privacy}", "received_events_url": "https://api.github.com/users/tazarov/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, {"login": "HammadB", "id": 5598697, "node_id": "MDQ6VXNlcjU1OTg2OTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5598697?v=4", "gravatar_id": "", "url": "https://api.github.com/users/HammadB", "html_url": "https://github.com/HammadB", "followers_url": "https://api.github.com/users/HammadB/followers", "following_url": "https://api.github.com/users/HammadB/following{/other_user}", "gists_url": "https://api.github.com/users/HammadB/gists{/gist_id}", "starred_url": "https://api.github.com/users/HammadB/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/HammadB/subscriptions", "organizations_url": "https://api.github.com/users/HammadB/orgs", "repos_url": "https://api.github.com/users/HammadB/repos", "events_url": "https://api.github.com/users/HammadB/events{/privacy}", "received_events_url": "https://api.github.com/users/HammadB/received_events", "type": "User", "user_view_type": "public", "site_admin": false}], "milestone": null, "comments": 27, "created_at": "2023-05-10T06:12:43Z", "updated_at": "2023-11-16T06:01:45Z", "closed_at": "2023-11-16T06:01:45Z", "assignee": {"login": "HammadB", "id": 5598697, "node_id": "MDQ6VXNlcjU1OTg2OTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5598697?v=4", "gravatar_id": "", "url": "https://api.github.com/users/HammadB", "html_url": "https://github.com/HammadB", "followers_url": "https://api.github.com/users/HammadB/followers", "following_url": "https://api.github.com/users/HammadB/following{/other_user}", "gists_url": "https://api.github.com/users/HammadB/gists{/gist_id}", "starred_url": "https://api.github.com/users/HammadB/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/HammadB/subscriptions", "organizations_url": "https://api.github.com/users/HammadB/orgs", "repos_url": "https://api.github.com/users/HammadB/repos", "events_url": "https://api.github.com/users/HammadB/events{/privacy}", "received_events_url": "https://api.github.com/users/HammadB/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### What happened?\n\nWe are running the EKS Kubernetes and Worker nodes OS is Bottlerocket and we are using the chromdb package in python3 \r\n\r\n\r\nembeddings = OpenAIEmbeddings(openai_api_key=os.environ['OPENAI_API_KEY'])\r\ncdb = Chroma.from_texts(\r\n  texts = [\"hello \", \"how to type\"],\r\n  embedding = embeddings,\r\n  persist_directory = 'chroma_db'\r\n)\r\n\r\nwe we run this code it always throws error   Illegal instruction (core dumped)\r\n\r\n\r\nBut we tried in normal ec2 instance and docker its working fine. But it fails in kubernetes pods which is running on the Bottle rocket os and Containerd runtime versions\n\n### Versions\n\nchroma-3.1.21 Python 3.11.3 \n\n### Relevant log output\n\n```shell\n>>> embeddings = OpenAIEmbeddings(openai_api_key=os.environ['OPENAI_API_KEY'])\r\n>>> cdb = Chroma.from_texts(\r\n...   texts = [\"hello \", \"how to type\"],\r\n...   embedding = embeddings,\r\n...   persist_directory = 'chroma_db'\r\n... )\r\nIllegal instruction (core dumped)\n```\n", "closed_by": {"login": "HammadB", "id": 5598697, "node_id": "MDQ6VXNlcjU1OTg2OTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5598697?v=4", "gravatar_id": "", "url": "https://api.github.com/users/HammadB", "html_url": "https://github.com/HammadB", "followers_url": "https://api.github.com/users/HammadB/followers", "following_url": "https://api.github.com/users/HammadB/following{/other_user}", "gists_url": "https://api.github.com/users/HammadB/gists{/gist_id}", "starred_url": "https://api.github.com/users/HammadB/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/HammadB/subscriptions", "organizations_url": "https://api.github.com/users/HammadB/orgs", "repos_url": "https://api.github.com/users/HammadB/repos", "events_url": "https://api.github.com/users/HammadB/events{/privacy}", "received_events_url": "https://api.github.com/users/HammadB/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/chroma-core/chroma/issues/506/reactions", "total_count": 2, "+1": 2, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/chroma-core/chroma/issues/506/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/chroma-core/chroma/issues/872", "repository_url": "https://api.github.com/repos/chroma-core/chroma", "labels_url": "https://api.github.com/repos/chroma-core/chroma/issues/872/labels{/name}", "comments_url": "https://api.github.com/repos/chroma-core/chroma/issues/872/comments", "events_url": "https://api.github.com/repos/chroma-core/chroma/issues/872/events", "html_url": "https://github.com/chroma-core/chroma/issues/872", "id": 1819477098, "node_id": "I_kwDOII5zmM5scwRq", "number": 872, "title": "[Bug]: collection.query RuntimeError: Cannot open header file", "user": {"login": "huanggefan", "id": 20538664, "node_id": "MDQ6VXNlcjIwNTM4NjY0", "avatar_url": "https://avatars.githubusercontent.com/u/20538664?v=4", "gravatar_id": "", "url": "https://api.github.com/users/huanggefan", "html_url": "https://github.com/huanggefan", "followers_url": "https://api.github.com/users/huanggefan/followers", "following_url": "https://api.github.com/users/huanggefan/following{/other_user}", "gists_url": "https://api.github.com/users/huanggefan/gists{/gist_id}", "starred_url": "https://api.github.com/users/huanggefan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/huanggefan/subscriptions", "organizations_url": "https://api.github.com/users/huanggefan/orgs", "repos_url": "https://api.github.com/users/huanggefan/repos", "events_url": "https://api.github.com/users/huanggefan/events{/privacy}", "received_events_url": "https://api.github.com/users/huanggefan/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 4620187878, "node_id": "LA_kwDOII5zmM8AAAABE2J45g", "url": "https://api.github.com/repos/chroma-core/chroma/labels/bug", "name": "bug", "color": "E99695", "default": true, "description": "Something isn't working"}], "state": "closed", "locked": false, "assignees": [{"login": "HammadB", "id": 5598697, "node_id": "MDQ6VXNlcjU1OTg2OTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5598697?v=4", "gravatar_id": "", "url": "https://api.github.com/users/HammadB", "html_url": "https://github.com/HammadB", "followers_url": "https://api.github.com/users/HammadB/followers", "following_url": "https://api.github.com/users/HammadB/following{/other_user}", "gists_url": "https://api.github.com/users/HammadB/gists{/gist_id}", "starred_url": "https://api.github.com/users/HammadB/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/HammadB/subscriptions", "organizations_url": "https://api.github.com/users/HammadB/orgs", "repos_url": "https://api.github.com/users/HammadB/repos", "events_url": "https://api.github.com/users/HammadB/events{/privacy}", "received_events_url": "https://api.github.com/users/HammadB/received_events", "type": "User", "user_view_type": "public", "site_admin": false}], "milestone": null, "comments": 26, "created_at": "2023-07-25T03:13:02Z", "updated_at": "2024-12-30T05:11:38Z", "closed_at": "2024-12-30T05:11:38Z", "assignee": {"login": "HammadB", "id": 5598697, "node_id": "MDQ6VXNlcjU1OTg2OTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5598697?v=4", "gravatar_id": "", "url": "https://api.github.com/users/HammadB", "html_url": "https://github.com/HammadB", "followers_url": "https://api.github.com/users/HammadB/followers", "following_url": "https://api.github.com/users/HammadB/following{/other_user}", "gists_url": "https://api.github.com/users/HammadB/gists{/gist_id}", "starred_url": "https://api.github.com/users/HammadB/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/HammadB/subscriptions", "organizations_url": "https://api.github.com/users/HammadB/orgs", "repos_url": "https://api.github.com/users/HammadB/repos", "events_url": "https://api.github.com/users/HammadB/events{/privacy}", "received_events_url": "https://api.github.com/users/HammadB/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### What happened?\n\n## 1. init data\r\n\r\n1. `chroma_client = chromadb.PersistentClient(path=str(collection_dir))`\r\n2. `chroma_collection = chroma_client.get_or_create_collection(name=collection_name)`\r\n3. add some data `chroma_collection.upsert(ids=[id], embeddings=[embedding], documents=[document], metadatas=[metadata])`\r\n4. **stop this program**\r\n\r\n## 2. query and RuntimeError except\r\n\r\n1. `collection.query(query_embeddings=query_embeddings, n_results=100)`\r\n\r\n## 3. remove index_metadata.pickle\r\n\r\n1. `rm 64597cda-24ba-4d7a-8fc4-b96f1fc098d9/index_metadata.pickle`\r\n\r\n## 4. query and no RuntimeError except\r\n\r\n## 5. restart program and  query and RuntimeError except\r\n\r\n## 6. remove index_metadata.pickle and restart program and  query and RuntimeError no except\r\n\r\nso, when **index_metadata.pickle** exists, will except RuntimeError\n\n### Versions\n\nchromadb 0.4.2\r\npython 3.11.4\r\nwindows 11\n\n### Relevant log output\n\n```shell\nCall function: query_result = collection.query(query_embeddings=query_embeddings, n_results=100)\r\n\r\n\r\n\r\nFile \"python-env\\Lib\\site-packages\\chromadb\\api\\models\\Collection.py\", line 223, in query\r\n    return self._client._query(\r\n           ^^^^^^^^^^^^^^^^^^^^\r\n  File \"python-env\\Lib\\site-packages\\chromadb\\api\\segment.py\", line 433, in _query\r\n    vector_reader = self._manager.get_segment(collection_id, VectorReader)\r\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n  File \"python-env\\Lib\\site-packages\\chromadb\\segment\\impl\\manager\\local.py\", line 112, in get_segment\r\n    instance = self._instance(self._segment_cache[collection_id][scope])\r\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n  File \"python-env\\Lib\\site-packages\\chromadb\\segment\\impl\\manager\\local.py\", line 131, in _instance\r\n    instance = cls(self._system, segment)\r\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n  File \"python-env\\Lib\\site-packages\\chromadb\\segment\\impl\\vector\\local_persistent_hnsw.py\", line 107, in __init__\r\n    self._init_index(self._dimensionality)\r\n  File \"python-env\\Lib\\site-packages\\chromadb\\segment\\impl\\vector\\local_persistent_hnsw.py\", line 149, in _init_index\r\n    index.load_index(\r\nRuntimeError: Cannot open header file\n```\n", "closed_by": {"login": "itaismith", "id": 42597089, "node_id": "MDQ6VXNlcjQyNTk3MDg5", "avatar_url": "https://avatars.githubusercontent.com/u/42597089?v=4", "gravatar_id": "", "url": "https://api.github.com/users/itaismith", "html_url": "https://github.com/itaismith", "followers_url": "https://api.github.com/users/itaismith/followers", "following_url": "https://api.github.com/users/itaismith/following{/other_user}", "gists_url": "https://api.github.com/users/itaismith/gists{/gist_id}", "starred_url": "https://api.github.com/users/itaismith/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/itaismith/subscriptions", "organizations_url": "https://api.github.com/users/itaismith/orgs", "repos_url": "https://api.github.com/users/itaismith/repos", "events_url": "https://api.github.com/users/itaismith/events{/privacy}", "received_events_url": "https://api.github.com/users/itaismith/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/chroma-core/chroma/issues/872/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/chroma-core/chroma/issues/872/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/chroma-core/chroma/issues/2274", "repository_url": "https://api.github.com/repos/chroma-core/chroma", "labels_url": "https://api.github.com/repos/chroma-core/chroma/issues/2274/labels{/name}", "comments_url": "https://api.github.com/repos/chroma-core/chroma/issues/2274/comments", "events_url": "https://api.github.com/repos/chroma-core/chroma/issues/2274/events", "html_url": "https://github.com/chroma-core/chroma/issues/2274", "id": 2329823778, "node_id": "I_kwDOII5zmM6K3koi", "number": 2274, "title": "[Bug]: Server token auth does not seem to work - still allows non authenticated queries", "user": {"login": "gfox2049", "id": 129688715, "node_id": "U_kgDOB7rkiw", "avatar_url": "https://avatars.githubusercontent.com/u/129688715?v=4", "gravatar_id": "", "url": "https://api.github.com/users/gfox2049", "html_url": "https://github.com/gfox2049", "followers_url": "https://api.github.com/users/gfox2049/followers", "following_url": "https://api.github.com/users/gfox2049/following{/other_user}", "gists_url": "https://api.github.com/users/gfox2049/gists{/gist_id}", "starred_url": "https://api.github.com/users/gfox2049/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/gfox2049/subscriptions", "organizations_url": "https://api.github.com/users/gfox2049/orgs", "repos_url": "https://api.github.com/users/gfox2049/repos", "events_url": "https://api.github.com/users/gfox2049/events{/privacy}", "received_events_url": "https://api.github.com/users/gfox2049/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 4620187878, "node_id": "LA_kwDOII5zmM8AAAABE2J45g", "url": "https://api.github.com/repos/chroma-core/chroma/labels/bug", "name": "bug", "color": "E99695", "default": true, "description": "Something isn't working"}, {"id": 7078346231, "node_id": "LA_kwDOII5zmM8AAAABpeb99w", "url": "https://api.github.com/repos/chroma-core/chroma/labels/deployment", "name": "deployment", "color": "676A31", "default": false, "description": ""}], "state": "closed", "locked": false, "assignees": [{"login": "tazarov", "id": 1157440, "node_id": "MDQ6VXNlcjExNTc0NDA=", "avatar_url": "https://avatars.githubusercontent.com/u/1157440?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tazarov", "html_url": "https://github.com/tazarov", "followers_url": "https://api.github.com/users/tazarov/followers", "following_url": "https://api.github.com/users/tazarov/following{/other_user}", "gists_url": "https://api.github.com/users/tazarov/gists{/gist_id}", "starred_url": "https://api.github.com/users/tazarov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tazarov/subscriptions", "organizations_url": "https://api.github.com/users/tazarov/orgs", "repos_url": "https://api.github.com/users/tazarov/repos", "events_url": "https://api.github.com/users/tazarov/events{/privacy}", "received_events_url": "https://api.github.com/users/tazarov/received_events", "type": "User", "user_view_type": "public", "site_admin": false}], "milestone": null, "comments": 23, "created_at": "2024-06-02T19:16:36Z", "updated_at": "2025-01-02T21:49:39Z", "closed_at": "2025-01-02T21:49:39Z", "assignee": {"login": "tazarov", "id": 1157440, "node_id": "MDQ6VXNlcjExNTc0NDA=", "avatar_url": "https://avatars.githubusercontent.com/u/1157440?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tazarov", "html_url": "https://github.com/tazarov", "followers_url": "https://api.github.com/users/tazarov/followers", "following_url": "https://api.github.com/users/tazarov/following{/other_user}", "gists_url": "https://api.github.com/users/tazarov/gists{/gist_id}", "starred_url": "https://api.github.com/users/tazarov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tazarov/subscriptions", "organizations_url": "https://api.github.com/users/tazarov/orgs", "repos_url": "https://api.github.com/users/tazarov/repos", "events_url": "https://api.github.com/users/tazarov/events{/privacy}", "received_events_url": "https://api.github.com/users/tazarov/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### What happened?\n\nUsing token auth, rebuilt server with docker-compose with token auth settings hard coded into yml file.\r\n\r\nDoes not seem to work - still allowing client connections without token auth settings. \r\n\r\nHow to prevent allowing non-authenticated connections?\n\n### Versions\n\nPython 3.11.4, AWS Linux (used the version from chromadb cloud formation setup.)\r\n\r\nhttps://docs.trychroma.com/deployment/aws\n\n### Relevant log output\n\n```shell\nNA - works to query but it should not - seems it allows bypass of token auth even though that is hard coded into *yml\n```\n", "closed_by": {"login": "itaismith", "id": 42597089, "node_id": "MDQ6VXNlcjQyNTk3MDg5", "avatar_url": "https://avatars.githubusercontent.com/u/42597089?v=4", "gravatar_id": "", "url": "https://api.github.com/users/itaismith", "html_url": "https://github.com/itaismith", "followers_url": "https://api.github.com/users/itaismith/followers", "following_url": "https://api.github.com/users/itaismith/following{/other_user}", "gists_url": "https://api.github.com/users/itaismith/gists{/gist_id}", "starred_url": "https://api.github.com/users/itaismith/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/itaismith/subscriptions", "organizations_url": "https://api.github.com/users/itaismith/orgs", "repos_url": "https://api.github.com/users/itaismith/repos", "events_url": "https://api.github.com/users/itaismith/events{/privacy}", "received_events_url": "https://api.github.com/users/itaismith/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/chroma-core/chroma/issues/2274/reactions", "total_count": 1, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 1}, "timeline_url": "https://api.github.com/repos/chroma-core/chroma/issues/2274/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/chroma-core/chroma/issues/1178", "repository_url": "https://api.github.com/repos/chroma-core/chroma", "labels_url": "https://api.github.com/repos/chroma-core/chroma/issues/1178/labels{/name}", "comments_url": "https://api.github.com/repos/chroma-core/chroma/issues/1178/comments", "events_url": "https://api.github.com/repos/chroma-core/chroma/issues/1178/events", "html_url": "https://github.com/chroma-core/chroma/issues/1178", "id": 1911740175, "node_id": "I_kwDOII5zmM5x8tcP", "number": 1178, "title": "[Bug]: Next.js compatibility of js package", "user": {"login": "dsws", "id": 60757593, "node_id": "MDQ6VXNlcjYwNzU3NTkz", "avatar_url": "https://avatars.githubusercontent.com/u/60757593?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dsws", "html_url": "https://github.com/dsws", "followers_url": "https://api.github.com/users/dsws/followers", "following_url": "https://api.github.com/users/dsws/following{/other_user}", "gists_url": "https://api.github.com/users/dsws/gists{/gist_id}", "starred_url": "https://api.github.com/users/dsws/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dsws/subscriptions", "organizations_url": "https://api.github.com/users/dsws/orgs", "repos_url": "https://api.github.com/users/dsws/repos", "events_url": "https://api.github.com/users/dsws/events{/privacy}", "received_events_url": "https://api.github.com/users/dsws/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 4620187878, "node_id": "LA_kwDOII5zmM8AAAABE2J45g", "url": "https://api.github.com/repos/chroma-core/chroma/labels/bug", "name": "bug", "color": "E99695", "default": true, "description": "Something isn't working"}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 23, "created_at": "2023-09-25T15:16:06Z", "updated_at": "2025-06-30T18:10:17Z", "closed_at": "2025-06-30T18:10:17Z", "assignee": null, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### What happened?\n\nWhen I try to invoke this node file with import, it complains \"To load an ES module, set \"type\": \"module\" in the package.json or use the .mjs extension.\"\r\n\r\nimport { ChromaClient } from \"chromadb\";\r\nconst chroma = new ChromaClient({ path: \"http://localhost:8000\" });\r\n\r\nWhen i add the line to my package.json file all works fine.\r\n\r\n\"type\": \"module\"\r\n\r\nHowever, when I try to load the same in my NextJS app... it's giving me the following error\r\n\r\n./node_modules/onnxruntime-node/bin/napi-v3/darwin/arm64/onnxruntime_binding.node\r\nModule parse failed: Unexpected character '\ufffd' (1:0)\r\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\r\n(Source code omitted for this binary file)\r\n\r\nImport trace for requested module:\r\n./node_modules/onnxruntime-node/bin/napi-v3/darwin/arm64/onnxruntime_binding.node\r\n./node_modules/onnxruntime-node/bin/napi-v3/ sync ^\\.\\/.*\\/.*\\/onnxruntime_binding\\.node$\r\n./node_modules/onnxruntime-node/dist/binding.js\r\n./node_modules/onnxruntime-node/dist/backend.js\r\n./node_modules/onnxruntime-node/dist/index.js\r\n./node_modules/@visheratin/web-ai-node/node/session.js\r\n./node_modules/@visheratin/web-ai-node/node/index.js\r\n./node_modules/@visheratin/web-ai-node/index.js\r\n./node_modules/chromadb/dist/module/embeddings/WebAIEmbeddingFunction.js\r\n./node_modules/chromadb/dist/module/index.js\r\n./app/api/chat/retrieval/route.ts\r\n\n\n### Versions\n\n\"chromadb\": \"1.5.11\",\n\n### Relevant log output\n\n_No response_", "closed_by": {"login": "jairad26", "id": 55522316, "node_id": "MDQ6VXNlcjU1NTIyMzE2", "avatar_url": "https://avatars.githubusercontent.com/u/55522316?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jairad26", "html_url": "https://github.com/jairad26", "followers_url": "https://api.github.com/users/jairad26/followers", "following_url": "https://api.github.com/users/jairad26/following{/other_user}", "gists_url": "https://api.github.com/users/jairad26/gists{/gist_id}", "starred_url": "https://api.github.com/users/jairad26/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jairad26/subscriptions", "organizations_url": "https://api.github.com/users/jairad26/orgs", "repos_url": "https://api.github.com/users/jairad26/repos", "events_url": "https://api.github.com/users/jairad26/events{/privacy}", "received_events_url": "https://api.github.com/users/jairad26/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/chroma-core/chroma/issues/1178/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/chroma-core/chroma/issues/1178/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/chroma-core/chroma/issues/868", "repository_url": "https://api.github.com/repos/chroma-core/chroma", "labels_url": "https://api.github.com/repos/chroma-core/chroma/issues/868/labels{/name}", "comments_url": "https://api.github.com/repos/chroma-core/chroma/issues/868/comments", "events_url": "https://api.github.com/repos/chroma-core/chroma/issues/868/events", "html_url": "https://github.com/chroma-core/chroma/issues/868", "id": 1817933807, "node_id": "I_kwDOII5zmM5sW3fv", "number": 868, "title": "[Bug]: RuntimeError: Cannot return the results in a contigious 2D array. Probably ef or M is too small", "user": {"login": "JacksonCakes", "id": 51978507, "node_id": "MDQ6VXNlcjUxOTc4NTA3", "avatar_url": "https://avatars.githubusercontent.com/u/51978507?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JacksonCakes", "html_url": "https://github.com/JacksonCakes", "followers_url": "https://api.github.com/users/JacksonCakes/followers", "following_url": "https://api.github.com/users/JacksonCakes/following{/other_user}", "gists_url": "https://api.github.com/users/JacksonCakes/gists{/gist_id}", "starred_url": "https://api.github.com/users/JacksonCakes/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JacksonCakes/subscriptions", "organizations_url": "https://api.github.com/users/JacksonCakes/orgs", "repos_url": "https://api.github.com/users/JacksonCakes/repos", "events_url": "https://api.github.com/users/JacksonCakes/events{/privacy}", "received_events_url": "https://api.github.com/users/JacksonCakes/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 4620187878, "node_id": "LA_kwDOII5zmM8AAAABE2J45g", "url": "https://api.github.com/repos/chroma-core/chroma/labels/bug", "name": "bug", "color": "E99695", "default": true, "description": "Something isn't working"}], "state": "closed", "locked": false, "assignees": [{"login": "HammadB", "id": 5598697, "node_id": "MDQ6VXNlcjU1OTg2OTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5598697?v=4", "gravatar_id": "", "url": "https://api.github.com/users/HammadB", "html_url": "https://github.com/HammadB", "followers_url": "https://api.github.com/users/HammadB/followers", "following_url": "https://api.github.com/users/HammadB/following{/other_user}", "gists_url": "https://api.github.com/users/HammadB/gists{/gist_id}", "starred_url": "https://api.github.com/users/HammadB/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/HammadB/subscriptions", "organizations_url": "https://api.github.com/users/HammadB/orgs", "repos_url": "https://api.github.com/users/HammadB/repos", "events_url": "https://api.github.com/users/HammadB/events{/privacy}", "received_events_url": "https://api.github.com/users/HammadB/received_events", "type": "User", "user_view_type": "public", "site_admin": false}], "milestone": null, "comments": 22, "created_at": "2023-07-24T08:42:09Z", "updated_at": "2025-05-17T18:36:19Z", "closed_at": "2023-11-07T19:28:37Z", "assignee": {"login": "HammadB", "id": 5598697, "node_id": "MDQ6VXNlcjU1OTg2OTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5598697?v=4", "gravatar_id": "", "url": "https://api.github.com/users/HammadB", "html_url": "https://github.com/HammadB", "followers_url": "https://api.github.com/users/HammadB/followers", "following_url": "https://api.github.com/users/HammadB/following{/other_user}", "gists_url": "https://api.github.com/users/HammadB/gists{/gist_id}", "starred_url": "https://api.github.com/users/HammadB/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/HammadB/subscriptions", "organizations_url": "https://api.github.com/users/HammadB/orgs", "repos_url": "https://api.github.com/users/HammadB/repos", "events_url": "https://api.github.com/users/HammadB/events{/privacy}", "received_events_url": "https://api.github.com/users/HammadB/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### What happened?\n\nI have the following code to initialize the db client and get the collections:\r\n\r\n```\r\ndef initialize_vectordb(client_path,collections_name):\r\n    vectordb_client = chromadb.PersistentClient(path=client_path)\r\n    collections = vectordb_client.get_or_create_collection(name=collections_name)\r\n    return vectordb_client,collections\r\n```\r\nand here is the code to add documents to my db:\r\n```\r\ncollections.add(\r\n        documents=docs,\r\n        embeddings=embeddings,\r\n        metadatas=metadatas,\r\n        ids=ids\r\n    )\r\n```\r\nand following code to query the db:\r\n```\r\ncolumn_len = len(collections.get(where={\"source\":\"column\"})[\"ids\"])\r\nfile_len = len(collections.get(where={\"source\":\"file\"})[\"ids\"])\r\ntext_embeddings = embeddings_model(text)\r\nfile_results = collections.query(\r\n    query_embeddings=text_embeddings,\r\n    n_results=file_len,\r\n    where={\"source\":\"file\"}\r\n)\r\n```\r\nEverytime when I perform initialization of db, adding documents to db followed by query in the same session, it works perfectly fine. But when I terminate the session, then initialize the db followed by query, it will shows the error:\r\n```\r\nRuntimeError: Cannot return the results in a contigious 2D array. Probably ef or M is too small\r\n```\r\nBasically,\r\ninitialize_new_db -> add_docs to new db -> query db\u2705 Works fine\r\nstart new session -> initialize_persistent_client_db -> query db \u274c shows error\r\n\n\n### Versions\n\nChroma v0.4.2\r\nPython 3.8.15\n\n### Relevant log output\n\n_No response_", "closed_by": {"login": "jeffchuber", "id": 891664, "node_id": "MDQ6VXNlcjg5MTY2NA==", "avatar_url": "https://avatars.githubusercontent.com/u/891664?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jeffchuber", "html_url": "https://github.com/jeffchuber", "followers_url": "https://api.github.com/users/jeffchuber/followers", "following_url": "https://api.github.com/users/jeffchuber/following{/other_user}", "gists_url": "https://api.github.com/users/jeffchuber/gists{/gist_id}", "starred_url": "https://api.github.com/users/jeffchuber/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jeffchuber/subscriptions", "organizations_url": "https://api.github.com/users/jeffchuber/orgs", "repos_url": "https://api.github.com/users/jeffchuber/repos", "events_url": "https://api.github.com/users/jeffchuber/events{/privacy}", "received_events_url": "https://api.github.com/users/jeffchuber/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/chroma-core/chroma/issues/868/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/chroma-core/chroma/issues/868/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/chroma-core/chroma/issues/1628", "repository_url": "https://api.github.com/repos/chroma-core/chroma", "labels_url": "https://api.github.com/repos/chroma-core/chroma/issues/1628/labels{/name}", "comments_url": "https://api.github.com/repos/chroma-core/chroma/issues/1628/comments", "events_url": "https://api.github.com/repos/chroma-core/chroma/issues/1628/events", "html_url": "https://github.com/chroma-core/chroma/issues/1628", "id": 2080355203, "node_id": "I_kwDOII5zmM57_7OD", "number": 1628, "title": "[Bug]: sqlite3.DatabaseError: file is not a database", "user": {"login": "byashwan", "id": 103255676, "node_id": "U_kgDOBieOfA", "avatar_url": "https://avatars.githubusercontent.com/u/103255676?v=4", "gravatar_id": "", "url": "https://api.github.com/users/byashwan", "html_url": "https://github.com/byashwan", "followers_url": "https://api.github.com/users/byashwan/followers", "following_url": "https://api.github.com/users/byashwan/following{/other_user}", "gists_url": "https://api.github.com/users/byashwan/gists{/gist_id}", "starred_url": "https://api.github.com/users/byashwan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/byashwan/subscriptions", "organizations_url": "https://api.github.com/users/byashwan/orgs", "repos_url": "https://api.github.com/users/byashwan/repos", "events_url": "https://api.github.com/users/byashwan/events{/privacy}", "received_events_url": "https://api.github.com/users/byashwan/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 4620187878, "node_id": "LA_kwDOII5zmM8AAAABE2J45g", "url": "https://api.github.com/repos/chroma-core/chroma/labels/bug", "name": "bug", "color": "E99695", "default": true, "description": "Something isn't working"}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 20, "created_at": "2024-01-13T15:50:19Z", "updated_at": "2025-01-02T18:58:15Z", "closed_at": "2025-01-02T18:58:15Z", "assignee": null, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### What happened?\n\nI persisted my chroma db to a folder on my laptop and re-using it in my docker container. when i read  using below code, its showing ->sqlite3.DatabaseError: file is not a database\r\n\r\nself.vectorstore = Chroma(persist_directory=\"/home/gatekeeper_classifier/chroma\", embedding_function = self.embedding)\r\n\r\nmy chroma folder looks like this,\r\n![image](https://github.com/chroma-core/chroma/assets/103255676/0473ca09-4abc-4cd4-933b-7af15edbbd78)\r\n\n\n### Versions\n\nPython 3.10 , chromadb-0.4.22\n\n### Relevant log output\n\n_No response_", "closed_by": {"login": "itaismith", "id": 42597089, "node_id": "MDQ6VXNlcjQyNTk3MDg5", "avatar_url": "https://avatars.githubusercontent.com/u/42597089?v=4", "gravatar_id": "", "url": "https://api.github.com/users/itaismith", "html_url": "https://github.com/itaismith", "followers_url": "https://api.github.com/users/itaismith/followers", "following_url": "https://api.github.com/users/itaismith/following{/other_user}", "gists_url": "https://api.github.com/users/itaismith/gists{/gist_id}", "starred_url": "https://api.github.com/users/itaismith/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/itaismith/subscriptions", "organizations_url": "https://api.github.com/users/itaismith/orgs", "repos_url": "https://api.github.com/users/itaismith/repos", "events_url": "https://api.github.com/users/itaismith/events{/privacy}", "received_events_url": "https://api.github.com/users/itaismith/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/chroma-core/chroma/issues/1628/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/chroma-core/chroma/issues/1628/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/chroma-core/chroma/issues/1394", "repository_url": "https://api.github.com/repos/chroma-core/chroma", "labels_url": "https://api.github.com/repos/chroma-core/chroma/issues/1394/labels{/name}", "comments_url": "https://api.github.com/repos/chroma-core/chroma/issues/1394/comments", "events_url": "https://api.github.com/repos/chroma-core/chroma/issues/1394/events", "html_url": "https://github.com/chroma-core/chroma/issues/1394", "id": 1993689680, "node_id": "I_kwDOII5zmM521UpQ", "number": 1394, "title": "[Bug]: Very slow metadata filtering", "user": {"login": "ss323", "id": 140161952, "node_id": "U_kgDOCFqzoA", "avatar_url": "https://avatars.githubusercontent.com/u/140161952?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ss323", "html_url": "https://github.com/ss323", "followers_url": "https://api.github.com/users/ss323/followers", "following_url": "https://api.github.com/users/ss323/following{/other_user}", "gists_url": "https://api.github.com/users/ss323/gists{/gist_id}", "starred_url": "https://api.github.com/users/ss323/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ss323/subscriptions", "organizations_url": "https://api.github.com/users/ss323/orgs", "repos_url": "https://api.github.com/users/ss323/repos", "events_url": "https://api.github.com/users/ss323/events{/privacy}", "received_events_url": "https://api.github.com/users/ss323/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 4620187878, "node_id": "LA_kwDOII5zmM8AAAABE2J45g", "url": "https://api.github.com/repos/chroma-core/chroma/labels/bug", "name": "bug", "color": "E99695", "default": true, "description": "Something isn't working"}], "state": "closed", "locked": false, "assignees": [{"login": "beggers", "id": 64657842, "node_id": "MDQ6VXNlcjY0NjU3ODQy", "avatar_url": "https://avatars.githubusercontent.com/u/64657842?v=4", "gravatar_id": "", "url": "https://api.github.com/users/beggers", "html_url": "https://github.com/beggers", "followers_url": "https://api.github.com/users/beggers/followers", "following_url": "https://api.github.com/users/beggers/following{/other_user}", "gists_url": "https://api.github.com/users/beggers/gists{/gist_id}", "starred_url": "https://api.github.com/users/beggers/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/beggers/subscriptions", "organizations_url": "https://api.github.com/users/beggers/orgs", "repos_url": "https://api.github.com/users/beggers/repos", "events_url": "https://api.github.com/users/beggers/events{/privacy}", "received_events_url": "https://api.github.com/users/beggers/received_events", "type": "User", "user_view_type": "public", "site_admin": false}], "milestone": null, "comments": 20, "created_at": "2023-11-14T22:33:54Z", "updated_at": "2025-06-04T06:20:20Z", "closed_at": "2025-01-07T06:27:35Z", "assignee": {"login": "beggers", "id": 64657842, "node_id": "MDQ6VXNlcjY0NjU3ODQy", "avatar_url": "https://avatars.githubusercontent.com/u/64657842?v=4", "gravatar_id": "", "url": "https://api.github.com/users/beggers", "html_url": "https://github.com/beggers", "followers_url": "https://api.github.com/users/beggers/followers", "following_url": "https://api.github.com/users/beggers/following{/other_user}", "gists_url": "https://api.github.com/users/beggers/gists{/gist_id}", "starred_url": "https://api.github.com/users/beggers/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/beggers/subscriptions", "organizations_url": "https://api.github.com/users/beggers/orgs", "repos_url": "https://api.github.com/users/beggers/repos", "events_url": "https://api.github.com/users/beggers/events{/privacy}", "received_events_url": "https://api.github.com/users/beggers/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### What happened?\n\nI am using the vectordb.similarity_search function. I have 40k documents and one metadata filter using the function takes around 5 minutes. I am assuming that this should be a <1s exercise. Why is this so slow?\r\n\r\n\n\n### Versions\n\nChroma 0.4.17, Python 3.9\n\n### Relevant log output\n\n_No response_", "closed_by": {"login": "itaismith", "id": 42597089, "node_id": "MDQ6VXNlcjQyNTk3MDg5", "avatar_url": "https://avatars.githubusercontent.com/u/42597089?v=4", "gravatar_id": "", "url": "https://api.github.com/users/itaismith", "html_url": "https://github.com/itaismith", "followers_url": "https://api.github.com/users/itaismith/followers", "following_url": "https://api.github.com/users/itaismith/following{/other_user}", "gists_url": "https://api.github.com/users/itaismith/gists{/gist_id}", "starred_url": "https://api.github.com/users/itaismith/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/itaismith/subscriptions", "organizations_url": "https://api.github.com/users/itaismith/orgs", "repos_url": "https://api.github.com/users/itaismith/repos", "events_url": "https://api.github.com/users/itaismith/events{/privacy}", "received_events_url": "https://api.github.com/users/itaismith/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/chroma-core/chroma/issues/1394/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/chroma-core/chroma/issues/1394/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/chroma-core/chroma/issues/2510", "repository_url": "https://api.github.com/repos/chroma-core/chroma", "labels_url": "https://api.github.com/repos/chroma-core/chroma/issues/2510/labels{/name}", "comments_url": "https://api.github.com/repos/chroma-core/chroma/issues/2510/comments", "events_url": "https://api.github.com/repos/chroma-core/chroma/issues/2510/events", "html_url": "https://github.com/chroma-core/chroma/issues/2510", "id": 2405359833, "node_id": "I_kwDOII5zmM6PXuDZ", "number": 2510, "title": "[Bug]: AttributeError: 'NoneType' object has no attribute 'get'", "user": {"login": "saikumar-cloudangles", "id": 146807683, "node_id": "U_kgDOCMAbgw", "avatar_url": "https://avatars.githubusercontent.com/u/146807683?v=4", "gravatar_id": "", "url": "https://api.github.com/users/saikumar-cloudangles", "html_url": "https://github.com/saikumar-cloudangles", "followers_url": "https://api.github.com/users/saikumar-cloudangles/followers", "following_url": "https://api.github.com/users/saikumar-cloudangles/following{/other_user}", "gists_url": "https://api.github.com/users/saikumar-cloudangles/gists{/gist_id}", "starred_url": "https://api.github.com/users/saikumar-cloudangles/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/saikumar-cloudangles/subscriptions", "organizations_url": "https://api.github.com/users/saikumar-cloudangles/orgs", "repos_url": "https://api.github.com/users/saikumar-cloudangles/repos", "events_url": "https://api.github.com/users/saikumar-cloudangles/events{/privacy}", "received_events_url": "https://api.github.com/users/saikumar-cloudangles/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 4620187878, "node_id": "LA_kwDOII5zmM8AAAABE2J45g", "url": "https://api.github.com/repos/chroma-core/chroma/labels/bug", "name": "bug", "color": "E99695", "default": true, "description": "Something isn't working"}], "state": "closed", "locked": false, "assignees": [{"login": "tazarov", "id": 1157440, "node_id": "MDQ6VXNlcjExNTc0NDA=", "avatar_url": "https://avatars.githubusercontent.com/u/1157440?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tazarov", "html_url": "https://github.com/tazarov", "followers_url": "https://api.github.com/users/tazarov/followers", "following_url": "https://api.github.com/users/tazarov/following{/other_user}", "gists_url": "https://api.github.com/users/tazarov/gists{/gist_id}", "starred_url": "https://api.github.com/users/tazarov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tazarov/subscriptions", "organizations_url": "https://api.github.com/users/tazarov/orgs", "repos_url": "https://api.github.com/users/tazarov/repos", "events_url": "https://api.github.com/users/tazarov/events{/privacy}", "received_events_url": "https://api.github.com/users/tazarov/received_events", "type": "User", "user_view_type": "public", "site_admin": false}], "milestone": null, "comments": 19, "created_at": "2024-07-12T11:29:30Z", "updated_at": "2024-07-30T12:14:08Z", "closed_at": "2024-07-16T16:04:13Z", "assignee": {"login": "tazarov", "id": 1157440, "node_id": "MDQ6VXNlcjExNTc0NDA=", "avatar_url": "https://avatars.githubusercontent.com/u/1157440?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tazarov", "html_url": "https://github.com/tazarov", "followers_url": "https://api.github.com/users/tazarov/followers", "following_url": "https://api.github.com/users/tazarov/following{/other_user}", "gists_url": "https://api.github.com/users/tazarov/gists{/gist_id}", "starred_url": "https://api.github.com/users/tazarov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tazarov/subscriptions", "organizations_url": "https://api.github.com/users/tazarov/orgs", "repos_url": "https://api.github.com/users/tazarov/repos", "events_url": "https://api.github.com/users/tazarov/events{/privacy}", "received_events_url": "https://api.github.com/users/tazarov/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### What happened?\n\nI have installed latest version of chroma 0.5.4 using pip in python language\r\nI am connecting to my chroma  set up in an AWS EC2 instance through docker installation method.\r\nAfter creating a connection through chroma HttpClient using the host address and port name \r\nI tried to get list of all my connections using the below code:\r\n\r\ncollections= chroma_client.list_collections()\r\n\r\nand it is throwing the following error\r\n AttributeError: 'NoneType' object has no attribute 'get'\r\n \r\nI downgraded my chroma to version 0.5.3 and it was working fine\r\nSeems like an issue with newer version of 0.5.4 or Am I doing a mistake anywhere ??\r\n\r\nGotta need Your Feedback\r\n\n\n### Versions\n\nchroma 0.5.4\r\nWindows\r\neditor - Vs Code\r\nPython 3.11.5\r\nI was using ipykernel in  vs code for running my notebook .\n\n### Relevant log output\n\n```shell\nAttributeError: 'NoneType' object has no attribute 'get'\n```\n", "closed_by": {"login": "atroyn", "id": 1302641, "node_id": "MDQ6VXNlcjEzMDI2NDE=", "avatar_url": "https://avatars.githubusercontent.com/u/1302641?v=4", "gravatar_id": "", "url": "https://api.github.com/users/atroyn", "html_url": "https://github.com/atroyn", "followers_url": "https://api.github.com/users/atroyn/followers", "following_url": "https://api.github.com/users/atroyn/following{/other_user}", "gists_url": "https://api.github.com/users/atroyn/gists{/gist_id}", "starred_url": "https://api.github.com/users/atroyn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/atroyn/subscriptions", "organizations_url": "https://api.github.com/users/atroyn/orgs", "repos_url": "https://api.github.com/users/atroyn/repos", "events_url": "https://api.github.com/users/atroyn/events{/privacy}", "received_events_url": "https://api.github.com/users/atroyn/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/chroma-core/chroma/issues/2510/reactions", "total_count": 2, "+1": 2, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/chroma-core/chroma/issues/2510/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/chroma-core/chroma/issues/583", "repository_url": "https://api.github.com/repos/chroma-core/chroma", "labels_url": "https://api.github.com/repos/chroma-core/chroma/issues/583/labels{/name}", "comments_url": "https://api.github.com/repos/chroma-core/chroma/issues/583/comments", "events_url": "https://api.github.com/repos/chroma-core/chroma/issues/583/events", "html_url": "https://github.com/chroma-core/chroma/issues/583", "id": 1715666860, "node_id": "I_kwDOII5zmM5mQv-s", "number": 583, "title": "[Bug]: collection.delete( ) deletes all the data when called with empty list of ids.", "user": {"login": "Satyam-79", "id": 70771653, "node_id": "MDQ6VXNlcjcwNzcxNjUz", "avatar_url": "https://avatars.githubusercontent.com/u/70771653?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Satyam-79", "html_url": "https://github.com/Satyam-79", "followers_url": "https://api.github.com/users/Satyam-79/followers", "following_url": "https://api.github.com/users/Satyam-79/following{/other_user}", "gists_url": "https://api.github.com/users/Satyam-79/gists{/gist_id}", "starred_url": "https://api.github.com/users/Satyam-79/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Satyam-79/subscriptions", "organizations_url": "https://api.github.com/users/Satyam-79/orgs", "repos_url": "https://api.github.com/users/Satyam-79/repos", "events_url": "https://api.github.com/users/Satyam-79/events{/privacy}", "received_events_url": "https://api.github.com/users/Satyam-79/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 4620187878, "node_id": "LA_kwDOII5zmM8AAAABE2J45g", "url": "https://api.github.com/repos/chroma-core/chroma/labels/bug", "name": "bug", "color": "E99695", "default": true, "description": "Something isn't working"}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 19, "created_at": "2023-05-18T13:45:04Z", "updated_at": "2024-08-20T14:08:19Z", "closed_at": "2023-11-07T19:05:52Z", "assignee": null, "author_association": "CONTRIBUTOR", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### What happened?\n\nwhen calling `collection.delete()` with empty list of ids(`collection.delete(ids=[])`) it deletes all the `ids` in the database.\r\n\r\n\r\ncode to reproduce:\r\n\r\n```\r\nclient = chromadb.Client()\r\n\r\ncollection = client.get_or_create_collection(\"test\")\r\n\r\ncollection.add(\r\n    documents=[\"doc4\", \"doc5\", \"doc6\", \"doc7\", \"doc8\"],\r\n    ids=[\"id4\", \"id5\", \"id6\", \"id7\", \"id8\"],\r\n)\r\nprint(collection.get(include=[]))\r\ncollection.delete(ids=[])\r\n\r\nprint(\"After Delete\")\r\nprint(collection.get(include=[]))\r\n```\n\n### Versions\n\nchroma version - 0.3.23\r\npython version - 3.10.10\n\n### Relevant log output\n\n```shell\nNo embedding_function provided, using default embedding function: SentenceTransformerEmbeddingFunction\r\n{'ids': ['id4', 'id5', 'id6', 'id7', 'id8'], 'embeddings': None, 'documents': None, 'metadatas': None}\r\nAfter Delete\r\n{'ids': [], 'embeddings': None, 'documents': None, 'metadatas': None}\n```\n", "closed_by": {"login": "HammadB", "id": 5598697, "node_id": "MDQ6VXNlcjU1OTg2OTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5598697?v=4", "gravatar_id": "", "url": "https://api.github.com/users/HammadB", "html_url": "https://github.com/HammadB", "followers_url": "https://api.github.com/users/HammadB/followers", "following_url": "https://api.github.com/users/HammadB/following{/other_user}", "gists_url": "https://api.github.com/users/HammadB/gists{/gist_id}", "starred_url": "https://api.github.com/users/HammadB/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/HammadB/subscriptions", "organizations_url": "https://api.github.com/users/HammadB/orgs", "repos_url": "https://api.github.com/users/HammadB/repos", "events_url": "https://api.github.com/users/HammadB/events{/privacy}", "received_events_url": "https://api.github.com/users/HammadB/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/chroma-core/chroma/issues/583/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/chroma-core/chroma/issues/583/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/chroma-core/chroma/issues/405", "repository_url": "https://api.github.com/repos/chroma-core/chroma", "labels_url": "https://api.github.com/repos/chroma-core/chroma/issues/405/labels{/name}", "comments_url": "https://api.github.com/repos/chroma-core/chroma/issues/405/comments", "events_url": "https://api.github.com/repos/chroma-core/chroma/issues/405/events", "html_url": "https://github.com/chroma-core/chroma/issues/405", "id": 1678717702, "node_id": "I_kwDOII5zmM5kDzMG", "number": 405, "title": "[Bug]: error: \"IndexError('list index out of range')\"", "user": {"login": "kevmok", "id": 48875246, "node_id": "MDQ6VXNlcjQ4ODc1MjQ2", "avatar_url": "https://avatars.githubusercontent.com/u/48875246?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kevmok", "html_url": "https://github.com/kevmok", "followers_url": "https://api.github.com/users/kevmok/followers", "following_url": "https://api.github.com/users/kevmok/following{/other_user}", "gists_url": "https://api.github.com/users/kevmok/gists{/gist_id}", "starred_url": "https://api.github.com/users/kevmok/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kevmok/subscriptions", "organizations_url": "https://api.github.com/users/kevmok/orgs", "repos_url": "https://api.github.com/users/kevmok/repos", "events_url": "https://api.github.com/users/kevmok/events{/privacy}", "received_events_url": "https://api.github.com/users/kevmok/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 4620187878, "node_id": "LA_kwDOII5zmM8AAAABE2J45g", "url": "https://api.github.com/repos/chroma-core/chroma/labels/bug", "name": "bug", "color": "E99695", "default": true, "description": "Something isn't working"}], "state": "closed", "locked": false, "assignees": [{"login": "jeffchuber", "id": 891664, "node_id": "MDQ6VXNlcjg5MTY2NA==", "avatar_url": "https://avatars.githubusercontent.com/u/891664?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jeffchuber", "html_url": "https://github.com/jeffchuber", "followers_url": "https://api.github.com/users/jeffchuber/followers", "following_url": "https://api.github.com/users/jeffchuber/following{/other_user}", "gists_url": "https://api.github.com/users/jeffchuber/gists{/gist_id}", "starred_url": "https://api.github.com/users/jeffchuber/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jeffchuber/subscriptions", "organizations_url": "https://api.github.com/users/jeffchuber/orgs", "repos_url": "https://api.github.com/users/jeffchuber/repos", "events_url": "https://api.github.com/users/jeffchuber/events{/privacy}", "received_events_url": "https://api.github.com/users/jeffchuber/received_events", "type": "User", "user_view_type": "public", "site_admin": false}], "milestone": null, "comments": 19, "created_at": "2023-04-21T15:35:33Z", "updated_at": "2024-07-22T15:33:35Z", "closed_at": "2023-05-10T00:28:17Z", "assignee": {"login": "jeffchuber", "id": 891664, "node_id": "MDQ6VXNlcjg5MTY2NA==", "avatar_url": "https://avatars.githubusercontent.com/u/891664?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jeffchuber", "html_url": "https://github.com/jeffchuber", "followers_url": "https://api.github.com/users/jeffchuber/followers", "following_url": "https://api.github.com/users/jeffchuber/following{/other_user}", "gists_url": "https://api.github.com/users/jeffchuber/gists{/gist_id}", "starred_url": "https://api.github.com/users/jeffchuber/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jeffchuber/subscriptions", "organizations_url": "https://api.github.com/users/jeffchuber/orgs", "repos_url": "https://api.github.com/users/jeffchuber/repos", "events_url": "https://api.github.com/users/jeffchuber/events{/privacy}", "received_events_url": "https://api.github.com/users/jeffchuber/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### What happened?\n\nI have this typescript project that is trying to load a pdf and embeds into a local Chroma DB\r\n\r\n```\r\nimport { Chroma } from 'langchain/vectorstores/chroma';\r\nexport async function pdfLoader(llm: OpenAI) {\r\n  const loader = new PDFLoader('src/pdfs/SOP.pdf');\r\n  log(loader);\r\n  const docs = await loader.load();\r\n  const vectorStore = await Chroma.fromDocuments(docs, embeddings, {\r\n    collectionName: 'AITA',\r\n  });\r\n\r\n  await vectorStore.ensureCollection();\r\n...\r\n```\r\n\r\nThe problem is that when I try to use the `fromDocuments` method is throws this huge log with this `data: { error: \"IndexError('list index out of range')\" }` error.\r\n\r\nI have chroma set up locally, and I've tested other code to hit the DB, and it's working. Not sure what next steps are?\n\n### Versions\n\nChromadb v1.4.1 javascript\n\n### Relevant log output\n\n```shell\n/Users/kevin/code/src/github/kevmok/node-langchain-prompt/node_modules/.pnpm/axios@0.26.1/node_modules/axios/lib/core/createError.js:16\r\n  var error = new Error(message);\r\n              ^\r\n\r\n\r\nError: Request failed with status code 500\r\n    at createError (/Users/kevin/code/src/github/kevmok/node-langchain-prompt/node_modules/.pnpm/axios@0.26.1/node_modules/axios/lib/core/createError.js:16:15)\r\n    at settle (/Users/kevin/code/src/github/kevmok/node-langchain-prompt/node_modules/.pnpm/axios@0.26.1/node_modules/axios/lib/core/settle.js:17:12)\r\n    at IncomingMessage.handleStreamEnd (/Users/kevin/code/src/github/kevmok/node-langchain-prompt/node_modules/.pnpm/axios@0.26.1/node_modules/axios/lib/adapters/http.js:322:11)\r\n    at IncomingMessage.emit (node:events:525:35)\r\n    at IncomingMessage.emit (node:domain:489:12)\r\n    at endReadableNT (node:internal/streams/readable:1359:12)\r\n    at process.processTicksAndRejections (node:internal/process/task_queues:82:21) {\r\n  config: {\r\n    transitional: {\r\n      silentJSONParsing: true,\r\n      forcedJSONParsing: true,\r\n      clarifyTimeoutError: false\r\n    },\r\n    adapter: [Function: httpAdapter],\r\n    transformRequest: [ [Function: transformRequest] ],\r\n    transformResponse: [ [Function: transformResponse] ],\r\n    timeout: 0,\r\n    xsrfCookieName: 'XSRF-TOKEN',\r\n    xsrfHeaderName: 'X-XSRF-TOKEN',\r\n    maxContentLength: -1,\r\n    maxBodyLength: -1,\r\n    validateStatus: [Function: validateStatus],\r\n    headers: {\r\n      Accept: 'application/json, text/plain, */*',\r\n      'User-Agent': 'axios/0.26.1'\r\n    },\r\n    method: 'get',\r\n    url: 'http://localhost:8000/api/v1/collections/AITA/count',\r\n    data: undefined\r\n  },\r\n  request: <ref *1> ClientRequest {\r\n    _events: [Object: null prototype] {\r\n      abort: [Function (anonymous)],\r\n      aborted: [Function (anonymous)],\r\n      connect: [Function (anonymous)],\r\n      error: [Function (anonymous)],\r\n      socket: [Function (anonymous)],\r\n      timeout: [Function (anonymous)],\r\n      finish: [Function: requestOnFinish]\r\n    },\r\n    _eventsCount: 7,\r\n    _maxListeners: undefined,\r\n    outputData: [],\r\n    outputSize: 0,\r\n    writable: true,\r\n    destroyed: false,\r\n    _last: true,\r\n    chunkedEncoding: false,\r\n    shouldKeepAlive: false,\r\n    maxRequestsOnConnectionReached: false,\r\n    _defaultKeepAlive: true,\r\n    useChunkedEncodingByDefault: false,\r\n    sendDate: false,\r\n    _removedConnection: false,\r\n    _removedContLen: false,\r\n    _removedTE: false,\r\n    strictContentLength: false,\r\n    _contentLength: 0,\r\n    _hasBody: true,\r\n    _trailer: '',\r\n    finished: true,\r\n    _headerSent: true,\r\n    _closed: false,\r\n    socket: <ref *2> Socket {\r\n      connecting: false,\r\n      _hadError: false,\r\n      _parent: null,\r\n      _host: 'localhost',\r\n      _closeAfterHandlingError: false,\r\n      _readableState: ReadableState {\r\n        objectMode: false,\r\n        highWaterMark: 16384,\r\n        buffer: BufferList { head: null, tail: null, length: 0 },\r\n        length: 0,\r\n        pipes: [],\r\n        flowing: true,\r\n        ended: false,\r\n        endEmitted: false,\r\n        reading: true,\r\n        constructed: true,\r\n        sync: false,\r\n        needReadable: true,\r\n        emittedReadable: false,\r\n        readableListening: false,\r\n        resumeScheduled: false,\r\n        errorEmitted: false,\r\n        emitClose: false,\r\n        autoDestroy: true,\r\n        destroyed: false,\r\n        errored: null,\r\n        closed: false,\r\n        closeEmitted: false,\r\n        defaultEncoding: 'utf8',\r\n        awaitDrainWriters: null,\r\n        multiAwaitDrain: false,\r\n        readingMore: false,\r\n        dataEmitted: true,\r\n        decoder: null,\r\n        encoding: null,\r\n        [Symbol(kPaused)]: false\r\n      },\r\n      _events: [Object: null prototype] {\r\n        end: [Function: onReadableStreamEnd],\r\n        free: [Function: onFree],\r\n        close: [ [Function: onClose], [Function: socketCloseListener] ],\r\n        timeout: [Function: onTimeout],\r\n        agentRemove: [Function: onRemove],\r\n        error: [Function: socketErrorListener],\r\n        finish: [Function: bound onceWrapper] { listener: [Function: destroy] }\r\n      },\r\n      _eventsCount: 7,\r\n      _maxListeners: undefined,\r\n      _writableState: WritableState {\r\n        objectMode: false,\r\n        highWaterMark: 16384,\r\n        finalCalled: true,\r\n        needDrain: false,\r\n        ending: true,\r\n        ended: true,\r\n        finished: false,\r\n        destroyed: false,\r\n        decodeStrings: false,\r\n        defaultEncoding: 'utf8',\r\n        length: 0,\r\n        writing: false,\r\n        corked: 0,\r\n        sync: false,\r\n        bufferProcessing: false,\r\n        onwrite: [Function: bound onwrite],\r\n        writecb: null,\r\n        writelen: 0,\r\n        afterWriteTickInfo: null,\r\n        buffered: [],\r\n        bufferedIndex: 0,\r\n        allBuffers: true,\r\n        allNoop: true,\r\n        pendingcb: 1,\r\n        constructed: true,\r\n        prefinished: false,\r\n        errorEmitted: false,\r\n        emitClose: false,\r\n        autoDestroy: true,\r\n        errored: null,\r\n        closed: false,\r\n        closeEmitted: false,\r\n        [Symbol(kOnFinished)]: []\r\n      },\r\n      allowHalfOpen: false,\r\n      _sockname: null,\r\n      _pendingData: null,\r\n      _pendingEncoding: '',\r\n      server: null,\r\n      _server: null,\r\n      parser: null,\r\n      _httpMessage: [Circular *1],\r\n      [Symbol(async_id_symbol)]: 628,\r\n      [Symbol(kHandle)]: TCP {\r\n        reading: true,\r\n        onconnection: null,\r\n        [Symbol(owner_symbol)]: [Circular *2]\r\n      },\r\n      [Symbol(lastWriteQueueSize)]: 0,\r\n      [Symbol(timeout)]: null,\r\n      [Symbol(kBuffer)]: null,\r\n      [Symbol(kBufferCb)]: null,\r\n      [Symbol(kBufferGen)]: null,\r\n      [Symbol(kCapture)]: false,\r\n      [Symbol(kSetNoDelay)]: true,\r\n      [Symbol(kSetKeepAlive)]: true,\r\n      [Symbol(kSetKeepAliveInitialDelay)]: 60,\r\n      [Symbol(kBytesRead)]: 0,\r\n      [Symbol(kBytesWritten)]: 0\r\n    },\r\n    _header: 'GET /api/v1/collections/AITA/count HTTP/1.1\\r\\n' +\r\n      'Accept: application/json, text/plain, */*\\r\\n' +\r\n      'User-Agent: axios/0.26.1\\r\\n' +\r\n      'Host: localhost:8000\\r\\n' +\r\n      'Connection: close\\r\\n' +\r\n      '\\r\\n',\r\n    _keepAliveTimeout: 0,\r\n    _onPendingData: [Function: nop],\r\n    agent: Agent {\r\n      _events: [Object: null prototype] {\r\n        free: [Function (anonymous)],\r\n        newListener: [Function: maybeEnableKeylog]\r\n      },\r\n      _eventsCount: 2,\r\n      _maxListeners: undefined,\r\n      defaultPort: 80,\r\n      protocol: 'http:',\r\n      options: [Object: null prototype] { noDelay: true, path: null },\r\n      requests: [Object: null prototype] {},\r\n      sockets: [Object: null prototype] {\r\n        'localhost:8000:': [\r\n          <ref *2> Socket {\r\n            connecting: false,\r\n            _hadError: false,\r\n            _parent: null,\r\n            _host: 'localhost',\r\n            _closeAfterHandlingError: false,\r\n            _readableState: [ReadableState],\r\n            _events: [Object: null prototype],\r\n            _eventsCount: 7,\r\n            _maxListeners: undefined,\r\n            _writableState: [WritableState],\r\n            allowHalfOpen: false,\r\n            _sockname: null,\r\n            _pendingData: null,\r\n            _pendingEncoding: '',\r\n            server: null,\r\n            _server: null,\r\n            parser: null,\r\n            _httpMessage: [Circular *1],\r\n            [Symbol(async_id_symbol)]: 628,\r\n            [Symbol(kHandle)]: [TCP],\r\n            [Symbol(lastWriteQueueSize)]: 0,\r\n            [Symbol(timeout)]: null,\r\n            [Symbol(kBuffer)]: null,\r\n            [Symbol(kBufferCb)]: null,\r\n            [Symbol(kBufferGen)]: null,\r\n            [Symbol(kCapture)]: false,\r\n            [Symbol(kSetNoDelay)]: true,\r\n            [Symbol(kSetKeepAlive)]: true,\r\n            [Symbol(kSetKeepAliveInitialDelay)]: 60,\r\n            [Symbol(kBytesRead)]: 0,\r\n            [Symbol(kBytesWritten)]: 0\r\n          }\r\n        ]\r\n      },\r\n      freeSockets: [Object: null prototype] {},\r\n      keepAliveMsecs: 1000,\r\n      keepAlive: false,\r\n      maxSockets: Infinity,\r\n      maxFreeSockets: 256,\r\n      scheduling: 'lifo',\r\n      maxTotalSockets: Infinity,\r\n      totalSocketCount: 1,\r\n      [Symbol(kCapture)]: false\r\n    },\r\n    socketPath: undefined,\r\n    method: 'GET',\r\n    maxHeaderSize: undefined,\r\n    insecureHTTPParser: undefined,\r\n    path: '/api/v1/collections/AITA/count',\r\n    _ended: true,\r\n    res: IncomingMessage {\r\n      _readableState: ReadableState {\r\n        objectMode: false,\r\n        highWaterMark: 16384,\r\n        buffer: BufferList { head: null, tail: null, length: 0 },\r\n        length: 0,\r\n        pipes: [],\r\n        flowing: true,\r\n        ended: true,\r\n        endEmitted: true,\r\n        reading: false,\r\n        constructed: true,\r\n        sync: true,\r\n        needReadable: false,\r\n        emittedReadable: false,\r\n        readableListening: false,\r\n        resumeScheduled: false,\r\n        errorEmitted: false,\r\n        emitClose: true,\r\n        autoDestroy: true,\r\n        destroyed: true,\r\n        errored: null,\r\n        closed: true,\r\n        closeEmitted: true,\r\n        defaultEncoding: 'utf8',\r\n        awaitDrainWriters: null,\r\n        multiAwaitDrain: false,\r\n        readingMore: true,\r\n        dataEmitted: true,\r\n        decoder: null,\r\n        encoding: null,\r\n        [Symbol(kPaused)]: false\r\n      },\r\n      _events: [Object: null prototype] {\r\n        end: [ [Function: responseOnEnd], [Function: handleStreamEnd] ],\r\n        data: [Function: handleStreamData],\r\n        aborted: [Function: handlerStreamAborted],\r\n        error: [Function: handleStreamError]\r\n      },\r\n      _eventsCount: 4,\r\n      _maxListeners: undefined,\r\n      socket: <ref *2> Socket {\r\n        connecting: false,\r\n        _hadError: false,\r\n        _parent: null,\r\n        _host: 'localhost',\r\n        _closeAfterHandlingError: false,\r\n        _readableState: ReadableState {\r\n          objectMode: false,\r\n          highWaterMark: 16384,\r\n          buffer: BufferList { head: null, tail: null, length: 0 },\r\n          length: 0,\r\n          pipes: [],\r\n          flowing: true,\r\n          ended: false,\r\n          endEmitted: false,\r\n          reading: true,\r\n          constructed: true,\r\n          sync: false,\r\n          needReadable: true,\r\n          emittedReadable: false,\r\n          readableListening: false,\r\n          resumeScheduled: false,\r\n          errorEmitted: false,\r\n          emitClose: false,\r\n          autoDestroy: true,\r\n          destroyed: false,\r\n          errored: null,\r\n          closed: false,\r\n          closeEmitted: false,\r\n          defaultEncoding: 'utf8',\r\n          awaitDrainWriters: null,\r\n          multiAwaitDrain: false,\r\n          readingMore: false,\r\n          dataEmitted: true,\r\n          decoder: null,\r\n          encoding: null,\r\n          [Symbol(kPaused)]: false\r\n        },\r\n        _events: [Object: null prototype] {\r\n          end: [Function: onReadableStreamEnd],\r\n          free: [Function: onFree],\r\n          close: [ [Function: onClose], [Function: socketCloseListener] ],\r\n          timeout: [Function: onTimeout],\r\n          agentRemove: [Function: onRemove],\r\n          error: [Function: socketErrorListener],\r\n          finish: [Function: bound onceWrapper] {\r\n            listener: [Function: destroy]\r\n          }\r\n        },\r\n        _eventsCount: 7,\r\n        _maxListeners: undefined,\r\n        _writableState: WritableState {\r\n          objectMode: false,\r\n          highWaterMark: 16384,\r\n          finalCalled: true,\r\n          needDrain: false,\r\n          ending: true,\r\n          ended: true,\r\n          finished: false,\r\n          destroyed: false,\r\n          decodeStrings: false,\r\n          defaultEncoding: 'utf8',\r\n          length: 0,\r\n          writing: false,\r\n          corked: 0,\r\n          sync: false,\r\n          bufferProcessing: false,\r\n          onwrite: [Function: bound onwrite],\r\n          writecb: null,\r\n          writelen: 0,\r\n          afterWriteTickInfo: null,\r\n          buffered: [],\r\n          bufferedIndex: 0,\r\n          allBuffers: true,\r\n          allNoop: true,\r\n          pendingcb: 1,\r\n          constructed: true,\r\n          prefinished: false,\r\n          errorEmitted: false,\r\n          emitClose: false,\r\n          autoDestroy: true,\r\n          errored: null,\r\n          closed: false,\r\n          closeEmitted: false,\r\n          [Symbol(kOnFinished)]: []\r\n        },\r\n        allowHalfOpen: false,\r\n        _sockname: null,\r\n        _pendingData: null,\r\n        _pendingEncoding: '',\r\n        server: null,\r\n        _server: null,\r\n        parser: null,\r\n        _httpMessage: [Circular *1],\r\n        [Symbol(async_id_symbol)]: 628,\r\n        [Symbol(kHandle)]: TCP {\r\n          reading: true,\r\n          onconnection: null,\r\n          [Symbol(owner_symbol)]: [Circular *2]\r\n        },\r\n        [Symbol(lastWriteQueueSize)]: 0,\r\n        [Symbol(timeout)]: null,\r\n        [Symbol(kBuffer)]: null,\r\n        [Symbol(kBufferCb)]: null,\r\n        [Symbol(kBufferGen)]: null,\r\n        [Symbol(kCapture)]: false,\r\n        [Symbol(kSetNoDelay)]: true,\r\n        [Symbol(kSetKeepAlive)]: true,\r\n        [Symbol(kSetKeepAliveInitialDelay)]: 60,\r\n        [Symbol(kBytesRead)]: 0,\r\n        [Symbol(kBytesWritten)]: 0\r\n      },\r\n      httpVersionMajor: 1,\r\n      httpVersionMinor: 1,\r\n      httpVersion: '1.1',\r\n      complete: true,\r\n      rawHeaders: [\r\n        'date',\r\n        'Fri, 21 Apr 2023 14:33:00 GMT',\r\n        'server',\r\n        'uvicorn',\r\n        'content-length',\r\n        '49',\r\n        'content-type',\r\n        'application/json',\r\n        'connection',\r\n        'close'\r\n      ],\r\n      rawTrailers: [],\r\n      aborted: false,\r\n      upgrade: false,\r\n      url: '',\r\n      method: null,\r\n      statusCode: 500,\r\n      statusMessage: 'Internal Server Error',\r\n      client: <ref *2> Socket {\r\n        connecting: false,\r\n        _hadError: false,\r\n        _parent: null,\r\n        _host: 'localhost',\r\n        _closeAfterHandlingError: false,\r\n        _readableState: ReadableState {\r\n          objectMode: false,\r\n          highWaterMark: 16384,\r\n          buffer: BufferList { head: null, tail: null, length: 0 },\r\n          length: 0,\r\n          pipes: [],\r\n          flowing: true,\r\n          ended: false,\r\n          endEmitted: false,\r\n          reading: true,\r\n          constructed: true,\r\n          sync: false,\r\n          needReadable: true,\r\n          emittedReadable: false,\r\n          readableListening: false,\r\n          resumeScheduled: false,\r\n          errorEmitted: false,\r\n          emitClose: false,\r\n          autoDestroy: true,\r\n          destroyed: false,\r\n          errored: null,\r\n          closed: false,\r\n          closeEmitted: false,\r\n          defaultEncoding: 'utf8',\r\n          awaitDrainWriters: null,\r\n          multiAwaitDrain: false,\r\n          readingMore: false,\r\n          dataEmitted: true,\r\n          decoder: null,\r\n          encoding: null,\r\n          [Symbol(kPaused)]: false\r\n        },\r\n        _events: [Object: null prototype] {\r\n          end: [Function: onReadableStreamEnd],\r\n          free: [Function: onFree],\r\n          close: [ [Function: onClose], [Function: socketCloseListener] ],\r\n          timeout: [Function: onTimeout],\r\n          agentRemove: [Function: onRemove],\r\n          error: [Function: socketErrorListener],\r\n          finish: [Function: bound onceWrapper] {\r\n            listener: [Function: destroy]\r\n          }\r\n        },\r\n        _eventsCount: 7,\r\n        _maxListeners: undefined,\r\n        _writableState: WritableState {\r\n          objectMode: false,\r\n          highWaterMark: 16384,\r\n          finalCalled: true,\r\n          needDrain: false,\r\n          ending: true,\r\n          ended: true,\r\n          finished: false,\r\n          destroyed: false,\r\n          decodeStrings: false,\r\n          defaultEncoding: 'utf8',\r\n          length: 0,\r\n          writing: false,\r\n          corked: 0,\r\n          sync: false,\r\n          bufferProcessing: false,\r\n          onwrite: [Function: bound onwrite],\r\n          writecb: null,\r\n          writelen: 0,\r\n          afterWriteTickInfo: null,\r\n          buffered: [],\r\n          bufferedIndex: 0,\r\n          allBuffers: true,\r\n          allNoop: true,\r\n          pendingcb: 1,\r\n          constructed: true,\r\n          prefinished: false,\r\n          errorEmitted: false,\r\n          emitClose: false,\r\n          autoDestroy: true,\r\n          errored: null,\r\n          closed: false,\r\n          closeEmitted: false,\r\n          [Symbol(kOnFinished)]: []\r\n        },\r\n        allowHalfOpen: false,\r\n        _sockname: null,\r\n        _pendingData: null,\r\n        _pendingEncoding: '',\r\n        server: null,\r\n        _server: null,\r\n        parser: null,\r\n        _httpMessage: [Circular *1],\r\n        [Symbol(async_id_symbol)]: 628,\r\n        [Symbol(kHandle)]: TCP {\r\n          reading: true,\r\n          onconnection: null,\r\n          [Symbol(owner_symbol)]: [Circular *2]\r\n        },\r\n        [Symbol(lastWriteQueueSize)]: 0,\r\n        [Symbol(timeout)]: null,\r\n        [Symbol(kBuffer)]: null,\r\n        [Symbol(kBufferCb)]: null,\r\n        [Symbol(kBufferGen)]: null,\r\n        [Symbol(kCapture)]: false,\r\n        [Symbol(kSetNoDelay)]: true,\r\n        [Symbol(kSetKeepAlive)]: true,\r\n        [Symbol(kSetKeepAliveInitialDelay)]: 60,\r\n        [Symbol(kBytesRead)]: 0,\r\n        [Symbol(kBytesWritten)]: 0\r\n      },\r\n      _consuming: false,\r\n      _dumped: false,\r\n      req: [Circular *1],\r\n      responseUrl: 'http://localhost:8000/api/v1/collections/AITA/count',\r\n      redirects: [],\r\n      [Symbol(kCapture)]: false,\r\n      [Symbol(kHeaders)]: {\r\n        date: 'Fri, 21 Apr 2023 14:33:00 GMT',\r\n        server: 'uvicorn',\r\n        'content-length': '49',\r\n        'content-type': 'application/json',\r\n        connection: 'close'\r\n      },\r\n      [Symbol(kHeadersCount)]: 10,\r\n      [Symbol(kTrailers)]: null,\r\n      [Symbol(kTrailersCount)]: 0\r\n    },\r\n    aborted: false,\r\n    timeoutCb: null,\r\n    upgradeOrConnect: false,\r\n    parser: null,\r\n    maxHeadersCount: null,\r\n    reusedSocket: false,\r\n    host: 'localhost',\r\n    protocol: 'http:',\r\n    _redirectable: Writable {\r\n      _writableState: WritableState {\r\n        objectMode: false,\r\n        highWaterMark: 16384,\r\n        finalCalled: false,\r\n        needDrain: false,\r\n        ending: false,\r\n        ended: false,\r\n        finished: false,\r\n        destroyed: false,\r\n        decodeStrings: true,\r\n        defaultEncoding: 'utf8',\r\n        length: 0,\r\n        writing: false,\r\n        corked: 0,\r\n        sync: true,\r\n        bufferProcessing: false,\r\n        onwrite: [Function: bound onwrite],\r\n        writecb: null,\r\n        writelen: 0,\r\n        afterWriteTickInfo: null,\r\n        buffered: [],\r\n        bufferedIndex: 0,\r\n        allBuffers: true,\r\n        allNoop: true,\r\n        pendingcb: 0,\r\n        constructed: true,\r\n        prefinished: false,\r\n        errorEmitted: false,\r\n        emitClose: true,\r\n        autoDestroy: true,\r\n        errored: null,\r\n        closed: false,\r\n        closeEmitted: false,\r\n        [Symbol(kOnFinished)]: []\r\n      },\r\n      _events: [Object: null prototype] {\r\n        response: [Function: handleResponse],\r\n        error: [Function: handleRequestError],\r\n        socket: [Function: handleRequestSocket]\r\n      },\r\n      _eventsCount: 3,\r\n      _maxListeners: undefined,\r\n      _options: {\r\n        maxRedirects: 21,\r\n        maxBodyLength: 10485760,\r\n        protocol: 'http:',\r\n        path: '/api/v1/collections/AITA/count',\r\n        method: 'GET',\r\n        headers: {\r\n          Accept: 'application/json, text/plain, */*',\r\n          'User-Agent': 'axios/0.26.1'\r\n        },\r\n        agent: undefined,\r\n        agents: { http: undefined, https: undefined },\r\n        auth: undefined,\r\n        hostname: 'localhost',\r\n        port: '8000',\r\n        nativeProtocols: {\r\n          'http:': {\r\n            _connectionListener: [Function: connectionListener],\r\n            METHODS: [Array],\r\n            STATUS_CODES: [Object],\r\n            Agent: [Function],\r\n            ClientRequest: [Function: ClientRequest],\r\n            IncomingMessage: [Function: IncomingMessage],\r\n            OutgoingMessage: [Function: OutgoingMessage],\r\n            Server: [Function: Server],\r\n            ServerResponse: [Function: ServerResponse],\r\n            createServer: [Function: createServer],\r\n            validateHeaderName: [Function: __node_internal_],\r\n            validateHeaderValue: [Function: __node_internal_],\r\n            get: [Function: get],\r\n            request: [Function: request],\r\n            setMaxIdleHTTPParsers: [Function: setMaxIdleHTTPParsers],\r\n            maxHeaderSize: [Getter],\r\n            globalAgent: [Getter/Setter]\r\n          },\r\n          'https:': {\r\n            Agent: [Function: Agent],\r\n            globalAgent: [Agent],\r\n            Server: [Function: Server],\r\n            createServer: [Function: createServer],\r\n            get: [Function: get],\r\n            request: [Function: request]\r\n          }\r\n        },\r\n        pathname: '/api/v1/collections/AITA/count'\r\n      },\r\n      _ended: true,\r\n      _ending: true,\r\n      _redirectCount: 0,\r\n      _redirects: [],\r\n      _requestBodyLength: 0,\r\n      _requestBodyBuffers: [],\r\n      _onNativeResponse: [Function (anonymous)],\r\n      _currentRequest: [Circular *1],\r\n      _currentUrl: 'http://localhost:8000/api/v1/collections/AITA/count',\r\n      [Symbol(kCapture)]: false\r\n    },\r\n    [Symbol(kCapture)]: false,\r\n    [Symbol(kBytesWritten)]: 0,\r\n    [Symbol(kEndCalled)]: true,\r\n    [Symbol(kNeedDrain)]: false,\r\n    [Symbol(corked)]: 0,\r\n    [Symbol(kOutHeaders)]: [Object: null prototype] {\r\n      accept: [ 'Accept', 'application/json, text/plain, */*' ],\r\n      'user-agent': [ 'User-Agent', 'axios/0.26.1' ],\r\n      host: [ 'Host', 'localhost:8000' ]\r\n    },\r\n    [Symbol(kUniqueHeaders)]: null\r\n  },\r\n  response: {\r\n    status: 500,\r\n    statusText: 'Internal Server Error',\r\n    headers: {\r\n      date: 'Fri, 21 Apr 2023 14:33:00 GMT',\r\n      server: 'uvicorn',\r\n      'content-length': '49',\r\n      'content-type': 'application/json',\r\n      connection: 'close'\r\n    },\r\n    config: {\r\n      transitional: {\r\n        silentJSONParsing: true,\r\n        forcedJSONParsing: true,\r\n        clarifyTimeoutError: false\r\n      },\r\n      adapter: [Function: httpAdapter],\r\n      transformRequest: [ [Function: transformRequest] ],\r\n      transformResponse: [ [Function: transformResponse] ],\r\n      timeout: 0,\r\n      xsrfCookieName: 'XSRF-TOKEN',\r\n      xsrfHeaderName: 'X-XSRF-TOKEN',\r\n      maxContentLength: -1,\r\n      maxBodyLength: -1,\r\n      validateStatus: [Function: validateStatus],\r\n      headers: {\r\n        Accept: 'application/json, text/plain, */*',\r\n        'User-Agent': 'axios/0.26.1'\r\n      },\r\n      method: 'get',\r\n      url: 'http://localhost:8000/api/v1/collections/AITA/count',\r\n      data: undefined\r\n    },\r\n    request: <ref *1> ClientRequest {\r\n      _events: [Object: null prototype] {\r\n        abort: [Function (anonymous)],\r\n        aborted: [Function (anonymous)],\r\n        connect: [Function (anonymous)],\r\n        error: [Function (anonymous)],\r\n        socket: [Function (anonymous)],\r\n        timeout: [Function (anonymous)],\r\n        finish: [Function: requestOnFinish]\r\n      },\r\n      _eventsCount: 7,\r\n      _maxListeners: undefined,\r\n      outputData: [],\r\n      outputSize: 0,\r\n      writable: true,\r\n      destroyed: false,\r\n      _last: true,\r\n      chunkedEncoding: false,\r\n      shouldKeepAlive: false,\r\n      maxRequestsOnConnectionReached: false,\r\n      _defaultKeepAlive: true,\r\n      useChunkedEncodingByDefault: false,\r\n      sendDate: false,\r\n      _removedConnection: false,\r\n      _removedContLen: false,\r\n      _removedTE: false,\r\n      strictContentLength: false,\r\n      _contentLength: 0,\r\n      _hasBody: true,\r\n      _trailer: '',\r\n      finished: true,\r\n      _headerSent: true,\r\n      _closed: false,\r\n      socket: <ref *2> Socket {\r\n        connecting: false,\r\n        _hadError: false,\r\n        _parent: null,\r\n        _host: 'localhost',\r\n        _closeAfterHandlingError: false,\r\n        _readableState: ReadableState {\r\n          objectMode: false,\r\n          highWaterMark: 16384,\r\n          buffer: BufferList { head: null, tail: null, length: 0 },\r\n          length: 0,\r\n          pipes: [],\r\n          flowing: true,\r\n          ended: false,\r\n          endEmitted: false,\r\n          reading: true,\r\n          constructed: true,\r\n          sync: false,\r\n          needReadable: true,\r\n          emittedReadable: false,\r\n          readableListening: false,\r\n          resumeScheduled: false,\r\n          errorEmitted: false,\r\n          emitClose: false,\r\n          autoDestroy: true,\r\n          destroyed: false,\r\n          errored: null,\r\n          closed: false,\r\n          closeEmitted: false,\r\n          defaultEncoding: 'utf8',\r\n          awaitDrainWriters: null,\r\n          multiAwaitDrain: false,\r\n          readingMore: false,\r\n          dataEmitted: true,\r\n          decoder: null,\r\n          encoding: null,\r\n          [Symbol(kPaused)]: false\r\n        },\r\n        _events: [Object: null prototype] {\r\n          end: [Function: onReadableStreamEnd],\r\n          free: [Function: onFree],\r\n          close: [ [Function: onClose], [Function: socketCloseListener] ],\r\n          timeout: [Function: onTimeout],\r\n          agentRemove: [Function: onRemove],\r\n          error: [Function: socketErrorListener],\r\n          finish: [Function: bound onceWrapper] {\r\n            listener: [Function: destroy]\r\n          }\r\n        },\r\n        _eventsCount: 7,\r\n        _maxListeners: undefined,\r\n        _writableState: WritableState {\r\n          objectMode: false,\r\n          highWaterMark: 16384,\r\n          finalCalled: true,\r\n          needDrain: false,\r\n          ending: true,\r\n          ended: true,\r\n          finished: false,\r\n          destroyed: false,\r\n          decodeStrings: false,\r\n          defaultEncoding: 'utf8',\r\n          length: 0,\r\n          writing: false,\r\n          corked: 0,\r\n          sync: false,\r\n          bufferProcessing: false,\r\n          onwrite: [Function: bound onwrite],\r\n          writecb: null,\r\n          writelen: 0,\r\n          afterWriteTickInfo: null,\r\n          buffered: [],\r\n          bufferedIndex: 0,\r\n          allBuffers: true,\r\n          allNoop: true,\r\n          pendingcb: 1,\r\n          constructed: true,\r\n          prefinished: false,\r\n          errorEmitted: false,\r\n          emitClose: false,\r\n          autoDestroy: true,\r\n          errored: null,\r\n          closed: false,\r\n          closeEmitted: false,\r\n          [Symbol(kOnFinished)]: []\r\n        },\r\n        allowHalfOpen: false,\r\n        _sockname: null,\r\n        _pendingData: null,\r\n        _pendingEncoding: '',\r\n        server: null,\r\n        _server: null,\r\n        parser: null,\r\n        _httpMessage: [Circular *1],\r\n        [Symbol(async_id_symbol)]: 628,\r\n        [Symbol(kHandle)]: TCP {\r\n          reading: true,\r\n          onconnection: null,\r\n          [Symbol(owner_symbol)]: [Circular *2]\r\n        },\r\n        [Symbol(lastWriteQueueSize)]: 0,\r\n        [Symbol(timeout)]: null,\r\n        [Symbol(kBuffer)]: null,\r\n        [Symbol(kBufferCb)]: null,\r\n        [Symbol(kBufferGen)]: null,\r\n        [Symbol(kCapture)]: false,\r\n        [Symbol(kSetNoDelay)]: true,\r\n        [Symbol(kSetKeepAlive)]: true,\r\n        [Symbol(kSetKeepAliveInitialDelay)]: 60,\r\n        [Symbol(kBytesRead)]: 0,\r\n        [Symbol(kBytesWritten)]: 0\r\n      },\r\n      _header: 'GET /api/v1/collections/AITA/count HTTP/1.1\\r\\n' +\r\n        'Accept: application/json, text/plain, */*\\r\\n' +\r\n        'User-Agent: axios/0.26.1\\r\\n' +\r\n        'Host: localhost:8000\\r\\n' +\r\n        'Connection: close\\r\\n' +\r\n        '\\r\\n',\r\n      _keepAliveTimeout: 0,\r\n      _onPendingData: [Function: nop],\r\n      agent: Agent {\r\n        _events: [Object: null prototype] {\r\n          free: [Function (anonymous)],\r\n          newListener: [Function: maybeEnableKeylog]\r\n        },\r\n        _eventsCount: 2,\r\n        _maxListeners: undefined,\r\n        defaultPort: 80,\r\n        protocol: 'http:',\r\n        options: [Object: null prototype] { noDelay: true, path: null },\r\n        requests: [Object: null prototype] {},\r\n        sockets: [Object: null prototype] { 'localhost:8000:': [ [Socket] ] },\r\n        freeSockets: [Object: null prototype] {},\r\n        keepAliveMsecs: 1000,\r\n        keepAlive: false,\r\n        maxSockets: Infinity,\r\n        maxFreeSockets: 256,\r\n        scheduling: 'lifo',\r\n        maxTotalSockets: Infinity,\r\n        totalSocketCount: 1,\r\n        [Symbol(kCapture)]: false\r\n      },\r\n      socketPath: undefined,\r\n      method: 'GET',\r\n      maxHeaderSize: undefined,\r\n      insecureHTTPParser: undefined,\r\n      path: '/api/v1/collections/AITA/count',\r\n      _ended: true,\r\n      res: IncomingMessage {\r\n        _readableState: ReadableState {\r\n          objectMode: false,\r\n          highWaterMark: 16384,\r\n          buffer: BufferList { head: null, tail: null, length: 0 },\r\n          length: 0,\r\n          pipes: [],\r\n          flowing: true,\r\n          ended: true,\r\n          endEmitted: true,\r\n          reading: false,\r\n          constructed: true,\r\n          sync: true,\r\n          needReadable: false,\r\n          emittedReadable: false,\r\n          readableListening: false,\r\n          resumeScheduled: false,\r\n          errorEmitted: false,\r\n          emitClose: true,\r\n          autoDestroy: true,\r\n          destroyed: true,\r\n          errored: null,\r\n          closed: true,\r\n          closeEmitted: true,\r\n          defaultEncoding: 'utf8',\r\n          awaitDrainWriters: null,\r\n          multiAwaitDrain: false,\r\n          readingMore: true,\r\n          dataEmitted: true,\r\n          decoder: null,\r\n          encoding: null,\r\n          [Symbol(kPaused)]: false\r\n        },\r\n        _events: [Object: null prototype] {\r\n          end: [ [Function: responseOnEnd], [Function: handleStreamEnd] ],\r\n          data: [Function: handleStreamData],\r\n          aborted: [Function: handlerStreamAborted],\r\n          error: [Function: handleStreamError]\r\n        },\r\n        _eventsCount: 4,\r\n        _maxListeners: undefined,\r\n        socket: <ref *2> Socket {\r\n          connecting: false,\r\n          _hadError: false,\r\n          _parent: null,\r\n          _host: 'localhost',\r\n          _closeAfterHandlingError: false,\r\n          _readableState: ReadableState {\r\n            objectMode: false,\r\n            highWaterMark: 16384,\r\n            buffer: [BufferList],\r\n            length: 0,\r\n            pipes: [],\r\n            flowing: true,\r\n            ended: false,\r\n            endEmitted: false,\r\n            reading: true,\r\n            constructed: true,\r\n            sync: false,\r\n            needReadable: true,\r\n            emittedReadable: false,\r\n            readableListening: false,\r\n            resumeScheduled: false,\r\n            errorEmitted: false,\r\n            emitClose: false,\r\n            autoDestroy: true,\r\n            destroyed: false,\r\n            errored: null,\r\n            closed: false,\r\n            closeEmitted: false,\r\n            defaultEncoding: 'utf8',\r\n            awaitDrainWriters: null,\r\n            multiAwaitDrain: false,\r\n            readingMore: false,\r\n            dataEmitted: true,\r\n            decoder: null,\r\n            encoding: null,\r\n            [Symbol(kPaused)]: false\r\n          },\r\n          _events: [Object: null prototype] {\r\n            end: [Function: onReadableStreamEnd],\r\n            free: [Function: onFree],\r\n            close: [Array],\r\n            timeout: [Function: onTimeout],\r\n            agentRemove: [Function: onRemove],\r\n            error: [Function: socketErrorListener],\r\n            finish: [Function]\r\n          },\r\n          _eventsCount: 7,\r\n          _maxListeners: undefined,\r\n          _writableState: WritableState {\r\n            objectMode: false,\r\n            highWaterMark: 16384,\r\n            finalCalled: true,\r\n            needDrain: false,\r\n            ending: true,\r\n            ended: true,\r\n            finished: false,\r\n            destroyed: false,\r\n            decodeStrings: false,\r\n            defaultEncoding: 'utf8',\r\n            length: 0,\r\n            writing: false,\r\n            corked: 0,\r\n            sync: false,\r\n            bufferProcessing: false,\r\n            onwrite: [Function: bound onwrite],\r\n            writecb: null,\r\n            writelen: 0,\r\n            afterWriteTickInfo: null,\r\n            buffered: [],\r\n            bufferedIndex: 0,\r\n            allBuffers: true,\r\n            allNoop: true,\r\n            pendingcb: 1,\r\n            constructed: true,\r\n            prefinished: false,\r\n            errorEmitted: false,\r\n            emitClose: false,\r\n            autoDestroy: true,\r\n            errored: null,\r\n            closed: false,\r\n            closeEmitted: false,\r\n            [Symbol(kOnFinished)]: []\r\n          },\r\n          allowHalfOpen: false,\r\n          _sockname: null,\r\n          _pendingData: null,\r\n          _pendingEncoding: '',\r\n          server: null,\r\n          _server: null,\r\n          parser: null,\r\n          _httpMessage: [Circular *1],\r\n          [Symbol(async_id_symbol)]: 628,\r\n          [Symbol(kHandle)]: TCP {\r\n            reading: true,\r\n            onconnection: null,\r\n            [Symbol(owner_symbol)]: [Circular *2]\r\n          },\r\n          [Symbol(lastWriteQueueSize)]: 0,\r\n          [Symbol(timeout)]: null,\r\n          [Symbol(kBuffer)]: null,\r\n          [Symbol(kBufferCb)]: null,\r\n          [Symbol(kBufferGen)]: null,\r\n          [Symbol(kCapture)]: false,\r\n          [Symbol(kSetNoDelay)]: true,\r\n          [Symbol(kSetKeepAlive)]: true,\r\n          [Symbol(kSetKeepAliveInitialDelay)]: 60,\r\n          [Symbol(kBytesRead)]: 0,\r\n          [Symbol(kBytesWritten)]: 0\r\n        },\r\n        httpVersionMajor: 1,\r\n        httpVersionMinor: 1,\r\n        httpVersion: '1.1',\r\n        complete: true,\r\n        rawHeaders: [\r\n          'date',\r\n          'Fri, 21 Apr 2023 14:33:00 GMT',\r\n          'server',\r\n          'uvicorn',\r\n          'content-length',\r\n          '49',\r\n          'content-type',\r\n          'application/json',\r\n          'connection',\r\n          'close'\r\n        ],\r\n        rawTrailers: [],\r\n        aborted: false,\r\n        upgrade: false,\r\n        url: '',\r\n        method: null,\r\n        statusCode: 500,\r\n        statusMessage: 'Internal Server Error',\r\n        client: <ref *2> Socket {\r\n          connecting: false,\r\n          _hadError: false,\r\n          _parent: null,\r\n          _host: 'localhost',\r\n          _closeAfterHandlingError: false,\r\n          _readableState: ReadableState {\r\n            objectMode: false,\r\n            highWaterMark: 16384,\r\n            buffer: [BufferList],\r\n            length: 0,\r\n            pipes: [],\r\n            flowing: true,\r\n            ended: false,\r\n            endEmitted: false,\r\n            reading: true,\r\n            constructed: true,\r\n            sync: false,\r\n            needReadable: true,\r\n            emittedReadable: false,\r\n            readableListening: false,\r\n            resumeScheduled: false,\r\n            errorEmitted: false,\r\n            emitClose: false,\r\n            autoDestroy: true,\r\n            destroyed: false,\r\n            errored: null,\r\n            closed: false,\r\n            closeEmitted: false,\r\n            defaultEncoding: 'utf8',\r\n            awaitDrainWriters: null,\r\n            multiAwaitDrain: false,\r\n            readingMore: false,\r\n            dataEmitted: true,\r\n            decoder: null,\r\n            encoding: null,\r\n            [Symbol(kPaused)]: false\r\n          },\r\n          _events: [Object: null prototype] {\r\n            end: [Function: onReadableStreamEnd],\r\n            free: [Function: onFree],\r\n            close: [Array],\r\n            timeout: [Function: onTimeout],\r\n            agentRemove: [Function: onRemove],\r\n            error: [Function: socketErrorListener],\r\n            finish: [Function]\r\n          },\r\n          _eventsCount: 7,\r\n          _maxListeners: undefined,\r\n          _writableState: WritableState {\r\n            objectMode: false,\r\n            highWaterMark: 16384,\r\n            finalCalled: true,\r\n            needDrain: false,\r\n            ending: true,\r\n            ended: true,\r\n            finished: false,\r\n            destroyed: false,\r\n            decodeStrings: false,\r\n            defaultEncoding: 'utf8',\r\n            length: 0,\r\n            writing: false,\r\n            corked: 0,\r\n            sync: false,\r\n            bufferProcessing: false,\r\n            onwrite: [Function: bound onwrite],\r\n            writecb: null,\r\n            writelen: 0,\r\n            afterWriteTickInfo: null,\r\n            buffered: [],\r\n            bufferedIndex: 0,\r\n            allBuffers: true,\r\n            allNoop: true,\r\n            pendingcb: 1,\r\n            constructed: true,\r\n            prefinished: false,\r\n            errorEmitted: false,\r\n            emitClose: false,\r\n            autoDestroy: true,\r\n            errored: null,\r\n            closed: false,\r\n            closeEmitted: false,\r\n            [Symbol(kOnFinished)]: []\r\n          },\r\n          allowHalfOpen: false,\r\n          _sockname: null,\r\n          _pendingData: null,\r\n          _pendingEncoding: '',\r\n          server: null,\r\n          _server: null,\r\n          parser: null,\r\n          _httpMessage: [Circular *1],\r\n          [Symbol(async_id_symbol)]: 628,\r\n          [Symbol(kHandle)]: TCP {\r\n            reading: true,\r\n            onconnection: null,\r\n            [Symbol(owner_symbol)]: [Circular *2]\r\n          },\r\n          [Symbol(lastWriteQueueSize)]: 0,\r\n          [Symbol(timeout)]: null,\r\n          [Symbol(kBuffer)]: null,\r\n          [Symbol(kBufferCb)]: null,\r\n          [Symbol(kBufferGen)]: null,\r\n          [Symbol(kCapture)]: false,\r\n          [Symbol(kSetNoDelay)]: true,\r\n          [Symbol(kSetKeepAlive)]: true,\r\n          [Symbol(kSetKeepAliveInitialDelay)]: 60,\r\n          [Symbol(kBytesRead)]: 0,\r\n          [Symbol(kBytesWritten)]: 0\r\n        },\r\n        _consuming: false,\r\n        _dumped: false,\r\n        req: [Circular *1],\r\n        responseUrl: 'http://localhost:8000/api/v1/collections/AITA/count',\r\n        redirects: [],\r\n        [Symbol(kCapture)]: false,\r\n        [Symbol(kHeaders)]: {\r\n          date: 'Fri, 21 Apr 2023 14:33:00 GMT',\r\n          server: 'uvicorn',\r\n          'content-length': '49',\r\n          'content-type': 'application/json',\r\n          connection: 'close'\r\n        },\r\n        [Symbol(kHeadersCount)]: 10,\r\n        [Symbol(kTrailers)]: null,\r\n        [Symbol(kTrailersCount)]: 0\r\n      },\r\n      aborted: false,\r\n      timeoutCb: null,\r\n      upgradeOrConnect: false,\r\n      parser: null,\r\n      maxHeadersCount: null,\r\n      reusedSocket: false,\r\n      host: 'localhost',\r\n      protocol: 'http:',\r\n      _redirectable: Writable {\r\n        _writableState: WritableState {\r\n          objectMode: false,\r\n          highWaterMark: 16384,\r\n          finalCalled: false,\r\n          needDrain: false,\r\n          ending: false,\r\n          ended: false,\r\n          finished: false,\r\n          destroyed: false,\r\n          decodeStrings: true,\r\n          defaultEncoding: 'utf8',\r\n          length: 0,\r\n          writing: false,\r\n          corked: 0,\r\n          sync: true,\r\n          bufferProcessing: false,\r\n          onwrite: [Function: bound onwrite],\r\n          writecb: null,\r\n          writelen: 0,\r\n          afterWriteTickInfo: null,\r\n          buffered: [],\r\n          bufferedIndex: 0,\r\n          allBuffers: true,\r\n          allNoop: true,\r\n          pendingcb: 0,\r\n          constructed: true,\r\n          prefinished: false,\r\n          errorEmitted: false,\r\n          emitClose: true,\r\n          autoDestroy: true,\r\n          errored: null,\r\n          closed: false,\r\n          closeEmitted: false,\r\n          [Symbol(kOnFinished)]: []\r\n        },\r\n        _events: [Object: null prototype] {\r\n          response: [Function: handleResponse],\r\n          error: [Function: handleRequestError],\r\n          socket: [Function: handleRequestSocket]\r\n        },\r\n        _eventsCount: 3,\r\n        _maxListeners: undefined,\r\n        _options: {\r\n          maxRedirects: 21,\r\n          maxBodyLength: 10485760,\r\n          protocol: 'http:',\r\n          path: '/api/v1/collections/AITA/count',\r\n          method: 'GET',\r\n          headers: {\r\n            Accept: 'application/json, text/plain, */*',\r\n            'User-Agent': 'axios/0.26.1'\r\n          },\r\n          agent: undefined,\r\n          agents: { http: undefined, https: undefined },\r\n          auth: undefined,\r\n          hostname: 'localhost',\r\n          port: '8000',\r\n          nativeProtocols: { 'http:': [Object], 'https:': [Object] },\r\n          pathname: '/api/v1/collections/AITA/count'\r\n        },\r\n        _ended: true,\r\n        _ending: true,\r\n        _redirectCount: 0,\r\n        _redirects: [],\r\n        _requestBodyLength: 0,\r\n        _requestBodyBuffers: [],\r\n        _onNativeResponse: [Function (anonymous)],\r\n        _currentRequest: [Circular *1],\r\n        _currentUrl: 'http://localhost:8000/api/v1/collections/AITA/count',\r\n        [Symbol(kCapture)]: false\r\n      },\r\n      [Symbol(kCapture)]: false,\r\n      [Symbol(kBytesWritten)]: 0,\r\n      [Symbol(kEndCalled)]: true,\r\n      [Symbol(kNeedDrain)]: false,\r\n      [Symbol(corked)]: 0,\r\n      [Symbol(kOutHeaders)]: [Object: null prototype] {\r\n        accept: [ 'Accept', 'application/json, text/plain, */*' ],\r\n        'user-agent': [ 'User-Agent', 'axios/0.26.1' ],\r\n        host: [ 'Host', 'localhost:8000' ]\r\n      },\r\n      [Symbol(kUniqueHeaders)]: null\r\n    },\r\n    data: { error: \"IndexError('list index out of range')\" }\r\n  },\r\n  isAxiosError: true,\r\n  toJSON: [Function: toJSON]\r\n}\n```\n", "closed_by": {"login": "jeffchuber", "id": 891664, "node_id": "MDQ6VXNlcjg5MTY2NA==", "avatar_url": "https://avatars.githubusercontent.com/u/891664?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jeffchuber", "html_url": "https://github.com/jeffchuber", "followers_url": "https://api.github.com/users/jeffchuber/followers", "following_url": "https://api.github.com/users/jeffchuber/following{/other_user}", "gists_url": "https://api.github.com/users/jeffchuber/gists{/gist_id}", "starred_url": "https://api.github.com/users/jeffchuber/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jeffchuber/subscriptions", "organizations_url": "https://api.github.com/users/jeffchuber/orgs", "repos_url": "https://api.github.com/users/jeffchuber/repos", "events_url": "https://api.github.com/users/jeffchuber/events{/privacy}", "received_events_url": "https://api.github.com/users/jeffchuber/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/chroma-core/chroma/issues/405/reactions", "total_count": 1, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 1, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/chroma-core/chroma/issues/405/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/chroma-core/chroma/issues/3297", "repository_url": "https://api.github.com/repos/chroma-core/chroma", "labels_url": "https://api.github.com/repos/chroma-core/chroma/issues/3297/labels{/name}", "comments_url": "https://api.github.com/repos/chroma-core/chroma/issues/3297/comments", "events_url": "https://api.github.com/repos/chroma-core/chroma/issues/3297/events", "html_url": "https://github.com/chroma-core/chroma/pull/3297", "id": 2738763916, "node_id": "PR_kwDOII5zmM6FKony", "number": 3297, "title": "[BUG]: Delete collection resource leak (single-node Chroma)", "user": {"login": "tazarov", "id": 1157440, "node_id": "MDQ6VXNlcjExNTc0NDA=", "avatar_url": "https://avatars.githubusercontent.com/u/1157440?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tazarov", "html_url": "https://github.com/tazarov", "followers_url": "https://api.github.com/users/tazarov/followers", "following_url": "https://api.github.com/users/tazarov/following{/other_user}", "gists_url": "https://api.github.com/users/tazarov/gists{/gist_id}", "starred_url": "https://api.github.com/users/tazarov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tazarov/subscriptions", "organizations_url": "https://api.github.com/users/tazarov/orgs", "repos_url": "https://api.github.com/users/tazarov/repos", "events_url": "https://api.github.com/users/tazarov/events{/privacy}", "received_events_url": "https://api.github.com/users/tazarov/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 4620187878, "node_id": "LA_kwDOII5zmM8AAAABE2J45g", "url": "https://api.github.com/repos/chroma-core/chroma/labels/bug", "name": "bug", "color": "E99695", "default": true, "description": "Something isn't working"}, {"id": 5776098610, "node_id": "LA_kwDOII5zmM8AAAABWEhFMg", "url": "https://api.github.com/repos/chroma-core/chroma/labels/Local%20Chroma", "name": "Local Chroma", "color": "c2e0c6", "default": false, "description": "An improvement to Local (single node) Chroma"}], "state": "closed", "locked": false, "assignees": [{"login": "rohitcpbot", "id": 180123077, "node_id": "U_kgDOCrx1xQ", "avatar_url": "https://avatars.githubusercontent.com/u/180123077?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rohitcpbot", "html_url": "https://github.com/rohitcpbot", "followers_url": "https://api.github.com/users/rohitcpbot/followers", "following_url": "https://api.github.com/users/rohitcpbot/following{/other_user}", "gists_url": "https://api.github.com/users/rohitcpbot/gists{/gist_id}", "starred_url": "https://api.github.com/users/rohitcpbot/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rohitcpbot/subscriptions", "organizations_url": "https://api.github.com/users/rohitcpbot/orgs", "repos_url": "https://api.github.com/users/rohitcpbot/repos", "events_url": "https://api.github.com/users/rohitcpbot/events{/privacy}", "received_events_url": "https://api.github.com/users/rohitcpbot/received_events", "type": "User", "user_view_type": "public", "site_admin": false}], "milestone": null, "comments": 7, "created_at": "2024-12-13T16:30:55Z", "updated_at": "2025-02-11T14:49:50Z", "closed_at": "2025-02-11T14:49:50Z", "assignee": {"login": "rohitcpbot", "id": 180123077, "node_id": "U_kgDOCrx1xQ", "avatar_url": "https://avatars.githubusercontent.com/u/180123077?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rohitcpbot", "html_url": "https://github.com/rohitcpbot", "followers_url": "https://api.github.com/users/rohitcpbot/followers", "following_url": "https://api.github.com/users/rohitcpbot/following{/other_user}", "gists_url": "https://api.github.com/users/rohitcpbot/gists{/gist_id}", "starred_url": "https://api.github.com/users/rohitcpbot/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rohitcpbot/subscriptions", "organizations_url": "https://api.github.com/users/rohitcpbot/orgs", "repos_url": "https://api.github.com/users/rohitcpbot/repos", "events_url": "https://api.github.com/users/rohitcpbot/events{/privacy}", "received_events_url": "https://api.github.com/users/rohitcpbot/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "author_association": "CONTRIBUTOR", "type": null, "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/chroma-core/chroma/pulls/3297", "html_url": "https://github.com/chroma-core/chroma/pull/3297", "diff_url": "https://github.com/chroma-core/chroma/pull/3297.diff", "patch_url": "https://github.com/chroma-core/chroma/pull/3297.patch", "merged_at": "2025-02-11T14:49:50Z"}, "body": "## Description of changes\r\n\r\nCloses #3296\r\n\r\nThe delete collection logic slightly changes to accomodate the fix without breaking the transactional integrity of `self._sysdb.delete_collection`. The `chromadb.segment.SegmentManager.delete_segments` had to change to accept the list of segments to delete instead of `collection_id`.\r\n\r\n![image](https://github.com/user-attachments/assets/54dd30cf-8106-406f-a020-f53badf4dcf3)\r\n\r\n\r\n\r\n*Summarize the changes made by this PR.*\r\n - Improvements & Bug fixes\r\n   - Fixes the resource leak when deleting a collection\r\n\r\n\r\n\r\n## Test plan\r\n*How are these changes tested?*\r\n\r\n- [x] Tests pass locally with `pytest` for python, `yarn test` for js, `cargo test` for rust\r\n\r\n## Documentation Changes\r\nN/A\r\n", "closed_by": {"login": "tazarov", "id": 1157440, "node_id": "MDQ6VXNlcjExNTc0NDA=", "avatar_url": "https://avatars.githubusercontent.com/u/1157440?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tazarov", "html_url": "https://github.com/tazarov", "followers_url": "https://api.github.com/users/tazarov/followers", "following_url": "https://api.github.com/users/tazarov/following{/other_user}", "gists_url": "https://api.github.com/users/tazarov/gists{/gist_id}", "starred_url": "https://api.github.com/users/tazarov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tazarov/subscriptions", "organizations_url": "https://api.github.com/users/tazarov/orgs", "repos_url": "https://api.github.com/users/tazarov/repos", "events_url": "https://api.github.com/users/tazarov/events{/privacy}", "received_events_url": "https://api.github.com/users/tazarov/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/chroma-core/chroma/issues/3297/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/chroma-core/chroma/issues/3297/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/chroma-core/chroma/issues/870", "repository_url": "https://api.github.com/repos/chroma-core/chroma", "labels_url": "https://api.github.com/repos/chroma-core/chroma/issues/870/labels{/name}", "comments_url": "https://api.github.com/repos/chroma-core/chroma/issues/870/comments", "events_url": "https://api.github.com/repos/chroma-core/chroma/issues/870/events", "html_url": "https://github.com/chroma-core/chroma/issues/870", "id": 1817975029, "node_id": "I_kwDOII5zmM5sXBj1", "number": 870, "title": "[Bug]: Re-inserting records leads to log messages on every subsequent operation", "user": {"login": "mattpovey", "id": 4473194, "node_id": "MDQ6VXNlcjQ0NzMxOTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/4473194?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mattpovey", "html_url": "https://github.com/mattpovey", "followers_url": "https://api.github.com/users/mattpovey/followers", "following_url": "https://api.github.com/users/mattpovey/following{/other_user}", "gists_url": "https://api.github.com/users/mattpovey/gists{/gist_id}", "starred_url": "https://api.github.com/users/mattpovey/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mattpovey/subscriptions", "organizations_url": "https://api.github.com/users/mattpovey/orgs", "repos_url": "https://api.github.com/users/mattpovey/repos", "events_url": "https://api.github.com/users/mattpovey/events{/privacy}", "received_events_url": "https://api.github.com/users/mattpovey/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 4620187878, "node_id": "LA_kwDOII5zmM8AAAABE2J45g", "url": "https://api.github.com/repos/chroma-core/chroma/labels/bug", "name": "bug", "color": "E99695", "default": true, "description": "Something isn't working"}, {"id": 6434397431, "node_id": "LA_kwDOII5zmM8AAAABf4Uc9w", "url": "https://api.github.com/repos/chroma-core/chroma/labels/taz-sprint-4", "name": "taz-sprint-4", "color": "44E027", "default": false, "description": ""}], "state": "closed", "locked": false, "assignees": [{"login": "tazarov", "id": 1157440, "node_id": "MDQ6VXNlcjExNTc0NDA=", "avatar_url": "https://avatars.githubusercontent.com/u/1157440?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tazarov", "html_url": "https://github.com/tazarov", "followers_url": "https://api.github.com/users/tazarov/followers", "following_url": "https://api.github.com/users/tazarov/following{/other_user}", "gists_url": "https://api.github.com/users/tazarov/gists{/gist_id}", "starred_url": "https://api.github.com/users/tazarov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tazarov/subscriptions", "organizations_url": "https://api.github.com/users/tazarov/orgs", "repos_url": "https://api.github.com/users/tazarov/repos", "events_url": "https://api.github.com/users/tazarov/events{/privacy}", "received_events_url": "https://api.github.com/users/tazarov/received_events", "type": "User", "user_view_type": "public", "site_admin": false}], "milestone": null, "comments": 18, "created_at": "2023-07-24T09:06:42Z", "updated_at": "2025-03-19T03:33:02Z", "closed_at": "2024-12-30T05:07:02Z", "assignee": {"login": "tazarov", "id": 1157440, "node_id": "MDQ6VXNlcjExNTc0NDA=", "avatar_url": "https://avatars.githubusercontent.com/u/1157440?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tazarov", "html_url": "https://github.com/tazarov", "followers_url": "https://api.github.com/users/tazarov/followers", "following_url": "https://api.github.com/users/tazarov/following{/other_user}", "gists_url": "https://api.github.com/users/tazarov/gists{/gist_id}", "starred_url": "https://api.github.com/users/tazarov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tazarov/subscriptions", "organizations_url": "https://api.github.com/users/tazarov/orgs", "repos_url": "https://api.github.com/users/tazarov/repos", "events_url": "https://api.github.com/users/tazarov/events{/privacy}", "received_events_url": "https://api.github.com/users/tazarov/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### What happened?\n\nReinserting records without embeddings (i.e. requiring Chromadb to generate the embeddings) causes them to be held in the `embeddings_queue` table of chromadb.sqlite3. On every subsequent operation, log messages are presented as chroma (presumably) attempts to insert the already existing records:\r\n\r\n```\r\nAdd of existing embedding ID: 21\r\nInsert of existing embedding ID: 21\r\n```\r\n\r\nTo replicate, attempt to re-insert a record keeping the id, documents and metadata identical. If done n times (e.g. via a broken loop that increments record numbers incorrectly, which is how I did it), the row is added n times to the embeddings_queue table.\r\n\r\nThe issue is easily worked-around by deleting the records from embeddings_queue:\r\n\r\n```# Drop everything in the embeddings_queue table\r\ncur.execute(\"DELETE FROM embeddings_queue;\")\r\nconn.commit()\r\n```\r\n\r\nThe records appear to be added to the table in this file, https://github.com/chroma-core/chroma/blob/3ed229ccb9280ca2569525bf65f4bc218c36a745/chromadb/db/mixins/embeddings_queue.py#L88 \r\n\r\nThe warnings are raised in:\r\n\r\nhttps://github.com/chroma-core/chroma/blob/3ed229ccb9280ca2569525bf65f4bc218c36a745/chromadb/segment/impl/vector/local_hnsw.py#L303\r\n\r\nand \r\n\r\nhttps://github.com/chroma-core/chroma/blob/3ed229ccb9280ca2569525bf65f4bc218c36a745/chromadb/segment/impl/metadata/sqlite.py#L216\r\n\r\nand \r\n\r\nhttps://github.com/chroma-core/chroma/blob/3ed229ccb9280ca2569525bf65f4bc218c36a745/chromadb/segment/impl/vector/local_persistent_hnsw.py#L242\r\n\r\nIf there are data-loss risks associated with just dropping the duplicate queue entries, perhaps add an explanation of how to delete the offending records to the warnings?\r\n\n\n### Versions\n\nChroma v0.4.2 MacOS Ventura.\n\n### Relevant log output\n\n```shell\nRECEIVED WHEN QUERYING ETC.\r\n\r\nAdd of existing embedding ID: 1\r\nAdd of existing embedding ID: 2\r\nAdd of existing embedding ID: 3\r\nAdd of existing embedding ID: 4\r\nAdd of existing embedding ID: 5\r\nAdd of existing embedding ID: 6\r\nAdd of existing embedding ID: 7\r\nAdd of existing embedding ID: 8\r\nAdd of existing embedding ID: 9\r\nAdd of existing embedding ID: 10\r\nAdd of existing embedding ID: 11\r\nAdd of existing embedding ID: 12\r\nAdd of existing embedding ID: 13\r\nAdd of existing embedding ID: 14\r\nAdd of existing embedding ID: 15\r\nAdd of existing embedding ID: 16\r\nAdd of existing embedding ID: 17\r\nAdd of existing embedding ID: 18\r\nAdd of existing embedding ID: 19\r\nAdd of existing embedding ID: 20\r\nAdd of existing embedding ID: 21\r\nAdd of existing embedding ID: 22\r\nAdd of existing embedding ID: 23\r\nAdd of existing embedding ID: 24\r\nAdd of existing embedding ID: 25\r\nAdd of existing embedding ID: 26\r\nAdd of existing embedding ID: 27\r\nAdd of existing embedding ID: 28\r\nAdd of existing embedding ID: 29\r\nAdd of existing embedding ID: 30\r\nAdd of existing embedding ID: 31\r\nAdd of existing embedding ID: 32\r\nAdd of existing embedding ID: 33\r\nAdd of existing embedding ID: 34\r\nAdd of existing embedding ID: 35\r\nAdd of existing embedding ID: 36\r\nAdd of existing embedding ID: 37\r\nAdd of existing embedding ID: 38\r\nAdd of existing embedding ID: 39\r\nAdd of existing embedding ID: 40\r\nAdd of existing embedding ID: 41\r\nAdd of existing embedding ID: 42\r\nAdd of existing embedding ID: 43\r\nAdd of existing embedding ID: 44\r\nAdd of existing embedding ID: 45\r\nAdd of existing embedding ID: 46\r\nAdd of existing embedding ID: 47\r\nAdd of existing embedding ID: 48\r\nAdd of existing embedding ID: 49\r\nAdd of existing embedding ID: 50\r\nAdd of existing embedding ID: 51\r\n\r\nRECEIVED DURING THE ADD OPERATION WHICH CAUSED THE PROBLEM:\r\n\r\nAdd of existing embedding ID: 1\r\nInsert of existing embedding ID: 1\r\nAdd of existing embedding ID: 2\r\nInsert of existing embedding ID: 2\r\nAdd of existing embedding ID: 3\r\nInsert of existing embedding ID: 3\r\nAdd of existing embedding ID: 4\r\nInsert of existing embedding ID: 4\r\nAdd of existing embedding ID: 5\r\nInsert of existing embedding ID: 5\r\nAdd of existing embedding ID: 6\r\nInsert of existing embedding ID: 6\r\nAdd of existing embedding ID: 7\r\nInsert of existing embedding ID: 7\r\nAdd of existing embedding ID: 8\r\nInsert of existing embedding ID: 8\r\nAdd of existing embedding ID: 9\r\nInsert of existing embedding ID: 9\r\nAdd of existing embedding ID: 10\r\nInsert of existing embedding ID: 10\r\nAdd of existing embedding ID: 11\r\nInsert of existing embedding ID: 11\r\nAdd of existing embedding ID: 12\r\nInsert of existing embedding ID: 12\r\nAdd of existing embedding ID: 13\r\nInsert of existing embedding ID: 13\r\nAdd of existing embedding ID: 14\r\nInsert of existing embedding ID: 14\r\nAdd of existing embedding ID: 15\r\nInsert of existing embedding ID: 15\r\nAdd of existing embedding ID: 16\r\nInsert of existing embedding ID: 16\r\nAdd of existing embedding ID: 17\r\nInsert of existing embedding ID: 17\r\nAdd of existing embedding ID: 18\r\nInsert of existing embedding ID: 18\r\nAdd of existing embedding ID: 19\r\nInsert of existing embedding ID: 19\r\nAdd of existing embedding ID: 20\r\nInsert of existing embedding ID: 20\r\nAdd of existing embedding ID: 21\r\nInsert of existing embedding ID: 21\r\nAdd of existing embedding ID: 22\r\nInsert of existing embedding ID: 22\r\nAdd of existing embedding ID: 23\r\nInsert of existing embedding ID: 23\r\nAdd of existing embedding ID: 24\r\nInsert of existing embedding ID: 24\r\nAdd of existing embedding ID: 25\r\nInsert of existing embedding ID: 25\r\nAdd of existing embedding ID: 26\r\nInsert of existing embedding ID: 26\r\nAdd of existing embedding ID: 27\r\nInsert of existing embedding ID: 27\r\nAdd of existing embedding ID: 28\r\nInsert of existing embedding ID: 28\r\nAdd of existing embedding ID: 29\r\nInsert of existing embedding ID: 29\r\nAdd of existing embedding ID: 30\r\nInsert of existing embedding ID: 30\r\nAdd of existing embedding ID: 31\r\nInsert of existing embedding ID: 31\r\nAdd of existing embedding ID: 32\r\nInsert of existing embedding ID: 32\r\nAdd of existing embedding ID: 33\r\nInsert of existing embedding ID: 33\r\nAdd of existing embedding ID: 34\r\nInsert of existing embedding ID: 34\r\nAdd of existing embedding ID: 35\r\nInsert of existing embedding ID: 35\r\nAdd of existing embedding ID: 36\r\nInsert of existing embedding ID: 36\r\nAdd of existing embedding ID: 37\r\nInsert of existing embedding ID: 37\n```\n", "closed_by": {"login": "itaismith", "id": 42597089, "node_id": "MDQ6VXNlcjQyNTk3MDg5", "avatar_url": "https://avatars.githubusercontent.com/u/42597089?v=4", "gravatar_id": "", "url": "https://api.github.com/users/itaismith", "html_url": "https://github.com/itaismith", "followers_url": "https://api.github.com/users/itaismith/followers", "following_url": "https://api.github.com/users/itaismith/following{/other_user}", "gists_url": "https://api.github.com/users/itaismith/gists{/gist_id}", "starred_url": "https://api.github.com/users/itaismith/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/itaismith/subscriptions", "organizations_url": "https://api.github.com/users/itaismith/orgs", "repos_url": "https://api.github.com/users/itaismith/repos", "events_url": "https://api.github.com/users/itaismith/events{/privacy}", "received_events_url": "https://api.github.com/users/itaismith/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/chroma-core/chroma/issues/870/reactions", "total_count": 8, "+1": 8, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/chroma-core/chroma/issues/870/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/chroma-core/chroma/issues/364", "repository_url": "https://api.github.com/repos/chroma-core/chroma", "labels_url": "https://api.github.com/repos/chroma-core/chroma/issues/364/labels{/name}", "comments_url": "https://api.github.com/repos/chroma-core/chroma/issues/364/comments", "events_url": "https://api.github.com/repos/chroma-core/chroma/issues/364/events", "html_url": "https://github.com/chroma-core/chroma/issues/364", "id": 1670139633, "node_id": "I_kwDOII5zmM5jjE7x", "number": 364, "title": "[Bug]: AttributeError: 'NoneType' object has no attribute 'info'", "user": {"login": "deadbits", "id": 1332757, "node_id": "MDQ6VXNlcjEzMzI3NTc=", "avatar_url": "https://avatars.githubusercontent.com/u/1332757?v=4", "gravatar_id": "", "url": "https://api.github.com/users/deadbits", "html_url": "https://github.com/deadbits", "followers_url": "https://api.github.com/users/deadbits/followers", "following_url": "https://api.github.com/users/deadbits/following{/other_user}", "gists_url": "https://api.github.com/users/deadbits/gists{/gist_id}", "starred_url": "https://api.github.com/users/deadbits/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/deadbits/subscriptions", "organizations_url": "https://api.github.com/users/deadbits/orgs", "repos_url": "https://api.github.com/users/deadbits/repos", "events_url": "https://api.github.com/users/deadbits/events{/privacy}", "received_events_url": "https://api.github.com/users/deadbits/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 4620187878, "node_id": "LA_kwDOII5zmM8AAAABE2J45g", "url": "https://api.github.com/repos/chroma-core/chroma/labels/bug", "name": "bug", "color": "E99695", "default": true, "description": "Something isn't working"}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 18, "created_at": "2023-04-16T21:02:48Z", "updated_at": "2023-05-31T04:57:35Z", "closed_at": "2023-05-08T17:34:26Z", "assignee": null, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### What happened?\n\nI have a simple class that creates/connects to a persistent Chroma index, along with add and search functions. When I call this class I am get the following error from the duckdb.py library every time:\r\n\r\n```\r\nException ignored in: <function PersistentDuckDB.__del__ at 0x7fe22f7f2710>\r\nTraceback (most recent call last):\r\n  File \"/home/adam/.local/lib/python3.10/site-packages/chromadb/db/duckdb.py\", line 445, in __del__\r\nAttributeError: 'NoneType' object has no attribute 'info'\r\n```\r\n\r\nThe traceback seem to point to this line:\r\n```\r\n    def __del__(self):\r\n>>        logger.info(\"PersistentDuckDB del, about to run persist\")\r\n        self.persist()\r\n```\r\n\r\nThe code seems to otherwise execute as expected.\n\n### Versions\n\nChroma v0.3.21, Python 3.10.6, Ubuntu 22.04\n\n### Relevant log output\n\n```shell\n[status] loading config file: /home/adam/Research/machine-learning/fable/fable/../config/fable.conf\r\nUsing embedded DuckDB with persistence: data will be stored in: data/fable\r\nNo embedding_function provided, using default embedding function: SentenceTransformerEmbeddingFunction\r\n[status] searching for 3 nearest neighbors\r\n[debug] query_str='threat activity' query_embedding=None doc_ids=None top_k=3\r\n[status] found 1 results\r\nfound 1 results\r\nException ignored in: <function PersistentDuckDB.__del__ at 0x7efb0c38a680>\r\nTraceback (most recent call last):\r\n  File \"/home/adam/.local/lib/python3.10/site-packages/chromadb/db/duckdb.py\", line 445, in __del__\r\nAttributeError: 'NoneType' object has no attribute 'info'\n```\n", "closed_by": {"login": "jeffchuber", "id": 891664, "node_id": "MDQ6VXNlcjg5MTY2NA==", "avatar_url": "https://avatars.githubusercontent.com/u/891664?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jeffchuber", "html_url": "https://github.com/jeffchuber", "followers_url": "https://api.github.com/users/jeffchuber/followers", "following_url": "https://api.github.com/users/jeffchuber/following{/other_user}", "gists_url": "https://api.github.com/users/jeffchuber/gists{/gist_id}", "starred_url": "https://api.github.com/users/jeffchuber/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jeffchuber/subscriptions", "organizations_url": "https://api.github.com/users/jeffchuber/orgs", "repos_url": "https://api.github.com/users/jeffchuber/repos", "events_url": "https://api.github.com/users/jeffchuber/events{/privacy}", "received_events_url": "https://api.github.com/users/jeffchuber/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/chroma-core/chroma/issues/364/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/chroma-core/chroma/issues/364/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/chroma-core/chroma/issues/3879", "repository_url": "https://api.github.com/repos/chroma-core/chroma", "labels_url": "https://api.github.com/repos/chroma-core/chroma/issues/3879/labels{/name}", "comments_url": "https://api.github.com/repos/chroma-core/chroma/issues/3879/comments", "events_url": "https://api.github.com/repos/chroma-core/chroma/issues/3879/events", "html_url": "https://github.com/chroma-core/chroma/issues/3879", "id": 2888985299, "node_id": "I_kwDOII5zmM6sMmrT", "number": 3879, "title": "[Bug]: 405 (Method Not Allowed)", "user": {"login": "DmitryLukyanov", "id": 44870738, "node_id": "MDQ6VXNlcjQ0ODcwNzM4", "avatar_url": "https://avatars.githubusercontent.com/u/44870738?v=4", "gravatar_id": "", "url": "https://api.github.com/users/DmitryLukyanov", "html_url": "https://github.com/DmitryLukyanov", "followers_url": "https://api.github.com/users/DmitryLukyanov/followers", "following_url": "https://api.github.com/users/DmitryLukyanov/following{/other_user}", "gists_url": "https://api.github.com/users/DmitryLukyanov/gists{/gist_id}", "starred_url": "https://api.github.com/users/DmitryLukyanov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/DmitryLukyanov/subscriptions", "organizations_url": "https://api.github.com/users/DmitryLukyanov/orgs", "repos_url": "https://api.github.com/users/DmitryLukyanov/repos", "events_url": "https://api.github.com/users/DmitryLukyanov/events{/privacy}", "received_events_url": "https://api.github.com/users/DmitryLukyanov/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 4620187878, "node_id": "LA_kwDOII5zmM8AAAABE2J45g", "url": "https://api.github.com/repos/chroma-core/chroma/labels/bug", "name": "bug", "color": "E99695", "default": true, "description": "Something isn't working"}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 17, "created_at": "2025-03-01T15:54:03Z", "updated_at": "2025-06-30T22:01:52Z", "closed_at": "2025-06-30T22:01:52Z", "assignee": null, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### What happened?\n\nI have an error when I'm running request to chromadb from semantic kernel in .NET with docker compose.\nNOTE: the request without container configured if I spawn `chroma` with this command `chroma run --host localhost --port 8000` works correctly.\n\nThe error I see is `POST collections operation failed: Response status code does not indicate success: 405 (Method Not Allowed).` during collection creating.\n\nThe docker compose file:\n\n        version: '3.9'\n\n        networks:\n          net:\n            driver: bridge\n\n        services:\n\n          chroma:\n            image: chromadb/chroma:0.6.4.dev283\n            volumes:\n              - chroma-data:/chroma/chroma\n            restart: unless-stopped # possible values are: \"no\", always\", \"on-failure\", \"unless-stopped\"\n            ports:\n              - \"8000:8000\"\n            healthcheck:\n              # Adjust below to match your container port\n              test: [ \"CMD\", \"/bin/bash\", \"-c\", \"cat < /dev/null > /dev/tcp/localhost/8000\" ]\n              interval: 30s\n              timeout: 10s\n              retries: 3\n            networks:\n              - net\n\n          telegrambot:\n            image: ${DOCKER_REGISTRY-}telegrambot\n            build:\n              context: .\n              dockerfile: TelegramBot/Dockerfile\n            depends_on:\n              chroma:\n                condition: service_healthy\n            environment:\n              - OPENAI_API_KEY=${OPENAI_API_KEY}\n              - TELEGRAM_BOT_API_KEY=${TELEGRAM_BOT_API_KEY}\n              - CHROMA_ENDPOINT=http://chroma:8000\n            networks:\n              - net \n\n        volumes:\n          chroma-data:\n            driver: local\n\nI use the prerelease version to avoid the bug described here: https://github.com/chroma-core/chroma/issues/3798\n\nActual code inside `CreateCollection` method can be found here: https://github.com/microsoft/semantic-kernel/blob/4fdaf67b5a6314311676bea2a36a3b3dc2c08662/dotnet/src/Connectors/Connectors.Memory.Chroma/ChromaClient.cs#L63.\n\n\n\n### Versions\n\nChroma: 0.6.4.dev283\n\n### Relevant log output\n\n```shell\n// Chromadb is launched\n...\nchroma-1       | OpenTelemetry is not enabled because it is missing from the config.\nchroma-1       | \nchroma-1       | Listening on 0.0.0.0:8000\ntelegrambot-1  | info: Microsoft.Hosting.Lifetime[0]\ntelegrambot-1  |       Application started. Press Ctrl+C to shut down.\ntelegrambot-1  | info: Microsoft.Hosting.Lifetime[0]\ntelegrambot-1  |       Application started. Press Ctrl+C to shut down.\ntelegrambot-1  | info: Microsoft.Hosting.Lifetime[0]\ntelegrambot-1  |       Hosting environment: Production\ntelegrambot-1  | info: Microsoft.Hosting.Lifetime[0]\ntelegrambot-1  |       Content root path: /app\ntelegrambot-1  | info: Microsoft.Hosting.Lifetime[0]\ntelegrambot-1  |       Hosting environment: Production\ntelegrambot-1  | info: Microsoft.Hosting.Lifetime[0]\ntelegrambot-1  |       Content root path: /app\ntelegrambot-1  | info: TelegramBot.Worker[0]\ntelegrambot-1  |       Bot Id: 1234567890, Bot Name: ai_bot\ntelegrambot-1  | info: TelegramBot.Worker[0]\ntelegrambot-1  |       Bot Id: 1234567890, Bot Name: ai_bot\ntelegrambot-1  | info: TelegramBot.Worker[0]\ntelegrambot-1  |       Telegram Bot started.\ntelegrambot-1  | info: TelegramBot.Worker[0]\ntelegrambot-1  |       Telegram Bot started.\ntelegrambot-1  | dbug: Microsoft.SemanticKernel.Connectors.Chroma.ChromaClient[0]\ntelegrambot-1  |       Creating collection myCvMemory\ntelegrambot-1  | fail: Microsoft.SemanticKernel.Connectors.Chroma.ChromaClient[0]\ntelegrambot-1  |       POST collections operation failed: Response status code does not indicate success: 405 (Method Not Allowed)., \ntelegrambot-1  |       Microsoft.SemanticKernel.HttpOperationException: Response status code does not indicate success: 405 (Method Not Allowed).\ntelegrambot-1  |        ---> System.Net.Http.HttpRequestException: Response status code does not indicate success: 405 (Method Not Allowed).\ntelegrambot-1  |          at System.Net.Http.HttpResponseMessage.EnsureSuccessStatusCode()\ntelegrambot-1  |          at Microsoft.SemanticKernel.Http.HttpClientExtensions.SendWithSuccessCheckAsync(HttpClient client, HttpRequestMessage request, HttpCompletionOption completionOption, CancellationToken cancellationToken)\ntelegrambot-1  |          --- End of inner exception stack trace ---\ntelegrambot-1  |          at Microsoft.SemanticKernel.Http.HttpClientExtensions.SendWithSuccessCheckAsync(HttpClient client, HttpRequestMessage request, HttpCompletionOption completionOption, CancellationToken cancellationToken)\ntelegrambot-1  |          at Microsoft.SemanticKernel.Http.HttpClientExtensions.SendWithSuccessCheckAsync(HttpClient client, HttpRequestMessage request, CancellationToken cancellationToken)\ntelegrambot-1  |          at Microsoft.SemanticKernel.Connectors.Chroma.ChromaClient.ExecuteHttpRequestAsync(HttpRequestMessage request, CancellationToken cancellationToken)\ntelegrambot-1  | fail: Microsoft.Extensions.Hosting.Internal.Host[9]\ntelegrambot-1  |       BackgroundService failed\ntelegrambot-1  |       Microsoft.SemanticKernel.HttpOperationException: Response status code does not indicate success: 405 (Method Not Allowed).\ntelegrambot-1  |        ---> System.Net.Http.HttpRequestException: Response status code does not indicate success: 405 (Method Not Allowed).\ntelegrambot-1  |          at System.Net.Http.HttpResponseMessage.EnsureSuccessStatusCode()\ntelegrambot-1  |          at Microsoft.SemanticKernel.Http.HttpClientExtensions.SendWithSuccessCheckAsync(HttpClient client, HttpRequestMessage request, HttpCompletionOption completionOption, CancellationToken cancellationToken)\ntelegrambot-1  |          --- End of inner exception stack trace ---\ntelegrambot-1  |          at Microsoft.SemanticKernel.Http.HttpClientExtensions.SendWithSuccessCheckAsync(HttpClient client, HttpRequestMessage request, HttpCompletionOption completionOption, CancellationToken cancellationToken)\ntelegrambot-1  |          at Microsoft.SemanticKernel.Http.HttpClientExtensions.SendWithSuccessCheckAsync(HttpClient client, HttpRequestMessage request, CancellationToken cancellationToken)\ntelegrambot-1  |          at Microsoft.SemanticKernel.Connectors.Chroma.ChromaClient.ExecuteHttpRequestAsync(HttpRequestMessage request, CancellationToken cancellationToken)\ntelegrambot-1  |          at Microsoft.SemanticKernel.Connectors.Chroma.ChromaClient.CreateCollectionAsync(String collectionName, CancellationToken cancellationToken)\n...\n```", "closed_by": {"login": "jairad26", "id": 55522316, "node_id": "MDQ6VXNlcjU1NTIyMzE2", "avatar_url": "https://avatars.githubusercontent.com/u/55522316?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jairad26", "html_url": "https://github.com/jairad26", "followers_url": "https://api.github.com/users/jairad26/followers", "following_url": "https://api.github.com/users/jairad26/following{/other_user}", "gists_url": "https://api.github.com/users/jairad26/gists{/gist_id}", "starred_url": "https://api.github.com/users/jairad26/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jairad26/subscriptions", "organizations_url": "https://api.github.com/users/jairad26/orgs", "repos_url": "https://api.github.com/users/jairad26/repos", "events_url": "https://api.github.com/users/jairad26/events{/privacy}", "received_events_url": "https://api.github.com/users/jairad26/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/chroma-core/chroma/issues/3879/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/chroma-core/chroma/issues/3879/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/chroma-core/chroma/issues/1693", "repository_url": "https://api.github.com/repos/chroma-core/chroma", "labels_url": "https://api.github.com/repos/chroma-core/chroma/issues/1693/labels{/name}", "comments_url": "https://api.github.com/repos/chroma-core/chroma/issues/1693/comments", "events_url": "https://api.github.com/repos/chroma-core/chroma/issues/1693/events", "html_url": "https://github.com/chroma-core/chroma/issues/1693", "id": 2114805231, "node_id": "I_kwDOII5zmM5-DV3v", "number": 1693, "title": "[Bug]: sqlite3.OperationalError: database or disk is full", "user": {"login": "ghost", "id": 10137, "node_id": "MDQ6VXNlcjEwMTM3", "avatar_url": "https://avatars.githubusercontent.com/u/10137?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ghost", "html_url": "https://github.com/ghost", "followers_url": "https://api.github.com/users/ghost/followers", "following_url": "https://api.github.com/users/ghost/following{/other_user}", "gists_url": "https://api.github.com/users/ghost/gists{/gist_id}", "starred_url": "https://api.github.com/users/ghost/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ghost/subscriptions", "organizations_url": "https://api.github.com/users/ghost/orgs", "repos_url": "https://api.github.com/users/ghost/repos", "events_url": "https://api.github.com/users/ghost/events{/privacy}", "received_events_url": "https://api.github.com/users/ghost/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 4620187878, "node_id": "LA_kwDOII5zmM8AAAABE2J45g", "url": "https://api.github.com/repos/chroma-core/chroma/labels/bug", "name": "bug", "color": "E99695", "default": true, "description": "Something isn't working"}, {"id": 7078346231, "node_id": "LA_kwDOII5zmM8AAAABpeb99w", "url": "https://api.github.com/repos/chroma-core/chroma/labels/deployment", "name": "deployment", "color": "676A31", "default": false, "description": ""}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 17, "created_at": "2024-02-02T12:18:10Z", "updated_at": "2025-06-13T21:57:11Z", "closed_at": "2025-06-13T21:57:11Z", "assignee": null, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### What happened?\n\n**What Happened:**\r\n\r\n- Encountered an error with a SQLite database in a Docker container environment.\r\n- The error message was sqlite3.OperationalError: database or disk is full.\r\n- This issue occurred despite the host machine having sufficient disk space.\r\n- The SQLite database file size was found to be approximately 4.1 GB.\r\n- The Docker container settings and host machine settings were checked for potential causes of the error.\r\n\r\n**Expected Behavior:**\r\n\r\n- The SQLite database should operate without encountering a 'disk is full' error, especially considering that the host machine had adequate disk space.\r\n- Given the size of the SQLite file (4.1 GB) and the typical capabilities of SQLite and the Docker environment, normal database operations such as data insertion, updating, and querying were expected to occur without errors related to disk space.\r\n- The expectation was that the Docker container's configuration and the host system's file system would support the operation of a database of this size without triggering disk space-related errors.\n\n### Versions\n\nChromaDB V 0.4.9\r\nPython 3.10\n\n### Relevant log output\n\n```shell\nsqlite3.OperationalError: database or disk is full\r\nINFO:     [02-02-2024 04:10:33] 3.131.62.47:40862 - \"POST /api/v1/collections/559a54f0-9471-48af-98af-4d19c5fbd2db/add HTTP/1.1\" 500\r\nINFO:     [02-02-2024 04:10:33] 3.131.62.47:40862 - \"POST /api/v1/collections/559a54f0-9471-48af-98af-4d19c5fbd2db/query HTTP/1.1\" 200\r\nERROR:    [02-02-2024 04:10:34] database or disk is full\n```\n", "closed_by": {"login": "jairad26", "id": 55522316, "node_id": "MDQ6VXNlcjU1NTIyMzE2", "avatar_url": "https://avatars.githubusercontent.com/u/55522316?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jairad26", "html_url": "https://github.com/jairad26", "followers_url": "https://api.github.com/users/jairad26/followers", "following_url": "https://api.github.com/users/jairad26/following{/other_user}", "gists_url": "https://api.github.com/users/jairad26/gists{/gist_id}", "starred_url": "https://api.github.com/users/jairad26/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jairad26/subscriptions", "organizations_url": "https://api.github.com/users/jairad26/orgs", "repos_url": "https://api.github.com/users/jairad26/repos", "events_url": "https://api.github.com/users/jairad26/events{/privacy}", "received_events_url": "https://api.github.com/users/jairad26/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/chroma-core/chroma/issues/1693/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/chroma-core/chroma/issues/1693/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/chroma-core/chroma/issues/4386", "repository_url": "https://api.github.com/repos/chroma-core/chroma", "labels_url": "https://api.github.com/repos/chroma-core/chroma/issues/4386/labels{/name}", "comments_url": "https://api.github.com/repos/chroma-core/chroma/issues/4386/comments", "events_url": "https://api.github.com/repos/chroma-core/chroma/issues/4386/events", "html_url": "https://github.com/chroma-core/chroma/issues/4386", "id": 3020688237, "node_id": "I_kwDOII5zmM60DAtt", "number": 4386, "title": "[Bug]: KeyError: '_type' when using Docker with versions >1.0.0 (including latest)", "user": {"login": "aryanranderiya", "id": 64796509, "node_id": "MDQ6VXNlcjY0Nzk2NTA5", "avatar_url": "https://avatars.githubusercontent.com/u/64796509?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aryanranderiya", "html_url": "https://github.com/aryanranderiya", "followers_url": "https://api.github.com/users/aryanranderiya/followers", "following_url": "https://api.github.com/users/aryanranderiya/following{/other_user}", "gists_url": "https://api.github.com/users/aryanranderiya/gists{/gist_id}", "starred_url": "https://api.github.com/users/aryanranderiya/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aryanranderiya/subscriptions", "organizations_url": "https://api.github.com/users/aryanranderiya/orgs", "repos_url": "https://api.github.com/users/aryanranderiya/repos", "events_url": "https://api.github.com/users/aryanranderiya/events{/privacy}", "received_events_url": "https://api.github.com/users/aryanranderiya/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 4620187878, "node_id": "LA_kwDOII5zmM8AAAABE2J45g", "url": "https://api.github.com/repos/chroma-core/chroma/labels/bug", "name": "bug", "color": "E99695", "default": true, "description": "Something isn't working"}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 16, "created_at": "2025-04-25T18:00:06Z", "updated_at": "2025-07-25T18:03:45Z", "closed_at": "2025-06-20T20:16:54Z", "assignee": null, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### What happened?\n\nI'm using ChromaDB in a Dockerized FastAPI app and encountered the following error when calling await client.create_collection():\n\n```\nf\"Trying to instantiate configuration of type {cls.__name__} from JSON with type {json_map['_type']}\"\nKeyError: '_type'\n```\n\n- This is running inside a Docker container (Python 3.12).\n- Downgrading to 1.0.0 temporarily resolves the issue.\n- When pinging `localhost:8080/api/v2/heartbeat` it works fine \u2014 so the server is reachable and responsive.\n\n\n### Versions\n\nDocker image: `chromadb/chroma:latest`\nPython 3.12.10\nUbuntu 24 LTS\n\n\u2705 Works fine with version 1.0.0\n\u274c Fails with version 1.0.6\n\u274c Fails with the latest version (as of now)\n\n\n### Relevant log output\n\n```shell\nFile \"/app/app/db/chromadb.py\", line 221, in init_chroma\nawait client.create_collection(\nFile \"/usr/local/lib/python3.12/site-packages/chromadb/api/async_client.py\", line 181, in create_collection\nmodel = await self._server.create_collection(\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nFile \"/usr/local/lib/python3.12/site-packages/chromadb/telemetry/opentelemetry/__init__.py\", line 134, in async_wrapper\nreturn await f(*args, **kwargs)\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nFile \"/usr/local/lib/python3.12/site-packages/chromadb/api/async_fastapi.py\", line 291, in create_collection\nmodel = CollectionModel.from_json(resp_json)\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nFile \"/usr/local/lib/python3.12/site-packages/chromadb/types.py\", line 156, in from_json\nconfiguration = CollectionConfigurationInternal.from_json(\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nFile \"/usr/local/lib/python3.12/site-packages/chromadb/api/configuration.py\", line 209, in from_json\nf\"Trying to instantiate configuration of type {cls.__name__} from JSON with type {json_map['_type']}\"\n~~~~~~~~~~~~^^^^^^^^\nKeyError: '_type'\n\n```", "closed_by": {"login": "jairad26", "id": 55522316, "node_id": "MDQ6VXNlcjU1NTIyMzE2", "avatar_url": "https://avatars.githubusercontent.com/u/55522316?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jairad26", "html_url": "https://github.com/jairad26", "followers_url": "https://api.github.com/users/jairad26/followers", "following_url": "https://api.github.com/users/jairad26/following{/other_user}", "gists_url": "https://api.github.com/users/jairad26/gists{/gist_id}", "starred_url": "https://api.github.com/users/jairad26/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jairad26/subscriptions", "organizations_url": "https://api.github.com/users/jairad26/orgs", "repos_url": "https://api.github.com/users/jairad26/repos", "events_url": "https://api.github.com/users/jairad26/events{/privacy}", "received_events_url": "https://api.github.com/users/jairad26/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/chroma-core/chroma/issues/4386/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/chroma-core/chroma/issues/4386/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/chroma-core/chroma/issues/2675", "repository_url": "https://api.github.com/repos/chroma-core/chroma", "labels_url": "https://api.github.com/repos/chroma-core/chroma/issues/2675/labels{/name}", "comments_url": "https://api.github.com/repos/chroma-core/chroma/issues/2675/comments", "events_url": "https://api.github.com/repos/chroma-core/chroma/issues/2675/events", "html_url": "https://github.com/chroma-core/chroma/issues/2675", "id": 2471659682, "node_id": "I_kwDOII5zmM6TUoii", "number": 2675, "title": "[Bug]: Non deterministic query results in a local db query", "user": {"login": "naddeoa", "id": 1233709, "node_id": "MDQ6VXNlcjEyMzM3MDk=", "avatar_url": "https://avatars.githubusercontent.com/u/1233709?v=4", "gravatar_id": "", "url": "https://api.github.com/users/naddeoa", "html_url": "https://github.com/naddeoa", "followers_url": "https://api.github.com/users/naddeoa/followers", "following_url": "https://api.github.com/users/naddeoa/following{/other_user}", "gists_url": "https://api.github.com/users/naddeoa/gists{/gist_id}", "starred_url": "https://api.github.com/users/naddeoa/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/naddeoa/subscriptions", "organizations_url": "https://api.github.com/users/naddeoa/orgs", "repos_url": "https://api.github.com/users/naddeoa/repos", "events_url": "https://api.github.com/users/naddeoa/events{/privacy}", "received_events_url": "https://api.github.com/users/naddeoa/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 4620187878, "node_id": "LA_kwDOII5zmM8AAAABE2J45g", "url": "https://api.github.com/repos/chroma-core/chroma/labels/bug", "name": "bug", "color": "E99695", "default": true, "description": "Something isn't working"}, {"id": 7086455373, "node_id": "LA_kwDOII5zmM8AAAABpmK6TQ", "url": "https://api.github.com/repos/chroma-core/chroma/labels/index", "name": "index", "color": "0B58B4", "default": false, "description": ""}], "state": "closed", "locked": false, "assignees": [{"login": "itaismith", "id": 42597089, "node_id": "MDQ6VXNlcjQyNTk3MDg5", "avatar_url": "https://avatars.githubusercontent.com/u/42597089?v=4", "gravatar_id": "", "url": "https://api.github.com/users/itaismith", "html_url": "https://github.com/itaismith", "followers_url": "https://api.github.com/users/itaismith/followers", "following_url": "https://api.github.com/users/itaismith/following{/other_user}", "gists_url": "https://api.github.com/users/itaismith/gists{/gist_id}", "starred_url": "https://api.github.com/users/itaismith/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/itaismith/subscriptions", "organizations_url": "https://api.github.com/users/itaismith/orgs", "repos_url": "https://api.github.com/users/itaismith/repos", "events_url": "https://api.github.com/users/itaismith/events{/privacy}", "received_events_url": "https://api.github.com/users/itaismith/received_events", "type": "User", "user_view_type": "public", "site_admin": false}], "milestone": null, "comments": 16, "created_at": "2024-08-17T20:25:05Z", "updated_at": "2024-11-13T02:00:57Z", "closed_at": "2024-11-13T00:14:14Z", "assignee": {"login": "itaismith", "id": 42597089, "node_id": "MDQ6VXNlcjQyNTk3MDg5", "avatar_url": "https://avatars.githubusercontent.com/u/42597089?v=4", "gravatar_id": "", "url": "https://api.github.com/users/itaismith", "html_url": "https://github.com/itaismith", "followers_url": "https://api.github.com/users/itaismith/followers", "following_url": "https://api.github.com/users/itaismith/following{/other_user}", "gists_url": "https://api.github.com/users/itaismith/gists{/gist_id}", "starred_url": "https://api.github.com/users/itaismith/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/itaismith/subscriptions", "organizations_url": "https://api.github.com/users/itaismith/orgs", "repos_url": "https://api.github.com/users/itaismith/repos", "events_url": "https://api.github.com/users/itaismith/events{/privacy}", "received_events_url": "https://api.github.com/users/itaismith/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### What happened?\r\n\r\n\r\nMinimal repro here: https://github.com/naddeoa/chromadb_determinism_issue. Check that out and run `make install run` (with poetry installed)\r\n\r\nThe same query will yield different results between database loads. As long as the database is loaded the query results are consistent, but if you unload the database (just let the script end and restart it) then you'll randomly get different results. For example, the following are two sample runs using the repro code that differ. Nothing changed in the database (besides the apparent mutations that chromadb always does even though I'm only reading, which makes things very hard to reason about).\r\n\r\n```python\r\n[[[0.7512401342391968, 0.7793669104576111, 0.8091723322868347]],\r\n [[0.7512401342391968, 0.7793669104576111, 0.8091723322868347]],\r\n [[0.7512401342391968, 0.7793669104576111, 0.8091723322868347]],\r\n [[0.7512401342391968, 0.7793669104576111, 0.8091723322868347]],\r\n [[0.7512401342391968, 0.7793669104576111, 0.8091723322868347]],\r\n [[0.7512401342391968, 0.7793669104576111, 0.8091723322868347]],\r\n [[0.7512401342391968, 0.7793669104576111, 0.8091723322868347]],\r\n [[0.7512401342391968, 0.7793669104576111, 0.8091723322868347]],\r\n [[0.7512401342391968, 0.7793669104576111, 0.8091723322868347]],\r\n [[0.7512401342391968, 0.7793669104576111, 0.8091723322868347]]]\r\n\r\n# Values only change in between runs, not within runs\r\n[[[0.7512401342391968, 0.8091723322868347, 0.8145251274108887]],\r\n [[0.7512401342391968, 0.8091723322868347, 0.8145251274108887]],\r\n [[0.7512401342391968, 0.8091723322868347, 0.8145251274108887]],\r\n [[0.7512401342391968, 0.8091723322868347, 0.8145251274108887]],\r\n [[0.7512401342391968, 0.8091723322868347, 0.8145251274108887]],\r\n [[0.7512401342391968, 0.8091723322868347, 0.8145251274108887]],\r\n [[0.7512401342391968, 0.8091723322868347, 0.8145251274108887]],\r\n [[0.7512401342391968, 0.8091723322868347, 0.8145251274108887]],\r\n [[0.7512401342391968, 0.8091723322868347, 0.8145251274108887]],\r\n [[0.7512401342391968, 0.8091723322868347, 0.8145251274108887]]]\r\n```\r\n\r\nMy chroma instance was created with roughly the following code, using the same chromadb version (0.5.5)\r\n\r\n```python\r\nclient = chromadb.PersistentClient(path=db_path, settings=Settings(anonymized_telemetry=False))\r\ncollection = client.create_collection(name=\"collection\", metadata={\"hnsw:space\": \"cosine\"})\r\ndf = pd.read_csv(precomputed_embeddings)\r\nmetadatas = df[[...]].to_dict(\"records\"))\r\nids = df[\"id\"].astype(str).tolist()\r\nembeddings: List[Sequence[float]] = df[\"embeddings\"].tolist()\r\ncollection.add(documents=None, metadatas=metadatas, ids=ids, embeddings=embeddings)\r\n```\r\n\r\nI'm precomputing embeddings using my own encoder  (`sentence-transformers/all-MiniLM-L6-v2` for this repro still though) so I'm not using any documents and I'm querying by embedding values. There isn't really any mention of `determinism` in the chromadb docs so I'm not sure what I should be expecting.\r\n\r\n\r\n### Versions\r\n\r\nChromadb 0.5.5, python 3.10.12\r\n\r\nFull dependencies exported from poetry lock file: https://github.com/naddeoa/chromadb_determinism_issue/blob/master/requirements.txt\r\n\r\n### Relevant log output\r\n\r\n_No response_", "closed_by": {"login": "atroyn", "id": 1302641, "node_id": "MDQ6VXNlcjEzMDI2NDE=", "avatar_url": "https://avatars.githubusercontent.com/u/1302641?v=4", "gravatar_id": "", "url": "https://api.github.com/users/atroyn", "html_url": "https://github.com/atroyn", "followers_url": "https://api.github.com/users/atroyn/followers", "following_url": "https://api.github.com/users/atroyn/following{/other_user}", "gists_url": "https://api.github.com/users/atroyn/gists{/gist_id}", "starred_url": "https://api.github.com/users/atroyn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/atroyn/subscriptions", "organizations_url": "https://api.github.com/users/atroyn/orgs", "repos_url": "https://api.github.com/users/atroyn/repos", "events_url": "https://api.github.com/users/atroyn/events{/privacy}", "received_events_url": "https://api.github.com/users/atroyn/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/chroma-core/chroma/issues/2675/reactions", "total_count": 1, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 1}, "timeline_url": "https://api.github.com/repos/chroma-core/chroma/issues/2675/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}]}