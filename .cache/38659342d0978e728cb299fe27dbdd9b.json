{"d": [{"url": "https://api.github.com/repos/forwardemail/supertest/issues/124", "repository_url": "https://api.github.com/repos/forwardemail/supertest", "labels_url": "https://api.github.com/repos/forwardemail/supertest/issues/124/labels{/name}", "comments_url": "https://api.github.com/repos/forwardemail/supertest/issues/124/comments", "events_url": "https://api.github.com/repos/forwardemail/supertest/issues/124/events", "html_url": "https://github.com/forwardemail/supertest/issues/124", "id": 30436010, "node_id": "MDU6SXNzdWUzMDQzNjAxMA==", "number": 124, "title": "Unable to receive a octet stream", "user": {"login": "katcipis", "id": 157634, "node_id": "MDQ6VXNlcjE1NzYzNA==", "avatar_url": "https://avatars.githubusercontent.com/u/157634?v=4", "gravatar_id": "", "url": "https://api.github.com/users/katcipis", "html_url": "https://github.com/katcipis", "followers_url": "https://api.github.com/users/katcipis/followers", "following_url": "https://api.github.com/users/katcipis/following{/other_user}", "gists_url": "https://api.github.com/users/katcipis/gists{/gist_id}", "starred_url": "https://api.github.com/users/katcipis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/katcipis/subscriptions", "organizations_url": "https://api.github.com/users/katcipis/orgs", "repos_url": "https://api.github.com/users/katcipis/repos", "events_url": "https://api.github.com/users/katcipis/events{/privacy}", "received_events_url": "https://api.github.com/users/katcipis/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 7951643, "node_id": "MDU6TGFiZWw3OTUxNjQz", "url": "https://api.github.com/repos/forwardemail/supertest/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 7951647, "node_id": "MDU6TGFiZWw3OTUxNjQ3", "url": "https://api.github.com/repos/forwardemail/supertest/labels/question", "name": "question", "color": "cc317c", "default": true, "description": null}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 14, "created_at": "2014-03-29T03:06:09Z", "updated_at": "2019-03-09T11:25:44Z", "closed_at": "2019-03-09T11:25:44Z", "assignee": null, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "Hi,\n\nI was testing a web service that streams data that is received from a spawned process to the client. Everything was going fine, but suddenly, the tests started to fail intermittently (i loosed the \"repeatable\" property of my tests:-(), actually almost all the time it succeeded. \n\nDoing a little more debugging i was able to isolate the problem here:\n\nhttps://gitorious.org/katcipis-playground/playground/source/5198249525f740af4a8507ae237aaf369777fe73:javascript/nodejs/supertest-streamed-response-problem\n\nAs can be seem on the streamed-response-tests.js, i just send a response on express using multiple writes, and when im done with it...i call end.\n\nAs expected...it works... but if you run the script load-test.sh, you can see that it will inevitably fail after some time repeating the same test:\n\n```\n  1) Streaming data test should send all chunks correctly:\n\n      AssertionError: expected 1029 to equal 1031\n      + expected - actual\n\n      +1031\n      -1029\n```\n\nIt seems that some part of the data is not completely sent sometimes (or received), the amount of bytes missing is variable and the error sometimes happens very fast, on other cases it takes some time to happen.\n\nSome stuff on the code (like random generation of the buffers) that seems a little weird is because this is a isolated fragment of the real test that i have failing, with this level of isolation it really seems o be a problem on the send/receive of the data.\n\nAnyone has an idea if this is a bug or if I'm doing something wrong on the code ?\n", "closed_by": {"login": "rimiti", "id": 28003749, "node_id": "MDQ6VXNlcjI4MDAzNzQ5", "avatar_url": "https://avatars.githubusercontent.com/u/28003749?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rimiti", "html_url": "https://github.com/rimiti", "followers_url": "https://api.github.com/users/rimiti/followers", "following_url": "https://api.github.com/users/rimiti/following{/other_user}", "gists_url": "https://api.github.com/users/rimiti/gists{/gist_id}", "starred_url": "https://api.github.com/users/rimiti/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rimiti/subscriptions", "organizations_url": "https://api.github.com/users/rimiti/orgs", "repos_url": "https://api.github.com/users/rimiti/repos", "events_url": "https://api.github.com/users/rimiti/events{/privacy}", "received_events_url": "https://api.github.com/users/rimiti/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/forwardemail/supertest/issues/124/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/forwardemail/supertest/issues/124/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/forwardemail/supertest/issues/93", "repository_url": "https://api.github.com/repos/forwardemail/supertest", "labels_url": "https://api.github.com/repos/forwardemail/supertest/issues/93/labels{/name}", "comments_url": "https://api.github.com/repos/forwardemail/supertest/issues/93/comments", "events_url": "https://api.github.com/repos/forwardemail/supertest/issues/93/events", "html_url": "https://github.com/forwardemail/supertest/issues/93", "id": 25697782, "node_id": "MDU6SXNzdWUyNTY5Nzc4Mg==", "number": 93, "title": "Body is empty", "user": {"login": "neoqing", "id": 1840604, "node_id": "MDQ6VXNlcjE4NDA2MDQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1840604?v=4", "gravatar_id": "", "url": "https://api.github.com/users/neoqing", "html_url": "https://github.com/neoqing", "followers_url": "https://api.github.com/users/neoqing/followers", "following_url": "https://api.github.com/users/neoqing/following{/other_user}", "gists_url": "https://api.github.com/users/neoqing/gists{/gist_id}", "starred_url": "https://api.github.com/users/neoqing/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/neoqing/subscriptions", "organizations_url": "https://api.github.com/users/neoqing/orgs", "repos_url": "https://api.github.com/users/neoqing/repos", "events_url": "https://api.github.com/users/neoqing/events{/privacy}", "received_events_url": "https://api.github.com/users/neoqing/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 7951643, "node_id": "MDU6TGFiZWw3OTUxNjQz", "url": "https://api.github.com/repos/forwardemail/supertest/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 14, "created_at": "2014-01-16T01:52:02Z", "updated_at": "2019-03-09T11:25:44Z", "closed_at": "2019-03-09T11:25:44Z", "assignee": null, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "Hi,There\n   I did some testing on my demo app, find some strange result.\n   My demo app has a healthcheck, it returns with a 'ack' in the response (suppose 'ack' should be in response's body). code fragment shows below\napp.get('/demoapp/healthcheck', function (request, response) {\n      response.writeHead(200, {'Content-Type': 'text/plain'});\n      response.end('ack');\n  });\n\n  Then my test code shows below\nvar should = require('should'); \nvar assert = require('assert');\nvar request = require('supertest'); \n\ndescribe('Routing', function() {\n  var url = 'http://localhost:8080';\n\n  describe('demoservice', function() {\n    it('do health check', function(done) {\n\n```\nrequest(url)\n.get('/demoapp/healthcheck')    \n.expect(200,function(){\n    console.log('expect status');\n}) //Status code\n.end(function(err, res) {\n      if (err) {\n        throw err;\n      }     \n      console.log(res);\n      console.log(res.text);\n      console.log(res.body);    \n      res.text.should.have.match(/^ack/);\n      done();\n    });\n});\n```\n\n  });\n});\n\nIn the console, output is so weird,\nres shows it's 'body' is {}, but it has 'text' 'ackack' (not typo,it's real two ack), is there anybody can tell me why? Thanks in advance.\n", "closed_by": {"login": "rimiti", "id": 28003749, "node_id": "MDQ6VXNlcjI4MDAzNzQ5", "avatar_url": "https://avatars.githubusercontent.com/u/28003749?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rimiti", "html_url": "https://github.com/rimiti", "followers_url": "https://api.github.com/users/rimiti/followers", "following_url": "https://api.github.com/users/rimiti/following{/other_user}", "gists_url": "https://api.github.com/users/rimiti/gists{/gist_id}", "starred_url": "https://api.github.com/users/rimiti/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rimiti/subscriptions", "organizations_url": "https://api.github.com/users/rimiti/orgs", "repos_url": "https://api.github.com/users/rimiti/repos", "events_url": "https://api.github.com/users/rimiti/events{/privacy}", "received_events_url": "https://api.github.com/users/rimiti/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/forwardemail/supertest/issues/93/reactions", "total_count": 2, "+1": 2, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/forwardemail/supertest/issues/93/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/forwardemail/supertest/issues/474", "repository_url": "https://api.github.com/repos/forwardemail/supertest", "labels_url": "https://api.github.com/repos/forwardemail/supertest/issues/474/labels{/name}", "comments_url": "https://api.github.com/repos/forwardemail/supertest/issues/474/comments", "events_url": "https://api.github.com/repos/forwardemail/supertest/issues/474/events", "html_url": "https://github.com/forwardemail/supertest/pull/474", "id": 316741151, "node_id": "MDExOlB1bGxSZXF1ZXN0MTgzMzgxNDI5", "number": 474, "title": "Release v3.1.0", "user": {"login": "rimiti", "id": 28003749, "node_id": "MDQ6VXNlcjI4MDAzNzQ5", "avatar_url": "https://avatars.githubusercontent.com/u/28003749?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rimiti", "html_url": "https://github.com/rimiti", "followers_url": "https://api.github.com/users/rimiti/followers", "following_url": "https://api.github.com/users/rimiti/following{/other_user}", "gists_url": "https://api.github.com/users/rimiti/gists{/gist_id}", "starred_url": "https://api.github.com/users/rimiti/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rimiti/subscriptions", "organizations_url": "https://api.github.com/users/rimiti/orgs", "repos_url": "https://api.github.com/users/rimiti/repos", "events_url": "https://api.github.com/users/rimiti/events{/privacy}", "received_events_url": "https://api.github.com/users/rimiti/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 7951643, "node_id": "MDU6TGFiZWw3OTUxNjQz", "url": "https://api.github.com/repos/forwardemail/supertest/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 7951645, "node_id": "MDU6TGFiZWw3OTUxNjQ1", "url": "https://api.github.com/repos/forwardemail/supertest/labels/enhancement", "name": "enhancement", "color": "84b6eb", "default": true, "description": null}, {"id": 915690262, "node_id": "MDU6TGFiZWw5MTU2OTAyNjI=", "url": "https://api.github.com/repos/forwardemail/supertest/labels/release", "name": "release", "color": "ab59e5", "default": false, "description": ""}], "state": "closed", "locked": false, "assignees": [{"login": "mikelax", "id": 2080701, "node_id": "MDQ6VXNlcjIwODA3MDE=", "avatar_url": "https://avatars.githubusercontent.com/u/2080701?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mikelax", "html_url": "https://github.com/mikelax", "followers_url": "https://api.github.com/users/mikelax/followers", "following_url": "https://api.github.com/users/mikelax/following{/other_user}", "gists_url": "https://api.github.com/users/mikelax/gists{/gist_id}", "starred_url": "https://api.github.com/users/mikelax/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mikelax/subscriptions", "organizations_url": "https://api.github.com/users/mikelax/orgs", "repos_url": "https://api.github.com/users/mikelax/repos", "events_url": "https://api.github.com/users/mikelax/events{/privacy}", "received_events_url": "https://api.github.com/users/mikelax/received_events", "type": "User", "user_view_type": "public", "site_admin": false}], "milestone": {"url": "https://api.github.com/repos/forwardemail/supertest/milestones/6", "html_url": "https://github.com/forwardemail/supertest/milestone/6", "labels_url": "https://api.github.com/repos/forwardemail/supertest/milestones/6/labels", "id": 2953349, "node_id": "MDk6TWlsZXN0b25lMjk1MzM0OQ==", "number": 6, "title": "v3.1.0", "description": "", "creator": {"login": "mikelax", "id": 2080701, "node_id": "MDQ6VXNlcjIwODA3MDE=", "avatar_url": "https://avatars.githubusercontent.com/u/2080701?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mikelax", "html_url": "https://github.com/mikelax", "followers_url": "https://api.github.com/users/mikelax/followers", "following_url": "https://api.github.com/users/mikelax/following{/other_user}", "gists_url": "https://api.github.com/users/mikelax/gists{/gist_id}", "starred_url": "https://api.github.com/users/mikelax/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mikelax/subscriptions", "organizations_url": "https://api.github.com/users/mikelax/orgs", "repos_url": "https://api.github.com/users/mikelax/repos", "events_url": "https://api.github.com/users/mikelax/events{/privacy}", "received_events_url": "https://api.github.com/users/mikelax/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "open_issues": 0, "closed_issues": 11, "state": "closed", "created_at": "2017-12-02T23:04:14Z", "updated_at": "2018-09-05T13:54:53Z", "due_on": null, "closed_at": "2018-09-05T13:54:53Z"}, "comments": 11, "created_at": "2018-04-23T09:54:56Z", "updated_at": "2018-05-14T14:57:58Z", "closed_at": "2018-05-13T13:09:52Z", "assignee": {"login": "mikelax", "id": 2080701, "node_id": "MDQ6VXNlcjIwODA3MDE=", "avatar_url": "https://avatars.githubusercontent.com/u/2080701?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mikelax", "html_url": "https://github.com/mikelax", "followers_url": "https://api.github.com/users/mikelax/followers", "following_url": "https://api.github.com/users/mikelax/following{/other_user}", "gists_url": "https://api.github.com/users/mikelax/gists{/gist_id}", "starred_url": "https://api.github.com/users/mikelax/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mikelax/subscriptions", "organizations_url": "https://api.github.com/users/mikelax/orgs", "repos_url": "https://api.github.com/users/mikelax/repos", "events_url": "https://api.github.com/users/mikelax/events{/privacy}", "received_events_url": "https://api.github.com/users/mikelax/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "author_association": "CONTRIBUTOR", "type": null, "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/forwardemail/supertest/pulls/474", "html_url": "https://github.com/forwardemail/supertest/pull/474", "diff_url": "https://github.com/forwardemail/supertest/pull/474.diff", "patch_url": "https://github.com/forwardemail/supertest/pull/474.patch", "merged_at": "2018-05-13T13:09:52Z"}, "body": "Hello,\r\n\r\nPreparation of v3.1.0 release. \ud83d\udca5 \u2764\ufe0f \r\n\r\n\r\n**RELEASE NOTE**\r\n- #473 (@pedro-otero)\r\n- #472 (@rimiti)\r\n- #470 (@levioza)\r\n- #446 (@bkeepers)\r\n- #418 (@kevinburke)\r\n- #297 (@mikec)\r\n- #275 (@reallistic)\r\n\r\nRegards, \r\n\ud83e\udd84\r\n", "closed_by": {"login": "mikelax", "id": 2080701, "node_id": "MDQ6VXNlcjIwODA3MDE=", "avatar_url": "https://avatars.githubusercontent.com/u/2080701?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mikelax", "html_url": "https://github.com/mikelax", "followers_url": "https://api.github.com/users/mikelax/followers", "following_url": "https://api.github.com/users/mikelax/following{/other_user}", "gists_url": "https://api.github.com/users/mikelax/gists{/gist_id}", "starred_url": "https://api.github.com/users/mikelax/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mikelax/subscriptions", "organizations_url": "https://api.github.com/users/mikelax/orgs", "repos_url": "https://api.github.com/users/mikelax/repos", "events_url": "https://api.github.com/users/mikelax/events{/privacy}", "received_events_url": "https://api.github.com/users/mikelax/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/forwardemail/supertest/issues/474/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/forwardemail/supertest/issues/474/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/forwardemail/supertest/issues/875", "repository_url": "https://api.github.com/repos/forwardemail/supertest", "labels_url": "https://api.github.com/repos/forwardemail/supertest/issues/875/labels{/name}", "comments_url": "https://api.github.com/repos/forwardemail/supertest/issues/875/comments", "events_url": "https://api.github.com/repos/forwardemail/supertest/issues/875/events", "html_url": "https://github.com/forwardemail/supertest/issues/875", "id": 3784205975, "node_id": "I_kwDOAElymM7hjmaX", "number": 875, "title": "MODULE_NOT_FOUND error in 7.2.0", "user": {"login": "ddolcimascolo", "id": 5468291, "node_id": "MDQ6VXNlcjU0NjgyOTE=", "avatar_url": "https://avatars.githubusercontent.com/u/5468291?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ddolcimascolo", "html_url": "https://github.com/ddolcimascolo", "followers_url": "https://api.github.com/users/ddolcimascolo/followers", "following_url": "https://api.github.com/users/ddolcimascolo/following{/other_user}", "gists_url": "https://api.github.com/users/ddolcimascolo/gists{/gist_id}", "starred_url": "https://api.github.com/users/ddolcimascolo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ddolcimascolo/subscriptions", "organizations_url": "https://api.github.com/users/ddolcimascolo/orgs", "repos_url": "https://api.github.com/users/ddolcimascolo/repos", "events_url": "https://api.github.com/users/ddolcimascolo/events{/privacy}", "received_events_url": "https://api.github.com/users/ddolcimascolo/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 7951643, "node_id": "MDU6TGFiZWw3OTUxNjQz", "url": "https://api.github.com/repos/forwardemail/supertest/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 11, "created_at": "2026-01-06T08:19:56Z", "updated_at": "2026-01-06T10:17:09Z", "closed_at": "2026-01-06T08:42:26Z", "assignee": null, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "## Describe the bug\n\n**Node.js version:** <!-- Write your Node.js version. -->v24.11.1\n\n**OS version:** <!-- Write your operating system and version. -->Linux 6.14.0-37-generic #37~24.04.1-Ubuntu SMP PREEMPT_DYNAMIC Thu Nov 20 10:25:38 UTC 2 x86_64 x86_64 x86_64 GNU/Linux\n\n\n**Description:** <!-- A clear and concise description of what the bug is. --> Cannot run tests using supertest v7.2.0\n\n## Actual behavior\n\n<!-- Write actual behavior here. --> Tests immediately stop with this stacktrace\n\n```\n Exception during run: Error: Cannot find module './Assertion'                                     \nRequire stack:                                                                                                                                                                                          \n- /data/dev/rest2zapi/node_modules/supertest/lib/cookies/index.js                                                                                                                                       \n- /data/dev/rest2zapi/node_modules/supertest/index.js                                       \n- /data/dev/rest2zapi/backend/api/zapi.spec.js              \n```\n\n## Expected behavior\n\n<!-- Write expected behavior here. --> Tests run fine\n\n## Code to reproduce\n\nSimply `require('supertest')`\n\n<!-- Share code to reproduce here inside a code formatted block, gist, or a repository we can clone to reproduce. -->\n\n<!--\nWe encourage you to submit a pull request with a failing test:\n\n1) This will make it more likely for us to prioritize your issue.\n2) It's a good way to prove that the issue is related to this project and not your code.\n\nExample: <https://github.com/avajs/ava/blob/master/docs/01-writing-tests.md#failing-tests>\n-->\n\n## Checklist\n\n- [x] I have searched through GitHub issues for similar issues.\n- [x] I have completely read through the README and documentation.\n- [x] I have tested my code with the latest version of Node.js and this package and confirmed it is still not working.\n", "closed_by": {"login": "titanism", "id": 101466223, "node_id": "U_kgDOBgxAbw", "avatar_url": "https://avatars.githubusercontent.com/u/101466223?v=4", "gravatar_id": "", "url": "https://api.github.com/users/titanism", "html_url": "https://github.com/titanism", "followers_url": "https://api.github.com/users/titanism/followers", "following_url": "https://api.github.com/users/titanism/following{/other_user}", "gists_url": "https://api.github.com/users/titanism/gists{/gist_id}", "starred_url": "https://api.github.com/users/titanism/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/titanism/subscriptions", "organizations_url": "https://api.github.com/users/titanism/orgs", "repos_url": "https://api.github.com/users/titanism/repos", "events_url": "https://api.github.com/users/titanism/events{/privacy}", "received_events_url": "https://api.github.com/users/titanism/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/forwardemail/supertest/issues/875/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/forwardemail/supertest/issues/875/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/forwardemail/supertest/issues/534", "repository_url": "https://api.github.com/repos/forwardemail/supertest", "labels_url": "https://api.github.com/repos/forwardemail/supertest/issues/534/labels{/name}", "comments_url": "https://api.github.com/repos/forwardemail/supertest/issues/534/comments", "events_url": "https://api.github.com/repos/forwardemail/supertest/issues/534/events", "html_url": "https://github.com/forwardemail/supertest/issues/534", "id": 399712942, "node_id": "MDU6SXNzdWUzOTk3MTI5NDI=", "number": 534, "title": "Tests with error return fail with version 3.4.0", "user": {"login": "ilkkaparssinen", "id": 1501855, "node_id": "MDQ6VXNlcjE1MDE4NTU=", "avatar_url": "https://avatars.githubusercontent.com/u/1501855?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ilkkaparssinen", "html_url": "https://github.com/ilkkaparssinen", "followers_url": "https://api.github.com/users/ilkkaparssinen/followers", "following_url": "https://api.github.com/users/ilkkaparssinen/following{/other_user}", "gists_url": "https://api.github.com/users/ilkkaparssinen/gists{/gist_id}", "starred_url": "https://api.github.com/users/ilkkaparssinen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ilkkaparssinen/subscriptions", "organizations_url": "https://api.github.com/users/ilkkaparssinen/orgs", "repos_url": "https://api.github.com/users/ilkkaparssinen/repos", "events_url": "https://api.github.com/users/ilkkaparssinen/events{/privacy}", "received_events_url": "https://api.github.com/users/ilkkaparssinen/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 7951643, "node_id": "MDU6TGFiZWw3OTUxNjQz", "url": "https://api.github.com/repos/forwardemail/supertest/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1195529599, "node_id": "MDU6TGFiZWwxMTk1NTI5NTk5", "url": "https://api.github.com/repos/forwardemail/supertest/labels/needs-investigation", "name": "needs-investigation", "color": "d3ed80", "default": false, "description": ""}], "state": "closed", "locked": false, "assignees": [{"login": "gjohnson", "id": 67717, "node_id": "MDQ6VXNlcjY3NzE3", "avatar_url": "https://avatars.githubusercontent.com/u/67717?v=4", "gravatar_id": "", "url": "https://api.github.com/users/gjohnson", "html_url": "https://github.com/gjohnson", "followers_url": "https://api.github.com/users/gjohnson/followers", "following_url": "https://api.github.com/users/gjohnson/following{/other_user}", "gists_url": "https://api.github.com/users/gjohnson/gists{/gist_id}", "starred_url": "https://api.github.com/users/gjohnson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/gjohnson/subscriptions", "organizations_url": "https://api.github.com/users/gjohnson/orgs", "repos_url": "https://api.github.com/users/gjohnson/repos", "events_url": "https://api.github.com/users/gjohnson/events{/privacy}", "received_events_url": "https://api.github.com/users/gjohnson/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, {"login": "rimiti", "id": 28003749, "node_id": "MDQ6VXNlcjI4MDAzNzQ5", "avatar_url": "https://avatars.githubusercontent.com/u/28003749?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rimiti", "html_url": "https://github.com/rimiti", "followers_url": "https://api.github.com/users/rimiti/followers", "following_url": "https://api.github.com/users/rimiti/following{/other_user}", "gists_url": "https://api.github.com/users/rimiti/gists{/gist_id}", "starred_url": "https://api.github.com/users/rimiti/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rimiti/subscriptions", "organizations_url": "https://api.github.com/users/rimiti/orgs", "repos_url": "https://api.github.com/users/rimiti/repos", "events_url": "https://api.github.com/users/rimiti/events{/privacy}", "received_events_url": "https://api.github.com/users/rimiti/received_events", "type": "User", "user_view_type": "public", "site_admin": false}], "milestone": {"url": "https://api.github.com/repos/forwardemail/supertest/milestones/10", "html_url": "https://github.com/forwardemail/supertest/milestone/10", "labels_url": "https://api.github.com/repos/forwardemail/supertest/milestones/10/labels", "id": 3976732, "node_id": "MDk6TWlsZXN0b25lMzk3NjczMg==", "number": 10, "title": "v3.5.0", "description": null, "creator": {"login": "rimiti", "id": 28003749, "node_id": "MDQ6VXNlcjI4MDAzNzQ5", "avatar_url": "https://avatars.githubusercontent.com/u/28003749?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rimiti", "html_url": "https://github.com/rimiti", "followers_url": "https://api.github.com/users/rimiti/followers", "following_url": "https://api.github.com/users/rimiti/following{/other_user}", "gists_url": "https://api.github.com/users/rimiti/gists{/gist_id}", "starred_url": "https://api.github.com/users/rimiti/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rimiti/subscriptions", "organizations_url": "https://api.github.com/users/rimiti/orgs", "repos_url": "https://api.github.com/users/rimiti/repos", "events_url": "https://api.github.com/users/rimiti/events{/privacy}", "received_events_url": "https://api.github.com/users/rimiti/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "open_issues": 0, "closed_issues": 2, "state": "open", "created_at": "2019-01-16T08:48:45Z", "updated_at": "2019-01-22T07:41:01Z", "due_on": null, "closed_at": null}, "comments": 11, "created_at": "2019-01-16T09:13:44Z", "updated_at": "2019-01-16T12:45:19Z", "closed_at": "2019-01-16T12:45:19Z", "assignee": {"login": "gjohnson", "id": 67717, "node_id": "MDQ6VXNlcjY3NzE3", "avatar_url": "https://avatars.githubusercontent.com/u/67717?v=4", "gravatar_id": "", "url": "https://api.github.com/users/gjohnson", "html_url": "https://github.com/gjohnson", "followers_url": "https://api.github.com/users/gjohnson/followers", "following_url": "https://api.github.com/users/gjohnson/following{/other_user}", "gists_url": "https://api.github.com/users/gjohnson/gists{/gist_id}", "starred_url": "https://api.github.com/users/gjohnson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/gjohnson/subscriptions", "organizations_url": "https://api.github.com/users/gjohnson/orgs", "repos_url": "https://api.github.com/users/gjohnson/repos", "events_url": "https://api.github.com/users/gjohnson/events{/privacy}", "received_events_url": "https://api.github.com/users/gjohnson/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "When using version 3.4.0 tests that test for backend returning an error (400) fail. Example:\r\n```js\r\nit(\"Check that backend returns 400 with invalid data\", async function() {\r\n    let res = await server\r\n        .post(\"/api/someurl\")\r\n        .send({data: \"something invalid\"})\r\n        .expect(\"Content-type\", /json/)\r\n        .expect(400);\r\n  });\r\n```\r\nWhen using version 3.4.0 this test fails with \"Bad request\" error even when backend returns correctly 400 status code. \r\n\r\nWith supertest 3.3.0 code works as expected. ", "closed_by": {"login": "rimiti", "id": 28003749, "node_id": "MDQ6VXNlcjI4MDAzNzQ5", "avatar_url": "https://avatars.githubusercontent.com/u/28003749?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rimiti", "html_url": "https://github.com/rimiti", "followers_url": "https://api.github.com/users/rimiti/followers", "following_url": "https://api.github.com/users/rimiti/following{/other_user}", "gists_url": "https://api.github.com/users/rimiti/gists{/gist_id}", "starred_url": "https://api.github.com/users/rimiti/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rimiti/subscriptions", "organizations_url": "https://api.github.com/users/rimiti/orgs", "repos_url": "https://api.github.com/users/rimiti/repos", "events_url": "https://api.github.com/users/rimiti/events{/privacy}", "received_events_url": "https://api.github.com/users/rimiti/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/forwardemail/supertest/issues/534/reactions", "total_count": 9, "+1": 9, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/forwardemail/supertest/issues/534/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/forwardemail/supertest/issues/558", "repository_url": "https://api.github.com/repos/forwardemail/supertest", "labels_url": "https://api.github.com/repos/forwardemail/supertest/issues/558/labels{/name}", "comments_url": "https://api.github.com/repos/forwardemail/supertest/issues/558/comments", "events_url": "https://api.github.com/repos/forwardemail/supertest/issues/558/events", "html_url": "https://github.com/forwardemail/supertest/pull/558", "id": 420670670, "node_id": "MDExOlB1bGxSZXF1ZXN0MjYwOTAxMDE1", "number": 558, "title": "Superagent downgrading", "user": {"login": "rimiti", "id": 28003749, "node_id": "MDQ6VXNlcjI4MDAzNzQ5", "avatar_url": "https://avatars.githubusercontent.com/u/28003749?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rimiti", "html_url": "https://github.com/rimiti", "followers_url": "https://api.github.com/users/rimiti/followers", "following_url": "https://api.github.com/users/rimiti/following{/other_user}", "gists_url": "https://api.github.com/users/rimiti/gists{/gist_id}", "starred_url": "https://api.github.com/users/rimiti/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rimiti/subscriptions", "organizations_url": "https://api.github.com/users/rimiti/orgs", "repos_url": "https://api.github.com/users/rimiti/repos", "events_url": "https://api.github.com/users/rimiti/events{/privacy}", "received_events_url": "https://api.github.com/users/rimiti/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 7951643, "node_id": "MDU6TGFiZWw3OTUxNjQz", "url": "https://api.github.com/repos/forwardemail/supertest/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}, {"id": 1195493592, "node_id": "MDU6TGFiZWwxMTk1NDkzNTky", "url": "https://api.github.com/repos/forwardemail/supertest/labels/next-release", "name": "next-release", "color": "d82969", "default": false, "description": "Next release"}], "state": "closed", "locked": false, "assignees": [{"login": "rimiti", "id": 28003749, "node_id": "MDQ6VXNlcjI4MDAzNzQ5", "avatar_url": "https://avatars.githubusercontent.com/u/28003749?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rimiti", "html_url": "https://github.com/rimiti", "followers_url": "https://api.github.com/users/rimiti/followers", "following_url": "https://api.github.com/users/rimiti/following{/other_user}", "gists_url": "https://api.github.com/users/rimiti/gists{/gist_id}", "starred_url": "https://api.github.com/users/rimiti/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rimiti/subscriptions", "organizations_url": "https://api.github.com/users/rimiti/orgs", "repos_url": "https://api.github.com/users/rimiti/repos", "events_url": "https://api.github.com/users/rimiti/events{/privacy}", "received_events_url": "https://api.github.com/users/rimiti/received_events", "type": "User", "user_view_type": "public", "site_admin": false}], "milestone": {"url": "https://api.github.com/repos/forwardemail/supertest/milestones/14", "html_url": "https://github.com/forwardemail/supertest/milestone/14", "labels_url": "https://api.github.com/repos/forwardemail/supertest/milestones/14/labels", "id": 4139704, "node_id": "MDk6TWlsZXN0b25lNDEzOTcwNA==", "number": 14, "title": "v4.0.1", "description": null, "creator": {"login": "rimiti", "id": 28003749, "node_id": "MDQ6VXNlcjI4MDAzNzQ5", "avatar_url": "https://avatars.githubusercontent.com/u/28003749?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rimiti", "html_url": "https://github.com/rimiti", "followers_url": "https://api.github.com/users/rimiti/followers", "following_url": "https://api.github.com/users/rimiti/following{/other_user}", "gists_url": "https://api.github.com/users/rimiti/gists{/gist_id}", "starred_url": "https://api.github.com/users/rimiti/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rimiti/subscriptions", "organizations_url": "https://api.github.com/users/rimiti/orgs", "repos_url": "https://api.github.com/users/rimiti/repos", "events_url": "https://api.github.com/users/rimiti/events{/privacy}", "received_events_url": "https://api.github.com/users/rimiti/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "open_issues": 0, "closed_issues": 1, "state": "open", "created_at": "2019-03-14T08:42:16Z", "updated_at": "2019-03-15T12:44:56Z", "due_on": null, "closed_at": null}, "comments": 9, "created_at": "2019-03-13T19:06:39Z", "updated_at": "2019-10-02T08:16:11Z", "closed_at": "2019-03-15T12:44:56Z", "assignee": {"login": "rimiti", "id": 28003749, "node_id": "MDQ6VXNlcjI4MDAzNzQ5", "avatar_url": "https://avatars.githubusercontent.com/u/28003749?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rimiti", "html_url": "https://github.com/rimiti", "followers_url": "https://api.github.com/users/rimiti/followers", "following_url": "https://api.github.com/users/rimiti/following{/other_user}", "gists_url": "https://api.github.com/users/rimiti/gists{/gist_id}", "starred_url": "https://api.github.com/users/rimiti/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rimiti/subscriptions", "organizations_url": "https://api.github.com/users/rimiti/orgs", "repos_url": "https://api.github.com/users/rimiti/repos", "events_url": "https://api.github.com/users/rimiti/events{/privacy}", "received_events_url": "https://api.github.com/users/rimiti/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "author_association": "CONTRIBUTOR", "type": null, "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/forwardemail/supertest/pulls/558", "html_url": "https://github.com/forwardemail/supertest/pull/558", "diff_url": "https://github.com/forwardemail/supertest/pull/558.diff", "patch_url": "https://github.com/forwardemail/supertest/pull/558.patch", "merged_at": "2019-03-15T12:44:56Z"}, "body": "Hello,\r\n\r\nTo quickly unblock the situation, I propose to downgrade the superagent version.\r\n\r\n**Details of this PR:**\r\n- Test included to assert using promises (fail with superagent v4.x). \r\n- Superagent downgraded to \"^3.8.3\".\r\n\r\n**Related issues:**\r\n- #557\r\n- #556\r\n\r\n**Current investigation:**\r\nThe line causing this promise issue in superagent: https://github.com/visionmedia/superagent/blob/master/lib/request-base.js#L245\r\n\r\nIf this line is commented, supertest works fine with superagent v4. \r\n\r\n\r\n_Note: I am very busy to investigate for now, if anyone has time to work on a new pull request (regarding the safe update of superagent), it would be great. Otherwise I will do it as soon as I have time;_", "closed_by": {"login": "rimiti", "id": 28003749, "node_id": "MDQ6VXNlcjI4MDAzNzQ5", "avatar_url": "https://avatars.githubusercontent.com/u/28003749?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rimiti", "html_url": "https://github.com/rimiti", "followers_url": "https://api.github.com/users/rimiti/followers", "following_url": "https://api.github.com/users/rimiti/following{/other_user}", "gists_url": "https://api.github.com/users/rimiti/gists{/gist_id}", "starred_url": "https://api.github.com/users/rimiti/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rimiti/subscriptions", "organizations_url": "https://api.github.com/users/rimiti/orgs", "repos_url": "https://api.github.com/users/rimiti/repos", "events_url": "https://api.github.com/users/rimiti/events{/privacy}", "received_events_url": "https://api.github.com/users/rimiti/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/forwardemail/supertest/issues/558/reactions", "total_count": 4, "+1": 4, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/forwardemail/supertest/issues/558/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/forwardemail/supertest/issues/237", "repository_url": "https://api.github.com/repos/forwardemail/supertest", "labels_url": "https://api.github.com/repos/forwardemail/supertest/issues/237/labels{/name}", "comments_url": "https://api.github.com/repos/forwardemail/supertest/issues/237/comments", "events_url": "https://api.github.com/repos/forwardemail/supertest/issues/237/events", "html_url": "https://github.com/forwardemail/supertest/issues/237", "id": 82259526, "node_id": "MDU6SXNzdWU4MjI1OTUyNg==", "number": 237, "title": "supertest gets exception if the HTTP server is down", "user": {"login": "psinghsp", "id": 6025212, "node_id": "MDQ6VXNlcjYwMjUyMTI=", "avatar_url": "https://avatars.githubusercontent.com/u/6025212?v=4", "gravatar_id": "", "url": "https://api.github.com/users/psinghsp", "html_url": "https://github.com/psinghsp", "followers_url": "https://api.github.com/users/psinghsp/followers", "following_url": "https://api.github.com/users/psinghsp/following{/other_user}", "gists_url": "https://api.github.com/users/psinghsp/gists{/gist_id}", "starred_url": "https://api.github.com/users/psinghsp/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/psinghsp/subscriptions", "organizations_url": "https://api.github.com/users/psinghsp/orgs", "repos_url": "https://api.github.com/users/psinghsp/repos", "events_url": "https://api.github.com/users/psinghsp/events{/privacy}", "received_events_url": "https://api.github.com/users/psinghsp/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 7951643, "node_id": "MDU6TGFiZWw3OTUxNjQz", "url": "https://api.github.com/repos/forwardemail/supertest/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignees": [{"login": "mikelax", "id": 2080701, "node_id": "MDQ6VXNlcjIwODA3MDE=", "avatar_url": "https://avatars.githubusercontent.com/u/2080701?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mikelax", "html_url": "https://github.com/mikelax", "followers_url": "https://api.github.com/users/mikelax/followers", "following_url": "https://api.github.com/users/mikelax/following{/other_user}", "gists_url": "https://api.github.com/users/mikelax/gists{/gist_id}", "starred_url": "https://api.github.com/users/mikelax/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mikelax/subscriptions", "organizations_url": "https://api.github.com/users/mikelax/orgs", "repos_url": "https://api.github.com/users/mikelax/repos", "events_url": "https://api.github.com/users/mikelax/events{/privacy}", "received_events_url": "https://api.github.com/users/mikelax/received_events", "type": "User", "user_view_type": "public", "site_admin": false}], "milestone": {"url": "https://api.github.com/repos/forwardemail/supertest/milestones/2", "html_url": "https://github.com/forwardemail/supertest/milestone/2", "labels_url": "https://api.github.com/repos/forwardemail/supertest/milestones/2/labels", "id": 1265716, "node_id": "MDk6TWlsZXN0b25lMTI2NTcxNg==", "number": 2, "title": "1.2.0", "description": "", "creator": {"login": "mikelax", "id": 2080701, "node_id": "MDQ6VXNlcjIwODA3MDE=", "avatar_url": "https://avatars.githubusercontent.com/u/2080701?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mikelax", "html_url": "https://github.com/mikelax", "followers_url": "https://api.github.com/users/mikelax/followers", "following_url": "https://api.github.com/users/mikelax/following{/other_user}", "gists_url": "https://api.github.com/users/mikelax/gists{/gist_id}", "starred_url": "https://api.github.com/users/mikelax/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mikelax/subscriptions", "organizations_url": "https://api.github.com/users/mikelax/orgs", "repos_url": "https://api.github.com/users/mikelax/repos", "events_url": "https://api.github.com/users/mikelax/events{/privacy}", "received_events_url": "https://api.github.com/users/mikelax/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "open_issues": 0, "closed_issues": 6, "state": "closed", "created_at": "2015-08-21T03:26:44Z", "updated_at": "2016-05-26T23:24:32Z", "due_on": null, "closed_at": "2016-05-26T23:24:32Z"}, "comments": 10, "created_at": "2015-05-29T04:44:06Z", "updated_at": "2017-10-06T20:51:26Z", "closed_at": "2015-09-17T02:09:55Z", "assignee": {"login": "mikelax", "id": 2080701, "node_id": "MDQ6VXNlcjIwODA3MDE=", "avatar_url": "https://avatars.githubusercontent.com/u/2080701?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mikelax", "html_url": "https://github.com/mikelax", "followers_url": "https://api.github.com/users/mikelax/followers", "following_url": "https://api.github.com/users/mikelax/following{/other_user}", "gists_url": "https://api.github.com/users/mikelax/gists{/gist_id}", "starred_url": "https://api.github.com/users/mikelax/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mikelax/subscriptions", "organizations_url": "https://api.github.com/users/mikelax/orgs", "repos_url": "https://api.github.com/users/mikelax/repos", "events_url": "https://api.github.com/users/mikelax/events{/privacy}", "received_events_url": "https://api.github.com/users/mikelax/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "We have a REST API to reboot the HTTP server and then poll for it using another REST API to come back. While calling a REST API when web server is down, supertest gets an exception. You can see at the specific line that \"res\" is undefined because HTTP server is down. I think this code on line 202 needs to be modified to deal with this situation.\n\n/home/psingh/applianceUpgrade/node_modules/supertest/lib/test.js:202\n    if (res.status !== status) {\n           ^\nTypeError: Cannot read property 'status' of undefined\n    at Test.assert (/home/psingh/applianceUpgrade/node_modules/supertest/lib/test.js:202:12)\n", "closed_by": {"login": "mikelax", "id": 2080701, "node_id": "MDQ6VXNlcjIwODA3MDE=", "avatar_url": "https://avatars.githubusercontent.com/u/2080701?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mikelax", "html_url": "https://github.com/mikelax", "followers_url": "https://api.github.com/users/mikelax/followers", "following_url": "https://api.github.com/users/mikelax/following{/other_user}", "gists_url": "https://api.github.com/users/mikelax/gists{/gist_id}", "starred_url": "https://api.github.com/users/mikelax/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mikelax/subscriptions", "organizations_url": "https://api.github.com/users/mikelax/orgs", "repos_url": "https://api.github.com/users/mikelax/repos", "events_url": "https://api.github.com/users/mikelax/events{/privacy}", "received_events_url": "https://api.github.com/users/mikelax/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/forwardemail/supertest/issues/237/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/forwardemail/supertest/issues/237/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/forwardemail/supertest/issues/129", "repository_url": "https://api.github.com/repos/forwardemail/supertest", "labels_url": "https://api.github.com/repos/forwardemail/supertest/issues/129/labels{/name}", "comments_url": "https://api.github.com/repos/forwardemail/supertest/issues/129/comments", "events_url": "https://api.github.com/repos/forwardemail/supertest/issues/129/events", "html_url": "https://github.com/forwardemail/supertest/issues/129", "id": 32044882, "node_id": "MDU6SXNzdWUzMjA0NDg4Mg==", "number": 129, "title": "Redirects: Uncaught Error: Not running", "user": {"login": "Zev23", "id": 3324640, "node_id": "MDQ6VXNlcjMzMjQ2NDA=", "avatar_url": "https://avatars.githubusercontent.com/u/3324640?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Zev23", "html_url": "https://github.com/Zev23", "followers_url": "https://api.github.com/users/Zev23/followers", "following_url": "https://api.github.com/users/Zev23/following{/other_user}", "gists_url": "https://api.github.com/users/Zev23/gists{/gist_id}", "starred_url": "https://api.github.com/users/Zev23/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Zev23/subscriptions", "organizations_url": "https://api.github.com/users/Zev23/orgs", "repos_url": "https://api.github.com/users/Zev23/repos", "events_url": "https://api.github.com/users/Zev23/events{/privacy}", "received_events_url": "https://api.github.com/users/Zev23/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 7951643, "node_id": "MDU6TGFiZWw3OTUxNjQz", "url": "https://api.github.com/repos/forwardemail/supertest/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 10, "created_at": "2014-04-23T09:21:19Z", "updated_at": "2016-02-11T15:14:26Z", "closed_at": "2016-02-11T15:14:26Z", "assignee": null, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "I'm having this error when using 1 or more redirects.\nThis error occurs in supertest v0.11.0.\nsupertest v0.10.0 doesn't have this error.\n\nnode version 0.11.12.\n\nTest case:\n\n```\ndescribe('Redirects', function() {\n    it('should work', function(done) {\n        var app = express();\n        app.get('/', function(req, res) {\n            res.redirect('/r1');\n        });\n        app.get('/r1', function(req, res) {\n            res.send(200);\n        });\n\n        request(app)\n            .get('/')\n            .redirects(1)\n            .expect(200, done);\n    });\n});\n```\n\nError log:\n\n```\n  1) Redirects should work:\n     Uncaught Error: Not running\n      at Server.close (net.js:1344:11)\n      at /home/action/workspace/app/node_modules/supertest/lib/test.js:126:36\n      at Test.Request.callback (/home/action/workspace/app/node_modules/supertest/node_modules/superagent/lib/node/index.js:660:30)\n      at Test.<anonymous> (/home/action/workspace/app/node_modules/supertest/node_modules/superagent/lib/node/index.js:132:10)\n      at Test.EventEmitter.emit (events.js:104:17)\n      at IncomingMessage.<anonymous> (/home/action/workspace/app/node_modules/supertest/node_modules/superagent/lib/node/index.js:818:12)\n      at IncomingMessage.EventEmitter.emit (events.js:126:20)\n      at _stream_readable.js:895:16\n      at process._tickCallback (node.js:339:11)\n```\n", "closed_by": {"login": "mikelax", "id": 2080701, "node_id": "MDQ6VXNlcjIwODA3MDE=", "avatar_url": "https://avatars.githubusercontent.com/u/2080701?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mikelax", "html_url": "https://github.com/mikelax", "followers_url": "https://api.github.com/users/mikelax/followers", "following_url": "https://api.github.com/users/mikelax/following{/other_user}", "gists_url": "https://api.github.com/users/mikelax/gists{/gist_id}", "starred_url": "https://api.github.com/users/mikelax/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mikelax/subscriptions", "organizations_url": "https://api.github.com/users/mikelax/orgs", "repos_url": "https://api.github.com/users/mikelax/repos", "events_url": "https://api.github.com/users/mikelax/events{/privacy}", "received_events_url": "https://api.github.com/users/mikelax/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/forwardemail/supertest/issues/129/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/forwardemail/supertest/issues/129/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/forwardemail/supertest/issues/863", "repository_url": "https://api.github.com/repos/forwardemail/supertest", "labels_url": "https://api.github.com/repos/forwardemail/supertest/issues/863/labels{/name}", "comments_url": "https://api.github.com/repos/forwardemail/supertest/issues/863/comments", "events_url": "https://api.github.com/repos/forwardemail/supertest/issues/863/events", "html_url": "https://github.com/forwardemail/supertest/issues/863", "id": 3182359673, "node_id": "I_kwDOAElymM69rvR5", "number": 863, "title": "[fix] payload converted from array to int in v7.1.1", "user": {"login": "endze1t", "id": 38842789, "node_id": "MDQ6VXNlcjM4ODQyNzg5", "avatar_url": "https://avatars.githubusercontent.com/u/38842789?v=4", "gravatar_id": "", "url": "https://api.github.com/users/endze1t", "html_url": "https://github.com/endze1t", "followers_url": "https://api.github.com/users/endze1t/followers", "following_url": "https://api.github.com/users/endze1t/following{/other_user}", "gists_url": "https://api.github.com/users/endze1t/gists{/gist_id}", "starred_url": "https://api.github.com/users/endze1t/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/endze1t/subscriptions", "organizations_url": "https://api.github.com/users/endze1t/orgs", "repos_url": "https://api.github.com/users/endze1t/repos", "events_url": "https://api.github.com/users/endze1t/events{/privacy}", "received_events_url": "https://api.github.com/users/endze1t/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 7951643, "node_id": "MDU6TGFiZWw3OTUxNjQz", "url": "https://api.github.com/repos/forwardemail/supertest/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 6, "created_at": "2025-06-27T10:50:41Z", "updated_at": "2025-06-28T13:51:28Z", "closed_at": "2025-06-28T13:51:28Z", "assignee": null, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "## Describe the bug\n\n**Node.js version:** v22.17.0\n\n**OS version:** Win10\n\n**Description:** .send() converts int[] to int since v7.1.1 supertest (<= 7.1.0 no issues)\n\n## Actual behavior\n\n.send() converts int[] to int\n\n## Expected behavior\n.send() converts int[] to int[]\n\n## Code to reproduce\n```js\n    const agent = request\n        .agent(app)\n        .set('Accept', 'application/json')\n        .set('Content-Type', 'application/x-www-form-urlencoded');\n\n  const data = {\n    sales: [123],\n  };\n\n  const res = await agent\n    .post('/checkout')\n    .send(data);\n```\n\n## Checklist\n\n- [x] I have searched through GitHub issues for similar issues.\n- [x] I have completely read through the README and documentation.\n- [x] I have tested my code with the latest version of Node.js and this package and confirmed it is still not working.\n", "closed_by": {"login": "titanism", "id": 101466223, "node_id": "U_kgDOBgxAbw", "avatar_url": "https://avatars.githubusercontent.com/u/101466223?v=4", "gravatar_id": "", "url": "https://api.github.com/users/titanism", "html_url": "https://github.com/titanism", "followers_url": "https://api.github.com/users/titanism/followers", "following_url": "https://api.github.com/users/titanism/following{/other_user}", "gists_url": "https://api.github.com/users/titanism/gists{/gist_id}", "starred_url": "https://api.github.com/users/titanism/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/titanism/subscriptions", "organizations_url": "https://api.github.com/users/titanism/orgs", "repos_url": "https://api.github.com/users/titanism/repos", "events_url": "https://api.github.com/users/titanism/events{/privacy}", "received_events_url": "https://api.github.com/users/titanism/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/forwardemail/supertest/issues/863/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/forwardemail/supertest/issues/863/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/forwardemail/supertest/issues/859", "repository_url": "https://api.github.com/repos/forwardemail/supertest", "labels_url": "https://api.github.com/repos/forwardemail/supertest/issues/859/labels{/name}", "comments_url": "https://api.github.com/repos/forwardemail/supertest/issues/859/comments", "events_url": "https://api.github.com/repos/forwardemail/supertest/issues/859/events", "html_url": "https://github.com/forwardemail/supertest/issues/859", "id": 3070900537, "node_id": "I_kwDOAElymM63Cjk5", "number": 859, "title": "Content-Type header not being properly asserted", "user": {"login": "david-videau-ortega", "id": 106292073, "node_id": "U_kgDOBlXjaQ", "avatar_url": "https://avatars.githubusercontent.com/u/106292073?v=4", "gravatar_id": "", "url": "https://api.github.com/users/david-videau-ortega", "html_url": "https://github.com/david-videau-ortega", "followers_url": "https://api.github.com/users/david-videau-ortega/followers", "following_url": "https://api.github.com/users/david-videau-ortega/following{/other_user}", "gists_url": "https://api.github.com/users/david-videau-ortega/gists{/gist_id}", "starred_url": "https://api.github.com/users/david-videau-ortega/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/david-videau-ortega/subscriptions", "organizations_url": "https://api.github.com/users/david-videau-ortega/orgs", "repos_url": "https://api.github.com/users/david-videau-ortega/repos", "events_url": "https://api.github.com/users/david-videau-ortega/events{/privacy}", "received_events_url": "https://api.github.com/users/david-videau-ortega/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 7951643, "node_id": "MDU6TGFiZWw3OTUxNjQz", "url": "https://api.github.com/repos/forwardemail/supertest/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 6, "created_at": "2025-05-17T15:58:00Z", "updated_at": "2025-07-25T07:47:21Z", "closed_at": "2025-07-24T16:41:22Z", "assignee": null, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "Hello everyone. Thanks for maintaining this awesome tool. I'm facing an issue while trying to test a simple endpoint headers. I would highly appreciate any help you could bring.\n\n## Describe the bug\n\n**Node.js version:** v22.12.0\n\n**OS version:** Fedora Linux 41\n\n**Description:**\n\nI just started using supertest today (in its latest version from NPM), with the goal of testing the following simple endpoint:\n\n```javascript\nrouter.get('/health', (_, response) => {\n    response.setHeader('Content-Type', 'text/plain');\n    response.end('OK');\n})\n```\n\n## Actual behavior\n\nHaving written the following test:\n\n```javascript\nit('Should return a 200 HTTP status code', async () => {\n        const response = await request(application).get('/health');\n        expect(response.headers['Content-Type']).toBe('text/plain');\n    })\n```\nI encounter a failure, because of an unmet expectation on the `Content-Type` header, in the form of:\n\n```\nExpected: \"text/plain\"\nReceived: undefined\n```\n\nHowever, the following expectation works as expected:\n\n```\nexpect(response.headers['content-type']).toBe('text/plain');\n```\n\n## Expected behavior\n\nHaving verified through Postman that my API returns the correct header:\n\n![Image](https://github.com/user-attachments/assets/6dfd061b-f2c3-455a-b7ff-7a4178b50b6e)\n\nI expect to be able to assert the `Content-Type` header, with that exact casing.\n\n## Code to reproduce\n\n```\n// My app file\nconst express = require('express');\nconst healthcheckRouter = require('./shared/healthcheck/router');\n\n\n// Server setup\n\nconst application = express();\n\napplication.use('/health', healthcheckRouter);\n\nmodule.exports = {\n    application\n}\n```\n\n```\n// My router file\nconst express = require('express');\n\nconst healthcheckRouter = express.Router();\n\nhealthcheckRouter.get('/', (_, response) => {\n    response.setHeader('Content-Type', 'text/plain');\n    response.end('OK');\n})\n\nmodule.exports = healthcheckRouter;\n```\n\n```\n// My test file\nconst request = require('supertest');\nconst { application } = require('../../application');\n\ndescribe('Health check', () => {\n\n    it('Should return a 200 HTTP status code', async () => {\n        const response = await request(application).get('/health');\n        expect(response.headers['Content-Type']).toBe('text/plain');\n    })\n\n})\n```\n\nAs an additional note (knowing that it probably belongs to a separated issue), having verified with Postman that the endpoint provided effectively returns \"OK\", adding the following assertion:\n\n```javascript\nexpect(response.body).toBe('OK')\n```\n\nFails with the following:\n\n```\nExpected: \"OK\"\nReceived: {}\n```\n\n## Checklist\n\n- [ x ] I have searched through GitHub issues for similar issues.\n- [ x ] I have completely read through the README and documentation.\n- [ x ] I have tested my code with the latest version of Node.js and this package and confirmed it is still not working.\n", "closed_by": {"login": "david-videau-ortega", "id": 106292073, "node_id": "U_kgDOBlXjaQ", "avatar_url": "https://avatars.githubusercontent.com/u/106292073?v=4", "gravatar_id": "", "url": "https://api.github.com/users/david-videau-ortega", "html_url": "https://github.com/david-videau-ortega", "followers_url": "https://api.github.com/users/david-videau-ortega/followers", "following_url": "https://api.github.com/users/david-videau-ortega/following{/other_user}", "gists_url": "https://api.github.com/users/david-videau-ortega/gists{/gist_id}", "starred_url": "https://api.github.com/users/david-videau-ortega/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/david-videau-ortega/subscriptions", "organizations_url": "https://api.github.com/users/david-videau-ortega/orgs", "repos_url": "https://api.github.com/users/david-videau-ortega/repos", "events_url": "https://api.github.com/users/david-videau-ortega/events{/privacy}", "received_events_url": "https://api.github.com/users/david-videau-ortega/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/forwardemail/supertest/issues/859/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/forwardemail/supertest/issues/859/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/forwardemail/supertest/issues/104", "repository_url": "https://api.github.com/repos/forwardemail/supertest", "labels_url": "https://api.github.com/repos/forwardemail/supertest/issues/104/labels{/name}", "comments_url": "https://api.github.com/repos/forwardemail/supertest/issues/104/comments", "events_url": "https://api.github.com/repos/forwardemail/supertest/issues/104/events", "html_url": "https://github.com/forwardemail/supertest/issues/104", "id": 28241756, "node_id": "MDU6SXNzdWUyODI0MTc1Ng==", "number": 104, "title": "False positive when testing using agent with end() callback", "user": {"login": "HeinrichFilter", "id": 265415, "node_id": "MDQ6VXNlcjI2NTQxNQ==", "avatar_url": "https://avatars.githubusercontent.com/u/265415?v=4", "gravatar_id": "", "url": "https://api.github.com/users/HeinrichFilter", "html_url": "https://github.com/HeinrichFilter", "followers_url": "https://api.github.com/users/HeinrichFilter/followers", "following_url": "https://api.github.com/users/HeinrichFilter/following{/other_user}", "gists_url": "https://api.github.com/users/HeinrichFilter/gists{/gist_id}", "starred_url": "https://api.github.com/users/HeinrichFilter/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/HeinrichFilter/subscriptions", "organizations_url": "https://api.github.com/users/HeinrichFilter/orgs", "repos_url": "https://api.github.com/users/HeinrichFilter/repos", "events_url": "https://api.github.com/users/HeinrichFilter/events{/privacy}", "received_events_url": "https://api.github.com/users/HeinrichFilter/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 7951643, "node_id": "MDU6TGFiZWw3OTUxNjQz", "url": "https://api.github.com/repos/forwardemail/supertest/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 6, "created_at": "2014-02-25T11:57:40Z", "updated_at": "2014-03-18T08:15:54Z", "closed_at": "2014-03-18T08:15:54Z", "assignee": null, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "Considering the following tests, why doesn't the second test fail? Am I missing something?\n\n``` javascript\ndescribe('request.agent(app)', function(){\n  var app = express();\n\n  app.use(express.cookieParser());\n\n  app.get('/', function(req, res){\n    res.cookie('cookie', 'hey');\n    res.send();\n  });\n\n  app.get('/return', function(req, res){\n    if (req.cookies.cookie) res.send(req.cookies.cookie);\n    else res.send(':(')\n  });\n\n  var agent = request.agent(app);\n\n  it('Why does this test fail', function(done){\n    agent\n    .get('/')\n    .expect(404, done);\n  })\n\n  it('*but this test does not fail*', function(done){\n    agent\n    .get('/')\n    .expect(404)\n    .end(function(err, res){\n      done();\n    });\n  })\n})\n```\n\nScreenshot of result\n![screenshot from 2014-02-25 13 54 38](https://f.cloud.github.com/assets/265415/2257140/e1e02572-9e13-11e3-9e56-6e3fc891f712.png)\n", "closed_by": {"login": "HeinrichFilter", "id": 265415, "node_id": "MDQ6VXNlcjI2NTQxNQ==", "avatar_url": "https://avatars.githubusercontent.com/u/265415?v=4", "gravatar_id": "", "url": "https://api.github.com/users/HeinrichFilter", "html_url": "https://github.com/HeinrichFilter", "followers_url": "https://api.github.com/users/HeinrichFilter/followers", "following_url": "https://api.github.com/users/HeinrichFilter/following{/other_user}", "gists_url": "https://api.github.com/users/HeinrichFilter/gists{/gist_id}", "starred_url": "https://api.github.com/users/HeinrichFilter/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/HeinrichFilter/subscriptions", "organizations_url": "https://api.github.com/users/HeinrichFilter/orgs", "repos_url": "https://api.github.com/users/HeinrichFilter/repos", "events_url": "https://api.github.com/users/HeinrichFilter/events{/privacy}", "received_events_url": "https://api.github.com/users/HeinrichFilter/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/forwardemail/supertest/issues/104/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/forwardemail/supertest/issues/104/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/forwardemail/supertest/issues/67", "repository_url": "https://api.github.com/repos/forwardemail/supertest", "labels_url": "https://api.github.com/repos/forwardemail/supertest/issues/67/labels{/name}", "comments_url": "https://api.github.com/repos/forwardemail/supertest/issues/67/comments", "events_url": "https://api.github.com/repos/forwardemail/supertest/issues/67/events", "html_url": "https://github.com/forwardemail/supertest/pull/67", "id": 16170594, "node_id": "MDExOlB1bGxSZXF1ZXN0NjYzMTg2NQ==", "number": 67, "title": "failing tests to demonstrate .pipe problems", "user": {"login": "kirbysayshi", "id": 90831, "node_id": "MDQ6VXNlcjkwODMx", "avatar_url": "https://avatars.githubusercontent.com/u/90831?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kirbysayshi", "html_url": "https://github.com/kirbysayshi", "followers_url": "https://api.github.com/users/kirbysayshi/followers", "following_url": "https://api.github.com/users/kirbysayshi/following{/other_user}", "gists_url": "https://api.github.com/users/kirbysayshi/gists{/gist_id}", "starred_url": "https://api.github.com/users/kirbysayshi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kirbysayshi/subscriptions", "organizations_url": "https://api.github.com/users/kirbysayshi/orgs", "repos_url": "https://api.github.com/users/kirbysayshi/repos", "events_url": "https://api.github.com/users/kirbysayshi/events{/privacy}", "received_events_url": "https://api.github.com/users/kirbysayshi/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 7951643, "node_id": "MDU6TGFiZWw3OTUxNjQz", "url": "https://api.github.com/repos/forwardemail/supertest/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 5, "created_at": "2013-06-29T04:08:05Z", "updated_at": "2019-03-08T13:10:22Z", "closed_at": "2019-03-08T13:10:22Z", "assignee": null, "author_association": "NONE", "type": null, "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/forwardemail/supertest/pulls/67", "html_url": "https://github.com/forwardemail/supertest/pull/67", "diff_url": "https://github.com/forwardemail/supertest/pull/67.diff", "patch_url": "https://github.com/forwardemail/supertest/pull/67.patch", "merged_at": null}, "body": "This is a followup PR for #49. The question is: how to fix these based on how people think supertest should behave? Or of course I could be doing something wrong as well :)\n\nThere are two issues, as outlined in the comments, reproduced below:\n\n1) .pipe returns this.end().req.on(...). `this` of .on is http(s) Request, not supertest, meaning calls to `expect`, `assert`, etc fail because they don't exist \n\n2) .pipe, defined in superagent Request#pipe, calls `this.end()...` without an fn arg. `this.end` is actually Test#end, which has no guards for an undefined callback. What should the behavior of `this.end` with no callback be in supertest when there are errors? \n", "closed_by": {"login": "rimiti", "id": 28003749, "node_id": "MDQ6VXNlcjI4MDAzNzQ5", "avatar_url": "https://avatars.githubusercontent.com/u/28003749?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rimiti", "html_url": "https://github.com/rimiti", "followers_url": "https://api.github.com/users/rimiti/followers", "following_url": "https://api.github.com/users/rimiti/following{/other_user}", "gists_url": "https://api.github.com/users/rimiti/gists{/gist_id}", "starred_url": "https://api.github.com/users/rimiti/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rimiti/subscriptions", "organizations_url": "https://api.github.com/users/rimiti/orgs", "repos_url": "https://api.github.com/users/rimiti/repos", "events_url": "https://api.github.com/users/rimiti/events{/privacy}", "received_events_url": "https://api.github.com/users/rimiti/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/forwardemail/supertest/issues/67/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/forwardemail/supertest/issues/67/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/forwardemail/supertest/issues/480", "repository_url": "https://api.github.com/repos/forwardemail/supertest", "labels_url": "https://api.github.com/repos/forwardemail/supertest/issues/480/labels{/name}", "comments_url": "https://api.github.com/repos/forwardemail/supertest/issues/480/comments", "events_url": "https://api.github.com/repos/forwardemail/supertest/issues/480/events", "html_url": "https://github.com/forwardemail/supertest/issues/480", "id": 322862285, "node_id": "MDU6SXNzdWUzMjI4NjIyODU=", "number": 480, "title": "set hostname test failing", "user": {"login": "mikelax", "id": 2080701, "node_id": "MDQ6VXNlcjIwODA3MDE=", "avatar_url": "https://avatars.githubusercontent.com/u/2080701?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mikelax", "html_url": "https://github.com/mikelax", "followers_url": "https://api.github.com/users/mikelax/followers", "following_url": "https://api.github.com/users/mikelax/following{/other_user}", "gists_url": "https://api.github.com/users/mikelax/gists{/gist_id}", "starred_url": "https://api.github.com/users/mikelax/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mikelax/subscriptions", "organizations_url": "https://api.github.com/users/mikelax/orgs", "repos_url": "https://api.github.com/users/mikelax/repos", "events_url": "https://api.github.com/users/mikelax/events{/privacy}", "received_events_url": "https://api.github.com/users/mikelax/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 7951643, "node_id": "MDU6TGFiZWw3OTUxNjQz", "url": "https://api.github.com/repos/forwardemail/supertest/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignees": [{"login": "rimiti", "id": 28003749, "node_id": "MDQ6VXNlcjI4MDAzNzQ5", "avatar_url": "https://avatars.githubusercontent.com/u/28003749?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rimiti", "html_url": "https://github.com/rimiti", "followers_url": "https://api.github.com/users/rimiti/followers", "following_url": "https://api.github.com/users/rimiti/following{/other_user}", "gists_url": "https://api.github.com/users/rimiti/gists{/gist_id}", "starred_url": "https://api.github.com/users/rimiti/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rimiti/subscriptions", "organizations_url": "https://api.github.com/users/rimiti/orgs", "repos_url": "https://api.github.com/users/rimiti/repos", "events_url": "https://api.github.com/users/rimiti/events{/privacy}", "received_events_url": "https://api.github.com/users/rimiti/received_events", "type": "User", "user_view_type": "public", "site_admin": false}], "milestone": {"url": "https://api.github.com/repos/forwardemail/supertest/milestones/6", "html_url": "https://github.com/forwardemail/supertest/milestone/6", "labels_url": "https://api.github.com/repos/forwardemail/supertest/milestones/6/labels", "id": 2953349, "node_id": "MDk6TWlsZXN0b25lMjk1MzM0OQ==", "number": 6, "title": "v3.1.0", "description": "", "creator": {"login": "mikelax", "id": 2080701, "node_id": "MDQ6VXNlcjIwODA3MDE=", "avatar_url": "https://avatars.githubusercontent.com/u/2080701?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mikelax", "html_url": "https://github.com/mikelax", "followers_url": "https://api.github.com/users/mikelax/followers", "following_url": "https://api.github.com/users/mikelax/following{/other_user}", "gists_url": "https://api.github.com/users/mikelax/gists{/gist_id}", "starred_url": "https://api.github.com/users/mikelax/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mikelax/subscriptions", "organizations_url": "https://api.github.com/users/mikelax/orgs", "repos_url": "https://api.github.com/users/mikelax/repos", "events_url": "https://api.github.com/users/mikelax/events{/privacy}", "received_events_url": "https://api.github.com/users/mikelax/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "open_issues": 0, "closed_issues": 11, "state": "closed", "created_at": "2017-12-02T23:04:14Z", "updated_at": "2018-09-05T13:54:53Z", "due_on": null, "closed_at": "2018-09-05T13:54:53Z"}, "comments": 4, "created_at": "2018-05-14T15:16:28Z", "updated_at": "2019-08-19T04:30:23Z", "closed_at": "2018-09-05T13:54:32Z", "assignee": {"login": "rimiti", "id": 28003749, "node_id": "MDQ6VXNlcjI4MDAzNzQ5", "avatar_url": "https://avatars.githubusercontent.com/u/28003749?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rimiti", "html_url": "https://github.com/rimiti", "followers_url": "https://api.github.com/users/rimiti/followers", "following_url": "https://api.github.com/users/rimiti/following{/other_user}", "gists_url": "https://api.github.com/users/rimiti/gists{/gist_id}", "starred_url": "https://api.github.com/users/rimiti/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rimiti/subscriptions", "organizations_url": "https://api.github.com/users/rimiti/orgs", "repos_url": "https://api.github.com/users/rimiti/repos", "events_url": "https://api.github.com/users/rimiti/events{/privacy}", "received_events_url": "https://api.github.com/users/rimiti/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "author_association": "CONTRIBUTOR", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "Overview\r\n===\r\nWith the release of v3.1.0, we introduced a failing test case. \r\nThe test case is:  `should set request hostname`\r\n\r\nThe test is timing out, implying the done function isn't being called, I took a quick look at the test case and the only change I *thought* needed to be made was to instead return the error, ie: change `done();` on line 835 to `return done(err);` but this doesn't fix the issue. \r\n", "closed_by": {"login": "mikelax", "id": 2080701, "node_id": "MDQ6VXNlcjIwODA3MDE=", "avatar_url": "https://avatars.githubusercontent.com/u/2080701?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mikelax", "html_url": "https://github.com/mikelax", "followers_url": "https://api.github.com/users/mikelax/followers", "following_url": "https://api.github.com/users/mikelax/following{/other_user}", "gists_url": "https://api.github.com/users/mikelax/gists{/gist_id}", "starred_url": "https://api.github.com/users/mikelax/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mikelax/subscriptions", "organizations_url": "https://api.github.com/users/mikelax/orgs", "repos_url": "https://api.github.com/users/mikelax/repos", "events_url": "https://api.github.com/users/mikelax/events{/privacy}", "received_events_url": "https://api.github.com/users/mikelax/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/forwardemail/supertest/issues/480/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/forwardemail/supertest/issues/480/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/forwardemail/supertest/issues/55", "repository_url": "https://api.github.com/repos/forwardemail/supertest", "labels_url": "https://api.github.com/repos/forwardemail/supertest/issues/55/labels{/name}", "comments_url": "https://api.github.com/repos/forwardemail/supertest/issues/55/comments", "events_url": "https://api.github.com/repos/forwardemail/supertest/issues/55/events", "html_url": "https://github.com/forwardemail/supertest/issues/55", "id": 12612732, "node_id": "MDU6SXNzdWUxMjYxMjczMg==", "number": 55, "title": "Stacked assertions fail due to api inconsistency", "user": {"login": "DavidIAm", "id": 663086, "node_id": "MDQ6VXNlcjY2MzA4Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/663086?v=4", "gravatar_id": "", "url": "https://api.github.com/users/DavidIAm", "html_url": "https://github.com/DavidIAm", "followers_url": "https://api.github.com/users/DavidIAm/followers", "following_url": "https://api.github.com/users/DavidIAm/following{/other_user}", "gists_url": "https://api.github.com/users/DavidIAm/gists{/gist_id}", "starred_url": "https://api.github.com/users/DavidIAm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/DavidIAm/subscriptions", "organizations_url": "https://api.github.com/users/DavidIAm/orgs", "repos_url": "https://api.github.com/users/DavidIAm/repos", "events_url": "https://api.github.com/users/DavidIAm/events{/privacy}", "received_events_url": "https://api.github.com/users/DavidIAm/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 7951643, "node_id": "MDU6TGFiZWw3OTUxNjQz", "url": "https://api.github.com/repos/forwardemail/supertest/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 4, "created_at": "2013-03-29T17:46:15Z", "updated_at": "2019-03-10T09:17:36Z", "closed_at": "2019-03-09T11:25:43Z", "assignee": null, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "When attempting to execute this test:\n\nrequest(app)\n.get('/report/all')\n.redirects(1)\n.set('Accept', 'application/json')\n.expect('Content-Type', /json/)\n.end(function (err, res) { ...custom jasmine assertions here... } );\n\nI get this error:\n\nnode_modules/supertest/lib/test.js:186\n    actual = res.header[field.toLowerCase()];\n                ^\nTypeError: Cannot read property 'header' of null\n    at Test.assert (node_modules/supertest/lib/test.js:186:17)\n    at Test.end (node_modules/supertest/lib/test.js:124:10)\n    at Test.assert (node_modules/supertest/lib/test.js:196:3)\n    at Test.end (node_modules/supertest/lib/test.js:124:10)\n    at Test.Request.callback (node_modules/supertest/node_modules/superagent/lib/node/index.js:575:3)\n    at Test.<anonymous> (node_modules/supertest/node_modules/superagent/lib/node/index.js:133:10)\n    at Test.EventEmitter.emit (events.js:93:17)\n    at IncomingMessage.Request.end (node_modules/supertest/node_modules/superagent/lib/node/index.js:705:12)\n    at IncomingMessage.EventEmitter.emit (events.js:123:20)\n    at IncomingMessage._emitEnd (http.js:366:10)\n\nMy best understanding from analysis is that the the previous assert is passing through to another assert, but the input to the end event/method is just the response (res) and the input to whatever is passed through includes the error (err, res) making the inconsistency of the api causing the issue.  (perhaps a small wrapper for the first call inserting a null error after revising the api to consistently be err, res would do the job)\n", "closed_by": {"login": "rimiti", "id": 28003749, "node_id": "MDQ6VXNlcjI4MDAzNzQ5", "avatar_url": "https://avatars.githubusercontent.com/u/28003749?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rimiti", "html_url": "https://github.com/rimiti", "followers_url": "https://api.github.com/users/rimiti/followers", "following_url": "https://api.github.com/users/rimiti/following{/other_user}", "gists_url": "https://api.github.com/users/rimiti/gists{/gist_id}", "starred_url": "https://api.github.com/users/rimiti/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rimiti/subscriptions", "organizations_url": "https://api.github.com/users/rimiti/orgs", "repos_url": "https://api.github.com/users/rimiti/repos", "events_url": "https://api.github.com/users/rimiti/events{/privacy}", "received_events_url": "https://api.github.com/users/rimiti/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/forwardemail/supertest/issues/55/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/forwardemail/supertest/issues/55/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/forwardemail/supertest/issues/840", "repository_url": "https://api.github.com/repos/forwardemail/supertest", "labels_url": "https://api.github.com/repos/forwardemail/supertest/issues/840/labels{/name}", "comments_url": "https://api.github.com/repos/forwardemail/supertest/issues/840/comments", "events_url": "https://api.github.com/repos/forwardemail/supertest/issues/840/events", "html_url": "https://github.com/forwardemail/supertest/issues/840", "id": 2326773608, "node_id": "I_kwDOAElymM6Kr79o", "number": 840, "title": "[fix] bug based on node version", "user": {"login": "HongChaeMin", "id": 57277976, "node_id": "MDQ6VXNlcjU3Mjc3OTc2", "avatar_url": "https://avatars.githubusercontent.com/u/57277976?v=4", "gravatar_id": "", "url": "https://api.github.com/users/HongChaeMin", "html_url": "https://github.com/HongChaeMin", "followers_url": "https://api.github.com/users/HongChaeMin/followers", "following_url": "https://api.github.com/users/HongChaeMin/following{/other_user}", "gists_url": "https://api.github.com/users/HongChaeMin/gists{/gist_id}", "starred_url": "https://api.github.com/users/HongChaeMin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/HongChaeMin/subscriptions", "organizations_url": "https://api.github.com/users/HongChaeMin/orgs", "repos_url": "https://api.github.com/users/HongChaeMin/repos", "events_url": "https://api.github.com/users/HongChaeMin/events{/privacy}", "received_events_url": "https://api.github.com/users/HongChaeMin/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 7951643, "node_id": "MDU6TGFiZWw3OTUxNjQz", "url": "https://api.github.com/repos/forwardemail/supertest/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 3, "created_at": "2024-05-31T00:48:00Z", "updated_at": "2025-07-07T18:56:38Z", "closed_at": "2025-07-07T18:56:38Z", "assignee": null, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "## Describe the bug\r\n\r\n**Node.js version:** v22.1.0\r\n\r\n**OS version:** MacOS Sonoma 14.4.1(23E224)\r\n\r\n**Description:** From node 22 version, Array.isArray has been deprecated (https://nodejs.org/api/deprecations.html)\r\n\r\n```typescript\r\nrequest(app.getHttpServer())\r\n    .post(router)\r\n    .set('Content-Type', 'multipart/form-data')\r\n    .field('country', data.country)\r\n    .field('businessLocation', data.businessLocation)\r\n    .attach('file', 'test/resources/image.png')\r\n    .expect(HttpStatus.CREATED)\r\n    .expect(({ body }) => {\r\n        expect(body).toBeDefined();\r\n    });\r\n```\r\n\r\n\r\n```\r\n(node:13214) [DEP0044] DeprecationWarning: The `util.isArray` API is deprecated. Please use `Array.isArray()` instead.\r\n(Use `node --trace-deprecation ...` to show where the warning was created)\r\n```\r\n\r\nWhen you run code on Webstorm, get the above log and when you run it on cli, get the log `Aborted`.\r\nMaybe using `isArray`inside the `field` and `attach` functions.\r\n\r\n\r\n## Checklist\r\n\r\n- [x] I have searched through GitHub issues for similar issues.\r\n- [x] I have completely read through the README and documentation.\r\n- [x] I have tested my code with the latest version of Node.js and this package and confirmed it is still not working.\r\n", "closed_by": {"login": "titanism", "id": 101466223, "node_id": "U_kgDOBgxAbw", "avatar_url": "https://avatars.githubusercontent.com/u/101466223?v=4", "gravatar_id": "", "url": "https://api.github.com/users/titanism", "html_url": "https://github.com/titanism", "followers_url": "https://api.github.com/users/titanism/followers", "following_url": "https://api.github.com/users/titanism/following{/other_user}", "gists_url": "https://api.github.com/users/titanism/gists{/gist_id}", "starred_url": "https://api.github.com/users/titanism/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/titanism/subscriptions", "organizations_url": "https://api.github.com/users/titanism/orgs", "repos_url": "https://api.github.com/users/titanism/repos", "events_url": "https://api.github.com/users/titanism/events{/privacy}", "received_events_url": "https://api.github.com/users/titanism/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/forwardemail/supertest/issues/840/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/forwardemail/supertest/issues/840/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/forwardemail/supertest/issues/829", "repository_url": "https://api.github.com/repos/forwardemail/supertest", "labels_url": "https://api.github.com/repos/forwardemail/supertest/issues/829/labels{/name}", "comments_url": "https://api.github.com/repos/forwardemail/supertest/issues/829/comments", "events_url": "https://api.github.com/repos/forwardemail/supertest/issues/829/events", "html_url": "https://github.com/forwardemail/supertest/issues/829", "id": 2053283611, "node_id": "I_kwDOAElymM56Yp8b", "number": 829, "title": "SuperTest is not compatible with Node v18.19.0 Error: ECONNREFUSED: Connection Refused", "user": {"login": "brianpilati", "id": 369083, "node_id": "MDQ6VXNlcjM2OTA4Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/369083?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brianpilati", "html_url": "https://github.com/brianpilati", "followers_url": "https://api.github.com/users/brianpilati/followers", "following_url": "https://api.github.com/users/brianpilati/following{/other_user}", "gists_url": "https://api.github.com/users/brianpilati/gists{/gist_id}", "starred_url": "https://api.github.com/users/brianpilati/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brianpilati/subscriptions", "organizations_url": "https://api.github.com/users/brianpilati/orgs", "repos_url": "https://api.github.com/users/brianpilati/repos", "events_url": "https://api.github.com/users/brianpilati/events{/privacy}", "received_events_url": "https://api.github.com/users/brianpilati/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 7951643, "node_id": "MDU6TGFiZWw3OTUxNjQz", "url": "https://api.github.com/repos/forwardemail/supertest/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": true, "assignees": [], "milestone": null, "comments": 3, "created_at": "2023-12-22T02:29:23Z", "updated_at": "2024-01-23T21:53:54Z", "closed_at": "2024-01-23T21:53:35Z", "assignee": null, "author_association": "NONE", "type": null, "active_lock_reason": "spam", "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "## Describe the bug\r\n\r\n**Node.js version:** v18.19.0\r\n\r\n**OS version:** Ventura 13.6.1\r\n\r\n**Description:** SuperTest is not compatible with Node v18.19.0 Error: ECONNREFUSED: Connection Refused\r\n\r\n## Actual behavior\r\n\r\nIf I run supertest with node@16.20.2, all my test pass. If I run it with node@18.19.0, none of my tests run and I can an error\r\n\r\n## Expected behavior\r\n\r\nTests to run like using node@16.20.2\r\n\r\n## Code to reproduce\r\n\r\nat Test.assert (/Users/brian.pilati/code/greenseed/prism/subscription/prism-subscription-api/node_modules/supertest/lib/test.js:156:20)\r\n    at localAssert (/Users/brian.pilati/code/greenseed/prism/subscription/prism-subscription-api/node_modules/supertest/lib/test.js:120:14)\r\n    at /Users/brian.pilati/code/greenseed/prism/subscription/prism-subscription-api/node_modules/supertest/lib/test.js:125:7\r\n    at Request.callback (/Users/brian.pilati/code/greenseed/prism/subscription/prism-subscription-api/node_modules/superagent/lib/node/index.js:867:3)\r\n    at ClientRequest.<anonymous> (/Users/brian.pilati/code/greenseed/prism/subscription/prism-subscription-api/node_modules/superagent/lib/node/index.js:789:10)\r\n    at ClientRequest.emit (node:events:517:28)\r\n    at Socket.socketErrorListener (node:_http_client:501:9)\r\n    at Socket.emit (node:events:517:28)\r\n    at emitErrorNT (node:internal/streams/destroy:151:8)\r\n    at emitErrorCloseNT (node:internal/streams/destroy:116:3)\r\n\r\nconsole log from line 156\r\n\r\n```\r\nError: connect ECONNREFUSED 127.0.0.1:3999\r\n    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1555:16) {\r\n  errno: -61,\r\n  code: 'ECONNREFUSED',\r\n  syscall: 'connect',\r\n  address: '127.0.0.1',\r\n  port: 3999,\r\n  response: undefined\r\n}\r\n```\r\n\r\nI did remove all my node_modules and reinstall using node@18 and there was no change.\r\n\r\n## Checklist\r\n\r\n- [ ] I have searched through GitHub issues for similar issues.\r\n- [ ] I have completely read through the README and documentation.\r\n- [ ] I have tested my code with the latest version of Node.js and this package and confirmed it is still not working.\r\n", "closed_by": {"login": "titanism", "id": 101466223, "node_id": "U_kgDOBgxAbw", "avatar_url": "https://avatars.githubusercontent.com/u/101466223?v=4", "gravatar_id": "", "url": "https://api.github.com/users/titanism", "html_url": "https://github.com/titanism", "followers_url": "https://api.github.com/users/titanism/followers", "following_url": "https://api.github.com/users/titanism/following{/other_user}", "gists_url": "https://api.github.com/users/titanism/gists{/gist_id}", "starred_url": "https://api.github.com/users/titanism/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/titanism/subscriptions", "organizations_url": "https://api.github.com/users/titanism/orgs", "repos_url": "https://api.github.com/users/titanism/repos", "events_url": "https://api.github.com/users/titanism/events{/privacy}", "received_events_url": "https://api.github.com/users/titanism/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/forwardemail/supertest/issues/829/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/forwardemail/supertest/issues/829/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/forwardemail/supertest/issues/815", "repository_url": "https://api.github.com/repos/forwardemail/supertest", "labels_url": "https://api.github.com/repos/forwardemail/supertest/issues/815/labels{/name}", "comments_url": "https://api.github.com/repos/forwardemail/supertest/issues/815/comments", "events_url": "https://api.github.com/repos/forwardemail/supertest/issues/815/events", "html_url": "https://github.com/forwardemail/supertest/issues/815", "id": 1559837793, "node_id": "I_kwDOAElymM5c-Txh", "number": 815, "title": "`_body` key instead of `body` in response", "user": {"login": "mrtl-srn", "id": 5698488, "node_id": "MDQ6VXNlcjU2OTg0ODg=", "avatar_url": "https://avatars.githubusercontent.com/u/5698488?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mrtl-srn", "html_url": "https://github.com/mrtl-srn", "followers_url": "https://api.github.com/users/mrtl-srn/followers", "following_url": "https://api.github.com/users/mrtl-srn/following{/other_user}", "gists_url": "https://api.github.com/users/mrtl-srn/gists{/gist_id}", "starred_url": "https://api.github.com/users/mrtl-srn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mrtl-srn/subscriptions", "organizations_url": "https://api.github.com/users/mrtl-srn/orgs", "repos_url": "https://api.github.com/users/mrtl-srn/repos", "events_url": "https://api.github.com/users/mrtl-srn/events{/privacy}", "received_events_url": "https://api.github.com/users/mrtl-srn/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 7951643, "node_id": "MDU6TGFiZWw3OTUxNjQz", "url": "https://api.github.com/repos/forwardemail/supertest/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 3, "created_at": "2023-01-27T14:13:30Z", "updated_at": "2025-07-07T18:55:00Z", "closed_at": "2025-07-07T18:47:26Z", "assignee": null, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "## Describe the bug\r\n\r\n**Node.js version:** >= 14\r\n\r\n**OS version:** Docker devcontainer with vscode image\r\n\r\n**Description:** \r\n\r\nThere is a `_body` key instead of `body` in response.\r\nI don't know if it's an expected behavior due to recent changes but it's a breaking change for all my tests\r\n\r\n## Actual behavior\r\n\r\n```js\r\n// ./app.js\r\n\r\nconst express = require('express')\r\nconst app = express()\r\nconst port = 3000\r\n\r\napp.get('/', (req, res) => {\r\n  res.json({\r\n    ok: true,\r\n  })\r\n})\r\n\r\napp.listen(port, () => {\r\n  console.log(`Example app listening on port ${port}`)\r\n});\r\n\r\nmodule.exports = app;\r\n```\r\n\r\n```js\r\n// ./tests/app.test.js\r\n\r\nconst supertest = require('supertest');\r\nconst { expect } = require('chai');\r\nconst app = require('../app.js');\r\n\r\n\r\nconst server = supertest.agent(app);\r\n\r\ndescribe(\"Tests\", () => {\r\n  it('should return a JSON object', async () => {\r\n    const response = await server.get('/').expect(200);\r\n\r\n    console.log({ response });\r\n\r\n    expect(response).to.haveOwnProperty('body');\r\n  });\r\n});\r\n```\r\n\r\nResult\r\n```\r\n  1) Tests\r\n       should return a JSON object:\r\n     AssertionError: expected { Object (_events, _eventsCount, ...) } to have own property 'body'\r\n      at Context.<anonymous> (tests/app.test.js:14:25)\r\n      at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\r\n```\r\n\r\nIn the `response` object there is no \"body\", only a \"_body\"\r\n\r\n![image](https://user-images.githubusercontent.com/5698488/215105655-30448fb6-e8b1-4aae-b771-ed6cabf25b64.png)\r\n\r\n\r\n## Expected behavior\r\n\r\n\"body\" should be present and test should pass.\r\n\r\n## Code to reproduce\r\n\r\nHere is a replit example : https://replit.com/@MartialSeron/RowdyTenseLocations#tests/app.test.js\r\nYou just have to run `npm test` in the shell\r\n\r\n## Checklist\r\n\r\n- [x] I have searched through GitHub issues for similar issues.\r\n- [x] I have completely read through the README and documentation.\r\n- [x] I have tested my code with the latest version of Node.js and this package and confirmed it is still not working.\r\n", "closed_by": {"login": "titanism", "id": 101466223, "node_id": "U_kgDOBgxAbw", "avatar_url": "https://avatars.githubusercontent.com/u/101466223?v=4", "gravatar_id": "", "url": "https://api.github.com/users/titanism", "html_url": "https://github.com/titanism", "followers_url": "https://api.github.com/users/titanism/followers", "following_url": "https://api.github.com/users/titanism/following{/other_user}", "gists_url": "https://api.github.com/users/titanism/gists{/gist_id}", "starred_url": "https://api.github.com/users/titanism/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/titanism/subscriptions", "organizations_url": "https://api.github.com/users/titanism/orgs", "repos_url": "https://api.github.com/users/titanism/repos", "events_url": "https://api.github.com/users/titanism/events{/privacy}", "received_events_url": "https://api.github.com/users/titanism/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/forwardemail/supertest/issues/815/reactions", "total_count": 5, "+1": 5, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/forwardemail/supertest/issues/815/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/forwardemail/supertest/issues/535", "repository_url": "https://api.github.com/repos/forwardemail/supertest", "labels_url": "https://api.github.com/repos/forwardemail/supertest/issues/535/labels{/name}", "comments_url": "https://api.github.com/repos/forwardemail/supertest/issues/535/comments", "events_url": "https://api.github.com/repos/forwardemail/supertest/issues/535/events", "html_url": "https://github.com/forwardemail/supertest/pull/535", "id": 399750831, "node_id": "MDExOlB1bGxSZXF1ZXN0MjQ1MTAwOTYw", "number": 535, "title": "V3.4.1", "user": {"login": "rimiti", "id": 28003749, "node_id": "MDQ6VXNlcjI4MDAzNzQ5", "avatar_url": "https://avatars.githubusercontent.com/u/28003749?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rimiti", "html_url": "https://github.com/rimiti", "followers_url": "https://api.github.com/users/rimiti/followers", "following_url": "https://api.github.com/users/rimiti/following{/other_user}", "gists_url": "https://api.github.com/users/rimiti/gists{/gist_id}", "starred_url": "https://api.github.com/users/rimiti/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rimiti/subscriptions", "organizations_url": "https://api.github.com/users/rimiti/orgs", "repos_url": "https://api.github.com/users/rimiti/repos", "events_url": "https://api.github.com/users/rimiti/events{/privacy}", "received_events_url": "https://api.github.com/users/rimiti/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 7951643, "node_id": "MDU6TGFiZWw3OTUxNjQz", "url": "https://api.github.com/repos/forwardemail/supertest/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignees": [{"login": "rimiti", "id": 28003749, "node_id": "MDQ6VXNlcjI4MDAzNzQ5", "avatar_url": "https://avatars.githubusercontent.com/u/28003749?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rimiti", "html_url": "https://github.com/rimiti", "followers_url": "https://api.github.com/users/rimiti/followers", "following_url": "https://api.github.com/users/rimiti/following{/other_user}", "gists_url": "https://api.github.com/users/rimiti/gists{/gist_id}", "starred_url": "https://api.github.com/users/rimiti/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rimiti/subscriptions", "organizations_url": "https://api.github.com/users/rimiti/orgs", "repos_url": "https://api.github.com/users/rimiti/repos", "events_url": "https://api.github.com/users/rimiti/events{/privacy}", "received_events_url": "https://api.github.com/users/rimiti/received_events", "type": "User", "user_view_type": "public", "site_admin": false}], "milestone": {"url": "https://api.github.com/repos/forwardemail/supertest/milestones/11", "html_url": "https://github.com/forwardemail/supertest/milestone/11", "labels_url": "https://api.github.com/repos/forwardemail/supertest/milestones/11/labels", "id": 3977272, "node_id": "MDk6TWlsZXN0b25lMzk3NzI3Mg==", "number": 11, "title": "v3.4.1", "description": null, "creator": {"login": "rimiti", "id": 28003749, "node_id": "MDQ6VXNlcjI4MDAzNzQ5", "avatar_url": "https://avatars.githubusercontent.com/u/28003749?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rimiti", "html_url": "https://github.com/rimiti", "followers_url": "https://api.github.com/users/rimiti/followers", "following_url": "https://api.github.com/users/rimiti/following{/other_user}", "gists_url": "https://api.github.com/users/rimiti/gists{/gist_id}", "starred_url": "https://api.github.com/users/rimiti/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rimiti/subscriptions", "organizations_url": "https://api.github.com/users/rimiti/orgs", "repos_url": "https://api.github.com/users/rimiti/repos", "events_url": "https://api.github.com/users/rimiti/events{/privacy}", "received_events_url": "https://api.github.com/users/rimiti/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "open_issues": 0, "closed_issues": 2, "state": "open", "created_at": "2019-01-16T10:48:56Z", "updated_at": "2019-01-22T08:04:51Z", "due_on": null, "closed_at": null}, "comments": 2, "created_at": "2019-01-16T10:49:12Z", "updated_at": "2019-01-16T12:25:42Z", "closed_at": "2019-01-16T12:25:38Z", "assignee": {"login": "rimiti", "id": 28003749, "node_id": "MDQ6VXNlcjI4MDAzNzQ5", "avatar_url": "https://avatars.githubusercontent.com/u/28003749?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rimiti", "html_url": "https://github.com/rimiti", "followers_url": "https://api.github.com/users/rimiti/followers", "following_url": "https://api.github.com/users/rimiti/following{/other_user}", "gists_url": "https://api.github.com/users/rimiti/gists{/gist_id}", "starred_url": "https://api.github.com/users/rimiti/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rimiti/subscriptions", "organizations_url": "https://api.github.com/users/rimiti/orgs", "repos_url": "https://api.github.com/users/rimiti/repos", "events_url": "https://api.github.com/users/rimiti/events{/privacy}", "received_events_url": "https://api.github.com/users/rimiti/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "author_association": "CONTRIBUTOR", "type": null, "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/forwardemail/supertest/pulls/535", "html_url": "https://github.com/forwardemail/supertest/pull/535", "diff_url": "https://github.com/forwardemail/supertest/pull/535.diff", "patch_url": "https://github.com/forwardemail/supertest/pull/535.patch", "merged_at": "2019-01-16T12:25:38Z"}, "body": "Hello guys,\r\n\r\nEverybody is agree to merge this hotfix (Related issue: #534} ?\r\n\r\nRegards, \r\n\r\n", "closed_by": {"login": "rimiti", "id": 28003749, "node_id": "MDQ6VXNlcjI4MDAzNzQ5", "avatar_url": "https://avatars.githubusercontent.com/u/28003749?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rimiti", "html_url": "https://github.com/rimiti", "followers_url": "https://api.github.com/users/rimiti/followers", "following_url": "https://api.github.com/users/rimiti/following{/other_user}", "gists_url": "https://api.github.com/users/rimiti/gists{/gist_id}", "starred_url": "https://api.github.com/users/rimiti/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rimiti/subscriptions", "organizations_url": "https://api.github.com/users/rimiti/orgs", "repos_url": "https://api.github.com/users/rimiti/repos", "events_url": "https://api.github.com/users/rimiti/events{/privacy}", "received_events_url": "https://api.github.com/users/rimiti/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/forwardemail/supertest/issues/535/reactions", "total_count": 3, "+1": 3, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/forwardemail/supertest/issues/535/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/forwardemail/supertest/issues/861", "repository_url": "https://api.github.com/repos/forwardemail/supertest", "labels_url": "https://api.github.com/repos/forwardemail/supertest/issues/861/labels{/name}", "comments_url": "https://api.github.com/repos/forwardemail/supertest/issues/861/comments", "events_url": "https://api.github.com/repos/forwardemail/supertest/issues/861/events", "html_url": "https://github.com/forwardemail/supertest/issues/861", "id": 3125772888, "node_id": "I_kwDOAElymM66T4JY", "number": 861, "title": "[fix] Nondeterministic failures when running example code on OSX", "user": {"login": "josephjunker", "id": 1519098, "node_id": "MDQ6VXNlcjE1MTkwOTg=", "avatar_url": "https://avatars.githubusercontent.com/u/1519098?v=4", "gravatar_id": "", "url": "https://api.github.com/users/josephjunker", "html_url": "https://github.com/josephjunker", "followers_url": "https://api.github.com/users/josephjunker/followers", "following_url": "https://api.github.com/users/josephjunker/following{/other_user}", "gists_url": "https://api.github.com/users/josephjunker/gists{/gist_id}", "starred_url": "https://api.github.com/users/josephjunker/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/josephjunker/subscriptions", "organizations_url": "https://api.github.com/users/josephjunker/orgs", "repos_url": "https://api.github.com/users/josephjunker/repos", "events_url": "https://api.github.com/users/josephjunker/events{/privacy}", "received_events_url": "https://api.github.com/users/josephjunker/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 7951643, "node_id": "MDU6TGFiZWw3OTUxNjQz", "url": "https://api.github.com/repos/forwardemail/supertest/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 1, "created_at": "2025-06-06T20:13:46Z", "updated_at": "2025-06-06T21:30:03Z", "closed_at": "2025-06-06T21:30:02Z", "assignee": null, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "## Describe the bug\n\n**Node.js version:**  v22.15.1\n\n**OS version:** OSX Sequoia 15.5\n\n**Description:**  When running the provided example code in a loop, nondeterministic failures occur on OSX.\n\nI'm running the code from the top of the README 100k times in a loop (in series, not in parallel). When I do this I get failures. These failures appear to be the result of Supertest connecting to ports which are already in use by other programs.\n\nI previously thought this might be a Nestjs issue (https://github.com/nestjs/nest/issues/15239) but it occurs with plain Supertest and Express.\n\n## Actual behavior\n\nI have seen the following errors:\n\n```\nfailed with error!\nError: Parse Error: Expected HTTP/\n    at Socket.socketOnData (node:_http_client:558:22)\n    at Socket.emit (node:events:518:28)\n    at addChunk (node:internal/streams/readable:561:12)\n    at readableAddChunkPushByteMode (node:internal/streams/readable:512:3)\n    at Readable.push (node:internal/streams/readable:392:5)\n    at TCP.onStreamRead (node:internal/stream_base_commons:189:23) {\n  bytesParsed: 0,\n  code: 'HPE_INVALID_CONSTANT',\n  reason: 'Expected HTTP/',\n  rawPacket: Buffer(21) [Uint8Array] [<I've omitted this, its contents vary>],\n  response: undefined\n}\n```\n\n```\nfailed with error!\nError: socket hang up\n    at Socket.socketOnEnd (node:_http_client:542:25)\n    at Socket.emit (node:events:530:35)\n    at endReadableNT (node:internal/streams/readable:1698:12)\n    at process.processTicksAndRejections (node:internal/process/task_queues:90:21) {\n  code: 'ECONNRESET',\n  response: undefined\n}\n```\n\n```\nfailed with error!\nError: expected \"Content-Type\" matching /json/, got \"text/plain\"\n    at run (/Users/josephjunker/code/supertest-minimal-repro/index.js:14:14)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n----\n    at Test._assertHeader (/Users/josephjunker/code/supertest-minimal-repro/node_modules/supertest/lib/test.js:247:16)\n    at /Users/josephjunker/code/supertest-minimal-repro/node_modules/supertest/lib/test.js:323:13\n    at Test._assertFunction (/Users/josephjunker/code/supertest-minimal-repro/node_modules/supertest/lib/test.js:300:13)\n    at Test.assert (/Users/josephjunker/code/supertest-minimal-repro/node_modules/supertest/lib/test.js:179:23)\n    at Server.localAssert (/Users/josephjunker/code/supertest-minimal-repro/node_modules/supertest/lib/test.js:135:14)\n    at Object.onceWrapper (node:events:632:28)\n    at Server.emit (node:events:518:28)\n    at emitCloseNT (node:net:2418:8)\n    at process.processTicksAndRejections (node:internal/process/task_queues:89:21)\n```\n\n## Expected behavior\n\nNo error should occur; the example code should always work.\n\n## Code to reproduce\n\n```javascript\nconst request = require('supertest');\nconst express = require('express');\n\nconst app = express();\n\napp.get('/user', function(req, res) {\n  res.status(200).json({ name: 'john' });\n});\n\nasync function run() {\n    for (let i = 0; i < 100000; i++) {\n        await request(app)\n            .get('/user')\n            .expect('Content-Type', /json/)\n            .expect('Content-Length', '15')\n            .expect(200)\n    }\n}\n\nrun().catch(err => {\n    console.log(\"failed with error!\");\n    console.dir(err);\n})\n```\n\nI have reproduced failures on multiple OSX machines but I have not had a chance to test on other OSes yet.\n\n<!--\nWe encourage you to submit a pull request with a failing test:\n\n1) This will make it more likely for us to prioritize your issue.\n2) It's a good way to prove that the issue is related to this project and not your code.\n\nExample: <https://github.com/avajs/ava/blob/master/docs/01-writing-tests.md#failing-tests>\n-->\n\n## Checklist\n\n- [x] I have searched through GitHub issues for similar issues.\n- [x] I have completely read through the README and documentation.\n- [x] I have tested my code with the latest version of Node.js and this package and confirmed it is still not working.\n", "closed_by": {"login": "josephjunker", "id": 1519098, "node_id": "MDQ6VXNlcjE1MTkwOTg=", "avatar_url": "https://avatars.githubusercontent.com/u/1519098?v=4", "gravatar_id": "", "url": "https://api.github.com/users/josephjunker", "html_url": "https://github.com/josephjunker", "followers_url": "https://api.github.com/users/josephjunker/followers", "following_url": "https://api.github.com/users/josephjunker/following{/other_user}", "gists_url": "https://api.github.com/users/josephjunker/gists{/gist_id}", "starred_url": "https://api.github.com/users/josephjunker/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/josephjunker/subscriptions", "organizations_url": "https://api.github.com/users/josephjunker/orgs", "repos_url": "https://api.github.com/users/josephjunker/repos", "events_url": "https://api.github.com/users/josephjunker/events{/privacy}", "received_events_url": "https://api.github.com/users/josephjunker/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/forwardemail/supertest/issues/861/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/forwardemail/supertest/issues/861/timeline", "performed_via_github_app": null, "state_reason": "completed"}, {"url": "https://api.github.com/repos/forwardemail/supertest/issues/860", "repository_url": "https://api.github.com/repos/forwardemail/supertest", "labels_url": "https://api.github.com/repos/forwardemail/supertest/issues/860/labels{/name}", "comments_url": "https://api.github.com/repos/forwardemail/supertest/issues/860/comments", "events_url": "https://api.github.com/repos/forwardemail/supertest/issues/860/events", "html_url": "https://github.com/forwardemail/supertest/issues/860", "id": 3072730939, "node_id": "I_kwDOAElymM63Jic7", "number": 860, "title": "[fix] agent.query() is shadowed by HTTP method handler and therefore fails with \"TypeError: Invalid URL\"", "user": {"login": "sergburn", "id": 1159466, "node_id": "MDQ6VXNlcjExNTk0NjY=", "avatar_url": "https://avatars.githubusercontent.com/u/1159466?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sergburn", "html_url": "https://github.com/sergburn", "followers_url": "https://api.github.com/users/sergburn/followers", "following_url": "https://api.github.com/users/sergburn/following{/other_user}", "gists_url": "https://api.github.com/users/sergburn/gists{/gist_id}", "starred_url": "https://api.github.com/users/sergburn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sergburn/subscriptions", "organizations_url": "https://api.github.com/users/sergburn/orgs", "repos_url": "https://api.github.com/users/sergburn/repos", "events_url": "https://api.github.com/users/sergburn/events{/privacy}", "received_events_url": "https://api.github.com/users/sergburn/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 7951643, "node_id": "MDU6TGFiZWw3OTUxNjQz", "url": "https://api.github.com/repos/forwardemail/supertest/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 1, "created_at": "2025-05-19T06:56:10Z", "updated_at": "2025-07-07T18:54:33Z", "closed_at": "2025-07-07T18:47:24Z", "assignee": null, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "## Describe the bug\n\n**Node.js version:** 20.19.2\n\n**OS version:** Mac OS 15.4.1\n\n**Description:** An attempt to call `supertest.agent.query(<object>)` fails with \"TypeError: Invalid URL\". This does not happen in Node v20.19.1, but does so in 20.19.2, apparently because of [llhttp upgrade](https://github.com/nodejs/node/releases/tag/v20.19.2). The \"query\" is another HTTP method and [`methods.forEach()` in agent.js](https://github.com/ladjs/supertest/blob/200031e21905b25591ece2111ab2eb56cbf48fa2/lib/agent.js#L62) overwrites the `query()` function in superagent. (However, it looks like the same mistake is made [in superagent as well](https://github.com/ladjs/superagent/blob/ac678ef848e2a7a3690703fb4ef3217b76b4cd2a/src/node/agent.js#L81))\n\nVerified that same happens in Node 22.15.1\n\n## Actual behavior\n\nThe call fails with TypeError.\n```\nnode:internal/url:818\n      href = bindingUrl.parse(input, base, true);\n                        ^\n\nTypeError: Invalid URL\n    at new URL (node:internal/url:818:25)\n    at TestAgent._attachCookies (.../node_modules/superagent/lib/node/agent.js:69:17)\n    at TestAgent.<computed> [as query] (.../node_modules/supertest/lib/agent.js:77:10\n```\n\n## Expected behavior\n\nThis call is expected to store query parameters map in Agent's \"defaults\" to be re-used with following post()/get()/put() etc calls. \n\n## Code to reproduce\n\n```js\nconst supertest = require('supertest');\nconst agent = supertest.agent('http://localhost:3000');\nagent.query({ param: 'test' });\n```\n\n## Checklist\n\n- [x] I have searched through GitHub issues for similar issues.\n- [x] I have completely read through the README and documentation.\n- [x] I have tested my code with the latest version of Node.js and this package and confirmed it is still not working.\n", "closed_by": {"login": "titanism", "id": 101466223, "node_id": "U_kgDOBgxAbw", "avatar_url": "https://avatars.githubusercontent.com/u/101466223?v=4", "gravatar_id": "", "url": "https://api.github.com/users/titanism", "html_url": "https://github.com/titanism", "followers_url": "https://api.github.com/users/titanism/followers", "following_url": "https://api.github.com/users/titanism/following{/other_user}", "gists_url": "https://api.github.com/users/titanism/gists{/gist_id}", "starred_url": "https://api.github.com/users/titanism/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/titanism/subscriptions", "organizations_url": "https://api.github.com/users/titanism/orgs", "repos_url": "https://api.github.com/users/titanism/repos", "events_url": "https://api.github.com/users/titanism/events{/privacy}", "received_events_url": "https://api.github.com/users/titanism/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/forwardemail/supertest/issues/860/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/forwardemail/supertest/issues/860/timeline", "performed_via_github_app": null, "state_reason": "completed"}]}