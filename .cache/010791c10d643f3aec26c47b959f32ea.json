{"d": [{"url": "https://api.github.com/repos/better-auth/better-auth/issues/1006", "repository_url": "https://api.github.com/repos/better-auth/better-auth", "labels_url": "https://api.github.com/repos/better-auth/better-auth/issues/1006/labels{/name}", "comments_url": "https://api.github.com/repos/better-auth/better-auth/issues/1006/comments", "events_url": "https://api.github.com/repos/better-auth/better-auth/issues/1006/events", "html_url": "https://github.com/better-auth/better-auth/issues/1006", "id": 2756599335, "node_id": "I_kwDOL90GLc6kTl4n", "number": 1006, "title": "`useSession()` not always triggering a state change", "user": {"login": "k3dom", "id": 71038454, "node_id": "MDQ6VXNlcjcxMDM4NDU0", "avatar_url": "https://avatars.githubusercontent.com/u/71038454?v=4", "gravatar_id": "", "url": "https://api.github.com/users/k3dom", "html_url": "https://github.com/k3dom", "followers_url": "https://api.github.com/users/k3dom/followers", "following_url": "https://api.github.com/users/k3dom/following{/other_user}", "gists_url": "https://api.github.com/users/k3dom/gists{/gist_id}", "starred_url": "https://api.github.com/users/k3dom/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/k3dom/subscriptions", "organizations_url": "https://api.github.com/users/k3dom/orgs", "repos_url": "https://api.github.com/users/k3dom/repos", "events_url": "https://api.github.com/users/k3dom/events{/privacy}", "received_events_url": "https://api.github.com/users/k3dom/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 6971796828, "node_id": "LA_kwDOL90GLc8AAAABn40tXA", "url": "https://api.github.com/repos/better-auth/better-auth/labels/bug", "name": "bug", "color": "d73a4a", "default": true, "description": "Something isn't working"}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 76, "created_at": "2024-12-23T19:18:44Z", "updated_at": "2026-01-09T09:08:22Z", "closed_at": "2026-01-09T09:03:31Z", "assignee": null, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### Is this suited for github?\n\n- [X] Yes, this is suited for github\n\n### To Reproduce\n\n1. Sign in with email and password\r\n2. Use `useSession()` in the following component:\r\n\r\n```ts\r\nexport function AuthLayout({ children }: AppLayoutProps) {\r\n  const sidebar = useConfigStore((state) => state.sidebar)\r\n  const { data: session } = useSession()\r\n\r\n  return (\r\n    <SidebarProvider defaultOpen={sidebar}>\r\n      <Sidebar collapsible=\"icon\" variant=\"inset\">\r\n        <SidebarHeader>Test</SidebarHeader>\r\n        <SidebarContent>\r\n          <NavMain />\r\n        </SidebarContent>\r\n        <SidebarFooter>\r\n          <NavUser\r\n            name={session?.user.name ?? ''}\r\n            email={session?.user.email ?? ''}\r\n          />\r\n        </SidebarFooter>\r\n        <SidebarRail />\r\n      </Sidebar>\r\n      <SidebarInset>\r\n        <NavHeader />\r\n        <div className=\"m-4 mt-0 h-full\">{children}</div>\r\n      </SidebarInset>\r\n    </SidebarProvider>\r\n  )\r\n}\r\n```\n\n### Current vs. Expected behavior\n\n- **Current**:\r\nThe session state always starts with `null` (as it should). It then does a network request to `get-session` which succeeds. The problem now is that the state does not update maybe 50% to the time resulting in me not being able to show the user's name in this example. If I then trigger a component rerender by e.g. opening the navbar, the session information is properly reflected in the UI\r\n\r\n- **Expected**:\r\nI expect the state to always update after a successfull `get-session` call\n\n### What version of Better Auth are you using?\n\n1.1.1\n\n### Provide environment information\n\n```bash\nOS: Linux 6.12.4-arch1-1\r\nBrowser: Chrome 130.0.6723.116\n```\n\n\n### Which area(s) are affected? (Select all that apply)\n\nClient\n\n### Auth config (if applicable)\n\n```typescript\nbetterAuth({\r\n      trustedOrigins: c.env.BETTER_AUTH_TRUSTED_ORIGINS.split(','),\r\n      database: drizzleAdapter(c.get('db'), {\r\n        provider: 'pg',\r\n        usePlural: true,\r\n      }),\r\n      emailAndPassword: {\r\n        enabled: true,\r\n      },\r\n      advanced: {\r\n        cookiePrefix: 'viaptic',\r\n      },\r\n    })\n```\n\n\n### Additional context\n\nI tested this in both production and development and on both Chrome and Firefox. The issue persists everywhere", "closed_by": {"login": "ping-maxwell", "id": 145994855, "node_id": "U_kgDOCLO0Zw", "avatar_url": "https://avatars.githubusercontent.com/u/145994855?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ping-maxwell", "html_url": "https://github.com/ping-maxwell", "followers_url": "https://api.github.com/users/ping-maxwell/followers", "following_url": "https://api.github.com/users/ping-maxwell/following{/other_user}", "gists_url": "https://api.github.com/users/ping-maxwell/gists{/gist_id}", "starred_url": "https://api.github.com/users/ping-maxwell/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ping-maxwell/subscriptions", "organizations_url": "https://api.github.com/users/ping-maxwell/orgs", "repos_url": "https://api.github.com/users/ping-maxwell/repos", "events_url": "https://api.github.com/users/ping-maxwell/events{/privacy}", "received_events_url": "https://api.github.com/users/ping-maxwell/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/better-auth/better-auth/issues/1006/reactions", "total_count": 68, "+1": 64, "-1": 0, "laugh": 0, "hooray": 0, "confused": 4, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/better-auth/better-auth/issues/1006/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/better-auth/better-auth/issues/2055", "repository_url": "https://api.github.com/repos/better-auth/better-auth", "labels_url": "https://api.github.com/repos/better-auth/better-auth/issues/2055/labels{/name}", "comments_url": "https://api.github.com/repos/better-auth/better-auth/issues/2055/comments", "events_url": "https://api.github.com/repos/better-auth/better-auth/issues/2055/events", "html_url": "https://github.com/better-auth/better-auth/issues/2055", "id": 2958594443, "node_id": "I_kwDOL90GLc6wWJGL", "number": 2055, "title": "auth.api.getSession returns null in RSC Layout.tsx with valid session", "user": {"login": "ian", "id": 19853, "node_id": "MDQ6VXNlcjE5ODUz", "avatar_url": "https://avatars.githubusercontent.com/u/19853?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ian", "html_url": "https://github.com/ian", "followers_url": "https://api.github.com/users/ian/followers", "following_url": "https://api.github.com/users/ian/following{/other_user}", "gists_url": "https://api.github.com/users/ian/gists{/gist_id}", "starred_url": "https://api.github.com/users/ian/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ian/subscriptions", "organizations_url": "https://api.github.com/users/ian/orgs", "repos_url": "https://api.github.com/users/ian/repos", "events_url": "https://api.github.com/users/ian/events{/privacy}", "received_events_url": "https://api.github.com/users/ian/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 6971796828, "node_id": "LA_kwDOL90GLc8AAAABn40tXA", "url": "https://api.github.com/repos/better-auth/better-auth/labels/bug", "name": "bug", "color": "d73a4a", "default": true, "description": "Something isn't working"}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 68, "created_at": "2025-03-30T01:14:53Z", "updated_at": "2026-02-07T19:44:31Z", "closed_at": "2025-08-08T00:36:06Z", "assignee": null, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### Is this suited for github?\n\n- [x] Yes, this is suited for github\n\n### To Reproduce\n\nI'm trying to debug why `auth.api.getSession` will return null, when the session is valid after a query to /api/auth/get-session.\n\nConsider the following src/app/layout.tsx:\n\n```ts\nimport { Providers } from '@/components/providers';\nimport { auth } from '@/auth';\nimport { Analytics } from '@vercel/analytics/react';\nimport { headers } from 'next/headers';\n\nexport default async function RootLayout({\n  children,\n}: Readonly<{\n  children: React.ReactNode;\n}>) {\n  const session = await auth.api.getSession({\n    headers: await headers(),\n  });\n\n  console.debug('RootLayout', { session });\n\n  return (\n    <html lang=\"en\" suppressHydrationWarning>\n      <body>\n        <Providers>{children}</Providers>\n        <Analytics />\n      </body>\n    </html>\n  );\n}\n```\n\n\n### Current vs. Expected behavior\n\n\nOne would expect to see \"RootLayout: { session: { ... } }\" but instead, the session is null.\n\nI can see the session token in the requests:\n\n![Image](https://github.com/user-attachments/assets/bc0fd419-0de8-460a-9189-d769c868293f)\n\nAnd requests to /api/auth/get-session return a valid session:\n\n![Image](https://github.com/user-attachments/assets/2c8b73d2-0362-4264-ac7b-0e3912a765da)\n\n### What version of Better Auth are you using?\n\n1.2.5\n\n### Provide environment information\n\n```bash\n- OS: MacOS\n- Browser: Chrome\n```\n\n### Which area(s) are affected? (Select all that apply)\n\nBackend\n\n### Auth config (if applicable)\n\n```typescript\nexport const auth = betterAuth({\n  basePath: '/auth',\n  database: prismaAdapter(prisma, {\n    provider: 'postgresql',\n  }),\n  plugins: [\n    emailOTP({\n      sendVerificationOTP,\n    }),\n    nextCookies(),\n    expo(),\n  ],\n  socialProviders: {\n    google: {\n      clientId: process.env.GOOGLE_CLIENT_ID as string,\n      clientSecret: process.env.GOOGLE_CLIENT_SECRET as string,\n    },\n  },\n  user: {\n    additionalFields: {\n      role: {\n        type: 'string',\n        required: false,\n        defaultValue: 'user',\n        input: false,\n      },\n      lang: {\n        type: 'string',\n        required: false,\n        defaultValue: 'en',\n      },\n    },\n  },\n});\n```\n\n### Additional context\n\n_No response_", "closed_by": {"login": "ping-maxwell", "id": 145994855, "node_id": "U_kgDOCLO0Zw", "avatar_url": "https://avatars.githubusercontent.com/u/145994855?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ping-maxwell", "html_url": "https://github.com/ping-maxwell", "followers_url": "https://api.github.com/users/ping-maxwell/followers", "following_url": "https://api.github.com/users/ping-maxwell/following{/other_user}", "gists_url": "https://api.github.com/users/ping-maxwell/gists{/gist_id}", "starred_url": "https://api.github.com/users/ping-maxwell/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ping-maxwell/subscriptions", "organizations_url": "https://api.github.com/users/ping-maxwell/orgs", "repos_url": "https://api.github.com/users/ping-maxwell/repos", "events_url": "https://api.github.com/users/ping-maxwell/events{/privacy}", "received_events_url": "https://api.github.com/users/ping-maxwell/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/better-auth/better-auth/issues/2055/reactions", "total_count": 17, "+1": 17, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/better-auth/better-auth/issues/2055/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/better-auth/better-auth/issues/1974", "repository_url": "https://api.github.com/repos/better-auth/better-auth", "labels_url": "https://api.github.com/repos/better-auth/better-auth/issues/1974/labels{/name}", "comments_url": "https://api.github.com/repos/better-auth/better-auth/issues/1974/comments", "events_url": "https://api.github.com/repos/better-auth/better-auth/issues/1974/events", "html_url": "https://github.com/better-auth/better-auth/issues/1974", "id": 2942910471, "node_id": "I_kwDOL90GLc6vaUAH", "number": 1974, "title": "Expo plugin is not assignable to type 'BetterAuthPlugin'", "user": {"login": "Nikola-Milovic", "id": 50072027, "node_id": "MDQ6VXNlcjUwMDcyMDI3", "avatar_url": "https://avatars.githubusercontent.com/u/50072027?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Nikola-Milovic", "html_url": "https://github.com/Nikola-Milovic", "followers_url": "https://api.github.com/users/Nikola-Milovic/followers", "following_url": "https://api.github.com/users/Nikola-Milovic/following{/other_user}", "gists_url": "https://api.github.com/users/Nikola-Milovic/gists{/gist_id}", "starred_url": "https://api.github.com/users/Nikola-Milovic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Nikola-Milovic/subscriptions", "organizations_url": "https://api.github.com/users/Nikola-Milovic/orgs", "repos_url": "https://api.github.com/users/Nikola-Milovic/repos", "events_url": "https://api.github.com/users/Nikola-Milovic/events{/privacy}", "received_events_url": "https://api.github.com/users/Nikola-Milovic/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 6971796828, "node_id": "LA_kwDOL90GLc8AAAABn40tXA", "url": "https://api.github.com/repos/better-auth/better-auth/labels/bug", "name": "bug", "color": "d73a4a", "default": true, "description": "Something isn't working"}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 39, "created_at": "2025-03-24T11:19:59Z", "updated_at": "2025-10-13T00:11:59Z", "closed_at": "2025-10-13T00:11:59Z", "assignee": null, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### Is this suited for github?\n\n- [x] Yes, this is suited for github\n\n### To Reproduce\n\nFollowing the guide for [expo](https://www.better-auth.com/docs/integrations/expo) integration, there is a type error \n\n```\nimport { serve } from '@hono/node-server'\nimport { Hono } from 'hono'\n\nconst app = new Hono()\n\nimport { betterAuth } from \"better-auth\";\nimport Database from \"better-sqlite3\";\nimport { expo } from '@better-auth/expo';\n\nexport const auth = betterAuth({\n\tdatabase: new Database(\"./sqlite.db\"),\n\tplugins: [\n\t\texpo()\n\t],\n})\n\napp.get('/', (c) => {\n\treturn c.text('Hello Hono!')\n})\n\nserve({\n\tfetch: app.fetch,\n\tport: 3000\n}, (info) => {\n\tconsole.log(`Server is running on http://localhost:${info.port}`)\n})\n```\n\n\n```\nType '{ id: \"expo\"; init: (ctx: AuthContext) => { options: { trustedOrigins: string[]; }; }; onRequest(request: Request, ctx: AuthContext): Promise<{ request: Request; } | undefined>; hooks: { ...; }; }' is not assignable to type 'BetterAuthPlugin'.     \n  Types of property 'init' are incompatible.                                                                                                                                                                                                                  \n    Type '(ctx: AuthContext) => { options: { trustedOrigins: string[]; }; }' is not assignable to type '(ctx: AuthContext) => void | { context?: { appName?: string | undefined; baseURL?: string | undefined; trustedOrigins?: (string | undefined)[] |      \n    undefined; newSession?: { ...; } | ... 1 more ... | undefined; ... 15 more ...; runMigrations?: (() => Promise<...>) | undefined; } | undefined; options?: Partial<...> | un...'.                                                                         \n      Types of parameters 'ctx' and 'ctx' are incompatible.                                                                                                                                                                                                   \n        Type 'import(\"/tmp/my-app/node_modules/better-auth/dist/shared/better-auth.6BOIvSei\", { with: { \"resolution-mode\": \"import\" } }).l' is not assignable to type 'import(\"/tmp/my-app/node_modules/better-auth/dist/shared/better-auth.BaiNTuNz\").l'.    \n          The types of 'options.database' are incompatible between these types.                                                                                                                                                                               \n            Type 'BetterSqlite3.Database | import(\"/tmp/my-app/node_modules/kysely/dist/esm/dialect/postgres/postgres-dialect-config\", { with: { \"resolution-mode\": \"import\" } }).PostgresPool | import(\"/tmp/my-app/node_modules/kysely/dist/esm/dialect/    \n            mysql/mysql-dialect-config\", { with: { \"resolution-mode\": \"import\" } }).MysqlPool | ....' is not assignable to type 'BetterSqlite3.Database | import(\"/tmp/my-app/node_modules/kysely/dist/cjs/dialect/postgres/postgres-dialect-config\").        \n            PostgresPool | import(\"/tmp/my-app/node_modules/kysely/dist/cjs/dialect/mysql/mysql-dialect-config\").MysqlPool | ... 4 more ... | undefined'.                                                                                                     \n              Type 'Dialect' is not assignable to type 'Database | PostgresPool | MysqlPool | Dialect | AdapterInstance | { dialect: Dialect; type: KyselyDatabaseType; casing?: \"snake\" | ... 1 more ... | undefined; } | { ...; } | undefined'.             \n                Type 'import(\"/tmp/my-app/node_modules/kysely/dist/esm/dialect/dialect\", { with: { \"resolution-mode\": \"import\" } }).Dialect' is not assignable to type 'import(\"/tmp/my-app/node_modules/kysely/dist/cjs/dialect/dialect\").Dialect'.          \n                  The types of 'createAdapter().acquireMigrationLock' are incompatible between these types.                                                                                                                                                   \n                    Type '(db: import(\"/tmp/my-app/node_modules/kysely/dist/esm/kysely\", { with: { \"resolution-mode\": \"import\" } }).Kysely<any>, options: import(\"/tmp/my-app/node_modules/kysely/dist/esm/dialect/dialect-adapter\", { with: { \"resolution-   \n                    mode\": \"import\" } }).MigrationLockOptions) => Promise<...>' is not assignable to type '(db: import(\"/tmp/my-app/node_modules/kysely/dist/cjs/kysely\").Kysely<any>, options: import(\"/tmp/my-app/node_modules/kysely/dist/cjs/dialect/     \n                    dialect-adapter\").MigrationLockOptions) => Promise<...>'.                                                                                                                                                                                 \n                      Types of parameters 'db' and 'db' are incompatible.                                                                                                                                                                                     \n                        Type 'import(\"/tmp/my-app/node_modules/kysely/dist/cjs/kysely\").Kysely<any>' is not assignable to type 'import(\"/tmp/my-app/node_modules/kysely/dist/esm/kysely\", { with: { \"resolution-mode\": \"import\" } }).Kysely<any>'.            \n                          Property '#private' in type 'Kysely' refers to a different member that cannot be accessed from within type 'Kysely'. [2322\n```\n\n### Current vs. Expected behavior\n\nWould expect all the types to work properly\n\n### What version of Better Auth are you using?\n\n1.2.4\n\n### Provide environment information\n\n```bash\n@better-auth/expo ^1.2.4\n```\n\n### Which area(s) are affected? (Select all that apply)\n\nTypes\n\n### Auth config (if applicable)\n\n```typescript\n\n```\n\n### Additional context\n\nI created a fresh project and there is still an error.\n\n```\nnpm create hono@latest my-app \nnpm install better-auth  @better-auth/expo better-sqlite3\nnpm i --save-dev @types/better-sqlite3\n```", "closed_by": {"login": "himself65", "id": 14026360, "node_id": "MDQ6VXNlcjE0MDI2MzYw", "avatar_url": "https://avatars.githubusercontent.com/u/14026360?v=4", "gravatar_id": "", "url": "https://api.github.com/users/himself65", "html_url": "https://github.com/himself65", "followers_url": "https://api.github.com/users/himself65/followers", "following_url": "https://api.github.com/users/himself65/following{/other_user}", "gists_url": "https://api.github.com/users/himself65/gists{/gist_id}", "starred_url": "https://api.github.com/users/himself65/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/himself65/subscriptions", "organizations_url": "https://api.github.com/users/himself65/orgs", "repos_url": "https://api.github.com/users/himself65/repos", "events_url": "https://api.github.com/users/himself65/events{/privacy}", "received_events_url": "https://api.github.com/users/himself65/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/better-auth/better-auth/issues/1974/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/better-auth/better-auth/issues/1974/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/better-auth/better-auth/issues/1391", "repository_url": "https://api.github.com/repos/better-auth/better-auth", "labels_url": "https://api.github.com/repos/better-auth/better-auth/issues/1391/labels{/name}", "comments_url": "https://api.github.com/repos/better-auth/better-auth/issues/1391/comments", "events_url": "https://api.github.com/repos/better-auth/better-auth/issues/1391/events", "html_url": "https://github.com/better-auth/better-auth/issues/1391", "id": 2840374586, "node_id": "I_kwDOL90GLc6pTK06", "number": 1391, "title": "monorepo/turborepo: Inferred type of 'authClient' cannot be named without a reference to .pnpm/nanostores. A type annotation is necessary", "user": {"login": "ramadanomar", "id": 55840806, "node_id": "MDQ6VXNlcjU1ODQwODA2", "avatar_url": "https://avatars.githubusercontent.com/u/55840806?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ramadanomar", "html_url": "https://github.com/ramadanomar", "followers_url": "https://api.github.com/users/ramadanomar/followers", "following_url": "https://api.github.com/users/ramadanomar/following{/other_user}", "gists_url": "https://api.github.com/users/ramadanomar/gists{/gist_id}", "starred_url": "https://api.github.com/users/ramadanomar/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ramadanomar/subscriptions", "organizations_url": "https://api.github.com/users/ramadanomar/orgs", "repos_url": "https://api.github.com/users/ramadanomar/repos", "events_url": "https://api.github.com/users/ramadanomar/events{/privacy}", "received_events_url": "https://api.github.com/users/ramadanomar/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 6971796828, "node_id": "LA_kwDOL90GLc8AAAABn40tXA", "url": "https://api.github.com/repos/better-auth/better-auth/labels/bug", "name": "bug", "color": "d73a4a", "default": true, "description": "Something isn't working"}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 38, "created_at": "2025-02-09T01:47:42Z", "updated_at": "2025-04-02T19:37:50Z", "closed_at": "2025-03-15T13:57:37Z", "assignee": null, "author_association": "CONTRIBUTOR", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### Is this suited for github?\n\n- [x] Yes, this is suited for github\n\n### To Reproduce\n\nRunning a turborepo monorepo (NextJS 15)\n\n```\nThe inferred type of 'authClient' cannot be named without a reference to '.pnpm/nanostores@0.11.3/node_modules/nanostores'. This is likely not portable. A type annotation is necessary.\n```\n\nIf we typecast it with return type\n```ts\nexport const authClient: ReturnType<typeof createAuthClient> = createAuthClient(\n  {\n    baseURL: process.env.NEXT_PUBLIC_APP_URL,\n    plugins: [adminClient()],\n  }\n);\n```\nErrors goes away but we dont infer the routes from plugins. Example:\n```ts\n const response = await authClient.admin.listUsers({\n          query: { limit: 10 },\n        });\n```\nWould error with:\n```\nProperty 'admin' does not exist on type '{ signIn: { social: <FetchOptions extends { method?: string | undefined; headers?: (HeadersInit & (HeadersInit | CommonHeaders)) | undefined; redirect?: RequestRedirect | undefined; ... 32 more ...; disableValidation?: boolean | undefined; }>(data_0: Prettify<...>, data_1?: FetchOptions | undefined) => Promise<...>;...'.\n```\n\nSetting `preserveSymlinks\": true` would make the error go away but all types would be inferred as `any`.\n\nusing `inferAdditionalFields` does not work in this case\n\n```ts\nimport { inferAdditionalFields } from \"better-auth/client/plugins\";\nimport { createAuthClient } from \"better-auth/react\";\nimport type { auth } from \"./auth\";\n \nexport const authClient = createAuthClient({\n  plugins: [inferAdditionalFields<typeof auth>()],\n});\n```\n\n### Current vs. Expected behavior\n\nI would want it to work out of the box with inference.\n\n### What version of Better Auth are you using?\n\n1.1.16\n\n### Provide environment information\n\n```bash\n- pnpm: v9.15.0\n- node: v20.17.0\n- \"turbo\": \"^2.3.3\",\n```\n\n### Which area(s) are affected? (Select all that apply)\n\nTypes, Client\n\n### Auth config (if applicable)\n\n```typescript\nimport { betterAuth } from \"better-auth\"\nexport const auth = betterAuth({\n  emailAndPassword: {  \n    enabled: true\n  },\n});\n```\n\n### Additional context\n\nThis is my tsconfig.json\n```json\n{\n  \"extends\": \"@resellguru/typescript-config/nextjs.json\",\n  \"compilerOptions\": {\n    \"baseUrl\": \".\",\n    \"paths\": {\n      \"@/*\": [\"./*\"],\n      \"@resellguru/ui/*\": [\"../../packages/ui/src/*\"]\n    },\n    \"plugins\": [\n      {\n        \"name\": \"next\"\n      }\n    ],\n  },\n  \"include\": [\n    \"next-env.d.ts\",\n    \"next.config.mjs\",\n    \"**/*.ts\",\n    \"**/*.tsx\",\n    \".next/types/**/*.ts\"\n  ],\n  \"exclude\": [\"node_modules\"]\n}\n```\n\nIssue seems to appear in a lot of other cases: An example\n[Typescript #42873](https://github.com/microsoft/TypeScript/issues/42873#issuecomment-2066874644)\n", "closed_by": {"login": "Bekacru", "id": 86073083, "node_id": "MDQ6VXNlcjg2MDczMDgz", "avatar_url": "https://avatars.githubusercontent.com/u/86073083?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Bekacru", "html_url": "https://github.com/Bekacru", "followers_url": "https://api.github.com/users/Bekacru/followers", "following_url": "https://api.github.com/users/Bekacru/following{/other_user}", "gists_url": "https://api.github.com/users/Bekacru/gists{/gist_id}", "starred_url": "https://api.github.com/users/Bekacru/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Bekacru/subscriptions", "organizations_url": "https://api.github.com/users/Bekacru/orgs", "repos_url": "https://api.github.com/users/Bekacru/repos", "events_url": "https://api.github.com/users/Bekacru/events{/privacy}", "received_events_url": "https://api.github.com/users/Bekacru/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/better-auth/better-auth/issues/1391/reactions", "total_count": 6, "+1": 6, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/better-auth/better-auth/issues/1391/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/better-auth/better-auth/issues/2123", "repository_url": "https://api.github.com/repos/better-auth/better-auth", "labels_url": "https://api.github.com/repos/better-auth/better-auth/issues/2123/labels{/name}", "comments_url": "https://api.github.com/repos/better-auth/better-auth/issues/2123/comments", "events_url": "https://api.github.com/repos/better-auth/better-auth/issues/2123/events", "html_url": "https://github.com/better-auth/better-auth/issues/2123", "id": 2972816281, "node_id": "I_kwDOL90GLc6xMZOZ", "number": 2123, "title": "The inferred type of 'auth' cannot be named without a reference", "user": {"login": "guptaashwanee", "id": 52340682, "node_id": "MDQ6VXNlcjUyMzQwNjgy", "avatar_url": "https://avatars.githubusercontent.com/u/52340682?v=4", "gravatar_id": "", "url": "https://api.github.com/users/guptaashwanee", "html_url": "https://github.com/guptaashwanee", "followers_url": "https://api.github.com/users/guptaashwanee/followers", "following_url": "https://api.github.com/users/guptaashwanee/following{/other_user}", "gists_url": "https://api.github.com/users/guptaashwanee/gists{/gist_id}", "starred_url": "https://api.github.com/users/guptaashwanee/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/guptaashwanee/subscriptions", "organizations_url": "https://api.github.com/users/guptaashwanee/orgs", "repos_url": "https://api.github.com/users/guptaashwanee/repos", "events_url": "https://api.github.com/users/guptaashwanee/events{/privacy}", "received_events_url": "https://api.github.com/users/guptaashwanee/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 6971796828, "node_id": "LA_kwDOL90GLc8AAAABn40tXA", "url": "https://api.github.com/repos/better-auth/better-auth/labels/bug", "name": "bug", "color": "d73a4a", "default": true, "description": "Something isn't working"}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 37, "created_at": "2025-04-04T16:01:14Z", "updated_at": "2025-11-07T00:11:34Z", "closed_at": "2025-04-08T10:02:28Z", "assignee": null, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### Is this suited for github?\n\n- [x] Yes, this is suited for github\n\n### To Reproduce\n\nsetup better-auth in express node application.\n\n### Current vs. Expected behavior\n\nThe inferred type of 'auth' cannot be named without a reference to '../../node_modules/better-auth/dist/shared/better-auth.BAfIsot3.js'. This is likely not portable. A type annotation is necessary.ts(2742)\n\nconst auth = betterAuth({\n  \n});\n\n### What version of Better Auth are you using?\n\n^1.2.5\n\n### Provide environment information\n\n```bash\n- OS: Mac os\n```\n\n### Which area(s) are affected? (Select all that apply)\n\nBackend\n\n### Auth config (if applicable)\n\n```typescript\nimport { betterAuth } from \"better-auth\"\nexport const auth = betterAuth({\n  emailAndPassword: {  \n    enabled: true\n  },\n});\n```\n\n### Additional context\n\n_No response_", "closed_by": {"login": "Kinfe123", "id": 65047246, "node_id": "MDQ6VXNlcjY1MDQ3MjQ2", "avatar_url": "https://avatars.githubusercontent.com/u/65047246?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Kinfe123", "html_url": "https://github.com/Kinfe123", "followers_url": "https://api.github.com/users/Kinfe123/followers", "following_url": "https://api.github.com/users/Kinfe123/following{/other_user}", "gists_url": "https://api.github.com/users/Kinfe123/gists{/gist_id}", "starred_url": "https://api.github.com/users/Kinfe123/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Kinfe123/subscriptions", "organizations_url": "https://api.github.com/users/Kinfe123/orgs", "repos_url": "https://api.github.com/users/Kinfe123/repos", "events_url": "https://api.github.com/users/Kinfe123/events{/privacy}", "received_events_url": "https://api.github.com/users/Kinfe123/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/better-auth/better-auth/issues/2123/reactions", "total_count": 5, "+1": 5, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/better-auth/better-auth/issues/2123/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/better-auth/better-auth/issues/969", "repository_url": "https://api.github.com/repos/better-auth/better-auth", "labels_url": "https://api.github.com/repos/better-auth/better-auth/issues/969/labels{/name}", "comments_url": "https://api.github.com/repos/better-auth/better-auth/issues/969/comments", "events_url": "https://api.github.com/repos/better-auth/better-auth/issues/969/events", "html_url": "https://github.com/better-auth/better-auth/issues/969", "id": 2753502307, "node_id": "I_kwDOL90GLc6kHxxj", "number": 969, "title": "Cloudflare: Error: The script will never generate a response.", "user": {"login": "CMMA04", "id": 105871984, "node_id": "U_kgDOBk96cA", "avatar_url": "https://avatars.githubusercontent.com/u/105871984?v=4", "gravatar_id": "", "url": "https://api.github.com/users/CMMA04", "html_url": "https://github.com/CMMA04", "followers_url": "https://api.github.com/users/CMMA04/followers", "following_url": "https://api.github.com/users/CMMA04/following{/other_user}", "gists_url": "https://api.github.com/users/CMMA04/gists{/gist_id}", "starred_url": "https://api.github.com/users/CMMA04/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/CMMA04/subscriptions", "organizations_url": "https://api.github.com/users/CMMA04/orgs", "repos_url": "https://api.github.com/users/CMMA04/repos", "events_url": "https://api.github.com/users/CMMA04/events{/privacy}", "received_events_url": "https://api.github.com/users/CMMA04/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 6971796828, "node_id": "LA_kwDOL90GLc8AAAABn40tXA", "url": "https://api.github.com/repos/better-auth/better-auth/labels/bug", "name": "bug", "color": "d73a4a", "default": true, "description": "Something isn't working"}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 36, "created_at": "2024-12-20T21:24:18Z", "updated_at": "2025-12-06T16:48:29Z", "closed_at": "2025-06-16T01:40:00Z", "assignee": null, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### Is this suited for github?\n\n- [X] Yes, this is suited for github\n\n### To Reproduce\n\n1. Deploy or preview an aplication using Cloudlflare Pages or Workers, the issue does not show up if you use dev\r\n2. Try to sign in\n\n### Current vs. Expected behavior\n\nCurrent:\r\nSign in, shows the following error in terminal:\r\n```\r\n\u2718 [ERROR] A hanging Promise was canceled. This happens when the worker runtime is waiting for a Promise from JavaScript to resolve, but has detected that the Promise cannot possibly ever resolve because all code and events related to the Promise's I/O context have already finished.\r\n\r\n\r\n[wrangler:inf] POST /api/auth/sign-in/email 500 Internal Server Error (296ms)\r\n\u2718 [ERROR] Uncaught (in response) Error: The script will never generate a response.\r\n```\r\nIf you try again, it works.\r\nIt does not get catch by a try statement, however if you read the error value using:\r\n```\r\nconst { data, error } = await authClient.signIn.email({\r\n      email: event.data.email,\r\n      password: event.data.password,\r\n});\r\nif (error) {\r\n      console.log(error)\r\n} \r\n```\r\nIt will say: undefined\r\n\r\nExpected:\r\nSign in without issues\n\n### What version of Better Auth are you using?\n\n1.0.22\n\n### Provide environment information\n\n```bash\n- OS: MacOS y Windows (tested using preview) and Cloudflare Pages\r\n- Browser: Any\r\n- Framework: Nuxt\n```\n\n\n### Which area(s) are affected? (Select all that apply)\n\nBackend\n\n### Auth config (if applicable)\n\n```typescript\nexport const auth = betterAuth({\r\n  appName: \"test\",\r\n  database: drizzleAdapter(db, {\r\n    provider: \"pg\",\r\n    schema: {\r\n      ...schema,\r\n    },\r\n  }),\r\n  secondaryStorage: {\r\n    get: async (key) => await redis.get(key),\r\n    set: async (key, value, ttl) => {\r\n      if (ttl) await redis.set(key, JSON.stringify(value), { ex: ttl });\r\n      else await redis.set(key, JSON.stringify(value));\r\n    },\r\n    delete: async (key) => {\r\n      await redis.del(key);\r\n    },\r\n  },\r\n  plugins: [\r\n    openAPI(),\r\n  ],\r\n  emailAndPassword: {\r\n    enabled: true,\r\n  },\r\n  emailVerification: {\r\n    sendVerificationEmail: async ({ user, url, token }) => {\r\n      const resend = new Resend(process.env.RESEND_API_KEY);\r\n      const data = await resend.emails.send({\r\n        from: \"noreply@test.com\",\r\n        to: user.email,\r\n        subject: \"Email verification\",\r\n        html: `Confirmation link: ${url}`,\r\n      });\r\n    },\r\n  },\r\n});\n```\n\n\n### Additional context\n\nFor some reason it does not happen if you run under nuxt dev, so it is a Clouflare only issue\r\n\r\nI apologize if it is a issue in our side or a known issue, I am learning to use this library and i am still new to auth enviorement", "closed_by": {"login": "Bekacru", "id": 86073083, "node_id": "MDQ6VXNlcjg2MDczMDgz", "avatar_url": "https://avatars.githubusercontent.com/u/86073083?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Bekacru", "html_url": "https://github.com/Bekacru", "followers_url": "https://api.github.com/users/Bekacru/followers", "following_url": "https://api.github.com/users/Bekacru/following{/other_user}", "gists_url": "https://api.github.com/users/Bekacru/gists{/gist_id}", "starred_url": "https://api.github.com/users/Bekacru/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Bekacru/subscriptions", "organizations_url": "https://api.github.com/users/Bekacru/orgs", "repos_url": "https://api.github.com/users/Bekacru/repos", "events_url": "https://api.github.com/users/Bekacru/events{/privacy}", "received_events_url": "https://api.github.com/users/Bekacru/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/better-auth/better-auth/issues/969/reactions", "total_count": 19, "+1": 19, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/better-auth/better-auth/issues/969/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/better-auth/better-auth/issues/2115", "repository_url": "https://api.github.com/repos/better-auth/better-auth", "labels_url": "https://api.github.com/repos/better-auth/better-auth/issues/2115/labels{/name}", "comments_url": "https://api.github.com/repos/better-auth/better-auth/issues/2115/comments", "events_url": "https://api.github.com/repos/better-auth/better-auth/issues/2115/events", "html_url": "https://github.com/better-auth/better-auth/issues/2115", "id": 2971696157, "node_id": "I_kwDOL90GLc6xIHwd", "number": 2115, "title": "Session cookie maxAge is not refreshed", "user": {"login": "ck-euan", "id": 147141389, "node_id": "U_kgDOCMUzDQ", "avatar_url": "https://avatars.githubusercontent.com/u/147141389?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ck-euan", "html_url": "https://github.com/ck-euan", "followers_url": "https://api.github.com/users/ck-euan/followers", "following_url": "https://api.github.com/users/ck-euan/following{/other_user}", "gists_url": "https://api.github.com/users/ck-euan/gists{/gist_id}", "starred_url": "https://api.github.com/users/ck-euan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ck-euan/subscriptions", "organizations_url": "https://api.github.com/users/ck-euan/orgs", "repos_url": "https://api.github.com/users/ck-euan/repos", "events_url": "https://api.github.com/users/ck-euan/events{/privacy}", "received_events_url": "https://api.github.com/users/ck-euan/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 6971796828, "node_id": "LA_kwDOL90GLc8AAAABn40tXA", "url": "https://api.github.com/repos/better-auth/better-auth/labels/bug", "name": "bug", "color": "d73a4a", "default": true, "description": "Something isn't working"}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 35, "created_at": "2025-04-04T08:49:22Z", "updated_at": "2026-01-29T08:01:08Z", "closed_at": "2026-01-27T00:34:04Z", "assignee": null, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### Is this suited for github?\n\n- [x] Yes, this is suited for github\n\n### To Reproduce\n\n1. Have a short session maxAge and updateAge:\n`session:{\n        expiriesIn:60,\n\tupdateAge:10\n}`\n\n2. When the updateAge has passed, call getSession\n\n### Current vs. Expected behavior\n\nCurrently the session in the database is refreshed and extended but the session cookie is not.\nIn the above example, the cookie expires after 60 seconds and you will be logged out.\n\nExpected behaviour is that whenever the session is updated the cookie is also updated with the new expiry.\n\nIn my app I have 30 minute maxAge and 5 minute updateAge. It's expected that as you use the app your session is constantly extended until you stop using at and the app stops calling getSession. However what actually happens is the user is always logged out after 30 minutes.\n\n### What version of Better Auth are you using?\n\n1.2.5\n\n### Provide environment information\n\n```bash\n- OS: Mac OS 15.3.1 (24D70)\n- Browser: AVersion 1.89.0 (60953)\n```\n\n### Which area(s) are affected? (Select all that apply)\n\nFrontend", "closed_by": {"login": "himself65", "id": 14026360, "node_id": "MDQ6VXNlcjE0MDI2MzYw", "avatar_url": "https://avatars.githubusercontent.com/u/14026360?v=4", "gravatar_id": "", "url": "https://api.github.com/users/himself65", "html_url": "https://github.com/himself65", "followers_url": "https://api.github.com/users/himself65/followers", "following_url": "https://api.github.com/users/himself65/following{/other_user}", "gists_url": "https://api.github.com/users/himself65/gists{/gist_id}", "starred_url": "https://api.github.com/users/himself65/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/himself65/subscriptions", "organizations_url": "https://api.github.com/users/himself65/orgs", "repos_url": "https://api.github.com/users/himself65/repos", "events_url": "https://api.github.com/users/himself65/events{/privacy}", "received_events_url": "https://api.github.com/users/himself65/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/better-auth/better-auth/issues/2115/reactions", "total_count": 3, "+1": 3, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/better-auth/better-auth/issues/2115/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/better-auth/better-auth/issues/6200", "repository_url": "https://api.github.com/repos/better-auth/better-auth", "labels_url": "https://api.github.com/repos/better-auth/better-auth/issues/6200/labels{/name}", "comments_url": "https://api.github.com/repos/better-auth/better-auth/issues/6200/comments", "events_url": "https://api.github.com/repos/better-auth/better-auth/issues/6200/events", "html_url": "https://github.com/better-auth/better-auth/issues/6200", "id": 3654662500, "node_id": "I_kwDOL90GLc7Z1blk", "number": 6200, "title": "1.4 experimental join : The model \"XXX\" was not found in the query object", "user": {"login": "bmichotte", "id": 235510, "node_id": "MDQ6VXNlcjIzNTUxMA==", "avatar_url": "https://avatars.githubusercontent.com/u/235510?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bmichotte", "html_url": "https://github.com/bmichotte", "followers_url": "https://api.github.com/users/bmichotte/followers", "following_url": "https://api.github.com/users/bmichotte/following{/other_user}", "gists_url": "https://api.github.com/users/bmichotte/gists{/gist_id}", "starred_url": "https://api.github.com/users/bmichotte/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bmichotte/subscriptions", "organizations_url": "https://api.github.com/users/bmichotte/orgs", "repos_url": "https://api.github.com/users/bmichotte/repos", "events_url": "https://api.github.com/users/bmichotte/events{/privacy}", "received_events_url": "https://api.github.com/users/bmichotte/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 6971796828, "node_id": "LA_kwDOL90GLc8AAAABn40tXA", "url": "https://api.github.com/repos/better-auth/better-auth/labels/bug", "name": "bug", "color": "d73a4a", "default": true, "description": "Something isn't working"}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 34, "created_at": "2025-11-22T13:06:40Z", "updated_at": "2025-11-24T17:18:04Z", "closed_at": "2025-11-22T17:54:54Z", "assignee": null, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### Is this suited for github?\n\n- [x] Yes, this is suited for github\n\n### To Reproduce\n\nI have the following setup : \n\n```ts\n// src/db/index.ts\nexport {\n    accountRelations,\n    accountsTable,\n    sessionRelations,\n    sessionsTable,\n    subscriptionsTable,\n    userRelations,\n    userRoles,\n    usersTable,\n    verificationsTable,\n} from './auth'\n```\n\n```ts\n// src/db/auth.ts\nexport const usersTable = pgTable('users', {\n // ...\n})\n\n// so on, all tables are named with the following pattern : namesTable = pgTable('names')\n```\n\n```ts\nexport const auth = betterAuth({\n    database: drizzleAdapter(db, {\n        provider: 'pg',\n        usePlural: true,\n        schema: {\n            users: schema.usersTable,\n            sessions: schema.sessionsTable,\n            accounts: schema.accountsTable,\n            verifications: schema.verificationsTable,\n            subscriptions: schema.subscriptionsTable,\n        },\n    }),\n })\n```\nThis configuration **works**.\n\n\n\n\n### Current vs. Expected behavior\n\nIf I add \n```ts\n     experimental: {\n         joins: true,\n     },\n```\non my better auth config, I got the following\n\n```\n2025-11-22T11:45:45.113Z ERROR [Better Auth]: [# Drizzle Adapter]: The model \"sessions\" was not found in the query object. Please update your Drizzle schema to include relations or re-generate using \"npx auth generate\".\n2025-11-22T11:45:45.113Z INFO [Better Auth]: Falling back to regular query\n```\n\n### What version of Better Auth are you using?\n\n1.4.0\n\n### System info\n\n```bash\n{\n  \"system\": {\n    \"platform\": \"darwin\",\n    \"arch\": \"arm64\",\n    \"version\": \"Darwin Kernel Version 24.6.0: Mon Jul 14 11:30:55 PDT 2025; root:xnu-11417.140.69~1/RELEASE_ARM64_T6031\",\n    \"release\": \"24.6.0\",\n    \"cpuCount\": 16,\n    \"cpuModel\": \"Apple M3 Max\",\n    \"totalMemory\": \"128.00 GB\",\n    \"freeMemory\": \"7.19 GB\"\n  },\n  \"node\": {\n    \"version\": \"v22.16.0\",\n    \"env\": \"development\"\n  },\n  \"packageManager\": {\n    \"name\": \"npm\",\n    \"version\": \"10.9.2\"\n  },\n  \"frameworks\": [\n    {\n      \"name\": \"next\",\n      \"version\": \"^16.0.3\"\n    },\n    {\n      \"name\": \"react\",\n      \"version\": \"^19.2.0\"\n    }\n  ],\n  \"databases\": [\n    {\n      \"name\": \"pg\",\n      \"version\": \"^8.16.3\"\n    },\n    {\n      \"name\": \"drizzle\",\n      \"version\": \"^0.44.7\"\n    }\n  ],\n  \"betterAuth\": {\n    \"version\": \"^1.4.0\",\n    \"config\": {\n      \"experimental\": {\n        \"joins\": true\n      },\n      \"trustedOrigins\": [\n        \"http://localhost:3000\",\n        \"jdc://\"\n      ],\n      \"emailAndPassword\": {\n        \"enabled\": true\n      },\n      \"socialProviders\": {\n        \"google\": {\n          \"clientId\": \"[REDACTED]\",\n          \"clientSecret\": \"[REDACTED]\"\n        }\n      },\n      \"plugins\": [\n        {\n          \"name\": \"next-cookies\",\n          \"config\": {\n            \"id\": \"next-cookies\",\n            \"hooks\": {\n              \"after\": [\n                {}\n              ]\n            }\n          }\n        },\n        {\n          \"name\": \"admin\",\n          \"config\": {\n            \"id\": \"admin\",\n            \"hooks\": {\n              \"after\": [\n                {}\n              ]\n            },\n            \"endpoints\": {},\n            \"$ERROR_CODES\": {\n              \"FAILED_TO_CREATE_USER\": \"Failed to create user\",\n              \"USER_ALREADY_EXISTS\": \"User already exists.\",\n              \"USER_ALREADY_EXISTS_USE_ANOTHER_EMAIL\": \"User already exists. Use another email.\",\n              \"YOU_CANNOT_BAN_YOURSELF\": \"You cannot ban yourself\",\n              \"YOU_ARE_NOT_ALLOWED_TO_CHANGE_USERS_ROLE\": \"You are not allowed to change users role\",\n              \"YOU_ARE_NOT_ALLOWED_TO_CREATE_USERS\": \"You are not allowed to create users\",\n              \"YOU_ARE_NOT_ALLOWED_TO_LIST_USERS\": \"You are not allowed to list users\",\n              \"YOU_ARE_NOT_ALLOWED_TO_LIST_USERS_SESSIONS\": \"You are not allowed to list users sessions\",\n              \"YOU_ARE_NOT_ALLOWED_TO_BAN_USERS\": \"You are not allowed to ban users\",\n              \"YOU_ARE_NOT_ALLOWED_TO_IMPERSONATE_USERS\": \"You are not allowed to impersonate users\",\n              \"YOU_ARE_NOT_ALLOWED_TO_REVOKE_USERS_SESSIONS\": \"You are not allowed to revoke users sessions\",\n              \"YOU_ARE_NOT_ALLOWED_TO_DELETE_USERS\": \"You are not allowed to delete users\",\n              \"YOU_ARE_NOT_ALLOWED_TO_SET_USERS_PASSWORD\": \"[REDACTED]\",\n              \"BANNED_USER\": \"You have been banned from this application\",\n              \"YOU_ARE_NOT_ALLOWED_TO_GET_USER\": \"You are not allowed to get user\",\n              \"NO_DATA_TO_UPDATE\": \"No data to update\",\n              \"YOU_ARE_NOT_ALLOWED_TO_UPDATE_USERS\": \"You are not allowed to update users\",\n              \"YOU_CANNOT_REMOVE_YOURSELF\": \"You cannot remove yourself\",\n              \"YOU_ARE_NOT_ALLOWED_TO_SET_NON_EXISTENT_VALUE\": \"You are not allowed to set a non-existent role value\"\n            },\n            \"schema\": {\n              \"user\": {\n                \"fields\": {\n                  \"role\": {\n                    \"type\": \"string\",\n                    \"required\": false,\n                    \"input\": false\n                  },\n                  \"banned\": {\n                    \"type\": \"boolean\",\n                    \"defaultValue\": false,\n                    \"required\": false,\n                    \"input\": false\n                  },\n                  \"banReason\": {\n                    \"type\": \"string\",\n                    \"required\": false,\n                    \"input\": false\n                  },\n                  \"banExpires\": {\n                    \"type\": \"date\",\n                    \"required\": false,\n                    \"input\": false\n                  }\n                }\n              },\n              \"session\": {\n                \"fields\": {\n                  \"impersonatedBy\": {\n                    \"type\": \"string\",\n                    \"required\": false\n                  }\n                }\n              }\n            }\n          }\n        },\n        {\n          \"name\": \"expo\",\n          \"config\": {\n            \"id\": \"expo\",\n            \"hooks\": {\n              \"after\": [\n                {}\n              ]\n            },\n            \"endpoints\": {}\n          }\n        },\n        {\n          \"name\": \"stripe\",\n          \"config\": {\n            \"id\": \"stripe\",\n            \"endpoints\": {},\n            \"schema\": {\n              \"subscription\": {\n                \"fields\": {\n                  \"plan\": {\n                    \"type\": \"string\",\n                    \"required\": true\n                  },\n                  \"referenceId\": {\n                    \"type\": \"string\",\n                    \"required\": true\n                  },\n                  \"stripeCustomerId\": {\n                    \"type\": \"string\",\n                    \"required\": false\n                  },\n                  \"stripeSubscriptionId\": {\n                    \"type\": \"string\",\n                    \"required\": false\n                  },\n                  \"status\": {\n                    \"type\": \"string\",\n                    \"defaultValue\": \"incomplete\"\n                  },\n                  \"periodStart\": {\n                    \"type\": \"date\",\n                    \"required\": false\n                  },\n                  \"periodEnd\": {\n                    \"type\": \"date\",\n                    \"required\": false\n                  },\n                  \"trialStart\": {\n                    \"type\": \"date\",\n                    \"required\": false\n                  },\n                  \"trialEnd\": {\n                    \"type\": \"date\",\n                    \"required\": false\n                  },\n                  \"cancelAtPeriodEnd\": {\n                    \"type\": \"boolean\",\n                    \"required\": false,\n                    \"defaultValue\": false\n                  },\n                  \"seats\": {\n                    \"type\": \"number\",\n                    \"required\": false\n                  }\n                }\n              },\n              \"user\": {\n                \"fields\": {\n                  \"stripeCustomerId\": {\n                    \"type\": \"string\",\n                    \"required\": false\n                  }\n                }\n              }\n            },\n            \"$ERROR_CODES\": {\n              \"SUBSCRIPTION_NOT_FOUND\": \"Subscription not found\",\n              \"SUBSCRIPTION_PLAN_NOT_FOUND\": \"Subscription plan not found\",\n              \"ALREADY_SUBSCRIBED_PLAN\": \"You're already subscribed to this plan\",\n              \"UNABLE_TO_CREATE_CUSTOMER\": \"Unable to create customer\",\n              \"FAILED_TO_FETCH_PLANS\": \"Failed to fetch plans\",\n              \"EMAIL_VERIFICATION_REQUIRED\": \"Email verification is required before you can subscribe to a plan\",\n              \"SUBSCRIPTION_NOT_ACTIVE\": \"Subscription is not active\",\n              \"SUBSCRIPTION_NOT_SCHEDULED_FOR_CANCELLATION\": \"Subscription is not scheduled for cancellation\"\n            }\n          }\n        }\n      ],\n      \"user\": {\n        \"additionalFields\": {\n          \"firstname\": {\n            \"type\": \"string\",\n            \"required\": true\n          },\n          \"lastname\": {\n            \"type\": \"string\",\n            \"required\": true\n          },\n          \"role\": {\n            \"type\": \"string\",\n            \"required\": false,\n            \"defaultValue\": \"user\",\n            \"input\": false\n          },\n          \"country\": {\n            \"type\": \"string\",\n            \"required\": false,\n            \"defaultValue\": \"BE\"\n          },\n          \"locale\": {\n            \"type\": \"string\",\n            \"required\": false,\n            \"defaultValue\": \"fr\"\n          }\n        }\n      },\n      \"account\": {\n        \"accountLinking\": {\n          \"enabled\": true,\n          \"allowDifferentEmails\": true,\n          \"trustedProviders\": [\n            \"google\",\n            \"email-password\"\n          ]\n        }\n      }\n    }\n  }\n}\n```\n\n### Which area(s) are affected? (Select all that apply)\n\nBackend\n\n### Auth config (if applicable)\n\n```typescript\nconst stripeClient = new Stripe(env.STRIPE_SECRET_KEY, {\n    apiVersion: '2025-11-17.clover',\n})\n\nexport const auth = betterAuth({\n    experimental: {\n        joins: true,\n    },\n    database: drizzleAdapter(db, {\n        provider: 'pg',\n        usePlural: true,\n        schema: {\n            users: schema.usersTable,\n            sessions: schema.sessionsTable,\n            accounts: schema.accountsTable,\n            verifications: schema.verificationsTable,\n            subscriptions: schema.subscriptionsTable,\n            sessionRelations: schema.sessionRelations,\n            userRelations: schema.userRelations,\n            accountRelations: schema.accountRelations,\n        },\n    }),\n    trustedOrigins: [env.BETTER_AUTH_URL, 'jdc://'],\n    emailAndPassword: {\n        enabled: true,\n        sendResetPassword: async ({ user, url, token }, _request) => {\n            console.log('sendResetPassword', user, url, token)\n            if (url.includes('callbackURL=/invite')) {\n                await sendInvitation(user as unknown as EmailUser, url)\n            } else {\n                await sendReset(user as unknown as EmailUser, url)\n            }\n        },\n    },\n    socialProviders: {\n        google: {\n            clientId: env.GOOGLE_CLIENT_ID,\n            clientSecret: env.GOOGLE_CLIENT_SECRET,\n            mapProfileToUser: profile => {\n                console.log('Google profile:', profile)\n                return {\n                    firstname: profile.given_name,\n                    lastname: profile.family_name,\n                }\n            },\n        },\n    },\n    plugins: [\n        nextCookies(),\n        admin(),\n        expo(),\n        stripe({\n            stripeClient,\n            stripeWebhookSecret: env.STRIPE_WEBHOOK_SECRET,\n            createCustomerOnSignUp: true,\n            onEvent: async event => {\n                console.log(`Stripe event received: ${event.type}`, { event })\n            },\n            subscription: {\n                enabled: true,\n                authorizeReference: async ({ user, session, referenceId, action }) => {\n                    console.log({ user, session, referenceId, action })\n                    return true\n                },\n                plans: plans.map(({ name, priceId, annualDiscountPriceId, freeTrial }) => ({\n                    name,\n                    priceId,\n                    annualDiscountPriceId,\n                    freeTrial: {\n                        days: freeTrial,\n                        onTrialStart: async subscription => {\n                            // Called when a trial starts\n                            console.log(`Trial started for subscription ${subscription.id}`, { subscription })\n                        },\n                        onTrialEnd: async ({ subscription }, request) => {\n                            // Called when a trial ends\n                            console.log(`Trial ended for subscription ${subscription.id}`, {\n                                subscription,\n                                request,\n                            })\n                        },\n                        onTrialExpired: async subscription => {\n                            // Called when a trial expires without conversion\n                            console.log(`Trial expired for subscription ${subscription.id}`, { subscription })\n                        },\n                    },\n                })),\n                onSubscriptionComplete: async ({ event, subscription, stripeSubscription, plan }) => {\n                    // Called when a subscription is successfully created\n                    console.log(`Subscription ${subscription.id} created for plan ${plan.name}`, {\n                        event,\n                        subscription,\n                        stripeSubscription,\n                        plan,\n                    })\n                },\n                onSubscriptionUpdate: async ({ event, subscription }) => {\n                    // Called when a subscription is updated\n                    console.log(`Subscription ${subscription.id} updated`, { event, subscription })\n                },\n                onSubscriptionCancel: async ({ event, subscription, stripeSubscription, cancellationDetails }) => {\n                    // Called when a subscription is canceled\n                    console.log(`subscription ${subscription.id} canceled`, {\n                        event,\n                        subscription,\n                        stripeSubscription,\n                        cancellationDetails,\n                    })\n                },\n                onSubscriptionDeleted: async ({ event, subscription, stripeSubscription }) => {\n                    // Called when a subscription is deleted\n                    console.log(`Subscription ${subscription.id} deleted`, { event, subscription, stripeSubscription })\n                },\n            },\n        }),\n    ],\n    user: {\n        additionalFields: {\n            firstname: {\n                type: 'string',\n                required: true,\n            },\n            lastname: {\n                type: 'string',\n                required: true,\n            },\n            role: {\n                type: 'string',\n                required: false,\n                defaultValue: 'user',\n                input: false,\n            },\n            country: {\n                type: 'string',\n                required: false,\n                defaultValue: 'BE',\n            },\n            locale: {\n                type: 'string',\n                required: false,\n                defaultValue: routing.defaultLocale,\n            },\n        },\n    },\n    account: {\n        accountLinking: {\n            enabled: true,\n            allowDifferentEmails: true,\n            trustedProviders: ['google', 'email-password'],\n        },\n    },\n})\n```\n\n### Additional context\n\nHere's a reproductible project : https://github.com/bmichotte/better-auth-drizzle", "closed_by": {"login": "ping-maxwell", "id": 145994855, "node_id": "U_kgDOCLO0Zw", "avatar_url": "https://avatars.githubusercontent.com/u/145994855?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ping-maxwell", "html_url": "https://github.com/ping-maxwell", "followers_url": "https://api.github.com/users/ping-maxwell/followers", "following_url": "https://api.github.com/users/ping-maxwell/following{/other_user}", "gists_url": "https://api.github.com/users/ping-maxwell/gists{/gist_id}", "starred_url": "https://api.github.com/users/ping-maxwell/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ping-maxwell/subscriptions", "organizations_url": "https://api.github.com/users/ping-maxwell/orgs", "repos_url": "https://api.github.com/users/ping-maxwell/repos", "events_url": "https://api.github.com/users/ping-maxwell/events{/privacy}", "received_events_url": "https://api.github.com/users/ping-maxwell/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/better-auth/better-auth/issues/6200/reactions", "total_count": 3, "+1": 2, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 1}, "timeline_url": "https://api.github.com/repos/better-auth/better-auth/issues/6200/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/better-auth/better-auth/issues/6613", "repository_url": "https://api.github.com/repos/better-auth/better-auth", "labels_url": "https://api.github.com/repos/better-auth/better-auth/issues/6613/labels{/name}", "comments_url": "https://api.github.com/repos/better-auth/better-auth/issues/6613/comments", "events_url": "https://api.github.com/repos/better-auth/better-auth/issues/6613/events", "html_url": "https://github.com/better-auth/better-auth/issues/6613", "id": 3706975237, "node_id": "I_kwDOL90GLc7c8_QF", "number": 6613, "title": "Upgrade from 1.3 to 1.4: Error runWithRequestState on cloudflare workers", "user": {"login": "tnkuehne", "id": 22354443, "node_id": "MDQ6VXNlcjIyMzU0NDQz", "avatar_url": "https://avatars.githubusercontent.com/u/22354443?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tnkuehne", "html_url": "https://github.com/tnkuehne", "followers_url": "https://api.github.com/users/tnkuehne/followers", "following_url": "https://api.github.com/users/tnkuehne/following{/other_user}", "gists_url": "https://api.github.com/users/tnkuehne/gists{/gist_id}", "starred_url": "https://api.github.com/users/tnkuehne/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tnkuehne/subscriptions", "organizations_url": "https://api.github.com/users/tnkuehne/orgs", "repos_url": "https://api.github.com/users/tnkuehne/repos", "events_url": "https://api.github.com/users/tnkuehne/events{/privacy}", "received_events_url": "https://api.github.com/users/tnkuehne/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 6971796828, "node_id": "LA_kwDOL90GLc8AAAABn40tXA", "url": "https://api.github.com/repos/better-auth/better-auth/labels/bug", "name": "bug", "color": "d73a4a", "default": true, "description": "Something isn't working"}], "state": "closed", "locked": true, "assignees": [], "milestone": null, "comments": 33, "created_at": "2025-12-08T15:51:22Z", "updated_at": "2026-01-13T00:04:13Z", "closed_at": "2026-01-12T19:20:56Z", "assignee": null, "author_association": "CONTRIBUTOR", "type": null, "active_lock_reason": "resolved", "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### Is this suited for github?\n\n- [x] Yes, this is suited for github\n\n### To Reproduce\n\n1. Follow the setup guide for SvelteKit https://www.better-auth.com/docs/integrations/svelte-kit. This worked perfectly deployed on cloudflare workers (node compat enabled `\"compatibility_date\": \"2025-06-12\"` and `\"compatibility_flags\": [\"nodejs_compat\"]` with version 1.3\n2. Upgrade to 1.4\n3. Call `await auth.api.signInSSO`\n\n```ts\nconst res = await auth.api.signInSSO({\n    body: {\n        email,\n        callbackURL: redirectTo,\n    },\n});\n```\n\nThrows error\n```console\nNo request state found. Please make sure you are calling this function within a `runWithRequestState` callback.\n    at getCurrentRequestState (file:///home/timo/ZedProjects/enterprise/node_modules/.pnpm/@better-auth+core@1.4.5_@better-auth+utils@0.3.0_@better-fetch+fetch@1.1.18_better-call_c97e445e802b315319ad04ddb5da9384/node_modules/@better-auth/core/dist/context-DgQ9XGBl.mjs:41:20)\n    at async set (file:///home/timo/ZedProjects/enterprise/node_modules/.pnpm/@better-auth+core@1.4.5_@better-auth+utils@0.3.0_@better-fetch+fetch@1.1.18_better-call_c97e445e802b315319ad04ddb5da9384/node_modules/@better-auth/core/dist/context-DgQ9XGBl.mjs:63:5)\n    at async generateState (file:///home/timo/ZedProjects/enterprise/node_modules/.pnpm/better-auth@1.4.5_@sveltejs+kit@2.49.1_@opentelemetry+api@1.9.0_@sveltejs+vite-plugin-s_2117d6321a543e35ae24707332b8d2bc/node_modules/better-auth/dist/utils-db7gNqd-.mjs:28:2)\n    at null.<anonymous> (async file:///home/timo/ZedProjects/enterprise/.wrangler/tmp/dev-OZuMhX/_worker.js:116425:26)\n    at async internalHandler (file:///home/timo/ZedProjects/enterprise/node_modules/.pnpm/better-call@1.1.4_zod@4.1.13/node_modules/better-call/src/endpoint.ts:503:20)\n    at null.<anonymous> (async file:///home/timo/ZedProjects/enterprise/.wrangler/tmp/dev-OZuMhX/_worker.js:141196:26)\n    at async trySSO (file:///home/timo/ZedProjects/enterprise/.svelte-kit/output/server/entries/pages/login/_page.server.ts.js:66:11)\n    at async default (file:///home/timo/ZedProjects/enterprise/.svelte-kit/output/server/entries/pages/login/_page.server.ts.js:101:17)\n    at async fn (file:///home/timo/ZedProjects/enterprise/.svelte-kit/output/server/index.js:646:19)\n    at null.<anonymous> (async file:///home/timo/ZedProjects/enterprise/.wrangler/tmp/dev-OZuMhX/_worker.js:512753:14)\n```\n\n### Current vs. Expected behavior\n\nBefore upgrading to 1.4, it was working, and now it's broken.\n\n### What version of Better Auth are you using?\n\n1.4.5\n\n### System info\n\n```bash\n{\n  \"system\": {\n    \"platform\": \"linux\",\n    \"arch\": \"x64\",\n    \"version\": \"#36~24.04.1-Ubuntu SMP PREEMPT_DYNAMIC Wed Oct 15 15:45:17 UTC 2\",\n    \"release\": \"6.14.0-36-generic\",\n    \"cpuCount\": 16,\n    \"cpuModel\": \"AMD Ryzen 7 PRO 5850U with Radeon Graphics\",\n    \"totalMemory\": \"27.23 GB\",\n    \"freeMemory\": \"9.15 GB\"\n  },\n  \"node\": {\n    \"version\": \"v22.19.0\",\n    \"env\": \"development\"\n  },\n  \"packageManager\": {\n    \"name\": \"pnpm\",\n    \"version\": \"10.23.0\"\n  },\n  \"frameworks\": [\n    {\n      \"name\": \"svelte\",\n      \"version\": \"^5.45.6\"\n    },\n    {\n      \"name\": \"@sveltejs/kit\",\n      \"version\": \"^2.49.1\"\n    }\n  ],\n  \"databases\": [\n    {\n      \"name\": \"drizzle\",\n      \"version\": \"^0.45.0\"\n    },\n    {\n      \"name\": \"@neondatabase/serverless\",\n      \"version\": \"^1.0.2\"\n    }\n  ],\n  \"betterAuth\": {\n    \"version\": \"^1.4.5\",\n    \"config\": {\n      \"baseURL\": \"http://localhost:8787\",\n      \"account\": {\n        \"accountLinking\": {\n          \"enabled\": true,\n          \"allowDifferentEmails\": true\n        }\n      },\n      \"socialProviders\": {\n        \"microsoft\": {\n          \"clientId\": \"[REDACTED]\",\n          \"clientSecret\": \"[REDACTED]\",\n          \"tenantId\": \"common\",\n          \"authority\": \"https://login.microsoftonline.com\",\n          \"prompt\": \"select_account\"\n        }\n      },\n      \"plugins\": [\n        {\n          \"name\": \"email-otp\",\n          \"config\": {\n            \"id\": \"email-otp\",\n            \"endpoints\": {},\n            \"hooks\": {\n              \"after\": [\n                {}\n              ]\n            },\n            \"$ERROR_CODES\": {\n              \"OTP_EXPIRED\": \"OTP expired\",\n              \"INVALID_OTP\": \"Invalid OTP\",\n              \"TOO_MANY_ATTEMPTS\": \"Too many attempts\"\n            },\n            \"rateLimit\": [\n              {\n                \"window\": 60,\n                \"max\": 3\n              },\n              {\n                \"window\": 60,\n                \"max\": 3\n              },\n              {\n                \"window\": 60,\n                \"max\": 3\n              },\n              {\n                \"window\": 60,\n                \"max\": 3\n              }\n            ]\n          }\n        },\n        {\n          \"name\": \"admin\",\n          \"config\": {\n            \"id\": \"admin\",\n            \"hooks\": {\n              \"after\": [\n                {}\n              ]\n            },\n            \"endpoints\": {},\n            \"$ERROR_CODES\": {\n              \"FAILED_TO_CREATE_USER\": \"Failed to create user\",\n              \"USER_ALREADY_EXISTS\": \"User already exists.\",\n              \"USER_ALREADY_EXISTS_USE_ANOTHER_EMAIL\": \"User already exists. Use another email.\",\n              \"YOU_CANNOT_BAN_YOURSELF\": \"You cannot ban yourself\",\n              \"YOU_ARE_NOT_ALLOWED_TO_CHANGE_USERS_ROLE\": \"You are not allowed to change users role\",\n              \"YOU_ARE_NOT_ALLOWED_TO_CREATE_USERS\": \"You are not allowed to create users\",\n              \"YOU_ARE_NOT_ALLOWED_TO_LIST_USERS\": \"You are not allowed to list users\",\n              \"YOU_ARE_NOT_ALLOWED_TO_LIST_USERS_SESSIONS\": \"You are not allowed to list users sessions\",\n              \"YOU_ARE_NOT_ALLOWED_TO_BAN_USERS\": \"You are not allowed to ban users\",\n              \"YOU_ARE_NOT_ALLOWED_TO_IMPERSONATE_USERS\": \"You are not allowed to impersonate users\",\n              \"YOU_ARE_NOT_ALLOWED_TO_REVOKE_USERS_SESSIONS\": \"You are not allowed to revoke users sessions\",\n              \"YOU_ARE_NOT_ALLOWED_TO_DELETE_USERS\": \"You are not allowed to delete users\",\n              \"YOU_ARE_NOT_ALLOWED_TO_SET_USERS_PASSWORD\": \"[REDACTED]\",\n              \"BANNED_USER\": \"You have been banned from this application\",\n              \"YOU_ARE_NOT_ALLOWED_TO_GET_USER\": \"You are not allowed to get user\",\n              \"NO_DATA_TO_UPDATE\": \"No data to update\",\n              \"YOU_ARE_NOT_ALLOWED_TO_UPDATE_USERS\": \"You are not allowed to update users\",\n              \"YOU_CANNOT_REMOVE_YOURSELF\": \"You cannot remove yourself\",\n              \"YOU_ARE_NOT_ALLOWED_TO_SET_NON_EXISTENT_VALUE\": \"You are not allowed to set a non-existent role value\"\n            },\n            \"schema\": {\n              \"user\": {\n                \"fields\": {\n                  \"role\": {\n                    \"type\": \"string\",\n                    \"required\": false,\n                    \"input\": false\n                  },\n                  \"banned\": {\n                    \"type\": \"boolean\",\n                    \"defaultValue\": false,\n                    \"required\": false,\n                    \"input\": false\n                  },\n                  \"banReason\": {\n                    \"type\": \"string\",\n                    \"required\": false,\n                    \"input\": false\n                  },\n                  \"banExpires\": {\n                    \"type\": \"date\",\n                    \"required\": false,\n                    \"input\": false\n                  }\n                }\n              },\n              \"session\": {\n                \"fields\": {\n                  \"impersonatedBy\": {\n                    \"type\": \"string\",\n                    \"required\": false\n                  }\n                }\n              }\n            }\n          }\n        },\n        {\n          \"name\": \"organization\",\n          \"config\": {\n            \"id\": \"organization\",\n            \"endpoints\": {},\n            \"schema\": {\n              \"organization\": {\n                \"fields\": {\n                  \"name\": {\n                    \"type\": \"string\",\n                    \"required\": true,\n                    \"sortable\": true\n                  },\n                  \"slug\": {\n                    \"type\": \"string\",\n                    \"required\": true,\n                    \"unique\": true,\n                    \"sortable\": true\n                  },\n                  \"logo\": {\n                    \"type\": \"string\",\n                    \"required\": false\n                  },\n                  \"createdAt\": {\n                    \"type\": \"date\",\n                    \"required\": true\n                  },\n                  \"metadata\": {\n                    \"type\": \"string\",\n                    \"required\": false\n                  }\n                }\n              },\n              \"member\": {\n                \"fields\": {\n                  \"organizationId\": {\n                    \"type\": \"string\",\n                    \"required\": true,\n                    \"references\": {\n                      \"model\": \"organization\",\n                      \"field\": \"id\"\n                    },\n                    \"index\": true\n                  },\n                  \"userId\": {\n                    \"type\": \"string\",\n                    \"required\": true,\n                    \"references\": {\n                      \"model\": \"user\",\n                      \"field\": \"id\"\n                    },\n                    \"index\": true\n                  },\n                  \"role\": {\n                    \"type\": \"string\",\n                    \"required\": true,\n                    \"sortable\": true,\n                    \"defaultValue\": \"member\"\n                  },\n                  \"createdAt\": {\n                    \"type\": \"date\",\n                    \"required\": true\n                  }\n                }\n              },\n              \"invitation\": {\n                \"fields\": {\n                  \"organizationId\": {\n                    \"type\": \"string\",\n                    \"required\": true,\n                    \"references\": {\n                      \"model\": \"organization\",\n                      \"field\": \"id\"\n                    },\n                    \"index\": true\n                  },\n                  \"email\": {\n                    \"type\": \"string\",\n                    \"required\": true,\n                    \"sortable\": true,\n                    \"index\": true\n                  },\n                  \"role\": {\n                    \"type\": \"string\",\n                    \"required\": false,\n                    \"sortable\": true\n                  },\n                  \"status\": {\n                    \"type\": \"string\",\n                    \"required\": true,\n                    \"sortable\": true,\n                    \"defaultValue\": \"pending\"\n                  },\n                  \"expiresAt\": {\n                    \"type\": \"date\",\n                    \"required\": true\n                  },\n                  \"createdAt\": {\n                    \"type\": \"date\",\n                    \"required\": true\n                  },\n                  \"inviterId\": {\n                    \"type\": \"string\",\n                    \"references\": {\n                      \"model\": \"user\",\n                      \"field\": \"id\"\n                    },\n                    \"required\": true\n                  }\n                }\n              },\n              \"session\": {\n                \"fields\": {\n                  \"activeOrganizationId\": {\n                    \"type\": \"string\",\n                    \"required\": false\n                  }\n                }\n              }\n            },\n            \"$Infer\": {\n              \"Organization\": {},\n              \"Invitation\": {},\n              \"Member\": {},\n              \"Team\": {},\n              \"TeamMember\": {},\n              \"ActiveOrganization\": {}\n            },\n            \"$ERROR_CODES\": {\n              \"YOU_ARE_NOT_ALLOWED_TO_CREATE_A_NEW_ORGANIZATION\": \"You are not allowed to create a new organization\",\n              \"YOU_HAVE_REACHED_THE_MAXIMUM_NUMBER_OF_ORGANIZATIONS\": \"You have reached the maximum number of organizations\",\n              \"ORGANIZATION_ALREADY_EXISTS\": \"Organization already exists\",\n              \"ORGANIZATION_SLUG_ALREADY_TAKEN\": \"Organization slug already taken\",\n              \"ORGANIZATION_NOT_FOUND\": \"Organization not found\",\n              \"USER_IS_NOT_A_MEMBER_OF_THE_ORGANIZATION\": \"User is not a member of the organization\",\n              \"YOU_ARE_NOT_ALLOWED_TO_UPDATE_THIS_ORGANIZATION\": \"You are not allowed to update this organization\",\n              \"YOU_ARE_NOT_ALLOWED_TO_DELETE_THIS_ORGANIZATION\": \"You are not allowed to delete this organization\",\n              \"NO_ACTIVE_ORGANIZATION\": \"No active organization\",\n              \"USER_IS_ALREADY_A_MEMBER_OF_THIS_ORGANIZATION\": \"User is already a member of this organization\",\n              \"MEMBER_NOT_FOUND\": \"Member not found\",\n              \"ROLE_NOT_FOUND\": \"Role not found\",\n              \"YOU_ARE_NOT_ALLOWED_TO_CREATE_A_NEW_TEAM\": \"You are not allowed to create a new team\",\n              \"TEAM_ALREADY_EXISTS\": \"Team already exists\",\n              \"TEAM_NOT_FOUND\": \"Team not found\",\n              \"YOU_CANNOT_LEAVE_THE_ORGANIZATION_AS_THE_ONLY_OWNER\": \"You cannot leave the organization as the only owner\",\n              \"YOU_CANNOT_LEAVE_THE_ORGANIZATION_WITHOUT_AN_OWNER\": \"You cannot leave the organization without an owner\",\n              \"YOU_ARE_NOT_ALLOWED_TO_DELETE_THIS_MEMBER\": \"You are not allowed to delete this member\",\n              \"YOU_ARE_NOT_ALLOWED_TO_INVITE_USERS_TO_THIS_ORGANIZATION\": \"You are not allowed to invite users to this organization\",\n              \"USER_IS_ALREADY_INVITED_TO_THIS_ORGANIZATION\": \"User is already invited to this organization\",\n              \"INVITATION_NOT_FOUND\": \"Invitation not found\",\n              \"YOU_ARE_NOT_THE_RECIPIENT_OF_THE_INVITATION\": \"You are not the recipient of the invitation\",\n              \"EMAIL_VERIFICATION_REQUIRED_BEFORE_ACCEPTING_OR_REJECTING_INVITATION\": \"Email verification required before accepting or rejecting invitation\",\n              \"YOU_ARE_NOT_ALLOWED_TO_CANCEL_THIS_INVITATION\": \"You are not allowed to cancel this invitation\",\n              \"INVITER_IS_NO_LONGER_A_MEMBER_OF_THE_ORGANIZATION\": \"Inviter is no longer a member of the organization\",\n              \"YOU_ARE_NOT_ALLOWED_TO_INVITE_USER_WITH_THIS_ROLE\": \"You are not allowed to invite a user with this role\",\n              \"FAILED_TO_RETRIEVE_INVITATION\": \"Failed to retrieve invitation\",\n              \"YOU_HAVE_REACHED_THE_MAXIMUM_NUMBER_OF_TEAMS\": \"You have reached the maximum number of teams\",\n              \"UNABLE_TO_REMOVE_LAST_TEAM\": \"Unable to remove last team\",\n              \"YOU_ARE_NOT_ALLOWED_TO_UPDATE_THIS_MEMBER\": \"You are not allowed to update this member\",\n              \"ORGANIZATION_MEMBERSHIP_LIMIT_REACHED\": \"Organization membership limit reached\",\n              \"YOU_ARE_NOT_ALLOWED_TO_CREATE_TEAMS_IN_THIS_ORGANIZATION\": \"You are not allowed to create teams in this organization\",\n              \"YOU_ARE_NOT_ALLOWED_TO_DELETE_TEAMS_IN_THIS_ORGANIZATION\": \"You are not allowed to delete teams in this organization\",\n              \"YOU_ARE_NOT_ALLOWED_TO_UPDATE_THIS_TEAM\": \"You are not allowed to update this team\",\n              \"YOU_ARE_NOT_ALLOWED_TO_DELETE_THIS_TEAM\": \"You are not allowed to delete this team\",\n              \"INVITATION_LIMIT_REACHED\": \"Invitation limit reached\",\n              \"TEAM_MEMBER_LIMIT_REACHED\": \"Team member limit reached\",\n              \"USER_IS_NOT_A_MEMBER_OF_THE_TEAM\": \"User is not a member of the team\",\n              \"YOU_CAN_NOT_ACCESS_THE_MEMBERS_OF_THIS_TEAM\": \"You are not allowed to list the members of this team\",\n              \"YOU_DO_NOT_HAVE_AN_ACTIVE_TEAM\": \"You do not have an active team\",\n              \"YOU_ARE_NOT_ALLOWED_TO_CREATE_A_NEW_TEAM_MEMBER\": \"You are not allowed to create a new member\",\n              \"YOU_ARE_NOT_ALLOWED_TO_REMOVE_A_TEAM_MEMBER\": \"You are not allowed to remove a team member\",\n              \"YOU_ARE_NOT_ALLOWED_TO_ACCESS_THIS_ORGANIZATION\": \"You are not allowed to access this organization as an owner\",\n              \"YOU_ARE_NOT_A_MEMBER_OF_THIS_ORGANIZATION\": \"You are not a member of this organization\",\n              \"MISSING_AC_INSTANCE\": \"Dynamic Access Control requires a pre-defined ac instance on the server auth plugin. Read server logs for more information\",\n              \"YOU_MUST_BE_IN_AN_ORGANIZATION_TO_CREATE_A_ROLE\": \"You must be in an organization to create a role\",\n              \"YOU_ARE_NOT_ALLOWED_TO_CREATE_A_ROLE\": \"You are not allowed to create a role\",\n              \"YOU_ARE_NOT_ALLOWED_TO_UPDATE_A_ROLE\": \"You are not allowed to update a role\",\n              \"YOU_ARE_NOT_ALLOWED_TO_DELETE_A_ROLE\": \"You are not allowed to delete a role\",\n              \"YOU_ARE_NOT_ALLOWED_TO_READ_A_ROLE\": \"You are not allowed to read a role\",\n              \"YOU_ARE_NOT_ALLOWED_TO_LIST_A_ROLE\": \"You are not allowed to list a role\",\n              \"YOU_ARE_NOT_ALLOWED_TO_GET_A_ROLE\": \"You are not allowed to get a role\",\n              \"TOO_MANY_ROLES\": \"This organization has too many roles\",\n              \"INVALID_RESOURCE\": \"The provided permission includes an invalid resource\",\n              \"ROLE_NAME_IS_ALREADY_TAKEN\": \"That role name is already taken\",\n              \"CANNOT_DELETE_A_PRE_DEFINED_ROLE\": \"Cannot delete a pre-defined role\"\n            },\n            \"options\": {\n              \"ac\": {\n                \"statements\": {\n                  \"organization\": [\n                    \"update\",\n                    \"delete\"\n                  ],\n                  \"member\": [\n                    \"create\",\n                    \"update\",\n                    \"delete\"\n                  ],\n                  \"invitation\": [\n                    \"create\",\n                    \"cancel\"\n                  ],\n                  \"team\": [\n                    \"create\",\n                    \"update\",\n                    \"delete\"\n                  ],\n                  \"ac\": [\n                    \"create\",\n                    \"read\",\n                    \"update\",\n                    \"delete\"\n                  ],\n                  \"onboarding\": [\n                    \"create\",\n                    \"read\",\n                    \"update\",\n                    \"delete\"\n                  ],\n                  \"management\": [\n                    \"create\",\n                    \"read\",\n                    \"update\",\n                    \"delete\"\n                  ]\n                }\n              },\n              \"roles\": {\n                \"owner\": {\n                  \"statements\": {\n                    \"onboarding\": [\n                      \"create\",\n                      \"read\",\n                      \"update\",\n                      \"delete\"\n                    ],\n                    \"management\": [\n                      \"create\",\n                      \"read\",\n                      \"update\",\n                      \"delete\"\n                    ],\n                    \"organization\": [\n                      \"update\",\n                      \"delete\"\n                    ],\n                    \"member\": [\n                      \"create\",\n                      \"update\",\n                      \"delete\"\n                    ],\n                    \"invitation\": [\n                      \"create\",\n                      \"cancel\"\n                    ],\n                    \"team\": [\n                      \"create\",\n                      \"update\",\n                      \"delete\"\n                    ],\n                    \"ac\": [\n                      \"create\",\n                      \"read\",\n                      \"update\",\n                      \"delete\"\n                    ]\n                  }\n                },\n                \"admin\": {\n                  \"statements\": {\n                    \"onboarding\": [\n                      \"create\",\n                      \"read\",\n                      \"update\",\n                      \"delete\"\n                    ],\n                    \"management\": [\n                      \"create\",\n                      \"read\",\n                      \"update\",\n                      \"delete\"\n                    ],\n                    \"organization\": [\n                      \"update\"\n                    ],\n                    \"invitation\": [\n                      \"create\",\n                      \"cancel\"\n                    ],\n                    \"member\": [\n                      \"create\",\n                      \"update\",\n                      \"delete\"\n                    ],\n                    \"team\": [\n                      \"create\",\n                      \"update\",\n                      \"delete\"\n                    ],\n                    \"ac\": [\n                      \"create\",\n                      \"read\",\n                      \"update\",\n                      \"delete\"\n                    ]\n                  }\n                },\n                \"member\": {\n                  \"statements\": {\n                    \"onboarding\": [\n                      \"read\"\n                    ],\n                    \"organization\": [],\n                    \"member\": [],\n                    \"invitation\": [],\n                    \"team\": [],\n                    \"ac\": [\n                      \"read\"\n                    ]\n                  }\n                },\n                \"supervisor\": {\n                  \"statements\": {\n                    \"onboarding\": [\n                      \"create\",\n                      \"read\",\n                      \"update\",\n                      \"delete\"\n                    ],\n                    \"organization\": [],\n                    \"member\": [],\n                    \"invitation\": [],\n                    \"team\": [],\n                    \"ac\": [\n                      \"read\"\n                    ]\n                  }\n                },\n                \"manager\": {\n                  \"statements\": {\n                    \"onboarding\": [\n                      \"create\",\n                      \"read\",\n                      \"update\",\n                      \"delete\"\n                    ],\n                    \"management\": [\n                      \"create\",\n                      \"read\",\n                      \"update\",\n                      \"delete\"\n                    ],\n                    \"organization\": [],\n                    \"member\": [],\n                    \"invitation\": [],\n                    \"team\": [],\n                    \"ac\": [\n                      \"read\"\n                    ]\n                  }\n                }\n              }\n            }\n          }\n        },\n        {\n          \"name\": \"sso\",\n          \"config\": {\n            \"id\": \"sso\",\n            \"endpoints\": {},\n            \"schema\": {\n              \"ssoProvider\": {\n                \"modelName\": \"ssoProvider\",\n                \"fields\": {\n                  \"issuer\": {\n                    \"type\": \"string\",\n                    \"required\": true,\n                    \"fieldName\": \"issuer\"\n                  },\n                  \"oidcConfig\": {\n                    \"type\": \"string\",\n                    \"required\": false,\n                    \"fieldName\": \"oidcConfig\"\n                  },\n                  \"samlConfig\": {\n                    \"type\": \"string\",\n                    \"required\": false,\n                    \"fieldName\": \"samlConfig\"\n                  },\n                  \"userId\": {\n                    \"type\": \"string\",\n                    \"references\": {\n                      \"model\": \"user\",\n                      \"field\": \"id\"\n                    },\n                    \"fieldName\": \"userId\"\n                  },\n                  \"providerId\": {\n                    \"type\": \"string\",\n                    \"required\": true,\n                    \"unique\": true,\n                    \"fieldName\": \"providerId\"\n                  },\n                  \"organizationId\": {\n                    \"type\": \"string\",\n                    \"required\": false,\n                    \"fieldName\": \"organizationId\"\n                  },\n                  \"domain\": {\n                    \"type\": \"string\",\n                    \"required\": true,\n                    \"fieldName\": \"domain\"\n                  }\n                }\n              }\n            }\n          }\n        },\n        {\n          \"name\": \"passkey\",\n          \"config\": {\n            \"id\": \"passkey\",\n            \"endpoints\": {},\n            \"schema\": {\n              \"passkey\": {\n                \"fields\": {\n                  \"name\": {\n                    \"type\": \"string\",\n                    \"required\": false\n                  },\n                  \"publicKey\": {\n                    \"type\": \"string\",\n                    \"required\": true\n                  },\n                  \"userId\": {\n                    \"type\": \"string\",\n                    \"references\": {\n                      \"model\": \"user\",\n                      \"field\": \"id\"\n                    },\n                    \"required\": true,\n                    \"index\": true\n                  },\n                  \"credentialID\": {\n                    \"type\": \"string\",\n                    \"required\": true,\n                    \"index\": true\n                  },\n                  \"counter\": {\n                    \"type\": \"number\",\n                    \"required\": true\n                  },\n                  \"deviceType\": {\n                    \"type\": \"string\",\n                    \"required\": true\n                  },\n                  \"backedUp\": {\n                    \"type\": \"boolean\",\n                    \"required\": true\n                  },\n                  \"transports\": {\n                    \"type\": \"string\",\n                    \"required\": false\n                  },\n                  \"createdAt\": {\n                    \"type\": \"date\",\n                    \"required\": false\n                  },\n                  \"aaguid\": {\n                    \"type\": \"string\",\n                    \"required\": false\n                  }\n                }\n              }\n            },\n            \"$ERROR_CODES\": {\n              \"CHALLENGE_NOT_FOUND\": \"Challenge not found\",\n              \"YOU_ARE_NOT_ALLOWED_TO_REGISTER_THIS_PASSKEY\": \"You are not allowed to register this passkey\",\n              \"FAILED_TO_VERIFY_REGISTRATION\": \"Failed to verify registration\",\n              \"PASSKEY_NOT_FOUND\": \"Passkey not found\",\n              \"AUTHENTICATION_FAILED\": \"Authentication failed\",\n              \"UNABLE_TO_CREATE_SESSION\": \"Unable to create session\",\n              \"FAILED_TO_UPDATE_PASSKEY\": \"Failed to update passkey\"\n            }\n          }\n        },\n        {\n          \"name\": \"sveltekit-cookies\",\n          \"config\": {\n            \"id\": \"sveltekit-cookies\",\n            \"hooks\": {\n              \"after\": [\n                {}\n              ]\n            }\n          }\n        }\n      ],\n      \"telemetry\": {\n        \"enabled\": false\n      },\n      \"advanced\": {}\n    }\n  }\n}\n```\n\n### Which area(s) are affected? (Select all that apply)\n\nBackend\n\n### Auth config (if applicable)\n\n```typescript\nimport { dev } from \"$app/environment\";\nimport { getRequestEvent } from \"$app/server\";\nimport { env } from \"$env/dynamic/private\";\nimport { BETTER_AUTH_URL } from \"$env/static/private\";\nimport { ac, roles } from \"$lib/permissions\";\nimport { db } from \"$lib/server/db\";\nimport {\n    sendOTPEmail,\n    sendOTPSignInEmail,\n    sendOTPVerificationEmail,\n    sendOrganizationInvitationEmail,\n} from \"$lib/server/email\";\nimport { sso } from \"@better-auth/sso\";\nimport { betterAuth } from \"better-auth\";\nimport { drizzleAdapter } from \"better-auth/adapters/drizzle\";\nimport {\n    admin as adminPlugin,\n    emailOTP,\n    organization,\n} from \"better-auth/plugins\";\nimport { passkey } from \"@better-auth/passkey\";\nimport { sveltekitCookies } from \"better-auth/svelte-kit\";\n\nconst MICROSOFT_CLIENT_ID = env.MICROSOFT_CLIENT_ID;\nconst MICROSOFT_CLIENT_SECRET = env.MICROSOFT_CLIENT_SECRET;\nif (!MICROSOFT_CLIENT_ID || !MICROSOFT_CLIENT_SECRET) {\n    throw new Error(\n        \"Missing required environment variable: MICROSOFT_CLIENT_ID or MICROSOFT_CLIENT_SECRET\",\n    );\n}\n\nexport const auth = betterAuth({\n    baseURL: BETTER_AUTH_URL,\n    database: drizzleAdapter(db, {\n        provider: \"pg\",\n    }),\n    account: {\n        accountLinking: {\n            enabled: true,\n            allowDifferentEmails: true,\n        },\n    },\n    socialProviders: {\n        microsoft: {\n            clientId: MICROSOFT_CLIENT_ID,\n            clientSecret: MICROSOFT_CLIENT_SECRET,\n            tenantId: \"common\",\n            authority: \"https://login.microsoftonline.com\",\n            prompt: \"select_account\",\n        },\n    },\n    plugins: [\n        emailOTP({\n            async sendVerificationOTP({ email, otp, type }) {\n                if (dev) {\n                    console.log(`OTP ${otp} sent to ${email}`);\n                    return Promise.resolve();\n                }\n                if (type === \"sign-in\") {\n                    await sendOTPSignInEmail(otp, email);\n                } else if (type === \"email-verification\") {\n                    await sendOTPVerificationEmail(otp, email);\n                } else {\n                    await sendOTPEmail(otp, email);\n                }\n            },\n            disableSignUp: true,\n        }),\n        adminPlugin(),\n        organization({\n            ac,\n            roles,\n            async sendInvitationEmail(data) {\n                const inviteLink = `${BETTER_AUTH_URL}/accept-invitation/${data.id}`;\n                if (dev) {\n                    console.log(`Invite link: ${inviteLink}`);\n                    return Promise.resolve();\n                }\n                await sendOrganizationInvitationEmail(\n                    data.email,\n                    data.inviter.user.name,\n                    data.inviter.user.email,\n                    data.organization.name,\n                    inviteLink,\n                );\n            },\n        }),\n        sso({\n            organizationProvisioning: {\n                disabled: false,\n                defaultRole: \"member\",\n            },\n        }),\n        passkey({\n            rpID: dev ? \"localhost\" : new URL(BETTER_AUTH_URL).hostname,\n            rpName: \"mendra AI\",\n            origin: dev ? \"http://localhost:5173\" : BETTER_AUTH_URL,\n        }),\n        sveltekitCookies(getRequestEvent),\n    ],\n    telemetry: {\n        enabled: false,\n    },\n    advanced: dev\n        ? {}\n        : {\n              ipAddress: {\n                  ipAddressHeaders: [\"cf-connecting-ip\"],\n              },\n          },\n});\n```\n\n### Additional context\n\n_No response_", "closed_by": {"login": "himself65", "id": 14026360, "node_id": "MDQ6VXNlcjE0MDI2MzYw", "avatar_url": "https://avatars.githubusercontent.com/u/14026360?v=4", "gravatar_id": "", "url": "https://api.github.com/users/himself65", "html_url": "https://github.com/himself65", "followers_url": "https://api.github.com/users/himself65/followers", "following_url": "https://api.github.com/users/himself65/following{/other_user}", "gists_url": "https://api.github.com/users/himself65/gists{/gist_id}", "starred_url": "https://api.github.com/users/himself65/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/himself65/subscriptions", "organizations_url": "https://api.github.com/users/himself65/orgs", "repos_url": "https://api.github.com/users/himself65/repos", "events_url": "https://api.github.com/users/himself65/events{/privacy}", "received_events_url": "https://api.github.com/users/himself65/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/better-auth/better-auth/issues/6613/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/better-auth/better-auth/issues/6613/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/better-auth/better-auth/issues/3951", "repository_url": "https://api.github.com/repos/better-auth/better-auth", "labels_url": "https://api.github.com/repos/better-auth/better-auth/issues/3951/labels{/name}", "comments_url": "https://api.github.com/repos/better-auth/better-auth/issues/3951/comments", "events_url": "https://api.github.com/repos/better-auth/better-auth/issues/3951/events", "html_url": "https://github.com/better-auth/better-auth/issues/3951", "id": 3314388233, "node_id": "I_kwDOL90GLc7FjY0J", "number": 3951, "title": "Cannot use better-auth cli to generate schema", "user": {"login": "l0seq", "id": 118999347, "node_id": "U_kgDOBxfJMw", "avatar_url": "https://avatars.githubusercontent.com/u/118999347?v=4", "gravatar_id": "", "url": "https://api.github.com/users/l0seq", "html_url": "https://github.com/l0seq", "followers_url": "https://api.github.com/users/l0seq/followers", "following_url": "https://api.github.com/users/l0seq/following{/other_user}", "gists_url": "https://api.github.com/users/l0seq/gists{/gist_id}", "starred_url": "https://api.github.com/users/l0seq/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/l0seq/subscriptions", "organizations_url": "https://api.github.com/users/l0seq/orgs", "repos_url": "https://api.github.com/users/l0seq/repos", "events_url": "https://api.github.com/users/l0seq/events{/privacy}", "received_events_url": "https://api.github.com/users/l0seq/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 6971796828, "node_id": "LA_kwDOL90GLc8AAAABn40tXA", "url": "https://api.github.com/repos/better-auth/better-auth/labels/bug", "name": "bug", "color": "d73a4a", "default": true, "description": "Something isn't working"}], "state": "closed", "locked": false, "assignees": [{"login": "himself65", "id": 14026360, "node_id": "MDQ6VXNlcjE0MDI2MzYw", "avatar_url": "https://avatars.githubusercontent.com/u/14026360?v=4", "gravatar_id": "", "url": "https://api.github.com/users/himself65", "html_url": "https://github.com/himself65", "followers_url": "https://api.github.com/users/himself65/followers", "following_url": "https://api.github.com/users/himself65/following{/other_user}", "gists_url": "https://api.github.com/users/himself65/gists{/gist_id}", "starred_url": "https://api.github.com/users/himself65/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/himself65/subscriptions", "organizations_url": "https://api.github.com/users/himself65/orgs", "repos_url": "https://api.github.com/users/himself65/repos", "events_url": "https://api.github.com/users/himself65/events{/privacy}", "received_events_url": "https://api.github.com/users/himself65/received_events", "type": "User", "user_view_type": "public", "site_admin": false}], "milestone": null, "comments": 30, "created_at": "2025-08-12T13:54:07Z", "updated_at": "2026-02-07T11:04:57Z", "closed_at": "2025-08-24T23:35:56Z", "assignee": {"login": "himself65", "id": 14026360, "node_id": "MDQ6VXNlcjE0MDI2MzYw", "avatar_url": "https://avatars.githubusercontent.com/u/14026360?v=4", "gravatar_id": "", "url": "https://api.github.com/users/himself65", "html_url": "https://github.com/himself65", "followers_url": "https://api.github.com/users/himself65/followers", "following_url": "https://api.github.com/users/himself65/following{/other_user}", "gists_url": "https://api.github.com/users/himself65/gists{/gist_id}", "starred_url": "https://api.github.com/users/himself65/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/himself65/subscriptions", "organizations_url": "https://api.github.com/users/himself65/orgs", "repos_url": "https://api.github.com/users/himself65/repos", "events_url": "https://api.github.com/users/himself65/events{/privacy}", "received_events_url": "https://api.github.com/users/himself65/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### Is this suited for github?\n\n- [x] Yes, this is suited for github\n\n### To Reproduce\n\n1. Run `bunx --bun @better-auth/cli generate --config src/auth/index.ts`\n2. CLI will return: `Cannot find module 'zod/v4' from '/tmp/bunx-1000-@better-auth/cli@latest/node_modules/@better-auth/cli/dist/index.mjs'`\n\n### Current vs. Expected behavior\n\nMigrations should be generated normally as expected, but this error is returned.\n\n### What version of Better Auth are you using?\n\n1.3.5\n\n### System info\n\n```bash\nSystem:\n    OS: Linux 6.12 Manjaro Linux\n    CPU: (12) x64 AMD Ryzen 5 5600H with Radeon Graphics\n    Memory: 18.50 GB / 30.21 GB\n    Container: Yes\n    Shell: 5.9 - /bin/zsh\n  Browsers:\n    Chromium: 138.0.7204.157\n```\n\n### Which area(s) are affected? (Select all that apply)\n\nOther\n\n### Auth config (if applicable)\n\n```typescript\nimport { betterAuth } from \"better-auth\";\nimport { drizzleAdapter } from \"better-auth/adapters/drizzle\";\nimport { db } from \"../database\";\nimport { account, appInvitation, session, user, verification } from \"../database/schema\";\nimport { admin } from \"better-auth/plugins\";\nimport { appInvite } from \"@better-auth-kit/app-invite\"\n\nexport const auth = betterAuth({\n    database: drizzleAdapter(db, {\n        provider: \"sqlite\",\n        schema: {\n            user,\n            account,\n            session,\n            verification,\n            appInvitation\n        },\n    }),\n    emailAndPassword: {\n        enabled: true,\n        disableSignUp: false,\n    },\n    plugins: [\n        admin(),\n        appInvite({\n            sendInvitationEmail: async (data) => {\n                /*  WIP */\n            },\n            allowUserToCreateInvitation: (user) => {\n                return true;\n                /*  WIP */\n            }\n        })\n    ]\n});\n```\n\n### Additional context\n\nI have tested it with npx and bunx, same behavior", "closed_by": {"login": "himself65", "id": 14026360, "node_id": "MDQ6VXNlcjE0MDI2MzYw", "avatar_url": "https://avatars.githubusercontent.com/u/14026360?v=4", "gravatar_id": "", "url": "https://api.github.com/users/himself65", "html_url": "https://github.com/himself65", "followers_url": "https://api.github.com/users/himself65/followers", "following_url": "https://api.github.com/users/himself65/following{/other_user}", "gists_url": "https://api.github.com/users/himself65/gists{/gist_id}", "starred_url": "https://api.github.com/users/himself65/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/himself65/subscriptions", "organizations_url": "https://api.github.com/users/himself65/orgs", "repos_url": "https://api.github.com/users/himself65/repos", "events_url": "https://api.github.com/users/himself65/events{/privacy}", "received_events_url": "https://api.github.com/users/himself65/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/better-auth/better-auth/issues/3951/reactions", "total_count": 15, "+1": 13, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 2}, "timeline_url": "https://api.github.com/repos/better-auth/better-auth/issues/3951/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/better-auth/better-auth/issues/6798", "repository_url": "https://api.github.com/repos/better-auth/better-auth", "labels_url": "https://api.github.com/repos/better-auth/better-auth/issues/6798/labels{/name}", "comments_url": "https://api.github.com/repos/better-auth/better-auth/issues/6798/comments", "events_url": "https://api.github.com/repos/better-auth/better-auth/issues/6798/events", "html_url": "https://github.com/better-auth/better-auth/issues/6798", "id": 3734553656, "node_id": "I_kwDOL90GLc7emMQ4", "number": 6798, "title": "trustedOrigins disregarded in v1.4.7", "user": {"login": "giuliog-GR", "id": 126473831, "node_id": "U_kgDOB4nWZw", "avatar_url": "https://avatars.githubusercontent.com/u/126473831?v=4", "gravatar_id": "", "url": "https://api.github.com/users/giuliog-GR", "html_url": "https://github.com/giuliog-GR", "followers_url": "https://api.github.com/users/giuliog-GR/followers", "following_url": "https://api.github.com/users/giuliog-GR/following{/other_user}", "gists_url": "https://api.github.com/users/giuliog-GR/gists{/gist_id}", "starred_url": "https://api.github.com/users/giuliog-GR/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/giuliog-GR/subscriptions", "organizations_url": "https://api.github.com/users/giuliog-GR/orgs", "repos_url": "https://api.github.com/users/giuliog-GR/repos", "events_url": "https://api.github.com/users/giuliog-GR/events{/privacy}", "received_events_url": "https://api.github.com/users/giuliog-GR/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 6971796828, "node_id": "LA_kwDOL90GLc8AAAABn40tXA", "url": "https://api.github.com/repos/better-auth/better-auth/labels/bug", "name": "bug", "color": "d73a4a", "default": true, "description": "Something isn't working"}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 29, "created_at": "2025-12-16T12:19:44Z", "updated_at": "2026-01-02T10:27:19Z", "closed_at": "2025-12-27T02:53:23Z", "assignee": null, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 1}, "body": "### Is this suited for github?\n\n- [x] Yes, this is suited for github\n\n### To Reproduce\n\n1. Upgrade from v1.4.4 to v1.4.7 \n2. Better Auth breaks due to invalid origin\n3. Downgrade to v1.4.4 everything works again\n\n### Current vs. Expected behavior\n\nI would expect the system to continue working instead it is currently throwing the following error:\n\n`2025-12-16T12:02:08.788Z ERROR [Better Auth]: Invalid origin: http://localhost:5173`\n\nI did not have any trustedOrigin specified, I have tried to add a list of trusted origins but that does not seem to have any effect. Authentication is effectively broken. \n\n### What version of Better Auth are you using?\n\n1.4.7\n\n### System info\n\n```bash\n{\n  \"system\": {\n    \"platform\": \"linux\",\n    \"arch\": \"x64\",\n    \"version\": \"#101-Ubuntu SMP Tue Nov 14 13:30:08 UTC 2023\",\n    \"release\": \"5.15.0-91-generic\",\n    \"cpuCount\": 32,\n    \"cpuModel\": \"AMD EPYC 73F3 16-Core Processor\",\n    \"totalMemory\": \"1003.36 GB\",\n    \"freeMemory\": \"896.62 GB\"\n  },\n  \"node\": {\n    \"version\": \"v22.21.0\",\n    \"env\": \"development\"\n  },\n  \"packageManager\": {\n    \"name\": \"npm\",\n    \"version\": \"11.6.2\"\n  },\n  \"frameworks\": [\n    {\n      \"name\": \"svelte\",\n      \"version\": \"^5.45.10\"\n    },\n    {\n      \"name\": \"@sveltejs/kit\",\n      \"version\": \"^2.49.2\"\n    }\n  ],\n  \"databases\": [\n    {\n      \"name\": \"pg\",\n      \"version\": \"^8.16.3\"\n    },\n    {\n      \"name\": \"postgres\",\n      \"version\": \"^3.4.7\"\n    },\n    {\n      \"name\": \"drizzle\",\n      \"version\": \"^0.45.1\"\n    }\n  ],\n  \"betterAuth\": {\n    \"version\": \"1.4.7\",\n    \"config\": {\n      \"trustedOrigins\": [\n        \"https://REDACTED\",\n        \"https://REDACTED\",\n        \"http://localhost:5173\"\n      ],\n      \"session\": {\n        \"expiresIn\": 86400\n      },\n      \"user\": {\n        \"additionalFields\": {\n          \"groups\": {\n            \"type\": \"string[]\",\n            \"required\": true,\n            \"defaultValue\": [],\n            \"input\": false\n          }\n        }\n      },\n      \"plugins\": [\n        {\n          \"name\": \"sveltekit-cookies\",\n          \"config\": {\n            \"id\": \"sveltekit-cookies\",\n            \"hooks\": {\n              \"after\": [\n                {}\n              ]\n            }\n          }\n        },\n        {\n          \"name\": \"generic-oauth\",\n          \"config\": {\n            \"id\": \"generic-oauth\",\n            \"endpoints\": {},\n            \"$ERROR_CODES\": {\n              \"INVALID_OAUTH_CONFIGURATION\": \"Invalid OAuth configuration\",\n              \"TOKEN_URL_NOT_FOUND\": \"Invalid OAuth configuration. Token URL not found.\",\n              \"PROVIDER_CONFIG_NOT_FOUND\": \"No config found for provider\",\n              \"PROVIDER_ID_REQUIRED\": \"Provider ID is required\",\n              \"INVALID_OAUTH_CONFIG\": \"Invalid OAuth configuration.\",\n              \"SESSION_REQUIRED\": \"Session is required\"\n            }\n          }\n        }\n      ]\n    }\n  }\n}\n```\n\n### Which area(s) are affected? (Select all that apply)\n\nBackend, Documentation, Client\n\n### Auth config (if applicable)\n\n```typescript\nimport { betterAuth } from 'better-auth';\nimport { genericOAuth } from 'better-auth/plugins';\nimport { drizzleAdapter } from 'better-auth/adapters/drizzle';\nimport { db } from '../db';\nimport { sveltekitCookies } from 'better-auth/svelte-kit';\nimport { getRequestEvent } from '$app/server';\nimport { config } from '$lib/utils/config';\nimport * as schema from '../db/schema/better_auth';\n\nconst clientId: string = config.backends['REDACTED'].auth.client_id ?? '';\n\nexport const auth = betterAuth({\n    database: drizzleAdapter(db, {\n        provider: 'pg',\n        schema: schema\n    }),\n    trustedOrigins: [\n        'https://REDACTED',\n        'https://REDACTED',\n        'http://localhost:5173'\n    ],\n    session: {\n        expiresIn: 60 * 60 * 24 // 1 day\n    },\n    user: {\n        additionalFields: {\n            groups: {\n                type: 'string[]',\n                required: true,\n                defaultValue: [],\n                input: false\n            }\n        }\n    },\n    plugins: [\n        sveltekitCookies(getRequestEvent),\n        genericOAuth({\n            config: [\n                {\n                    providerId: 'signin',\n                    clientId: clientId,\n                    clientSecret: clientId.split('.')[0],\n                    pkce: true,\n                    accessType: 'offline',\n                    discoveryUrl: 'REDACTED/openid-configuration',\n                    scopes: [\n                        'email',\n                        'groups',\n                        'openid',\n                        'profile',\n                        'offline_access',\n                        clientId.split('.')[0]\n                    ],\n                    overrideUserInfo: true,\n                    mapProfileToUser: async (profile) => {\n                        return {\n                            email: profile.email,\n                            name: profile.name,\n                            groups: profile.groups || []\n                        };\n                    }\n                }\n            ]\n        })\n    ]\n});\n```\n\n### Additional context\n\nI have tested 1.4.6 and the issue is still there. Looks like it was introduced at some point after 1.4.4 release. Can't really find anything useful in the docs to solve this issue. \n\nI am using the latest Bun as my node runtime", "closed_by": {"login": "Bekacru", "id": 86073083, "node_id": "MDQ6VXNlcjg2MDczMDgz", "avatar_url": "https://avatars.githubusercontent.com/u/86073083?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Bekacru", "html_url": "https://github.com/Bekacru", "followers_url": "https://api.github.com/users/Bekacru/followers", "following_url": "https://api.github.com/users/Bekacru/following{/other_user}", "gists_url": "https://api.github.com/users/Bekacru/gists{/gist_id}", "starred_url": "https://api.github.com/users/Bekacru/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Bekacru/subscriptions", "organizations_url": "https://api.github.com/users/Bekacru/orgs", "repos_url": "https://api.github.com/users/Bekacru/repos", "events_url": "https://api.github.com/users/Bekacru/events{/privacy}", "received_events_url": "https://api.github.com/users/Bekacru/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/better-auth/better-auth/issues/6798/reactions", "total_count": 6, "+1": 6, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/better-auth/better-auth/issues/6798/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/better-auth/better-auth/issues/1143", "repository_url": "https://api.github.com/repos/better-auth/better-auth", "labels_url": "https://api.github.com/repos/better-auth/better-auth/issues/1143/labels{/name}", "comments_url": "https://api.github.com/repos/better-auth/better-auth/issues/1143/comments", "events_url": "https://api.github.com/repos/better-auth/better-auth/issues/1143/events", "html_url": "https://github.com/better-auth/better-auth/issues/1143", "id": 2769196930, "node_id": "I_kwDOL90GLc6lDpeC", "number": 1143, "title": "Not compatible with Cloudflare Workers or edge environments", "user": {"login": "enqqi", "id": 13815017, "node_id": "MDQ6VXNlcjEzODE1MDE3", "avatar_url": "https://avatars.githubusercontent.com/u/13815017?v=4", "gravatar_id": "", "url": "https://api.github.com/users/enqqi", "html_url": "https://github.com/enqqi", "followers_url": "https://api.github.com/users/enqqi/followers", "following_url": "https://api.github.com/users/enqqi/following{/other_user}", "gists_url": "https://api.github.com/users/enqqi/gists{/gist_id}", "starred_url": "https://api.github.com/users/enqqi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/enqqi/subscriptions", "organizations_url": "https://api.github.com/users/enqqi/orgs", "repos_url": "https://api.github.com/users/enqqi/repos", "events_url": "https://api.github.com/users/enqqi/events{/privacy}", "received_events_url": "https://api.github.com/users/enqqi/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 6971796828, "node_id": "LA_kwDOL90GLc8AAAABn40tXA", "url": "https://api.github.com/repos/better-auth/better-auth/labels/bug", "name": "bug", "color": "d73a4a", "default": true, "description": "Something isn't working"}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 27, "created_at": "2025-01-05T09:52:27Z", "updated_at": "2025-06-30T19:01:10Z", "closed_at": "2025-02-04T17:28:30Z", "assignee": null, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### Is this suited for github?\n\n- [X] Yes, this is suited for github\n\n### To Reproduce\n\n1. `bun create hono@latest my-app` (select workers template)\r\n2. Setup better-auth for hono follow official better-auth [docs](https://www.better-auth.com/docs/integrations/hono)\r\n3. While setting it up, the documentation specifies that Better-Auth expects a specific export in a [specific directory](https://www.better-auth.com/docs/installation#create-a-better-auth-instance).\r\n4. Here is where the first problem starts... You cannot follow the prescribed setup in a serverless environment (e.g., Cloudflare Workers) because env or bindings are not globally accessible.\r\n5. Attempt to work around this limitation:\r\n    - Initialize the auth client dynamically in a middleware and set it in the context.\r\n    - However, when using this approach, the sign-in and sign-up endpoints return a 500 error. This happens due to the use of this internally by Better-Auth (I think).\r\n    - one of the errors was illegal use of `this`.\r\n    - The error occurs because the workaround relies on dynamically creating the auth client as a function, which is incompatible with Better-Auth\u2019s design. Here\u2019s an example of the workaround that triggers the issue:\r\n```typescript\r\nexport const getAuth = (env: Env) => betterAuth({ ... });\r\n```\r\n7. Better-Auth requires the auth instance to be a constant and located in a specific directory as per its documentation. This restriction makes it incompatible with the dynamic initialization needed for serverless environments like Cloudflare Workers.\n\n### Current vs. Expected behavior\n\n\r\n## Current Behavior\r\nWhen attempting to use Better-Auth in edge environments like Cloudflare Workers, unexpected issues occur that prevent seamless integration and functionality.\r\n\r\n1. **Immutable Headers Error (500):**\r\n   - After creating a user or logging in, a 500 error is thrown related to immutable headers.\r\n\r\n2. **Incompatibility with Exporting `auth` as a Function:**\r\n   - Better-Auth\u2019s internal packages fail to handle `auth` being exported as a function. This is necessary to dynamically pass secrets and bindings like KV.\r\n   - **Workaround:** Resorted to `export const auth = ...` and hardcoded sensitive variables (e.g., `DB_URL`), which is not ideal for security and flexibility.\r\n\r\n3. **Custom `SecondaryStorage` KV Issue:**\r\n   - Unable to use a custom `SecondaryStorage` KV because it requires passing the actual KV binding, which is not supported in the current setup.\r\n\r\n## Expected Behavior\r\n1. Seamless integration of Better-Auth with edge environments like Cloudflare Workers.\r\n2. Ability to:\r\n   - Export `auth` as a function to dynamically handle secrets and bindings.\r\n   - Pass custom KV bindings for `SecondaryStorage` without issues.\r\n3. No immutable header-related errors after user creation or login.\r\n\r\n\n\n### What version of Better Auth are you using?\n\n1.1.10\n\n### Provide environment information\n\n```bash\nOS: macOS 15.2 24C101 arm64 \r\nHost: Mac16,7 \r\nKernel: 24.2.0 \r\nCPU: Apple M4 Pro \r\nGPU: Apple M4 Pro \r\nMemory: 4946MiB / 49152MiB\n```\n\n\n### Which area(s) are affected? (Select all that apply)\n\nBackend, Package\n\n### Auth config (if applicable)\n\n```typescript\nYes, I have nodejs_compat and als flags\r\n\r\n\r\nexport const auth = betterAuth({\r\n  database: drizzleAdapter(drizzle(env.DB_URL), {\r\n    provider: 'pg'\r\n  }),\r\n  baseURL: env.BASE_URL,\r\n  secret: env.BASE_URL,\r\n  plugins: [openAPI()],\r\n  emailAndPassword: {\r\n    enabled: true,\r\n  },\r\n  secondaryStorage: {\r\n    get: env.AuthKV.get,\r\n    set: (k, v) => env.AuthKV.put(k, v),\r\n    delete: env.AuthKV.delete,\r\n  }\r\n})\n```\n\n\n### Additional context\n\n**Global Variables or Storage:**\r\n   - While `AsyncLocalStorage` (similar to what Next.js uses) could be a potential solution, it requires a function context. Since this is not a function-based approach, store/context remains undefined.\r\n\r\n### Possible Solutions\r\n- Allow Better-Auth to be initialized as a function that accepts secrets and bindings as parameters, enabling dynamic initialization.\r\n- Provide a mechanism to use global variables in edge environments.\r\n- Explore leveraging `AsyncLocalStorage` or a similar approach to maintain context across asynchronous calls.\r\n\r\nFor further ideas, [this discussion](https://x.com/wesbos/status/1749974802050261339) offers useful insights.", "closed_by": {"login": "enqqi", "id": 13815017, "node_id": "MDQ6VXNlcjEzODE1MDE3", "avatar_url": "https://avatars.githubusercontent.com/u/13815017?v=4", "gravatar_id": "", "url": "https://api.github.com/users/enqqi", "html_url": "https://github.com/enqqi", "followers_url": "https://api.github.com/users/enqqi/followers", "following_url": "https://api.github.com/users/enqqi/following{/other_user}", "gists_url": "https://api.github.com/users/enqqi/gists{/gist_id}", "starred_url": "https://api.github.com/users/enqqi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/enqqi/subscriptions", "organizations_url": "https://api.github.com/users/enqqi/orgs", "repos_url": "https://api.github.com/users/enqqi/repos", "events_url": "https://api.github.com/users/enqqi/events{/privacy}", "received_events_url": "https://api.github.com/users/enqqi/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/better-auth/better-auth/issues/1143/reactions", "total_count": 8, "+1": 8, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/better-auth/better-auth/issues/1143/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/better-auth/better-auth/issues/7023", "repository_url": "https://api.github.com/repos/better-auth/better-auth", "labels_url": "https://api.github.com/repos/better-auth/better-auth/issues/7023/labels{/name}", "comments_url": "https://api.github.com/repos/better-auth/better-auth/issues/7023/comments", "events_url": "https://api.github.com/repos/better-auth/better-auth/issues/7023/events", "html_url": "https://github.com/better-auth/better-auth/issues/7023", "id": 3764735475, "node_id": "I_kwDOL90GLc7gZU3z", "number": 7023, "title": "State mismatch error when signing in with social providers in Next.js integration since v1.4.4", "user": {"login": "Cybermb", "id": 1338479, "node_id": "MDQ6VXNlcjEzMzg0Nzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1338479?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Cybermb", "html_url": "https://github.com/Cybermb", "followers_url": "https://api.github.com/users/Cybermb/followers", "following_url": "https://api.github.com/users/Cybermb/following{/other_user}", "gists_url": "https://api.github.com/users/Cybermb/gists{/gist_id}", "starred_url": "https://api.github.com/users/Cybermb/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Cybermb/subscriptions", "organizations_url": "https://api.github.com/users/Cybermb/orgs", "repos_url": "https://api.github.com/users/Cybermb/repos", "events_url": "https://api.github.com/users/Cybermb/events{/privacy}", "received_events_url": "https://api.github.com/users/Cybermb/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 6971796828, "node_id": "LA_kwDOL90GLc8AAAABn40tXA", "url": "https://api.github.com/repos/better-auth/better-auth/labels/bug", "name": "bug", "color": "d73a4a", "default": true, "description": "Something isn't working"}, {"id": 8484952823, "node_id": "LA_kwDOL90GLc8AAAAB-b4a9w", "url": "https://api.github.com/repos/better-auth/better-auth/labels/nextjs", "name": "nextjs", "color": "89D6EE", "default": false, "description": "Issues related to the NextJS framework"}], "state": "closed", "locked": false, "assignees": [{"login": "himself65", "id": 14026360, "node_id": "MDQ6VXNlcjE0MDI2MzYw", "avatar_url": "https://avatars.githubusercontent.com/u/14026360?v=4", "gravatar_id": "", "url": "https://api.github.com/users/himself65", "html_url": "https://github.com/himself65", "followers_url": "https://api.github.com/users/himself65/followers", "following_url": "https://api.github.com/users/himself65/following{/other_user}", "gists_url": "https://api.github.com/users/himself65/gists{/gist_id}", "starred_url": "https://api.github.com/users/himself65/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/himself65/subscriptions", "organizations_url": "https://api.github.com/users/himself65/orgs", "repos_url": "https://api.github.com/users/himself65/repos", "events_url": "https://api.github.com/users/himself65/events{/privacy}", "received_events_url": "https://api.github.com/users/himself65/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, {"login": "bytaesu", "id": 166604494, "node_id": "U_kgDOCe4uzg", "avatar_url": "https://avatars.githubusercontent.com/u/166604494?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bytaesu", "html_url": "https://github.com/bytaesu", "followers_url": "https://api.github.com/users/bytaesu/followers", "following_url": "https://api.github.com/users/bytaesu/following{/other_user}", "gists_url": "https://api.github.com/users/bytaesu/gists{/gist_id}", "starred_url": "https://api.github.com/users/bytaesu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bytaesu/subscriptions", "organizations_url": "https://api.github.com/users/bytaesu/orgs", "repos_url": "https://api.github.com/users/bytaesu/repos", "events_url": "https://api.github.com/users/bytaesu/events{/privacy}", "received_events_url": "https://api.github.com/users/bytaesu/received_events", "type": "User", "user_view_type": "public", "site_admin": false}], "milestone": null, "comments": 25, "created_at": "2025-12-27T12:35:09Z", "updated_at": "2026-01-15T10:54:13Z", "closed_at": "2026-01-13T18:01:07Z", "assignee": {"login": "himself65", "id": 14026360, "node_id": "MDQ6VXNlcjE0MDI2MzYw", "avatar_url": "https://avatars.githubusercontent.com/u/14026360?v=4", "gravatar_id": "", "url": "https://api.github.com/users/himself65", "html_url": "https://github.com/himself65", "followers_url": "https://api.github.com/users/himself65/followers", "following_url": "https://api.github.com/users/himself65/following{/other_user}", "gists_url": "https://api.github.com/users/himself65/gists{/gist_id}", "starred_url": "https://api.github.com/users/himself65/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/himself65/subscriptions", "organizations_url": "https://api.github.com/users/himself65/orgs", "repos_url": "https://api.github.com/users/himself65/repos", "events_url": "https://api.github.com/users/himself65/events{/privacy}", "received_events_url": "https://api.github.com/users/himself65/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### Is this suited for github?\n\n- [x] Yes, this is suited for github\n\n### To Reproduce\n\nhttps://github.com/Cybermb/better-auth-new-nextjs-sso-issue\n\n1. Clone the reproduction repository.\n\n2. Set the required environment variables.\n\n3. Run the development server.\n\n4. Click the sign-in button.\n\n5. Authenticate using GitHub (also reproducible with Google and Discord).\n\n6. Observe the error after redirect.\n\n### Current vs. Expected behavior\n\nWhen signing in using a social provider via the client library (not a server action), an error is thrown during the callback phase:\n\n```\nAPIError [Error [APIError]: ] {\n  status: 'FOUND',\n  body: undefined,\n  headers: Headers {\n    'set-cookie': '__Secure-better-auth.state=; Max-Age=0; Secure, __Secure-better-auth.session_token=JbFVwakAGlkSJ7Ro5p3e8jXFb6JUzJLe.ymH39VA4gTmnmfWOSVph8GnCh1flVoZ2qrsU9zgPVrs%3D; Max-Age=604800; Path=/; HttpOnly; Secure; SameSite=None',\n    location: 'http://localhost:3000'\n  },\n  statusCode: 302\n}\n```\n\n\nThe error indicates a state mismatch, even though:\n\n- The state parameter appears to be present in the callback URL.\n\n- Authentication ultimately succeeds.\n\n- A valid session cookie is set.\n\n- The user is redirected correctly.\n\nExpected behavior:\n\n- No error should be thrown during a successful OAuth sign-in flow.\n\n- State validation should pass when using the client-side sign-in API, as it did prior to v1.4.4.\n\n### What version of Better Auth are you using?\n\n1.4.4-1.4.9\n\n### System info\n\n```bash\n{\n  \"system\": {\n    \"platform\": \"win32\",\n    \"arch\": \"x64\",\n  },\n  \"node\": {\n    \"version\": \"v22.19.0\",\n    \"env\": \"production\"\n  },\n  \"packageManager\": {\n    \"name\": \"npm\",\n    \"version\": \"9.6.6\"\n  },\n  \"frameworks\": [\n    {\n      \"name\": \"next\",\n      \"version\": \"^16.1.1\"\n    },\n    {\n      \"name\": \"react\",\n      \"version\": \"^19.0.0\"\n    }\n  ],\n  \"databases\": [\n    {\n      \"name\": \"@prisma/client\",\n      \"version\": \"^6.6.0\"\n    }\n  ],\n  \"betterAuth\": {\n    \"version\": \"1.4.4-beta.1\",\n    \"config\": null\n  }\n}\n```\n\n### Which area(s) are affected? (Select all that apply)\n\nBackend\n\n### Auth config (if applicable)\n\n```typescript\n\n```\n\n### Additional context\n\nThis issue appears to have been introduced in version 1.4.4. Downgrading to v1.4.3 resolves the problem. Occurs when using the Next.js integration. Sign-in is initiated via the client library, not a server action. Reproducible locally in development. The OAuth flow completes successfully despite the error being thrown.\n\nReproducible with multiple providers:\n- GitHub\n- Google\n- Discord", "closed_by": {"login": "himself65", "id": 14026360, "node_id": "MDQ6VXNlcjE0MDI2MzYw", "avatar_url": "https://avatars.githubusercontent.com/u/14026360?v=4", "gravatar_id": "", "url": "https://api.github.com/users/himself65", "html_url": "https://github.com/himself65", "followers_url": "https://api.github.com/users/himself65/followers", "following_url": "https://api.github.com/users/himself65/following{/other_user}", "gists_url": "https://api.github.com/users/himself65/gists{/gist_id}", "starred_url": "https://api.github.com/users/himself65/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/himself65/subscriptions", "organizations_url": "https://api.github.com/users/himself65/orgs", "repos_url": "https://api.github.com/users/himself65/repos", "events_url": "https://api.github.com/users/himself65/events{/privacy}", "received_events_url": "https://api.github.com/users/himself65/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/better-auth/better-auth/issues/7023/reactions", "total_count": 2, "+1": 2, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/better-auth/better-auth/issues/7023/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/better-auth/better-auth/issues/1131", "repository_url": "https://api.github.com/repos/better-auth/better-auth", "labels_url": "https://api.github.com/repos/better-auth/better-auth/issues/1131/labels{/name}", "comments_url": "https://api.github.com/repos/better-auth/better-auth/issues/1131/comments", "events_url": "https://api.github.com/repos/better-auth/better-auth/issues/1131/events", "html_url": "https://github.com/better-auth/better-auth/issues/1131", "id": 2768890666, "node_id": "I_kwDOL90GLc6lCesq", "number": 1131, "title": "Organization Hooks aren't Typed ", "user": {"login": "msywulak", "id": 51167140, "node_id": "MDQ6VXNlcjUxMTY3MTQw", "avatar_url": "https://avatars.githubusercontent.com/u/51167140?v=4", "gravatar_id": "", "url": "https://api.github.com/users/msywulak", "html_url": "https://github.com/msywulak", "followers_url": "https://api.github.com/users/msywulak/followers", "following_url": "https://api.github.com/users/msywulak/following{/other_user}", "gists_url": "https://api.github.com/users/msywulak/gists{/gist_id}", "starred_url": "https://api.github.com/users/msywulak/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/msywulak/subscriptions", "organizations_url": "https://api.github.com/users/msywulak/orgs", "repos_url": "https://api.github.com/users/msywulak/repos", "events_url": "https://api.github.com/users/msywulak/events{/privacy}", "received_events_url": "https://api.github.com/users/msywulak/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 6971796828, "node_id": "LA_kwDOL90GLc8AAAABn40tXA", "url": "https://api.github.com/repos/better-auth/better-auth/labels/bug", "name": "bug", "color": "d73a4a", "default": true, "description": "Something isn't working"}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 25, "created_at": "2025-01-04T15:24:00Z", "updated_at": "2025-01-18T03:31:32Z", "closed_at": "2025-01-18T03:31:31Z", "assignee": null, "author_association": "CONTRIBUTOR", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### Is this suited for github?\n\n- [X] Yes, this is suited for github\n\n### To Reproduce\n\nAdd the organization plugin to your config \r\n\r\n```typescript\r\n  plugins: [openAPI(), passkey(), nextCookies(), organization(), adminPlugin()],\r\n```\r\n\r\nadd organizationClient to your client \r\n\r\n```typescript\r\nexport const authClient = createAuthClient({\r\n  plugins: [\r\n    passkeyClient(),\r\n    magicLinkClient(),\r\n    organizationClient(),\r\n    adminClient(),\r\n  ],\r\n});\r\n```\r\n\r\nadd to your auth \r\n\r\n```typescript\r\nimport { betterAuth } from \"better-auth\";\r\nimport { authConfig } from \"@/lib/auth/config\";\r\nimport { authActions } from \"@/lib/auth/actions\";\r\n\r\nexport const auth = betterAuth({\r\n  ...authConfig,\r\n  ...authActions,\r\n});\r\n```\n\n### Current vs. Expected behavior\n\nCurrently the following hooks are Any typed. I would expect them to have the appropriate types for the organization plugin. \r\n\r\n![image](https://github.com/user-attachments/assets/e37f94a3-752d-4116-9eee-93c486cca571)\r\n\n\n### What version of Better Auth are you using?\n\n1.1.9\n\n### Provide environment information\n\n```bash\n- Windows 11\n```\n\n\n### Which area(s) are affected? (Select all that apply)\n\nTypes\n\n### Auth config (if applicable)\n\n```typescript\nimport { drizzleAdapter } from \"better-auth/adapters/drizzle\";\r\nimport { db } from \"@/db\";\r\nimport {\r\n  openAPI,\r\n  organization,\r\n  admin as adminPlugin,\r\n} from \"better-auth/plugins\";\r\nimport { passkey } from \"better-auth/plugins/passkey\";\r\nimport { APP_NAME } from \"@/utils/constants\";\r\nimport { env } from \"@/env\";\r\nimport { BetterAuthOptions } from \"better-auth\";\r\nimport { nextCookies } from \"better-auth/next-js\";\r\n\r\nexport const authConfig = {\r\n  appName: APP_NAME,\r\n  baseURL:\r\n    env.NODE_ENV === \"production\"\r\n      ? env.NEXT_PUBLIC_APP_URL\r\n      : \"http://app.localhost:3000\",\r\n  trustedOrigins: [\r\n    env.NEXT_PUBLIC_APP_URL,\r\n    \"http://app.localhost:3000\",\r\n    \"http://localhost:3000\",\r\n  ],\r\n  logger: {\r\n    disabled: env.NODE_ENV === \"production\",\r\n    level: \"debug\",\r\n  },\r\n  database: drizzleAdapter(db, {\r\n    provider: \"pg\",\r\n  }),\r\n  session: {\r\n    freshAge: 0,\r\n    expiresIn: 60 * 60 * 24 * 3, // 3 days\r\n    updateAge: 60 * 60 * 12, // 12 hours (every 12 hours the session expiration is updated)\r\n    cookieCache: {\r\n      enabled: true,\r\n      maxAge: 60 * 5, // 5 minutes\r\n    },\r\n  },\r\n  user: {\r\n    additionalFields: {\r\n      defaultOrganization: {\r\n        type: \"string\",\r\n        required: false,\r\n        input: false,\r\n      },\r\n    },\r\n    changeEmail: {\r\n      enabled: true,\r\n    },\r\n    deleteUser: {\r\n      enabled: true,\r\n    },\r\n  },\r\n  emailAndPassword: {\r\n    enabled: true,\r\n    requireEmailVerification: true,\r\n  },\r\n  socialProviders: {\r\n    microsoft: {\r\n      clientId: env.MICROSOFT_CLIENT_ID,\r\n      clientSecret: env.MICROSOFT_CLIENT_SECRET,\r\n      getUserInfo: async (token) => {\r\n        const res = await fetch(\"https://graph.microsoft.com/v1.0/me\", {\r\n          headers: {\r\n            Authorization: `Bearer ${token.accessToken}`,\r\n          },\r\n        });\r\n        const user = await res.json();\r\n        console.log(user);\r\n\r\n        return {\r\n          user: {\r\n            id: user.id,\r\n            name: user.displayName,\r\n            email: user.userPrincipalName,\r\n            emailVerified: true,\r\n            createdAt: new Date(),\r\n            updatedAt: new Date(),\r\n          },\r\n          data: user.data,\r\n        };\r\n      },\r\n    },\r\n  },\r\n\r\n  plugins: [openAPI(), passkey(), nextCookies(), organization(), adminPlugin()],\r\n} satisfies BetterAuthOptions;\n```\n\n\n### Additional context\n\n_No response_", "closed_by": {"login": "msywulak", "id": 51167140, "node_id": "MDQ6VXNlcjUxMTY3MTQw", "avatar_url": "https://avatars.githubusercontent.com/u/51167140?v=4", "gravatar_id": "", "url": "https://api.github.com/users/msywulak", "html_url": "https://github.com/msywulak", "followers_url": "https://api.github.com/users/msywulak/followers", "following_url": "https://api.github.com/users/msywulak/following{/other_user}", "gists_url": "https://api.github.com/users/msywulak/gists{/gist_id}", "starred_url": "https://api.github.com/users/msywulak/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/msywulak/subscriptions", "organizations_url": "https://api.github.com/users/msywulak/orgs", "repos_url": "https://api.github.com/users/msywulak/repos", "events_url": "https://api.github.com/users/msywulak/events{/privacy}", "received_events_url": "https://api.github.com/users/msywulak/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/better-auth/better-auth/issues/1131/reactions", "total_count": 7, "+1": 7, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/better-auth/better-auth/issues/1131/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/better-auth/better-auth/issues/5662", "repository_url": "https://api.github.com/repos/better-auth/better-auth", "labels_url": "https://api.github.com/repos/better-auth/better-auth/issues/5662/labels{/name}", "comments_url": "https://api.github.com/repos/better-auth/better-auth/issues/5662/comments", "events_url": "https://api.github.com/repos/better-auth/better-auth/issues/5662/events", "html_url": "https://github.com/better-auth/better-auth/issues/5662", "id": 3566865236, "node_id": "I_kwDOL90GLc7UmgtU", "number": 5662, "title": "mapProfileToUser requiring snake_case for custom fields", "user": {"login": "lohrm-stabl", "id": 111898561, "node_id": "U_kgDOBqtvwQ", "avatar_url": "https://avatars.githubusercontent.com/u/111898561?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lohrm-stabl", "html_url": "https://github.com/lohrm-stabl", "followers_url": "https://api.github.com/users/lohrm-stabl/followers", "following_url": "https://api.github.com/users/lohrm-stabl/following{/other_user}", "gists_url": "https://api.github.com/users/lohrm-stabl/gists{/gist_id}", "starred_url": "https://api.github.com/users/lohrm-stabl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lohrm-stabl/subscriptions", "organizations_url": "https://api.github.com/users/lohrm-stabl/orgs", "repos_url": "https://api.github.com/users/lohrm-stabl/repos", "events_url": "https://api.github.com/users/lohrm-stabl/events{/privacy}", "received_events_url": "https://api.github.com/users/lohrm-stabl/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 6971796828, "node_id": "LA_kwDOL90GLc8AAAABn40tXA", "url": "https://api.github.com/repos/better-auth/better-auth/labels/bug", "name": "bug", "color": "d73a4a", "default": true, "description": "Something isn't working"}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 24, "created_at": "2025-10-29T16:21:44Z", "updated_at": "2025-10-30T15:11:55Z", "closed_at": "2025-10-30T14:59:14Z", "assignee": null, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "We upgraded better-auth version to v1.3.33 and now our old code silently failed:\n```typescript\nplugins: [\n\t\tgenericOAuth({\n\t\t\tconfig: [\n\t\t\t\t{\n\t\t\t\t\tproviderId: \"cognito\",\n\t\t\t\t\tclientId: env.COGNITO_CLIENT_ID,\n\t\t\t\t\tclientSecret: env.COGNITO_CLIENT_SECRET,\n\t\t\t\t\tdiscoveryUrl: discoveryUrl,\n\t\t\t\t\tscopes: [\"openid\", \"email\", \"profile\"],\n\t\t\t\t\tpkce: true,\n\t\t\t\t\tredirectURI: `${env.AUTH_REDIRECT_PROXY_BASE_URL || getServerUrl()}/api/auth/callback/cognito`,\n\t\t\t\t\toverrideUserInfo: true, // update the userinfo on each login\n\t\t\t\t\tmapProfileToUser: async (profile) => {\n\t\t\t\t\t\tconst userInfo = { ...profile };\n\t\t\t\t\t\tdelete userInfo.sub; // remove sub as it's mapped to id\n\t\t\t\t\t\tdelete userInfo.email; // remove email as it's mapped to email\n\t\t\t\t\t\tdelete userInfo.email_verified; // remove email_verified as it's mapped to emailVerified\n\t\t\t\t\t\tdelete userInfo.emailVerified; // remove emailVerified as it's redundant\n\n\t\t\t\t\t\t// token claims \u2014 not useful to persist\n\t\t\t\t\t\tdelete userInfo.at_hash;\n\t\t\t\t\t\tdelete userInfo.iss;\n\t\t\t\t\t\tdelete userInfo.aud;\n\t\t\t\t\t\tdelete userInfo.token_use;\n\t\t\t\t\t\tdelete userInfo.auth_time;\n\t\t\t\t\t\tdelete userInfo.exp;\n\t\t\t\t\t\tdelete userInfo.iat;\n\t\t\t\t\t\tdelete userInfo.jti;\n\t\t\t\t\t\tdelete userInfo.origin_jti;\n\n\t\t\t\t\t\tconsole.log(\"Storing userInfo:\", JSON.stringify(userInfo, null, 2));\n\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tid: profile.sub,\n\t\t\t\t\t\t\temail: profile.email,\n\t\t\t\t\t\t\temailVerified: true,\n\t\t\t\t\t\t\timage: null,\n\t\t\t\t\t\t\tname:\n\t\t\t\t\t\t\t\tprofile.name ||\n\t\t\t\t\t\t\t\tprofile.given_name ||\n\t\t\t\t\t\t\t\tprofile.preferred_username,\n\t\t\t\t\t\t\t\"user_info\": userInfo,\n\t\t\t\t\t\t};\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t}),\n...\n```\n\n`userInfo` is a custom field which we added to our Drizzle Schema.\nIt now requires us to return it like this:\n```typescript\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tid: profile.sub,\n\t\t\t\t\t\t\temail: profile.email,\n\t\t\t\t\t\t\temailVerified: true,\n\t\t\t\t\t\t\timage: null,\n\t\t\t\t\t\t\tname:\n\t\t\t\t\t\t\t\tprofile.name ||\n\t\t\t\t\t\t\t\tprofile.given_name ||\n\t\t\t\t\t\t\t\tprofile.preferred_username,\n\t\t\t\t\t\t\tuserInfo,\n\t\t\t\t\t\t};\n```\nSo the field like it's named it the database, not in the drizzleschema:\n\n```typescript\nexport const users = schemaAuth.table(\"users\", {\n\t// -- CORE SCHEMA START\n\tid: text(\"id\").primaryKey().default(UUID_V7),\n\tname: text(\"name\").notNull(),\n\temail: text(\"email\").notNull().unique(),\n\temailVerified: boolean(\"email_verified\").default(false).notNull(),\n\timage: text(\"image\"),\n\t...timestampFields,\n\t// -- CORE SCHEMA END\n\t// -- ADMIN SCHEMA START\n\trole: text(\"role\"),\n\tbanned: boolean(\"banned\"),\n\tbanReason: text(\"ban_reason\"),\n\tbanExpires: timestamp(\"ban_expires\", { withTimezone: true }),\n\t// -- ADMIN SCHEMA END\n\tuserInfo: jsonb(\"user_info\"), // userinfo from OIDC\n});\n```\n\nIs this a bug or is this intentional?", "closed_by": {"login": "ping-maxwell", "id": 145994855, "node_id": "U_kgDOCLO0Zw", "avatar_url": "https://avatars.githubusercontent.com/u/145994855?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ping-maxwell", "html_url": "https://github.com/ping-maxwell", "followers_url": "https://api.github.com/users/ping-maxwell/followers", "following_url": "https://api.github.com/users/ping-maxwell/following{/other_user}", "gists_url": "https://api.github.com/users/ping-maxwell/gists{/gist_id}", "starred_url": "https://api.github.com/users/ping-maxwell/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ping-maxwell/subscriptions", "organizations_url": "https://api.github.com/users/ping-maxwell/orgs", "repos_url": "https://api.github.com/users/ping-maxwell/repos", "events_url": "https://api.github.com/users/ping-maxwell/events{/privacy}", "received_events_url": "https://api.github.com/users/ping-maxwell/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/better-auth/better-auth/issues/5662/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/better-auth/better-auth/issues/5662/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/better-auth/better-auth/issues/4741", "repository_url": "https://api.github.com/repos/better-auth/better-auth", "labels_url": "https://api.github.com/repos/better-auth/better-auth/issues/4741/labels{/name}", "comments_url": "https://api.github.com/repos/better-auth/better-auth/issues/4741/comments", "events_url": "https://api.github.com/repos/better-auth/better-auth/issues/4741/events", "html_url": "https://github.com/better-auth/better-auth/issues/4741", "id": 3429047927, "node_id": "I_kwDOL90GLc7MYx53", "number": 4741, "title": "unexpected `Invalid id value` error during login with `mongoose`", "user": {"login": "firatciftci", "id": 2052855, "node_id": "MDQ6VXNlcjIwNTI4NTU=", "avatar_url": "https://avatars.githubusercontent.com/u/2052855?v=4", "gravatar_id": "", "url": "https://api.github.com/users/firatciftci", "html_url": "https://github.com/firatciftci", "followers_url": "https://api.github.com/users/firatciftci/followers", "following_url": "https://api.github.com/users/firatciftci/following{/other_user}", "gists_url": "https://api.github.com/users/firatciftci/gists{/gist_id}", "starred_url": "https://api.github.com/users/firatciftci/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/firatciftci/subscriptions", "organizations_url": "https://api.github.com/users/firatciftci/orgs", "repos_url": "https://api.github.com/users/firatciftci/repos", "events_url": "https://api.github.com/users/firatciftci/events{/privacy}", "received_events_url": "https://api.github.com/users/firatciftci/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 6971796828, "node_id": "LA_kwDOL90GLc8AAAABn40tXA", "url": "https://api.github.com/repos/better-auth/better-auth/labels/bug", "name": "bug", "color": "d73a4a", "default": true, "description": "Something isn't working"}, {"id": 8484953532, "node_id": "LA_kwDOL90GLc8AAAAB-b4dvA", "url": "https://api.github.com/repos/better-auth/better-auth/labels/svelte", "name": "svelte", "color": "1B68DA", "default": false, "description": "Issues related to the Svelte framework"}], "state": "closed", "locked": false, "assignees": [{"login": "ping-maxwell", "id": 145994855, "node_id": "U_kgDOCLO0Zw", "avatar_url": "https://avatars.githubusercontent.com/u/145994855?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ping-maxwell", "html_url": "https://github.com/ping-maxwell", "followers_url": "https://api.github.com/users/ping-maxwell/followers", "following_url": "https://api.github.com/users/ping-maxwell/following{/other_user}", "gists_url": "https://api.github.com/users/ping-maxwell/gists{/gist_id}", "starred_url": "https://api.github.com/users/ping-maxwell/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ping-maxwell/subscriptions", "organizations_url": "https://api.github.com/users/ping-maxwell/orgs", "repos_url": "https://api.github.com/users/ping-maxwell/repos", "events_url": "https://api.github.com/users/ping-maxwell/events{/privacy}", "received_events_url": "https://api.github.com/users/ping-maxwell/received_events", "type": "User", "user_view_type": "public", "site_admin": false}], "milestone": null, "comments": 24, "created_at": "2025-09-18T07:28:50Z", "updated_at": "2025-12-12T14:13:52Z", "closed_at": "2025-09-19T18:57:05Z", "assignee": {"login": "ping-maxwell", "id": 145994855, "node_id": "U_kgDOCLO0Zw", "avatar_url": "https://avatars.githubusercontent.com/u/145994855?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ping-maxwell", "html_url": "https://github.com/ping-maxwell", "followers_url": "https://api.github.com/users/ping-maxwell/followers", "following_url": "https://api.github.com/users/ping-maxwell/following{/other_user}", "gists_url": "https://api.github.com/users/ping-maxwell/gists{/gist_id}", "starred_url": "https://api.github.com/users/ping-maxwell/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ping-maxwell/subscriptions", "organizations_url": "https://api.github.com/users/ping-maxwell/orgs", "repos_url": "https://api.github.com/users/ping-maxwell/repos", "events_url": "https://api.github.com/users/ping-maxwell/events{/privacy}", "received_events_url": "https://api.github.com/users/ping-maxwell/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### Is this suited for github?\n\n- [x] Yes, this is suited for github\n\n### To Reproduce\n\n1. Create a new SvelteKit application\n2. Set up Better Auth using the `mongodbAdapter` and Mongoose\n3. Create a form to log in using email and password\n4. Build the application\n5. Deploy and run the production application\n4. Enter credential and press the login button\n5. See error logs in production server\n\n\n\n### Current vs. Expected behavior\n\nIn Better Auth version 1.3.9 and below, signing in works without any issues. However, in version 1.3.10 and above, a sign in operation throws the following error:\n```\n2025-09-18T07:13:34.571Z ERROR [Better Auth]: Error Error: Invalid id value\n    at serializeID (file:///app/build/server/chunks/hooks.server-DX0z3Uu4.js:99202:12)\n    at file:///app/build/server/chunks/hooks.server-DX0z3Uu4.js:99224:30\n    at Array.map (<anonymous>)\n    at convertWhereClause (file:///app/build/server/chunks/hooks.server-DX0z3Uu4.js:99214:29)\n    at Object.findMany (file:///app/build/server/chunks/hooks.server-DX0z3Uu4.js:99314:28)\n    at Object.findMany (file:///app/build/server/chunks/hooks.server-DX0z3Uu4.js:97068:38)\n    at Object.findUserByEmail (file:///app/build/server/chunks/hooks.server-DX0z3Uu4.js:98083:52)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async file:///app/build/server/chunks/better-auth.D-2CmEwz-taOnBrMS.js:10303:15\n    at async internalHandler (file:///app/build/server/chunks/better-auth.D-2CmEwz-taOnBrMS.js:1138:20)\n```\n\nThere appears to be a regression with the `mongodbAdapter` and how it handles MongoDB ObjectId values during the login process as it tries to serialize the value to a string.\n\n### What version of Better Auth are you using?\n\n1.3.11\n\n### System info\n\n```bash\n{\n  \"system\": {\n    \"platform\": \"darwin\",\n    \"arch\": \"arm64\",\n    \"version\": \"Darwin Kernel Version 25.0.0: Mon Aug 25 21:17:54 PDT 2025; root:xnu-12377.1.9~3/RELEASE_ARM64_T6041\",\n    \"release\": \"25.0.0\",\n    \"cpuCount\": 14,\n    \"cpuModel\": \"Apple M4 Pro\",\n    \"totalMemory\": \"24.00 GB\",\n    \"freeMemory\": \"0.42 GB\"\n  },\n  \"node\": {\n    \"version\": \"v22.19.0\",\n    \"env\": \"development\"\n  },\n  \"packageManager\": {\n    \"name\": \"npm\",\n    \"version\": \"11.6.0\"\n  },\n  \"frameworks\": [\n    {\n      \"name\": \"svelte\",\n      \"version\": \"^5.39.2\"\n    },\n    {\n      \"name\": \"@sveltejs/kit\",\n      \"version\": \"^2.42.1\"\n    }\n  ],\n  \"databases\": null,\n  \"betterAuth\": {\n    \"version\": \"1.3.11\",\n    \"config\": {\n      \"plugins\": [\n        {\n          \"name\": \"username\",\n          \"config\": {\n            \"id\": \"username\",\n            \"endpoints\": {},\n            \"schema\": {\n              \"user\": {\n                \"fields\": {\n                  \"username\": {\n                    \"type\": \"string\",\n                    \"required\": false,\n                    \"sortable\": true,\n                    \"unique\": true,\n                    \"returned\": true,\n                    \"transform\": {}\n                  },\n                  \"displayUsername\": {\n                    \"type\": \"string\",\n                    \"required\": false,\n                    \"transform\": {}\n                  }\n                }\n              }\n            },\n            \"hooks\": {\n              \"before\": [\n                {},\n                {}\n              ]\n            },\n            \"$ERROR_CODES\": {\n              \"INVALID_USERNAME_OR_PASSWORD\": \"[REDACTED]\",\n              \"EMAIL_NOT_VERIFIED\": \"Email not verified\",\n              \"UNEXPECTED_ERROR\": \"Unexpected error\",\n              \"USERNAME_IS_ALREADY_TAKEN\": \"Username is already taken. Please try another.\",\n              \"USERNAME_TOO_SHORT\": \"Username is too short\",\n              \"USERNAME_TOO_LONG\": \"Username is too long\",\n              \"INVALID_USERNAME\": \"Username is invalid\",\n              \"INVALID_DISPLAY_USERNAME\": \"Display username is invalid\"\n            }\n          }\n        },\n        {\n          \"name\": \"sveltekit-cookies\",\n          \"config\": {\n            \"id\": \"sveltekit-cookies\",\n            \"hooks\": {\n              \"after\": [\n                {}\n              ]\n            }\n          }\n        }\n      ],\n      \"emailAndPassword\": {\n        \"enabled\": true,\n      },\n    }\n  }\n}\n```\n\n### Which area(s) are affected? (Select all that apply)\n\nBackend\n\n### Auth config (if applicable)\n\n```typescript\nimport { getRequestEvent } from \"$app/server\";\nimport { betterAuth } from \"better-auth\";\nimport { mongodbAdapter } from \"better-auth/adapters/mongodb\";\nimport { username } from \"better-auth/plugins\";\nimport { sveltekitCookies } from \"better-auth/svelte-kit\";\nimport mongoose from \"mongoose\";\nimport dbConnect from \"./db-connect\";\n\nawait dbConnect();\nconst client = mongoose.connection.db;\n\nexport const auth = betterAuth({\n  database: mongodbAdapter(client),\n  plugins: [username(), sveltekitCookies(getRequestEvent)],\n  emailAndPassword: {\n    enabled: true,\n  },\n});\n```\n\n### Additional context\n\n_No response_", "closed_by": {"login": "himself65", "id": 14026360, "node_id": "MDQ6VXNlcjE0MDI2MzYw", "avatar_url": "https://avatars.githubusercontent.com/u/14026360?v=4", "gravatar_id": "", "url": "https://api.github.com/users/himself65", "html_url": "https://github.com/himself65", "followers_url": "https://api.github.com/users/himself65/followers", "following_url": "https://api.github.com/users/himself65/following{/other_user}", "gists_url": "https://api.github.com/users/himself65/gists{/gist_id}", "starred_url": "https://api.github.com/users/himself65/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/himself65/subscriptions", "organizations_url": "https://api.github.com/users/himself65/orgs", "repos_url": "https://api.github.com/users/himself65/repos", "events_url": "https://api.github.com/users/himself65/events{/privacy}", "received_events_url": "https://api.github.com/users/himself65/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/better-auth/better-auth/issues/4741/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/better-auth/better-auth/issues/4741/timeline", "performed_via_github_app": null, "state_reason": "not_planned", "pinned_comment": null}, {"url": "https://api.github.com/repos/better-auth/better-auth/issues/1580", "repository_url": "https://api.github.com/repos/better-auth/better-auth", "labels_url": "https://api.github.com/repos/better-auth/better-auth/issues/1580/labels{/name}", "comments_url": "https://api.github.com/repos/better-auth/better-auth/issues/1580/comments", "events_url": "https://api.github.com/repos/better-auth/better-auth/issues/1580/events", "html_url": "https://github.com/better-auth/better-auth/issues/1580", "id": 2882002654, "node_id": "I_kwDOL90GLc6rx97e", "number": 1580, "title": "`errorCallbackURL` is not working it is ignored on error", "user": {"login": "rohittiwari-dev", "id": 137717184, "node_id": "U_kgDOCDVlwA", "avatar_url": "https://avatars.githubusercontent.com/u/137717184?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rohittiwari-dev", "html_url": "https://github.com/rohittiwari-dev", "followers_url": "https://api.github.com/users/rohittiwari-dev/followers", "following_url": "https://api.github.com/users/rohittiwari-dev/following{/other_user}", "gists_url": "https://api.github.com/users/rohittiwari-dev/gists{/gist_id}", "starred_url": "https://api.github.com/users/rohittiwari-dev/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rohittiwari-dev/subscriptions", "organizations_url": "https://api.github.com/users/rohittiwari-dev/orgs", "repos_url": "https://api.github.com/users/rohittiwari-dev/repos", "events_url": "https://api.github.com/users/rohittiwari-dev/events{/privacy}", "received_events_url": "https://api.github.com/users/rohittiwari-dev/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 6971796828, "node_id": "LA_kwDOL90GLc8AAAABn40tXA", "url": "https://api.github.com/repos/better-auth/better-auth/labels/bug", "name": "bug", "color": "d73a4a", "default": true, "description": "Something isn't working"}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 24, "created_at": "2025-02-26T15:27:26Z", "updated_at": "2025-12-01T17:57:19Z", "closed_at": "2025-09-16T01:07:32Z", "assignee": null, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### Is this suited for github?\n\n- [x] #1581\n\n### To Reproduce\n\n![Image](https://github.com/user-attachments/assets/35165233-df4a-453c-a401-9a04b88b1cfa)\n\nmost probably this is due to callback api route and in my case code is not generated as i cancel the process to choose another account \n\nlogger do print access_denied and error_description=undefined but it do not redirect it \n\n\n\n\n### Current vs. Expected behavior\n\nCurrent : \n\nit is ignoring errorCallbackURL in social signing process even if it is passed and redirecting it to api default error page\n\nexpected\nit should redirect to the callbackurl passed in social loging \n```typescript\nawait authClient.signIn.social(\n\t{\n\t\tprovider: \"google\",\n\t\tcallbackURL: \"/dashboard\",\n\t\terrorCallbackURL: \"/sign-in\",\n\t},\n\t{\n\t\tonRequest: () => {\n\t\t\tsetIsOAuthLogin(true);\n\t\t},\n\t\tonError: (ctx) => {\n\t\t\tsetIsOAuthLogin(false);\n\t\t\ttoast.error(ctx.error.message);\n\t\t},\n\t},\n);\n``` \nin my case it should redirect it to signing page with queries code and description as designed\n\n\n### What version of Better Auth are you using?\n\n1.1.21\n\n### Provide environment information\n\n```bash\n- OS : Windows\n- Browser : Chrome\n```\n\n### Which area(s) are affected? (Select all that apply)\n\nClient\n\n### Auth config (if applicable)\n\n```typescript\nexport const auth = betterAuth({\n\tappName: \"Notespace\",\n\tdatabase: drizzleAdapter(db, {\n\t\tprovider: \"pg\",\n\t\tschema: {\n\t\t\t...schema,\n\t\t\tuser: schema.UserTable,\n\t\t\taccount: schema.ConnectedAuthProvidersTable,\n\t\t\tsession: schema.UserAuthSessionTable,\n\t\t\tverification: schema.UserAuthVerificationTable,\n\t\t},\n\t}),\n\temailAndPassword: {\n\t\tenabled: true,\n\t\tautoSignIn: true,\n\t\trequireEmailVerification: true,\n\t},\n\temailVerification: {\n\t\tsendOnSignUp: true,\n\t\tautoSignInAfterVerification: true,\n\t\tsendVerificationEmail: async ({ user, url }) => {\n\t\t\tawait sendEmail({\n\t\t\t\tto: user.email,\n\t\t\t\tsubject: \"Verify your email address\",\n\t\t\t\ttext: `Click the link to verify your email: ${url}`,\n\t\t\t});\n\t\t},\n\t},\n\tsocialProviders: {\n\t\tgoogle: {\n\t\t\tclientId: process.env.GOOGLE_CLIENT_ID as string,\n\t\t\tclientSecret: process.env.GOOGLE_CLIENT_SECRET as string,\n\t\t},\n\t},\n\tplugins: [openAPI()],\n} satisfies BetterAuthOptions);\n```\n\n### Additional context\n\nImages for reference :\n\n![Image](https://github.com/user-attachments/assets/d2f03754-f3e0-4ece-abc9-b0006a5450e3)\n\n![Image](https://github.com/user-attachments/assets/e732b905-d567-4165-846b-d1e1315c6013)\n\n\n", "closed_by": {"login": "himself65", "id": 14026360, "node_id": "MDQ6VXNlcjE0MDI2MzYw", "avatar_url": "https://avatars.githubusercontent.com/u/14026360?v=4", "gravatar_id": "", "url": "https://api.github.com/users/himself65", "html_url": "https://github.com/himself65", "followers_url": "https://api.github.com/users/himself65/followers", "following_url": "https://api.github.com/users/himself65/following{/other_user}", "gists_url": "https://api.github.com/users/himself65/gists{/gist_id}", "starred_url": "https://api.github.com/users/himself65/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/himself65/subscriptions", "organizations_url": "https://api.github.com/users/himself65/orgs", "repos_url": "https://api.github.com/users/himself65/repos", "events_url": "https://api.github.com/users/himself65/events{/privacy}", "received_events_url": "https://api.github.com/users/himself65/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/better-auth/better-auth/issues/1580/reactions", "total_count": 12, "+1": 12, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/better-auth/better-auth/issues/1580/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/better-auth/better-auth/issues/1570", "repository_url": "https://api.github.com/repos/better-auth/better-auth", "labels_url": "https://api.github.com/repos/better-auth/better-auth/issues/1570/labels{/name}", "comments_url": "https://api.github.com/repos/better-auth/better-auth/issues/1570/comments", "events_url": "https://api.github.com/repos/better-auth/better-auth/issues/1570/events", "html_url": "https://github.com/better-auth/better-auth/issues/1570", "id": 2877216247, "node_id": "I_kwDOL90GLc6rftX3", "number": 1570, "title": "using better-auth client breaks typescript server", "user": {"login": "darklight9811", "id": 20667774, "node_id": "MDQ6VXNlcjIwNjY3Nzc0", "avatar_url": "https://avatars.githubusercontent.com/u/20667774?v=4", "gravatar_id": "", "url": "https://api.github.com/users/darklight9811", "html_url": "https://github.com/darklight9811", "followers_url": "https://api.github.com/users/darklight9811/followers", "following_url": "https://api.github.com/users/darklight9811/following{/other_user}", "gists_url": "https://api.github.com/users/darklight9811/gists{/gist_id}", "starred_url": "https://api.github.com/users/darklight9811/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/darklight9811/subscriptions", "organizations_url": "https://api.github.com/users/darklight9811/orgs", "repos_url": "https://api.github.com/users/darklight9811/repos", "events_url": "https://api.github.com/users/darklight9811/events{/privacy}", "received_events_url": "https://api.github.com/users/darklight9811/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 6971796828, "node_id": "LA_kwDOL90GLc8AAAABn40tXA", "url": "https://api.github.com/repos/better-auth/better-auth/labels/bug", "name": "bug", "color": "d73a4a", "default": true, "description": "Something isn't working"}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 24, "created_at": "2025-02-25T06:32:52Z", "updated_at": "2025-09-30T07:41:16Z", "closed_at": "2025-09-30T07:41:16Z", "assignee": null, "author_association": "CONTRIBUTOR", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### Is this suited for github?\n\n- [x] Yes, this is suited for github\n\n### To Reproduce\n\n> please ignore the music, I didnt notice when I was recording it\n\nhttps://github.com/user-attachments/assets/d1813ca0-3cae-485d-ad1d-8673a3843178\n\n### Current vs. Expected behavior\n\n# expected \n- the typescript server to continue working\n\n# current\n- the entire typescript server stops working for any file\n\n### What version of Better Auth are you using?\n\n1.1.21\n\n### Provide environment information\n\n```bash\n- OS: Windows 11\n- Code editor: VSCode\n```\n\n### Which area(s) are affected? (Select all that apply)\n\nTypes\n\n### Auth config (if applicable)\n\n```typescript\nimport { anonymousClient } from \"better-auth/client/plugins\";\nimport { createAuthClient } from \"better-auth/client\";\n\nexport const authClient = createAuthClient({\n\tbaseURL: `http://localhost:3000/auth`,\n\tplugins: [anonymousClient()],\n\tfetchOptions: {\n\t\tauth: {\n\t\t\ttype: \"Bearer\",\n\t\t\ttoken: () => (typeof localStorage !== \"undefined\" ? localStorage.getItem(\"token\") : \"\"),\n\t\t},\n\t},\n});\n```\n\n### Additional context\n\nI noticed somewhere a stack overflow complain by typescript in one of my tests, sadly I couldnt reproduce, it was complaining about the login type excessively deep nest instantiation.", "closed_by": {"login": "Bekacru", "id": 86073083, "node_id": "MDQ6VXNlcjg2MDczMDgz", "avatar_url": "https://avatars.githubusercontent.com/u/86073083?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Bekacru", "html_url": "https://github.com/Bekacru", "followers_url": "https://api.github.com/users/Bekacru/followers", "following_url": "https://api.github.com/users/Bekacru/following{/other_user}", "gists_url": "https://api.github.com/users/Bekacru/gists{/gist_id}", "starred_url": "https://api.github.com/users/Bekacru/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Bekacru/subscriptions", "organizations_url": "https://api.github.com/users/Bekacru/orgs", "repos_url": "https://api.github.com/users/Bekacru/repos", "events_url": "https://api.github.com/users/Bekacru/events{/privacy}", "received_events_url": "https://api.github.com/users/Bekacru/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/better-auth/better-auth/issues/1570/reactions", "total_count": 2, "+1": 1, "-1": 0, "laugh": 1, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/better-auth/better-auth/issues/1570/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/better-auth/better-auth/issues/1035", "repository_url": "https://api.github.com/repos/better-auth/better-auth", "labels_url": "https://api.github.com/repos/better-auth/better-auth/issues/1035/labels{/name}", "comments_url": "https://api.github.com/repos/better-auth/better-auth/issues/1035/comments", "events_url": "https://api.github.com/repos/better-auth/better-auth/issues/1035/events", "html_url": "https://github.com/better-auth/better-auth/issues/1035", "id": 2760412729, "node_id": "I_kwDOL90GLc6kiI45", "number": 1035, "title": "ERROR: unable_to_create_user", "user": {"login": "eliasdanielr", "id": 114700694, "node_id": "U_kgDOBtYxlg", "avatar_url": "https://avatars.githubusercontent.com/u/114700694?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eliasdanielr", "html_url": "https://github.com/eliasdanielr", "followers_url": "https://api.github.com/users/eliasdanielr/followers", "following_url": "https://api.github.com/users/eliasdanielr/following{/other_user}", "gists_url": "https://api.github.com/users/eliasdanielr/gists{/gist_id}", "starred_url": "https://api.github.com/users/eliasdanielr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eliasdanielr/subscriptions", "organizations_url": "https://api.github.com/users/eliasdanielr/orgs", "repos_url": "https://api.github.com/users/eliasdanielr/repos", "events_url": "https://api.github.com/users/eliasdanielr/events{/privacy}", "received_events_url": "https://api.github.com/users/eliasdanielr/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 6971796828, "node_id": "LA_kwDOL90GLc8AAAABn40tXA", "url": "https://api.github.com/repos/better-auth/better-auth/labels/bug", "name": "bug", "color": "d73a4a", "default": true, "description": "Something isn't working"}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 23, "created_at": "2024-12-27T05:24:41Z", "updated_at": "2025-10-16T09:42:24Z", "closed_at": "2025-01-07T03:00:42Z", "assignee": null, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### Is this suited for github?\n\n- [x] Yes, this is suited for github\n\n### To Reproduce\n\n1. **Create a mono repo with [[Turborepo](https://turbo.build/repo/docs)](https://turbo.build/repo/docs).**\r\n2. **Create `packages/database` using Drizzle ORM.** Here are its schemas.\r\n3. **Create `packages/auth`.** Here are the auth, authClient, and Next.js handlers.\r\n4. **Create `apps/web` using Next.js 15.1.0.**\r\n5. **Use `authClient.signIn.social` with any provider.**\r\n6. **See ERROR [Better Auth]: unable_to_create_user in the console.**\n\n### Current vs. Expected behavior\n\nWhen I sign in with a social provider, the user is not created as expected. At first, I looked up other related issues and found #1025, but in my case, **it\u2019s not an issue with my database schema.** To be more sure, before deleting the .next folder, I also removed the birthDay plugin to see if it was an issue with my implementation. The error doesn\u2019t provide enough information to figure out what\u2019s going wrong. **I tried the basics**: making sure my database server is running, manually creating a user using Drizzle ORM, and even deleting the .next folder (I was getting desperate).\r\n\n\n### What version of Better Auth are you using?\n\n1.1.4\n\n### Provide environment information\n\n```bash\n- Framework: Next.js\r\n- Database adapter: Drizzle\r\n- Database: postgres\r\n- OS: Linux Ubuntu x86_64\n```\n\n\n### Which area(s) are affected? (Select all that apply)\n\nBackend\n\n### Auth config (if applicable)\n\n```typescript\nimport { betterAuth } from \"better-auth\";\r\nimport { drizzleAdapter } from \"better-auth/adapters/drizzle\";\r\nimport { db } from \"@g3deon/database\";\r\nimport { envConfig } from \"../config\";\r\nimport { twoFactor } from \"better-auth/plugins\";\r\nimport { username } from \"better-auth/plugins\";\r\nimport z from \"zod\";\r\nimport { nextCookies } from \"better-auth/next-js\";\r\nimport { birthdayPlugin } from \"./plugins/birthday\";\r\nimport {\r\n  users,\r\n  accounts,\r\n  sessions,\r\n  verifications,\r\n} from \"@g3deon/database/schemas\";\r\n\r\nexport const auth = betterAuth({\r\n  database: drizzleAdapter(db, {\r\n    provider: \"pg\",\r\n    schema: { users, accounts, sessions, verifications },\r\n    usePlural: true,\r\n  }),\r\n  emailAndPassword: {\r\n    enabled: true,\r\n  },\r\n  user: {\r\n    additionalFields: {\r\n      accentColor: {\r\n        type: \"number\",\r\n        required: false,\r\n        defaultValue: 0,\r\n      },\r\n      locale: {\r\n        type: \"string\",\r\n        required: false,\r\n        defaultValue: \"en-US\",\r\n      },\r\n    },\r\n    fields: {\r\n      name: \"display_name\",\r\n    },\r\n  },\r\n  socialProviders: {\r\n    google: {\r\n      enabled: true,\r\n      clientId: envConfig.GOOGLE_CLIENT_ID,\r\n      clientSecret: envConfig.GOOGLE_CLIENT_SECRET,\r\n    },\r\n    github: {\r\n      enabled: true,\r\n      clientId: envConfig.GITHUB_CLIENT_ID,\r\n      clientSecret: envConfig.GITHUB_CLIENT_SECRET,\r\n    },\r\n    discord: {\r\n      enabled: true,\r\n      clientId: envConfig.DISCORD_CLIENT_ID,\r\n      clientSecret: envConfig.DISCORD_CLIENT_SECRET,\r\n    },\r\n  },\r\n  plugins: [twoFactor(), username(), nextCookies(), birthdayPlugin()],\r\n});\r\n\r\n// src/auth-client.ts\r\n\r\nimport { usernameClient } from \"better-auth/client/plugins\";\r\nimport { twoFactorClient } from \"better-auth/plugins\";\r\nimport { createAuthClient } from \"better-auth/react\";\r\nimport { birthdayClientPlugin } from \"./plugins/birthday\";\r\n\r\nexport const authClient = createAuthClient({\r\n\tplugins: [\r\n\t\tusernameClient(),\r\n\t\ttwoFactorClient({\r\n\t\t\tonTwoFactorRedirect() {\r\n\t\t\t\twindow.location.href = \"/2fa\";\r\n\t\t\t},\r\n\t\t}),\r\n\t\tbirthdayClientPlugin(),\r\n\t],\r\n});\n```\n\n\n### Additional context\n\nThis was tested without any users pre-created in the database. The expectation is that users should be automatically created when using a social provider.", "closed_by": {"login": "eliasdanielr", "id": 114700694, "node_id": "U_kgDOBtYxlg", "avatar_url": "https://avatars.githubusercontent.com/u/114700694?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eliasdanielr", "html_url": "https://github.com/eliasdanielr", "followers_url": "https://api.github.com/users/eliasdanielr/followers", "following_url": "https://api.github.com/users/eliasdanielr/following{/other_user}", "gists_url": "https://api.github.com/users/eliasdanielr/gists{/gist_id}", "starred_url": "https://api.github.com/users/eliasdanielr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eliasdanielr/subscriptions", "organizations_url": "https://api.github.com/users/eliasdanielr/orgs", "repos_url": "https://api.github.com/users/eliasdanielr/repos", "events_url": "https://api.github.com/users/eliasdanielr/events{/privacy}", "received_events_url": "https://api.github.com/users/eliasdanielr/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/better-auth/better-auth/issues/1035/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/better-auth/better-auth/issues/1035/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/better-auth/better-auth/issues/917", "repository_url": "https://api.github.com/repos/better-auth/better-auth", "labels_url": "https://api.github.com/repos/better-auth/better-auth/issues/917/labels{/name}", "comments_url": "https://api.github.com/repos/better-auth/better-auth/issues/917/comments", "events_url": "https://api.github.com/repos/better-auth/better-auth/issues/917/events", "html_url": "https://github.com/better-auth/better-auth/issues/917", "id": 2743818239, "node_id": "I_kwDOL90GLc6ji1f_", "number": 917, "title": "ctx.response.headers.get(\"set-auth-token\") is null", "user": {"login": "zhaopengme", "id": 1415418, "node_id": "MDQ6VXNlcjE0MTU0MTg=", "avatar_url": "https://avatars.githubusercontent.com/u/1415418?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zhaopengme", "html_url": "https://github.com/zhaopengme", "followers_url": "https://api.github.com/users/zhaopengme/followers", "following_url": "https://api.github.com/users/zhaopengme/following{/other_user}", "gists_url": "https://api.github.com/users/zhaopengme/gists{/gist_id}", "starred_url": "https://api.github.com/users/zhaopengme/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zhaopengme/subscriptions", "organizations_url": "https://api.github.com/users/zhaopengme/orgs", "repos_url": "https://api.github.com/users/zhaopengme/repos", "events_url": "https://api.github.com/users/zhaopengme/events{/privacy}", "received_events_url": "https://api.github.com/users/zhaopengme/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 6971796828, "node_id": "LA_kwDOL90GLc8AAAABn40tXA", "url": "https://api.github.com/repos/better-auth/better-auth/labels/bug", "name": "bug", "color": "d73a4a", "default": true, "description": "Something isn't working"}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 23, "created_at": "2024-12-17T03:04:01Z", "updated_at": "2025-08-03T12:41:23Z", "closed_at": "2025-04-11T10:30:33Z", "assignee": null, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### Is this suited for github?\n\n- [ ] Yes, this is suited for github\n\n### To Reproduce\n\n<img width=\"553\" alt=\"image\" src=\"https://github.com/user-attachments/assets/e313742c-60ea-45da-aaab-eb96dd4df968\" />\r\n\n\n### Current vs. Expected behavior\n\nctx.response.headers.get(\"set-auth-token\") is null.\r\n\n\n### What version of Better Auth are you using?\n\n1.0.22\n\n### Provide environment information\n\n```bash\n-OS mac\r\n-chrome\n```\n\n\n### Which area(s) are affected? (Select all that apply)\n\nClient\n\n### Auth config (if applicable)\n\n```typescript\nimport { betterAuth } from \"better-auth\"\r\n\r\nexport const auth = betterAuth({\r\n  trustedOrigins: [\"http://\", \"https://\", \"file://\"],\r\n  database: drizzleAdapter(db, {\r\n    schema: {\r\n      user: user,\r\n      account: account,\r\n      session: session,\r\n      verification: verification,\r\n    },\r\n    provider: \"pg\", // or \"mysql\", \"sqlite\"\r\n  }),\r\n  emailAndPassword: {\r\n    enabled: true\r\n  },\r\n  plugins: [\r\n    bearer()\r\n  ]\r\n});\n```\n\n\n### Additional context\n\n_No response_", "closed_by": {"login": "Kinfe123", "id": 65047246, "node_id": "MDQ6VXNlcjY1MDQ3MjQ2", "avatar_url": "https://avatars.githubusercontent.com/u/65047246?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Kinfe123", "html_url": "https://github.com/Kinfe123", "followers_url": "https://api.github.com/users/Kinfe123/followers", "following_url": "https://api.github.com/users/Kinfe123/following{/other_user}", "gists_url": "https://api.github.com/users/Kinfe123/gists{/gist_id}", "starred_url": "https://api.github.com/users/Kinfe123/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Kinfe123/subscriptions", "organizations_url": "https://api.github.com/users/Kinfe123/orgs", "repos_url": "https://api.github.com/users/Kinfe123/repos", "events_url": "https://api.github.com/users/Kinfe123/events{/privacy}", "received_events_url": "https://api.github.com/users/Kinfe123/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/better-auth/better-auth/issues/917/reactions", "total_count": 2, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 2}, "timeline_url": "https://api.github.com/repos/better-auth/better-auth/issues/917/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}]}