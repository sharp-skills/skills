{"d": [{"url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/782", "repository_url": "https://api.github.com/repos/dragonflydb/dragonfly", "labels_url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/782/labels{/name}", "comments_url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/782/comments", "events_url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/782/events", "html_url": "https://github.com/dragonflydb/dragonfly/issues/782", "id": 1581373894, "node_id": "I_kwDOGg_XLc5eQdnG", "number": 782, "title": "Dragonfly does not work with nest/bull ", "user": {"login": "romange", "id": 3674760, "node_id": "MDQ6VXNlcjM2NzQ3NjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3674760?v=4", "gravatar_id": "", "url": "https://api.github.com/users/romange", "html_url": "https://github.com/romange", "followers_url": "https://api.github.com/users/romange/followers", "following_url": "https://api.github.com/users/romange/following{/other_user}", "gists_url": "https://api.github.com/users/romange/gists{/gist_id}", "starred_url": "https://api.github.com/users/romange/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/romange/subscriptions", "organizations_url": "https://api.github.com/users/romange/orgs", "repos_url": "https://api.github.com/users/romange/repos", "events_url": "https://api.github.com/users/romange/events{/privacy}", "received_events_url": "https://api.github.com/users/romange/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 3632299438, "node_id": "LA_kwDOGg_XLc7YgH2u", "url": "https://api.github.com/repos/dragonflydb/dragonfly/labels/bug", "name": "bug", "color": "d73a4a", "default": true, "description": "Something isn't working"}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 63, "created_at": "2023-02-12T19:04:14Z", "updated_at": "2024-12-03T23:35:31Z", "closed_at": "2024-01-11T07:30:09Z", "assignee": null, "author_association": "COLLABORATOR", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "See this https://github.com/BlackYuzia/Dragonfly-Bull to reproduce.\r\n\r\n1. Dragonfly rejects EVAL under MULTI (which could potentially be fixed by making the multi TX global - dynamically)\r\n2. We also do not allow undeclared keys and this library uses undeclared keys extensively. See, for example, \r\nhttps://github.com/OptimalBits/bull/blob/develop/lib/commands/addJob-6.lua\r\n\r\nSee where I think EVAL is called under multi (but I am not sure):\r\nhttps://github.com/OptimalBits/bull/blob/master/lib/job.js#L88\r\n\r\nFirst reported in #781 ", "closed_by": {"login": "romange", "id": 3674760, "node_id": "MDQ6VXNlcjM2NzQ3NjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3674760?v=4", "gravatar_id": "", "url": "https://api.github.com/users/romange", "html_url": "https://github.com/romange", "followers_url": "https://api.github.com/users/romange/followers", "following_url": "https://api.github.com/users/romange/following{/other_user}", "gists_url": "https://api.github.com/users/romange/gists{/gist_id}", "starred_url": "https://api.github.com/users/romange/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/romange/subscriptions", "organizations_url": "https://api.github.com/users/romange/orgs", "repos_url": "https://api.github.com/users/romange/repos", "events_url": "https://api.github.com/users/romange/events{/privacy}", "received_events_url": "https://api.github.com/users/romange/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/782/reactions", "total_count": 5, "+1": 5, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/782/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/2302", "repository_url": "https://api.github.com/repos/dragonflydb/dragonfly", "labels_url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/2302/labels{/name}", "comments_url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/2302/comments", "events_url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/2302/events", "html_url": "https://github.com/dragonflydb/dragonfly/pull/2302", "id": 2040265643, "node_id": "PR_kwDOGg_XLc5h7T65", "number": 2302, "title": "bug(server): log evicted keys in journal in PrimeEvictionPolicy.", "user": {"login": "theyueli", "id": 61070669, "node_id": "MDQ6VXNlcjYxMDcwNjY5", "avatar_url": "https://avatars.githubusercontent.com/u/61070669?v=4", "gravatar_id": "", "url": "https://api.github.com/users/theyueli", "html_url": "https://github.com/theyueli", "followers_url": "https://api.github.com/users/theyueli/followers", "following_url": "https://api.github.com/users/theyueli/following{/other_user}", "gists_url": "https://api.github.com/users/theyueli/gists{/gist_id}", "starred_url": "https://api.github.com/users/theyueli/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/theyueli/subscriptions", "organizations_url": "https://api.github.com/users/theyueli/orgs", "repos_url": "https://api.github.com/users/theyueli/repos", "events_url": "https://api.github.com/users/theyueli/events{/privacy}", "received_events_url": "https://api.github.com/users/theyueli/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 3632299438, "node_id": "LA_kwDOGg_XLc7YgH2u", "url": "https://api.github.com/repos/dragonflydb/dragonfly/labels/bug", "name": "bug", "color": "d73a4a", "default": true, "description": "Something isn't working"}], "state": "closed", "locked": false, "assignees": [{"login": "theyueli", "id": 61070669, "node_id": "MDQ6VXNlcjYxMDcwNjY5", "avatar_url": "https://avatars.githubusercontent.com/u/61070669?v=4", "gravatar_id": "", "url": "https://api.github.com/users/theyueli", "html_url": "https://github.com/theyueli", "followers_url": "https://api.github.com/users/theyueli/followers", "following_url": "https://api.github.com/users/theyueli/following{/other_user}", "gists_url": "https://api.github.com/users/theyueli/gists{/gist_id}", "starred_url": "https://api.github.com/users/theyueli/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/theyueli/subscriptions", "organizations_url": "https://api.github.com/users/theyueli/orgs", "repos_url": "https://api.github.com/users/theyueli/repos", "events_url": "https://api.github.com/users/theyueli/events{/privacy}", "received_events_url": "https://api.github.com/users/theyueli/received_events", "type": "User", "user_view_type": "public", "site_admin": false}], "milestone": null, "comments": 7, "created_at": "2023-12-13T18:35:53Z", "updated_at": "2024-01-11T09:45:37Z", "closed_at": "2024-01-11T09:45:29Z", "assignee": {"login": "theyueli", "id": 61070669, "node_id": "MDQ6VXNlcjYxMDcwNjY5", "avatar_url": "https://avatars.githubusercontent.com/u/61070669?v=4", "gravatar_id": "", "url": "https://api.github.com/users/theyueli", "html_url": "https://github.com/theyueli", "followers_url": "https://api.github.com/users/theyueli/followers", "following_url": "https://api.github.com/users/theyueli/following{/other_user}", "gists_url": "https://api.github.com/users/theyueli/gists{/gist_id}", "starred_url": "https://api.github.com/users/theyueli/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/theyueli/subscriptions", "organizations_url": "https://api.github.com/users/theyueli/orgs", "repos_url": "https://api.github.com/users/theyueli/repos", "events_url": "https://api.github.com/users/theyueli/events{/privacy}", "received_events_url": "https://api.github.com/users/theyueli/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "author_association": "CONTRIBUTOR", "type": null, "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/dragonflydb/dragonfly/pulls/2302", "html_url": "https://github.com/dragonflydb/dragonfly/pull/2302", "diff_url": "https://github.com/dragonflydb/dragonfly/pull/2302.diff", "patch_url": "https://github.com/dragonflydb/dragonfly/pull/2302.patch", "merged_at": "2024-01-11T09:45:29Z"}, "body": "fixes https://github.com/dragonflydb/dragonfly/issues/2296\r\n\r\nadded a regression test that tests both policy based eviction as well as heart beat eviction. ", "closed_by": {"login": "theyueli", "id": 61070669, "node_id": "MDQ6VXNlcjYxMDcwNjY5", "avatar_url": "https://avatars.githubusercontent.com/u/61070669?v=4", "gravatar_id": "", "url": "https://api.github.com/users/theyueli", "html_url": "https://github.com/theyueli", "followers_url": "https://api.github.com/users/theyueli/followers", "following_url": "https://api.github.com/users/theyueli/following{/other_user}", "gists_url": "https://api.github.com/users/theyueli/gists{/gist_id}", "starred_url": "https://api.github.com/users/theyueli/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/theyueli/subscriptions", "organizations_url": "https://api.github.com/users/theyueli/orgs", "repos_url": "https://api.github.com/users/theyueli/repos", "events_url": "https://api.github.com/users/theyueli/events{/privacy}", "received_events_url": "https://api.github.com/users/theyueli/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/2302/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/2302/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/4244", "repository_url": "https://api.github.com/repos/dragonflydb/dragonfly", "labels_url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/4244/labels{/name}", "comments_url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/4244/comments", "events_url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/4244/events", "html_url": "https://github.com/dragonflydb/dragonfly/issues/4244", "id": 2714304212, "node_id": "I_kwDOGg_XLc6hyP7U", "number": 4244, "title": "Deadlock inside Dns resolve function", "user": {"login": "applike-ss", "id": 31846129, "node_id": "MDQ6VXNlcjMxODQ2MTI5", "avatar_url": "https://avatars.githubusercontent.com/u/31846129?v=4", "gravatar_id": "", "url": "https://api.github.com/users/applike-ss", "html_url": "https://github.com/applike-ss", "followers_url": "https://api.github.com/users/applike-ss/followers", "following_url": "https://api.github.com/users/applike-ss/following{/other_user}", "gists_url": "https://api.github.com/users/applike-ss/gists{/gist_id}", "starred_url": "https://api.github.com/users/applike-ss/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/applike-ss/subscriptions", "organizations_url": "https://api.github.com/users/applike-ss/orgs", "repos_url": "https://api.github.com/users/applike-ss/repos", "events_url": "https://api.github.com/users/applike-ss/events{/privacy}", "received_events_url": "https://api.github.com/users/applike-ss/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 3632299438, "node_id": "LA_kwDOGg_XLc7YgH2u", "url": "https://api.github.com/repos/dragonflydb/dragonfly/labels/bug", "name": "bug", "color": "d73a4a", "default": true, "description": "Something isn't working"}], "state": "closed", "locked": false, "assignees": [{"login": "romange", "id": 3674760, "node_id": "MDQ6VXNlcjM2NzQ3NjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3674760?v=4", "gravatar_id": "", "url": "https://api.github.com/users/romange", "html_url": "https://github.com/romange", "followers_url": "https://api.github.com/users/romange/followers", "following_url": "https://api.github.com/users/romange/following{/other_user}", "gists_url": "https://api.github.com/users/romange/gists{/gist_id}", "starred_url": "https://api.github.com/users/romange/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/romange/subscriptions", "organizations_url": "https://api.github.com/users/romange/orgs", "repos_url": "https://api.github.com/users/romange/repos", "events_url": "https://api.github.com/users/romange/events{/privacy}", "received_events_url": "https://api.github.com/users/romange/received_events", "type": "User", "user_view_type": "public", "site_admin": false}], "milestone": null, "comments": 50, "created_at": "2024-12-03T08:17:53Z", "updated_at": "2025-03-18T12:28:53Z", "closed_at": "2025-02-24T15:00:55Z", "assignee": {"login": "romange", "id": 3674760, "node_id": "MDQ6VXNlcjM2NzQ3NjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3674760?v=4", "gravatar_id": "", "url": "https://api.github.com/users/romange", "html_url": "https://github.com/romange", "followers_url": "https://api.github.com/users/romange/followers", "following_url": "https://api.github.com/users/romange/following{/other_user}", "gists_url": "https://api.github.com/users/romange/gists{/gist_id}", "starred_url": "https://api.github.com/users/romange/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/romange/subscriptions", "organizations_url": "https://api.github.com/users/romange/orgs", "repos_url": "https://api.github.com/users/romange/repos", "events_url": "https://api.github.com/users/romange/events{/privacy}", "received_events_url": "https://api.github.com/users/romange/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "author_association": "CONTRIBUTOR", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "**Describe the bug**\r\nFirst of all: I am not entirely sure if this is a bug in our java redis cluster client library or in dragonfly itself.\r\nHowever since i have already once created a ticket here where indeed dragonfly was not handling things truly like redis did, i want to create the issue here and see where it leads us.\r\n\r\nWe are seeing rising connections on our dragonfly instance after some time.\r\nI suppose that the lattice library is refreshing its internal representation of the cluster topology, as we do get these entries (filtered for these) via the `client list` command:\r\n\r\n\r\n<details>\r\n  <summary>client list output</summary>\r\n\r\n```\r\nid=105831 addr=0.0.0.0:0 laddr=10.137.60.6:6379 fd=12 name=lettuce#ClusterTopologyRefresh tid=0 irqmatch=0 age=67701 idle=67701 db=0 flags=t phase=process lib-name= lib-ver=\r\nid=105832 addr=0.0.0.0:0 laddr=10.137.60.6:6379 fd=13 name=lettuce#ClusterTopologyRefresh tid=0 irqmatch=0 age=67701 idle=67701 db=0 flags=t phase=process lib-name= lib-ver=\r\nid=105835 addr=0.0.0.0:0 laddr=10.137.60.6:6379 fd=15 name=lettuce#ClusterTopologyRefresh tid=0 irqmatch=0 age=67693 idle=67693 db=0 flags=t phase=process lib-name= lib-ver=\r\nid=105836 addr=0.0.0.0:0 laddr=10.137.60.6:6379 fd=16 name=lettuce#ClusterTopologyRefresh tid=0 irqmatch=0 age=67691 idle=67691 db=0 flags=t phase=process lib-name= lib-ver=\r\nid=105837 addr=0.0.0.0:0 laddr=10.137.60.6:6379 fd=19 name=lettuce#ClusterTopologyRefresh tid=0 irqmatch=0 age=67691 idle=67691 db=0 flags=t phase=process lib-name= lib-ver=\r\nid=105838 addr=0.0.0.0:0 laddr=10.137.60.6:6379 fd=20 name=lettuce#ClusterTopologyRefresh tid=0 irqmatch=0 age=67690 idle=67690 db=0 flags=t phase=process lib-name= lib-ver=\r\nid=105839 addr=0.0.0.0:0 laddr=10.137.60.6:6379 fd=21 name=lettuce#ClusterTopologyRefresh tid=0 irqmatch=0 age=67690 idle=67690 db=0 flags=t phase=process lib-name= lib-ver=\r\nid=105842 addr=0.0.0.0:0 laddr=10.137.60.6:6379 fd=22 name=lettuce#ClusterTopologyRefresh tid=0 irqmatch=0 age=67690 idle=67690 db=0 flags=t phase=process lib-name= lib-ver=\r\nid=105849 addr=0.0.0.0:0 laddr=10.137.60.6:6379 fd=24 name=lettuce#ClusterTopologyRefresh tid=0 irqmatch=0 age=67657 idle=67657 db=0 flags=t phase=process lib-name= lib-ver=\r\nid=105854 addr=0.0.0.0:0 laddr=10.137.60.6:6379 fd=27 name=lettuce#ClusterTopologyRefresh tid=0 irqmatch=0 age=67636 idle=67636 db=0 flags=t phase=process lib-name= lib-ver=\r\nid=105857 addr=0.0.0.0:0 laddr=10.137.60.6:6379 fd=31 name=lettuce#ClusterTopologyRefresh tid=0 irqmatch=0 age=67624 idle=67624 db=0 flags=t phase=process lib-name= lib-ver=\r\nid=105870 addr=0.0.0.0:0 laddr=10.137.60.6:6379 fd=37 name=lettuce#ClusterTopologyRefresh tid=0 irqmatch=0 age=67563 idle=67503 db=0 flags=at phase=shutting_down lib-name= lib-ver=\r\nid=105889 addr=0.0.0.0:0 laddr=10.137.60.6:6379 fd=38 name=lettuce#ClusterTopologyRefresh tid=0 irqmatch=0 age=67477 idle=67477 db=0 flags=t phase=process lib-name= lib-ver=\r\nid=105894 addr=0.0.0.0:0 laddr=10.137.60.6:6379 fd=39 name=lettuce#ClusterTopologyRefresh tid=0 irqmatch=0 age=67458 idle=67458 db=0 flags=t phase=process lib-name= lib-ver=\r\nid=105899 addr=0.0.0.0:0 laddr=10.137.60.6:6379 fd=40 name=lettuce#ClusterTopologyRefresh tid=0 irqmatch=0 age=67438 idle=67438 db=0 flags=t phase=process lib-name= lib-ver=\r\nid=105900 addr=0.0.0.0:0 laddr=10.137.60.6:6379 fd=41 name=lettuce#ClusterTopologyRefresh tid=0 irqmatch=0 age=67432 idle=67432 db=0 flags=t phase=process lib-name= lib-ver=\r\nid=105905 addr=0.0.0.0:0 laddr=10.137.60.6:6379 fd=42 name=lettuce#ClusterTopologyRefresh tid=0 irqmatch=0 age=67418 idle=67418 db=0 flags=t phase=process lib-name= lib-ver=\r\nid=105906 addr=0.0.0.0:0 laddr=10.137.60.6:6379 fd=43 name=lettuce#ClusterTopologyRefresh tid=0 irqmatch=0 age=67418 idle=67418 db=0 flags=t phase=process lib-name= lib-ver=\r\nid=105907 addr=0.0.0.0:0 laddr=10.137.60.6:6379 fd=44 name=lettuce#ClusterTopologyRefresh tid=0 irqmatch=0 age=67416 idle=67416 db=0 flags=t phase=process lib-name= lib-ver=\r\nid=105910 addr=0.0.0.0:0 laddr=10.137.60.6:6379 fd=45 name=lettuce#ClusterTopologyRefresh tid=0 irqmatch=0 age=67401 idle=67401 db=0 flags=t phase=process lib-name= lib-ver=\r\nid=105911 addr=0.0.0.0:0 laddr=10.137.60.6:6379 fd=46 name=lettuce#ClusterTopologyRefresh tid=0 irqmatch=0 age=67401 idle=67401 db=0 flags=t phase=process lib-name= lib-ver=\r\nid=105914 addr=0.0.0.0:0 laddr=10.137.60.6:6379 fd=47 name=lettuce#ClusterTopologyRefresh tid=0 irqmatch=0 age=67393 idle=67393 db=0 flags=t phase=process lib-name= lib-ver=\r\nid=105915 addr=0.0.0.0:0 laddr=10.137.60.6:6379 fd=48 name=lettuce#ClusterTopologyRefresh tid=0 irqmatch=0 age=67391 idle=67331 db=0 flags=at phase=shutting_down lib-name= lib-ver=\r\n```\r\n</details>\r\n\r\nThey did have this issue in the past and say that it is fixed, so my hope is that this is just another small implementation detail like last time.\r\n\r\nrefs: https://github.com/redis/lettuce/issues/1736\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Create a dragonfly cluster in emulated mode with multiple replicas\r\n2. Run a java application which is using the lattice library `io.lettuce:lettuce-core:6.5.0.RELEASE`\r\n3. delete one pod after the other and wait for them to come back before proceeding with the next\r\n4. See connection count rising\r\n\r\n**Expected behavior**\r\nConnection count should not increase with old aged connections.\r\n\r\n**Screenshots**\r\n-\r\n\r\n**Environment (please complete the following information):**\r\n - OS: bottlerocket 1.26.1\r\n - Kernel: # Command: 6.1.112\r\n - Containerized?: Kubernetes\r\n - Dragonfly Version: 1.25.2\r\n\r\n**Reproducible Code Snippet**\r\n-\r\n\r\n**Additional context**\r\n-", "closed_by": {"login": "romange", "id": 3674760, "node_id": "MDQ6VXNlcjM2NzQ3NjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3674760?v=4", "gravatar_id": "", "url": "https://api.github.com/users/romange", "html_url": "https://github.com/romange", "followers_url": "https://api.github.com/users/romange/followers", "following_url": "https://api.github.com/users/romange/following{/other_user}", "gists_url": "https://api.github.com/users/romange/gists{/gist_id}", "starred_url": "https://api.github.com/users/romange/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/romange/subscriptions", "organizations_url": "https://api.github.com/users/romange/orgs", "repos_url": "https://api.github.com/users/romange/repos", "events_url": "https://api.github.com/users/romange/events{/privacy}", "received_events_url": "https://api.github.com/users/romange/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/4244/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/4244/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/1710", "repository_url": "https://api.github.com/repos/dragonflydb/dragonfly", "labels_url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/1710/labels{/name}", "comments_url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/1710/comments", "events_url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/1710/events", "html_url": "https://github.com/dragonflydb/dragonfly/issues/1710", "id": 1855172047, "node_id": "I_kwDOGg_XLc5uk63P", "number": 1710, "title": "Dragonfly instances consume a relatively high amount of memory when running", "user": {"login": "kissingtiger", "id": 18210209, "node_id": "MDQ6VXNlcjE4MjEwMjA5", "avatar_url": "https://avatars.githubusercontent.com/u/18210209?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kissingtiger", "html_url": "https://github.com/kissingtiger", "followers_url": "https://api.github.com/users/kissingtiger/followers", "following_url": "https://api.github.com/users/kissingtiger/following{/other_user}", "gists_url": "https://api.github.com/users/kissingtiger/gists{/gist_id}", "starred_url": "https://api.github.com/users/kissingtiger/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kissingtiger/subscriptions", "organizations_url": "https://api.github.com/users/kissingtiger/orgs", "repos_url": "https://api.github.com/users/kissingtiger/repos", "events_url": "https://api.github.com/users/kissingtiger/events{/privacy}", "received_events_url": "https://api.github.com/users/kissingtiger/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 3632299438, "node_id": "LA_kwDOGg_XLc7YgH2u", "url": "https://api.github.com/repos/dragonflydb/dragonfly/labels/bug", "name": "bug", "color": "d73a4a", "default": true, "description": "Something isn't working"}], "state": "closed", "locked": false, "assignees": [{"login": "dranikpg", "id": 20553775, "node_id": "MDQ6VXNlcjIwNTUzNzc1", "avatar_url": "https://avatars.githubusercontent.com/u/20553775?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dranikpg", "html_url": "https://github.com/dranikpg", "followers_url": "https://api.github.com/users/dranikpg/followers", "following_url": "https://api.github.com/users/dranikpg/following{/other_user}", "gists_url": "https://api.github.com/users/dranikpg/gists{/gist_id}", "starred_url": "https://api.github.com/users/dranikpg/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dranikpg/subscriptions", "organizations_url": "https://api.github.com/users/dranikpg/orgs", "repos_url": "https://api.github.com/users/dranikpg/repos", "events_url": "https://api.github.com/users/dranikpg/events{/privacy}", "received_events_url": "https://api.github.com/users/dranikpg/received_events", "type": "User", "user_view_type": "public", "site_admin": false}], "milestone": null, "comments": 50, "created_at": "2023-08-17T14:55:14Z", "updated_at": "2023-09-19T07:11:54Z", "closed_at": "2023-09-19T07:11:54Z", "assignee": {"login": "dranikpg", "id": 20553775, "node_id": "MDQ6VXNlcjIwNTUzNzc1", "avatar_url": "https://avatars.githubusercontent.com/u/20553775?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dranikpg", "html_url": "https://github.com/dranikpg", "followers_url": "https://api.github.com/users/dranikpg/followers", "following_url": "https://api.github.com/users/dranikpg/following{/other_user}", "gists_url": "https://api.github.com/users/dranikpg/gists{/gist_id}", "starred_url": "https://api.github.com/users/dranikpg/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dranikpg/subscriptions", "organizations_url": "https://api.github.com/users/dranikpg/orgs", "repos_url": "https://api.github.com/users/dranikpg/repos", "events_url": "https://api.github.com/users/dranikpg/events{/privacy}", "received_events_url": "https://api.github.com/users/dranikpg/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "version\uff1adf-v1.6.2\r\nThe host memory occupied by the Dragonfly instance during operation far exceeds the instance storage memory\u3002\r\n# Memory\r\nused_memory:137367770528\r\n**used_memory_human:127.93GiB**\r\nused_memory_peak:227734733872\r\ncomitted_memory:-1272392216000\r\nused_memory_rss:296642269184\r\n**used_memory_rss_human:276.27GiB**\r\n\r\n<img width=\"962\" alt=\"image\" src=\"https://github.com/dragonflydb/dragonfly/assets/18210209/83c5c66a-760b-4300-b751-1bfdb238434c\">\r\n", "closed_by": {"login": "chakaz", "id": 7992598, "node_id": "MDQ6VXNlcjc5OTI1OTg=", "avatar_url": "https://avatars.githubusercontent.com/u/7992598?v=4", "gravatar_id": "", "url": "https://api.github.com/users/chakaz", "html_url": "https://github.com/chakaz", "followers_url": "https://api.github.com/users/chakaz/followers", "following_url": "https://api.github.com/users/chakaz/following{/other_user}", "gists_url": "https://api.github.com/users/chakaz/gists{/gist_id}", "starred_url": "https://api.github.com/users/chakaz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/chakaz/subscriptions", "organizations_url": "https://api.github.com/users/chakaz/orgs", "repos_url": "https://api.github.com/users/chakaz/repos", "events_url": "https://api.github.com/users/chakaz/events{/privacy}", "received_events_url": "https://api.github.com/users/chakaz/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/1710/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/1710/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/4497", "repository_url": "https://api.github.com/repos/dragonflydb/dragonfly", "labels_url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/4497/labels{/name}", "comments_url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/4497/comments", "events_url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/4497/events", "html_url": "https://github.com/dragonflydb/dragonfly/issues/4497", "id": 2804581262, "node_id": "I_kwDOGg_XLc6nKoOO", "number": 4497, "title": "Update from 1.19.2 to 1.26.1 leads to SIGSEGV", "user": {"login": "odoucet", "id": 199838, "node_id": "MDQ6VXNlcjE5OTgzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/199838?v=4", "gravatar_id": "", "url": "https://api.github.com/users/odoucet", "html_url": "https://github.com/odoucet", "followers_url": "https://api.github.com/users/odoucet/followers", "following_url": "https://api.github.com/users/odoucet/following{/other_user}", "gists_url": "https://api.github.com/users/odoucet/gists{/gist_id}", "starred_url": "https://api.github.com/users/odoucet/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/odoucet/subscriptions", "organizations_url": "https://api.github.com/users/odoucet/orgs", "repos_url": "https://api.github.com/users/odoucet/repos", "events_url": "https://api.github.com/users/odoucet/events{/privacy}", "received_events_url": "https://api.github.com/users/odoucet/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 3632299438, "node_id": "LA_kwDOGg_XLc7YgH2u", "url": "https://api.github.com/repos/dragonflydb/dragonfly/labels/bug", "name": "bug", "color": "d73a4a", "default": true, "description": "Something isn't working"}, {"id": 5489742613, "node_id": "LA_kwDOGg_XLc8AAAABRzbTFQ", "url": "https://api.github.com/repos/dragonflydb/dragonfly/labels/urgent", "name": "urgent", "color": "cc0000", "default": false, "description": "Important issue that needs to be fixed asap"}], "state": "closed", "locked": false, "assignees": [{"login": "chakaz", "id": 7992598, "node_id": "MDQ6VXNlcjc5OTI1OTg=", "avatar_url": "https://avatars.githubusercontent.com/u/7992598?v=4", "gravatar_id": "", "url": "https://api.github.com/users/chakaz", "html_url": "https://github.com/chakaz", "followers_url": "https://api.github.com/users/chakaz/followers", "following_url": "https://api.github.com/users/chakaz/following{/other_user}", "gists_url": "https://api.github.com/users/chakaz/gists{/gist_id}", "starred_url": "https://api.github.com/users/chakaz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/chakaz/subscriptions", "organizations_url": "https://api.github.com/users/chakaz/orgs", "repos_url": "https://api.github.com/users/chakaz/repos", "events_url": "https://api.github.com/users/chakaz/events{/privacy}", "received_events_url": "https://api.github.com/users/chakaz/received_events", "type": "User", "user_view_type": "public", "site_admin": false}], "milestone": null, "comments": 49, "created_at": "2025-01-22T14:44:37Z", "updated_at": "2025-01-27T09:50:44Z", "closed_at": "2025-01-26T21:18:29Z", "assignee": {"login": "chakaz", "id": 7992598, "node_id": "MDQ6VXNlcjc5OTI1OTg=", "avatar_url": "https://avatars.githubusercontent.com/u/7992598?v=4", "gravatar_id": "", "url": "https://api.github.com/users/chakaz", "html_url": "https://github.com/chakaz", "followers_url": "https://api.github.com/users/chakaz/followers", "following_url": "https://api.github.com/users/chakaz/following{/other_user}", "gists_url": "https://api.github.com/users/chakaz/gists{/gist_id}", "starred_url": "https://api.github.com/users/chakaz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/chakaz/subscriptions", "organizations_url": "https://api.github.com/users/chakaz/orgs", "repos_url": "https://api.github.com/users/chakaz/repos", "events_url": "https://api.github.com/users/chakaz/events{/privacy}", "received_events_url": "https://api.github.com/users/chakaz/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "**Describe the bug**\nWe tried upgrading a dragonfly cluster (two members) from v1.19.2 to v1.26.1\nWe restarted the replica instance, and here is the log after reboot : \n\n```\n2025-01-22T15:15:21+01:00 I20250122 14:15:21.933689     1 init.cc:78] dragonfly running in opt mode.\n2025-01-22T15:15:21+01:00 I20250122 14:15:21.933818     1 dfly_main.cc:691] Starting dragonfly df-v1.26.1-c2b95415241debb99bf969ebbc8465ce0bfe206f\n2025-01-22T15:15:21+01:00 I20250122 14:15:21.934052     1 dfly_main.cc:735] maxmemory has not been specified. Deciding myself....\n2025-01-22T15:15:21+01:00 I20250122 14:15:21.934062     1 dfly_main.cc:744] Found 3.00GiB available memory. Setting maxmemory to 2.40GiB\n2025-01-22T15:15:21+01:00 W20250122 14:15:21.934125     1 dfly_main.cc:368] Weird error 1 switching to epoll\n2025-01-22T15:15:22+01:00 I20250122 14:15:22.014271     1 proactor_pool.cc:147] Running 1 io threads\n2025-01-22T15:15:22+01:00 I20250122 14:15:22.017419     1 dfly_main.cc:272] Listening on admin socket any:9999\n2025-01-22T15:15:22+01:00 I20250122 14:15:22.018528     1 server_family.cc:835] Host OS: Linux 5.14.0-480.el9.x86_64 x86_64 with 1 threads\n2025-01-22T15:15:22+01:00 I20250122 14:15:22.022305     1 snapshot_storage.cc:185] Load snapshot: Searching for snapshot in directory: \"/dragonfly/snapshots\"\n2025-01-22T15:15:22+01:00 I20250122 14:15:22.025554     1 server_family.cc:1114] Loading /dragonfly/snapshots/dump-summary.dfs\n2025-01-22T15:15:22+01:00 I20250122 14:15:22.034510     6 listener_interface.cc:101] sock[5] AcceptServer - listening on port 9999\n2025-01-22T15:15:22+01:00 I20250122 14:15:22.034538     6 listener_interface.cc:101] sock[6] AcceptServer - listening on port 6379\n2025-01-22T15:15:22+01:00 I20250122 14:15:22.034548     6 listener_interface.cc:101] sock[7] AcceptServer - listening on port 11211\n2025-01-22T15:15:23+01:00 I20250122 14:15:23.489850     6 server_family.cc:1154] Load finished, num keys read: 323\n2025-01-22T15:15:34+01:00 I20250122 14:15:34.925325     6 server_family.cc:2769] Replicating 10.233.130.142:9999\n2025-01-22T15:15:34+01:00 F20250122 14:15:34.925524     6 db_slice.cc:783] Check failed: fetched_items_.empty() \n2025-01-22T15:15:34+01:00 *** Check failure stack trace: ***\n2025-01-22T15:15:34+01:00     @     0x55c033cde923  google::LogMessage::SendToLog()\n2025-01-22T15:15:34+01:00     @     0x55c033cd70e7  google::LogMessage::Flush()\n2025-01-22T15:15:34+01:00     @     0x55c033cd8a6f  google::LogMessageFatal::~LogMessageFatal()\n2025-01-22T15:15:34+01:00     @     0x55c03351770f  dfly::DbSlice::FlushDbIndexes()\n2025-01-22T15:15:34+01:00     @     0x55c0335178a2  dfly::DbSlice::FlushDb()\n2025-01-22T15:15:34+01:00     @     0x55c033296f2a  _ZN4absl12lts_2024011619functional_internal12InvokeObjectIZN4dfly12ServerFamily8DrakarysEPNS3_11TransactionEtEUlS6_PNS3_11EngineShardEE_NS5_14RunnableResultEJS6_S8_EEET0_NS1_7VoidPtrEDpNS1_8ForwardTIT1_E4typeE\n2025-01-22T15:15:34+01:00     @     0x55c0335577b9  dfly::Transaction::RunCallback()\n2025-01-22T15:15:34+01:00     @     0x55c03355a59b  dfly::Transaction::RunInShard()\n2025-01-22T15:15:34+01:00     @     0x55c033498790  dfly::EngineShard::PollExecution()\n2025-01-22T15:15:34+01:00     @     0x55d7633db3a1  _ZNSt17_Function_handlerIFvvEZN4dfly11Transaction11DispatchHopEvEUlvE1_E9_M_invokeERKSt9_Any_data\n2025-01-22T15:15:34+01:00     @     0x55d76394cf55  util::fb2::FiberQueue::Run()\n2025-01-22T15:15:34+01:00     @     0x55d76342d730  _ZN5boost7context6detail11fiber_entryINS1_12fiber_recordINS0_5fiberEN4util3fb219FixedStackAllocatorEZNS6_6detail15WorkerFiberImplIZN4dfly9TaskQueue5StartESt17basic_string_viewIcSt11char_traitsIcEEEUlvE_JEEC4IS7_EESF_RKNS0_12preallocatedEOT_OSG_EUlOS4_E_EEEEvNS1_10transfer_tE\n2025-01-22T15:15:34+01:00     @     0x55d76396c25f  make_fcontext\n2025-01-22T15:15:34+01:00     *** SIGABRT received at time=1737556484 on cpu 0 ***\n2025-01-22T15:15:34+01:00     PC: @     0x7f1faca299fc  (unknown)  pthread_kill\n2025-01-22T15:15:34+01:00     [failure_signal_handler.cc : 345] RAW: Signal 11 raised at PC=0x7f1fac9bb898 while already in AbslFailureSignalHandler()\n2025-01-22T15:15:34+01:00     *** SIGSEGV received at time=1737556484 on cpu 0 ***\n2025-01-22T15:15:34+01:00     PC: @     0x7f1fac9bb898  (unknown)  abort\n```\n\nThis happens in a loop.\n\nIf we delete snapshot, a full sync happens and member starts correctly : \n```\nI20250122 14:18:26.534972     1 dfly_main.cc:691] Starting dragonfly df-v1.26.1-c2b95415241debb99bf969ebbc8465ce0bfe206f\nI20250122 14:18:26.535194     1 dfly_main.cc:735] maxmemory has not been specified. Deciding myself....\nI20250122 14:18:26.535209     1 dfly_main.cc:744] Found 3.00GiB available memory. Setting maxmemory to 2.40GiB\nW20250122 14:18:26.535251     1 dfly_main.cc:368] Weird error 1 switching to epoll\nI20250122 14:18:26.612828     1 proactor_pool.cc:147] Running 1 io threads\nI20250122 14:18:26.615834     1 dfly_main.cc:272] Listening on admin socket any:9999\nI20250122 14:18:26.616796     1 server_family.cc:835] Host OS: Linux 5.14.0-480.el9.x86_64 x86_64 with 1 threads\nI20250122 14:18:26.620615     1 snapshot_storage.cc:185] Load snapshot: Searching for snapshot in directory: \"/dragonfly/snapshots\"\nW20250122 14:18:26.623203     1 server_family.cc:950] Load snapshot: No snapshot found\nI20250122 14:18:26.630414     6 listener_interface.cc:101] sock[5] AcceptServer - listening on port 9999\nI20250122 14:18:26.630442     6 listener_interface.cc:101] sock[6] AcceptServer - listening on port 6379\nI20250122 14:18:26.630453     6 listener_interface.cc:101] sock[7] AcceptServer - listening on port 11211\nI20250122 14:18:46.526578     6 server_family.cc:2769] Replicating 10.233.130.142:9999\nI20250122 14:18:47.943701     6 replica.cc:569] Started full sync with 10.233.130.142:9999\nI20250122 14:18:49.127570     6 replica.cc:589] full sync finished in 2.6 s\nI20250122 14:18:49.127673     6 replica.cc:679] Transitioned into stable sync\n```\n\nOn another cluster, even deleting snapshot and full resync failed (100% failure after 10+ restarts) : \n```\nI20250122 14:36:19.137816     1 server_family.cc:835] Host OS: Linux 5.14.0-480.el9.x86_64 x86_64 with 1 threads\nI20250122 14:36:19.149236     1 snapshot_storage.cc:185] Load snapshot: Searching for snapshot in directory: \"/dragonfly/snapshots\"\nW20250122 14:36:19.152247     1 server_family.cc:950] Load snapshot: No snapshot found\nI20250122 14:36:19.160511     6 listener_interface.cc:101] sock[5] AcceptServer - listening on port 9999\nI20250122 14:36:19.160552     6 listener_interface.cc:101] sock[6] AcceptServer - listening on port 6379\nI20250122 14:36:19.160574     6 listener_interface.cc:101] sock[7] AcceptServer - listening on port 11211\nI20250122 14:36:37.548327     6 server_family.cc:2769] Replicating 10.233.131.239:9999\nI20250122 14:36:37.560622     6 replica.cc:569] Started full sync with 10.233.131.239:9999\nI20250122 14:36:37.593991     6 server_family.cc:2769] Replicating 10.233.131.239:9999\nW20250122 14:36:37.594259     6 replica.cc:246] Error syncing with 10.233.131.239:9999 generic:125 Operation canceled\nI20250122 14:36:37.660379     6 replica.cc:569] Started full sync with 10.233.131.239:9999\nI20250122 14:36:39.770289     6 server_family.cc:2769] Replicating 10.233.131.239:9999\nW20250122 14:36:39.770624     6 replica.cc:246] Error syncing with 10.233.131.239:9999 generic:125 Operation canceled\nF20250122 14:36:39.775619     6 db_slice.cc:783] Check failed: fetched_items_.empty() \n*** Check failure stack trace: ***\n    @     0x55681cb35923  google::LogMessage::SendToLog()\n    @     0x55681cb2e0e7  google::LogMessage::Flush()\n    @     0x55681cb2fa6f  google::LogMessageFatal::~LogMessageFatal()\n    @     0x55681c36e70f  dfly::DbSlice::FlushDbIndexes()\n    @     0x55681c36e8a2  dfly::DbSlice::FlushDb()\n    @     0x55681c0edf2a  _ZN4absl12lts_2024011619functional_internal12InvokeObjectIZN4dfly12ServerFamily8DrakarysEPNS3_11TransactionEtEUlS6_PNS3_11EngineShardEE_NS5_14RunnableResultEJS6_S8_EEET0_NS1_7VoidPtrEDpNS1_8ForwardTIT1_E4typeE\n    @     0x55681c3ae7b9  dfly::Transaction::RunCallback()\n    @     0x55681c3b159b  dfly::Transaction::RunInShard()\n    @     0x55681c2ef790  dfly::EngineShard::PollExecution()\n    @     0x55681c3aa3a1  _ZNSt17_Function_handlerIFvvEZN4dfly11Transaction11DispatchHopEvEUlvE1_E9_M_invokeERKSt9_Any_data\n    @     0x55681c91bf55  util::fb2::FiberQueue::Run()\n    @     0x55681c3fc730  _ZN5boost7context6detail11fiber_entryINS1_12fiber_recordINS0_5fiberEN4util3fb219FixedStackAllocatorEZNS6_6detail15WorkerFiberImplIZN4dfly9TaskQueue5StartESt17basic_string_viewIcSt11char_traitsIcEEEUlvE_JEEC4IS7_EESF_RKNS0_12preallocatedEOT_OSG_EUlOS4_E_EEEEvNS1_10transfer_tE\n    @     0x55681c93b25f  make_fcontext\n*** SIGABRT received at time=1737556599 on cpu 0 ***\nPC: @     0x7f4768cc29fc  (unknown)  pthread_kill\n[failure_signal_handler.cc : 345] RAW: Signal 11 raised at PC=0x7f4768c54898 while already in AbslFailureSignalHandler()\n\n```\n\non master instance, at the same moment : \n```\nI20250122 14:36:37.550398     6 dflycmd.cc:651] Registered replica 10.233.130.163:6379\nI20250122 14:36:37.559907     6 dflycmd.cc:345] Started sync with replica 10.233.130.163:6379\nI20250122 14:36:37.648327     6 dflycmd.cc:110] Disconnecting from replica 10.233.130.163:6379\nI20250122 14:36:37.648401     6 rdb_save.cc:1247] Error writing to rdb sink Broken pipe\nI20250122 14:36:37.648496     6 dflycmd.cc:641] Replication error: Operation canceled: Context cancelled\nI20250122 14:36:37.650457     6 dflycmd.cc:651] Registered replica 10.233.130.163:6379\nI20250122 14:36:37.659725     6 dflycmd.cc:345] Started sync with replica 10.233.130.163:6379\nI20250122 14:36:39.784649     6 rdb_save.cc:1247] Error writing to rdb sink Broken pipe\nI20250122 14:36:39.784729     6 dflycmd.cc:641] Replication error: Broken pipe\nI20250122 14:36:39.784785     6 dflycmd.cc:110] Disconnecting from replica 10.233.130.163:6379\n```\n\nIn this case we were forced to start over and setup a new empty cluster.\n\n\n**To Reproduce**\nThis was reproduced in FOUR different Dragonfly cluster, with same update (same version source/destination).\nEvery time but one, deleting dfs file makes it work.\n\n\n**Expected behavior**\nWorking update, or at least a full resync from master without crash.\n\n**Environment (please complete the following information):**\n - Dragonfly official image docker.dragonflydb.io/dragonflydb/dragonfly\n - Run in Kubernetes 1.30.4\n", "closed_by": {"login": "chakaz", "id": 7992598, "node_id": "MDQ6VXNlcjc5OTI1OTg=", "avatar_url": "https://avatars.githubusercontent.com/u/7992598?v=4", "gravatar_id": "", "url": "https://api.github.com/users/chakaz", "html_url": "https://github.com/chakaz", "followers_url": "https://api.github.com/users/chakaz/followers", "following_url": "https://api.github.com/users/chakaz/following{/other_user}", "gists_url": "https://api.github.com/users/chakaz/gists{/gist_id}", "starred_url": "https://api.github.com/users/chakaz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/chakaz/subscriptions", "organizations_url": "https://api.github.com/users/chakaz/orgs", "repos_url": "https://api.github.com/users/chakaz/repos", "events_url": "https://api.github.com/users/chakaz/events{/privacy}", "received_events_url": "https://api.github.com/users/chakaz/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/4497/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/4497/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/4663", "repository_url": "https://api.github.com/repos/dragonflydb/dragonfly", "labels_url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/4663/labels{/name}", "comments_url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/4663/comments", "events_url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/4663/events", "html_url": "https://github.com/dragonflydb/dragonfly/issues/4663", "id": 2881445650, "node_id": "I_kwDOGg_XLc6rv18S", "number": 4663, "title": "Hung replica", "user": {"login": "fernandomacho", "id": 62182142, "node_id": "MDQ6VXNlcjYyMTgyMTQy", "avatar_url": "https://avatars.githubusercontent.com/u/62182142?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fernandomacho", "html_url": "https://github.com/fernandomacho", "followers_url": "https://api.github.com/users/fernandomacho/followers", "following_url": "https://api.github.com/users/fernandomacho/following{/other_user}", "gists_url": "https://api.github.com/users/fernandomacho/gists{/gist_id}", "starred_url": "https://api.github.com/users/fernandomacho/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fernandomacho/subscriptions", "organizations_url": "https://api.github.com/users/fernandomacho/orgs", "repos_url": "https://api.github.com/users/fernandomacho/repos", "events_url": "https://api.github.com/users/fernandomacho/events{/privacy}", "received_events_url": "https://api.github.com/users/fernandomacho/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 3632299438, "node_id": "LA_kwDOGg_XLc7YgH2u", "url": "https://api.github.com/repos/dragonflydb/dragonfly/labels/bug", "name": "bug", "color": "d73a4a", "default": true, "description": "Something isn't working"}], "state": "closed", "locked": false, "assignees": [{"login": "adiholden", "id": 117041239, "node_id": "U_kgDOBvnoVw", "avatar_url": "https://avatars.githubusercontent.com/u/117041239?v=4", "gravatar_id": "", "url": "https://api.github.com/users/adiholden", "html_url": "https://github.com/adiholden", "followers_url": "https://api.github.com/users/adiholden/followers", "following_url": "https://api.github.com/users/adiholden/following{/other_user}", "gists_url": "https://api.github.com/users/adiholden/gists{/gist_id}", "starred_url": "https://api.github.com/users/adiholden/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/adiholden/subscriptions", "organizations_url": "https://api.github.com/users/adiholden/orgs", "repos_url": "https://api.github.com/users/adiholden/repos", "events_url": "https://api.github.com/users/adiholden/events{/privacy}", "received_events_url": "https://api.github.com/users/adiholden/received_events", "type": "User", "user_view_type": "public", "site_admin": false}], "milestone": {"url": "https://api.github.com/repos/dragonflydb/dragonfly/milestones/10", "html_url": "https://github.com/dragonflydb/dragonfly/milestone/10", "labels_url": "https://api.github.com/repos/dragonflydb/dragonfly/milestones/10/labels", "id": 12424772, "node_id": "MI_kwDOGg_XLc4AvZZE", "number": 10, "title": "v1.28", "description": "", "creator": {"login": "romange", "id": 3674760, "node_id": "MDQ6VXNlcjM2NzQ3NjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3674760?v=4", "gravatar_id": "", "url": "https://api.github.com/users/romange", "html_url": "https://github.com/romange", "followers_url": "https://api.github.com/users/romange/followers", "following_url": "https://api.github.com/users/romange/following{/other_user}", "gists_url": "https://api.github.com/users/romange/gists{/gist_id}", "starred_url": "https://api.github.com/users/romange/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/romange/subscriptions", "organizations_url": "https://api.github.com/users/romange/orgs", "repos_url": "https://api.github.com/users/romange/repos", "events_url": "https://api.github.com/users/romange/events{/privacy}", "received_events_url": "https://api.github.com/users/romange/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "open_issues": 0, "closed_issues": 14, "state": "closed", "created_at": "2025-03-03T10:51:07Z", "updated_at": "2025-03-27T07:56:45Z", "due_on": null, "closed_at": "2025-03-27T07:56:45Z"}, "comments": 43, "created_at": "2025-02-26T12:36:40Z", "updated_at": "2025-03-04T14:49:29Z", "closed_at": "2025-03-04T07:48:19Z", "assignee": {"login": "adiholden", "id": 117041239, "node_id": "U_kgDOBvnoVw", "avatar_url": "https://avatars.githubusercontent.com/u/117041239?v=4", "gravatar_id": "", "url": "https://api.github.com/users/adiholden", "html_url": "https://github.com/adiholden", "followers_url": "https://api.github.com/users/adiholden/followers", "following_url": "https://api.github.com/users/adiholden/following{/other_user}", "gists_url": "https://api.github.com/users/adiholden/gists{/gist_id}", "starred_url": "https://api.github.com/users/adiholden/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/adiholden/subscriptions", "organizations_url": "https://api.github.com/users/adiholden/orgs", "repos_url": "https://api.github.com/users/adiholden/repos", "events_url": "https://api.github.com/users/adiholden/events{/privacy}", "received_events_url": "https://api.github.com/users/adiholden/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "Hello, I have been having the problem for many months where the dragonfly process randomly hangs completely. The process does not die but it is impossible to connect to that instance.\nI have installed the \"debug\" version and I have managed to capture a strace of the process in this case. I attach the content of the strace.\n\nIn this situation you cannot connect to the node and it starts generating dumps in the directory that is not configured for that purpose, it is as if it had started with a configuration that is not the one specified in the original startup.\n\nIn the logs (which I also attach) there is nothing that indicates an error.\n\nHmmm, has the ability to attach files been disabled?\n", "closed_by": {"login": "adiholden", "id": 117041239, "node_id": "U_kgDOBvnoVw", "avatar_url": "https://avatars.githubusercontent.com/u/117041239?v=4", "gravatar_id": "", "url": "https://api.github.com/users/adiholden", "html_url": "https://github.com/adiholden", "followers_url": "https://api.github.com/users/adiholden/followers", "following_url": "https://api.github.com/users/adiholden/following{/other_user}", "gists_url": "https://api.github.com/users/adiholden/gists{/gist_id}", "starred_url": "https://api.github.com/users/adiholden/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/adiholden/subscriptions", "organizations_url": "https://api.github.com/users/adiholden/orgs", "repos_url": "https://api.github.com/users/adiholden/repos", "events_url": "https://api.github.com/users/adiholden/events{/privacy}", "received_events_url": "https://api.github.com/users/adiholden/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/4663/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/4663/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/4672", "repository_url": "https://api.github.com/repos/dragonflydb/dragonfly", "labels_url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/4672/labels{/name}", "comments_url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/4672/comments", "events_url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/4672/events", "html_url": "https://github.com/dragonflydb/dragonfly/issues/4672", "id": 2886694683, "node_id": "I_kwDOGg_XLc6sD3cb", "number": 4672, "title": "SIGABRT with ssd tiering on 1.26.3", "user": {"login": "mainpart", "id": 2713266, "node_id": "MDQ6VXNlcjI3MTMyNjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2713266?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mainpart", "html_url": "https://github.com/mainpart", "followers_url": "https://api.github.com/users/mainpart/followers", "following_url": "https://api.github.com/users/mainpart/following{/other_user}", "gists_url": "https://api.github.com/users/mainpart/gists{/gist_id}", "starred_url": "https://api.github.com/users/mainpart/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mainpart/subscriptions", "organizations_url": "https://api.github.com/users/mainpart/orgs", "repos_url": "https://api.github.com/users/mainpart/repos", "events_url": "https://api.github.com/users/mainpart/events{/privacy}", "received_events_url": "https://api.github.com/users/mainpart/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 3632299438, "node_id": "LA_kwDOGg_XLc7YgH2u", "url": "https://api.github.com/repos/dragonflydb/dragonfly/labels/bug", "name": "bug", "color": "d73a4a", "default": true, "description": "Something isn't working"}, {"id": 5646965188, "node_id": "LA_kwDOGg_XLc8AAAABUJXZxA", "url": "https://api.github.com/repos/dragonflydb/dragonfly/labels/Next%20Up", "name": "Next Up", "color": "1d76db", "default": false, "description": "task that is ready to be worked on and should be added to working queue"}], "state": "closed", "locked": false, "assignees": [{"login": "romange", "id": 3674760, "node_id": "MDQ6VXNlcjM2NzQ3NjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3674760?v=4", "gravatar_id": "", "url": "https://api.github.com/users/romange", "html_url": "https://github.com/romange", "followers_url": "https://api.github.com/users/romange/followers", "following_url": "https://api.github.com/users/romange/following{/other_user}", "gists_url": "https://api.github.com/users/romange/gists{/gist_id}", "starred_url": "https://api.github.com/users/romange/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/romange/subscriptions", "organizations_url": "https://api.github.com/users/romange/orgs", "repos_url": "https://api.github.com/users/romange/repos", "events_url": "https://api.github.com/users/romange/events{/privacy}", "received_events_url": "https://api.github.com/users/romange/received_events", "type": "User", "user_view_type": "public", "site_admin": false}], "milestone": {"url": "https://api.github.com/repos/dragonflydb/dragonfly/milestones/10", "html_url": "https://github.com/dragonflydb/dragonfly/milestone/10", "labels_url": "https://api.github.com/repos/dragonflydb/dragonfly/milestones/10/labels", "id": 12424772, "node_id": "MI_kwDOGg_XLc4AvZZE", "number": 10, "title": "v1.28", "description": "", "creator": {"login": "romange", "id": 3674760, "node_id": "MDQ6VXNlcjM2NzQ3NjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3674760?v=4", "gravatar_id": "", "url": "https://api.github.com/users/romange", "html_url": "https://github.com/romange", "followers_url": "https://api.github.com/users/romange/followers", "following_url": "https://api.github.com/users/romange/following{/other_user}", "gists_url": "https://api.github.com/users/romange/gists{/gist_id}", "starred_url": "https://api.github.com/users/romange/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/romange/subscriptions", "organizations_url": "https://api.github.com/users/romange/orgs", "repos_url": "https://api.github.com/users/romange/repos", "events_url": "https://api.github.com/users/romange/events{/privacy}", "received_events_url": "https://api.github.com/users/romange/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "open_issues": 0, "closed_issues": 14, "state": "closed", "created_at": "2025-03-03T10:51:07Z", "updated_at": "2025-03-27T07:56:45Z", "due_on": null, "closed_at": "2025-03-27T07:56:45Z"}, "comments": 36, "created_at": "2025-02-28T09:47:58Z", "updated_at": "2025-03-18T08:38:04Z", "closed_at": "2025-03-17T11:45:08Z", "assignee": {"login": "romange", "id": 3674760, "node_id": "MDQ6VXNlcjM2NzQ3NjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3674760?v=4", "gravatar_id": "", "url": "https://api.github.com/users/romange", "html_url": "https://github.com/romange", "followers_url": "https://api.github.com/users/romange/followers", "following_url": "https://api.github.com/users/romange/following{/other_user}", "gists_url": "https://api.github.com/users/romange/gists{/gist_id}", "starred_url": "https://api.github.com/users/romange/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/romange/subscriptions", "organizations_url": "https://api.github.com/users/romange/orgs", "repos_url": "https://api.github.com/users/romange/repos", "events_url": "https://api.github.com/users/romange/events{/privacy}", "received_events_url": "https://api.github.com/users/romange/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "F20250228 09:25:57.923086    14 db_slice.cc:820] Check failed: db.expire.Insert(main_it->first.AsRef(), ExpirePeriod(delta)).second \n*** Check failure stack trace: ***\n    @     0x562e118a3923  google::LogMessage::SendToLog()\n    @     0x562e1189c0e7  google::LogMessage::Flush()\n    @     0x562e1189da6f  google::LogMessageFatal::~LogMessageFatal()\n    @     0x562e110e5338  dfly::DbSlice::AddExpire()\n    @     0x562e10f059c9  dfly::(anonymous namespace)::SetCmd::SetExisting()\n    @     0x562e10f05e77  dfly::(anonymous namespace)::SetCmd::Set()\n    @     0x562e10f067cf  _ZN4absl12lts_2024011619functional_internal12InvokeObjectIZN4dfly12_GLOBAL__N_110SetGenericERKNS4_6SetCmd9SetParamsESt17basic_string_viewIcSt11char_traitsIcEESC_bPNS3_11TransactionEEUlSE_PNS3_11EngineShardEE_NSD_14RunnableResultEJSE_SG_EEET0_NS1_7VoidPtrEDpNS1_8ForwardTIT1_E4typeE\n    @     0x562e1111bc19  dfly::Transaction::RunCallback()\n    @     0x562e1111c7a9  dfly::Transaction::ScheduleInShard()\n    @     0x562e1111e8df  dfly::Transaction::ScheduleBatchInShard()\n    @     0x562e11689d05  util::fb2::FiberQueue::Run()\n    @     0x562e11169b90  _ZN5boost7context6detail11fiber_entryINS1_12fiber_recordINS0_5fiberEN4util3fb219FixedStackAllocatorEZNS6_6detail15WorkerFiberImplIZN4dfly9TaskQueue5StartESt17basic_string_viewIcSt11char_traitsIcEEEUlvE_JEEC4IS7_EESF_RKNS0_12preallocatedEOT_OSG_EUlOS4_E_EEEEvNS1_10transfer_tE\n    @     0x562e116a900f  make_fcontext\n*** SIGABRT received at time=1740734757 on cpu 2 ***\nPC: @     0x7f9721e8a9fc  (unknown)  pthread_kill\n[failure_signal_handler.cc : 345] RAW: Signal 11 raised at PC=0x7f9721e1c898 while already in AbslFailureSignalHandler()\n*** SIGSEGV received at time=1740734757 on cpu 2 ***\nPC: @     0x7f9721e1c898  (unknown)  abort\n\n\n\n2. **Pod Details:**\n   - The pod crashed with Exit Code: 139 (SIGSEGV - Segmentation fault)\n   - Resource limits: 4Gi memory, 4 CPU\n   - Resource requests: 1Gi memory, 200m CPU\n   - Dragonfly version: df-v1.26.3\n   - Command args include `--maxmemory=1GB`\n", "closed_by": {"login": "romange", "id": 3674760, "node_id": "MDQ6VXNlcjM2NzQ3NjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3674760?v=4", "gravatar_id": "", "url": "https://api.github.com/users/romange", "html_url": "https://github.com/romange", "followers_url": "https://api.github.com/users/romange/followers", "following_url": "https://api.github.com/users/romange/following{/other_user}", "gists_url": "https://api.github.com/users/romange/gists{/gist_id}", "starred_url": "https://api.github.com/users/romange/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/romange/subscriptions", "organizations_url": "https://api.github.com/users/romange/orgs", "repos_url": "https://api.github.com/users/romange/repos", "events_url": "https://api.github.com/users/romange/events{/privacy}", "received_events_url": "https://api.github.com/users/romange/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/4672/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/4672/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/2500", "repository_url": "https://api.github.com/repos/dragonflydb/dragonfly", "labels_url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/2500/labels{/name}", "comments_url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/2500/comments", "events_url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/2500/events", "html_url": "https://github.com/dragonflydb/dragonfly/issues/2500", "id": 2105257010, "node_id": "I_kwDOGg_XLc59e6wy", "number": 2500, "title": "Dragonfly replica crash", "user": {"login": "vladimirem93", "id": 12939897, "node_id": "MDQ6VXNlcjEyOTM5ODk3", "avatar_url": "https://avatars.githubusercontent.com/u/12939897?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vladimirem93", "html_url": "https://github.com/vladimirem93", "followers_url": "https://api.github.com/users/vladimirem93/followers", "following_url": "https://api.github.com/users/vladimirem93/following{/other_user}", "gists_url": "https://api.github.com/users/vladimirem93/gists{/gist_id}", "starred_url": "https://api.github.com/users/vladimirem93/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vladimirem93/subscriptions", "organizations_url": "https://api.github.com/users/vladimirem93/orgs", "repos_url": "https://api.github.com/users/vladimirem93/repos", "events_url": "https://api.github.com/users/vladimirem93/events{/privacy}", "received_events_url": "https://api.github.com/users/vladimirem93/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 3632299438, "node_id": "LA_kwDOGg_XLc7YgH2u", "url": "https://api.github.com/repos/dragonflydb/dragonfly/labels/bug", "name": "bug", "color": "d73a4a", "default": true, "description": "Something isn't working"}], "state": "closed", "locked": false, "assignees": [{"login": "romange", "id": 3674760, "node_id": "MDQ6VXNlcjM2NzQ3NjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3674760?v=4", "gravatar_id": "", "url": "https://api.github.com/users/romange", "html_url": "https://github.com/romange", "followers_url": "https://api.github.com/users/romange/followers", "following_url": "https://api.github.com/users/romange/following{/other_user}", "gists_url": "https://api.github.com/users/romange/gists{/gist_id}", "starred_url": "https://api.github.com/users/romange/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/romange/subscriptions", "organizations_url": "https://api.github.com/users/romange/orgs", "repos_url": "https://api.github.com/users/romange/repos", "events_url": "https://api.github.com/users/romange/events{/privacy}", "received_events_url": "https://api.github.com/users/romange/received_events", "type": "User", "user_view_type": "public", "site_admin": false}], "milestone": null, "comments": 36, "created_at": "2024-01-29T11:17:50Z", "updated_at": "2024-02-20T06:57:41Z", "closed_at": "2024-02-19T15:28:27Z", "assignee": {"login": "romange", "id": 3674760, "node_id": "MDQ6VXNlcjM2NzQ3NjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3674760?v=4", "gravatar_id": "", "url": "https://api.github.com/users/romange", "html_url": "https://github.com/romange", "followers_url": "https://api.github.com/users/romange/followers", "following_url": "https://api.github.com/users/romange/following{/other_user}", "gists_url": "https://api.github.com/users/romange/gists{/gist_id}", "starred_url": "https://api.github.com/users/romange/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/romange/subscriptions", "organizations_url": "https://api.github.com/users/romange/orgs", "repos_url": "https://api.github.com/users/romange/repos", "events_url": "https://api.github.com/users/romange/events{/privacy}", "received_events_url": "https://api.github.com/users/romange/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "**Describe the bug**\r\nReplica crashes unexpectedly, reasons for replica to die weren't detected\r\n\r\n**To Reproduce**\r\n350 mln non-expiring keys \r\nused_memory_human:57.30GiB\r\nmaxmemory_human:250.00GiB\r\nCommands executed per second 20 000 ops\r\nMost commonly used operation: hget, hset\r\nMost commonly used strucuture: HashMap\r\n\r\n**Expected behavior**\r\nStable condition\r\n\r\n**Environment (please complete the following information):**\r\n - OS: bullseye/sid (container)  Rhel 9 (Host)\r\n - Kernel: 5.14.0-284.30.1.el9_2.x86_64 \r\n - Containerized?: Docker\r\n - Dragonfly Version: 1.12.0\r\n - Build Image: FROM\u00a0docker.dragonflydb.io/dragonflydb/dragonfly:v1.12.0 \r\n\r\n* Configuration info \r\ndragonfly --logtostderr --port 6379 --maxmemory=50G --dir $DRAGONFLY_DATA_DIR --requirepass=<password> --cache_mode=true --snapshot_cron \"* */1 * * *\" --dbnum 100 --masterauth=<password> --dbfilename dump\r\n\r\nsh -c dragonfly --logtostderr --port $DRAGONFLY_PORT --maxmemory=$DRAGONFLY_MEMORY \\ \r\n--dir $DRAGONFLY_DATA_DIR --requirepass=$DRAGONFLY_MASTER_PASSWORD --cache_mode=true \\ \r\n--snapshot_cron \"$DRAGONFLY_CRON_SCHEDULE\" --dbnum 100 --masterauth=$DRAGONFLY_MASTER_PASSWORD \\\r\n--dbfilename $DRAGONFLY_DUMP_FILENAME\r\n\r\ndragonfly:\r\n    image: dp-dragonflydb/dragonflydb:v.1.13.0\r\n    network_mode: \"host\"\r\n    restart: always\r\n    ulimits:\r\n      memlock: -1\r\n    environment:\r\n      <<: *dragonfy-environment\r\n      DRAGONFLY_PORT: <PORT>\r\n      DRAGONFLY_MEMORY: 50G\r\n      DRAGONFLY_MASTER_PASSWORD: <PASSWORD>\r\n      DRAGONFLY_DUMP_FILENAME: dump\r\n    volumes:\r\n      - $DATA_DIR/dragonfly:/data/dragonfly\r\n      - /etc/localtime:/etc/localtime:ro\r\n    deploy:\r\n      resources:\r\n        limits:\r\n          memory: 60G\r\n          cpus: '60'\r\n    oom_kill_disable: true\r\n    memswap_limit: 60G \r\n\r\n**Additional context**\r\n\r\nLogs before crash: \r\n\r\nI20240129 03:03:43.669939    23 dflycmd.cc:385] Transitioned into stable sync with replica 10.44.73.10:6397\r\nI20240129 03:25:03.809696    12 save_stages_controller.cc:276] Saving \"/data/dragonfly/dump-summary.dfs\" finished after 3.81 s\r\nI20240129 03:50:04.580170    12 save_stages_controller.cc:276] Saving \"/data/dragonfly/dump-summary.dfs\" finished after 4.58 s\r\nI20240129 04:00:19.486539    25 dflycmd.cc:614] Replication error: Software caused connection abort\r\nI20240129 04:00:19.492048    31 dflycmd.cc:663] Disconnecting from replica 10.44.73.10:6397\r\nI20240129 04:00:24.963119    12 save_stages_controller.cc:276] Saving \"/data/dragonfly/dump-summary.dfs\" finished after 25 s \r\nI20240129 03:35:01.495014    12 save_stages_controller.cc:276] Saving \"/data/dragonfly/dump-summary.dfs\" finished after 1.49 s\r\nI20240129 04:00:09.446189    12 save_stages_controller.cc:276] Saving \"/data/dragonfly/dump-summary.dfs\" finished after 9.44 s\r\nI20240129 04:00:17.317588    13 server_family.cc:1937] Replicating NO:ONE\r\nI20240129 04:00:17.319891     9 replica.cc:636] Exit stable sync\r\nW20240129 04:00:17.319902     9 replica.cc:237] Error stable sync with 10.14.205.15:6397 generic:125 Operation canceled\r\nE20240129 04:00:17.322391    13 server_family.cc:1246] Subcommand KILL not supported\r\nE20240129 04:00:17.322402    13 server_family.cc:1246] Subcommand KILL not supported \r\n\r\n", "closed_by": {"login": "romange", "id": 3674760, "node_id": "MDQ6VXNlcjM2NzQ3NjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3674760?v=4", "gravatar_id": "", "url": "https://api.github.com/users/romange", "html_url": "https://github.com/romange", "followers_url": "https://api.github.com/users/romange/followers", "following_url": "https://api.github.com/users/romange/following{/other_user}", "gists_url": "https://api.github.com/users/romange/gists{/gist_id}", "starred_url": "https://api.github.com/users/romange/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/romange/subscriptions", "organizations_url": "https://api.github.com/users/romange/orgs", "repos_url": "https://api.github.com/users/romange/repos", "events_url": "https://api.github.com/users/romange/events{/privacy}", "received_events_url": "https://api.github.com/users/romange/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/2500/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/2500/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/1186", "repository_url": "https://api.github.com/repos/dragonflydb/dragonfly", "labels_url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/1186/labels{/name}", "comments_url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/1186/comments", "events_url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/1186/events", "html_url": "https://github.com/dragonflydb/dragonfly/issues/1186", "id": 1698742547, "node_id": "I_kwDOGg_XLc5lQMET", "number": 1186, "title": "Process crash on startup with SIGSEGV error", "user": {"login": "brutaldev", "id": 1929531, "node_id": "MDQ6VXNlcjE5Mjk1MzE=", "avatar_url": "https://avatars.githubusercontent.com/u/1929531?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brutaldev", "html_url": "https://github.com/brutaldev", "followers_url": "https://api.github.com/users/brutaldev/followers", "following_url": "https://api.github.com/users/brutaldev/following{/other_user}", "gists_url": "https://api.github.com/users/brutaldev/gists{/gist_id}", "starred_url": "https://api.github.com/users/brutaldev/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brutaldev/subscriptions", "organizations_url": "https://api.github.com/users/brutaldev/orgs", "repos_url": "https://api.github.com/users/brutaldev/repos", "events_url": "https://api.github.com/users/brutaldev/events{/privacy}", "received_events_url": "https://api.github.com/users/brutaldev/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 3632299438, "node_id": "LA_kwDOGg_XLc7YgH2u", "url": "https://api.github.com/repos/dragonflydb/dragonfly/labels/bug", "name": "bug", "color": "d73a4a", "default": true, "description": "Something isn't working"}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 30, "created_at": "2023-05-06T19:09:14Z", "updated_at": "2023-05-09T18:17:40Z", "closed_at": "2023-05-09T18:17:40Z", "assignee": null, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "**Describe the bug**\r\nUsing the latest docker container, the process crashes with the following log entries:\r\n\r\n> docker run -p 6379:6379 --ulimit memlock=-1 docker.dragonflydb.io/dragonflydb/dragonfly\r\n```\r\nI20230506 19:01:41.032795     1 init.cc:56] dragonfly running in opt mode.\r\nI20230506 19:01:41.032846     1 dfly_main.cc:568] Starting dragonfly df-v1.2.1-0b13eaa9436097e6508b82c3ba593dc696f07c21\r\nW20230506 19:01:41.033144     1 dfly_main.cc:596] SWAP is enabled. Consider disabling it when running Dragonfly.\r\nI20230506 19:01:41.033177     1 dfly_main.cc:599] maxmemory has not been specified. Deciding myself....\r\nI20230506 19:01:41.033186     1 dfly_main.cc:603] Found 28.33GiB available memory. Setting maxmemory to 22.66GiB\r\nI20230506 19:01:41.080149    12 uring_proactor.cc:157] IORing with 1024 entries, allocated 102720 bytes, cq_entries is 2048\r\nI20230506 19:01:41.110323     1 proactor_pool.cc:73] Running 20 io threads\r\n*** SIGSEGV received at time=1683399701 on cpu 1 ***\r\nI20230506 19:01:41.144194     1 server_family.cc:457] Data directory is \"/data\"\r\n```\r\n\r\n**To Reproduce**\r\nRun the docker command from the docs:\r\n```docker run -p 6379:6379 --ulimit memlock=-1 docker.dragonflydb.io/dragonflydb/dragonfly```\r\n\r\n**Expected behavior**\r\nThe container starts with no errors.\r\n\r\n**Screenshots**\r\nNone, just console output.\r\n\r\n**Environment (please complete the following information):**\r\n - OS: Windows 11 Pro (Version 10.0.22621 Build 22621)\r\n - Containerized?: Docker Desktop (4.19.0)\r\n - Dragonfly Version: 1.2.1\r\n\r\n**Reproducible Code Snippet**\r\n```docker run -p 6379:6379 --ulimit memlock=-1 docker.dragonflydb.io/dragonflydb/dragonfly```\r\n\r\n**Additional context**\r\nAdd any other context about the problem here.\r\n", "closed_by": {"login": "brutaldev", "id": 1929531, "node_id": "MDQ6VXNlcjE5Mjk1MzE=", "avatar_url": "https://avatars.githubusercontent.com/u/1929531?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brutaldev", "html_url": "https://github.com/brutaldev", "followers_url": "https://api.github.com/users/brutaldev/followers", "following_url": "https://api.github.com/users/brutaldev/following{/other_user}", "gists_url": "https://api.github.com/users/brutaldev/gists{/gist_id}", "starred_url": "https://api.github.com/users/brutaldev/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brutaldev/subscriptions", "organizations_url": "https://api.github.com/users/brutaldev/orgs", "repos_url": "https://api.github.com/users/brutaldev/repos", "events_url": "https://api.github.com/users/brutaldev/events{/privacy}", "received_events_url": "https://api.github.com/users/brutaldev/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/1186/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/1186/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/272", "repository_url": "https://api.github.com/repos/dragonflydb/dragonfly", "labels_url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/272/labels{/name}", "comments_url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/272/comments", "events_url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/272/events", "html_url": "https://github.com/dragonflydb/dragonfly/issues/272", "id": 1365145464, "node_id": "I_kwDOGg_XLc5RXnd4", "number": 272, "title": "Dragonfly does not allow accessing undeclared keys in lua scripts", "user": {"login": "dranikpg", "id": 20553775, "node_id": "MDQ6VXNlcjIwNTUzNzc1", "avatar_url": "https://avatars.githubusercontent.com/u/20553775?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dranikpg", "html_url": "https://github.com/dranikpg", "followers_url": "https://api.github.com/users/dranikpg/followers", "following_url": "https://api.github.com/users/dranikpg/following{/other_user}", "gists_url": "https://api.github.com/users/dranikpg/gists{/gist_id}", "starred_url": "https://api.github.com/users/dranikpg/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dranikpg/subscriptions", "organizations_url": "https://api.github.com/users/dranikpg/orgs", "repos_url": "https://api.github.com/users/dranikpg/repos", "events_url": "https://api.github.com/users/dranikpg/events{/privacy}", "received_events_url": "https://api.github.com/users/dranikpg/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 3632299438, "node_id": "LA_kwDOGg_XLc7YgH2u", "url": "https://api.github.com/repos/dragonflydb/dragonfly/labels/bug", "name": "bug", "color": "d73a4a", "default": true, "description": "Something isn't working"}], "state": "closed", "locked": false, "assignees": [{"login": "dranikpg", "id": 20553775, "node_id": "MDQ6VXNlcjIwNTUzNzc1", "avatar_url": "https://avatars.githubusercontent.com/u/20553775?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dranikpg", "html_url": "https://github.com/dranikpg", "followers_url": "https://api.github.com/users/dranikpg/followers", "following_url": "https://api.github.com/users/dranikpg/following{/other_user}", "gists_url": "https://api.github.com/users/dranikpg/gists{/gist_id}", "starred_url": "https://api.github.com/users/dranikpg/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dranikpg/subscriptions", "organizations_url": "https://api.github.com/users/dranikpg/orgs", "repos_url": "https://api.github.com/users/dranikpg/repos", "events_url": "https://api.github.com/users/dranikpg/events{/privacy}", "received_events_url": "https://api.github.com/users/dranikpg/received_events", "type": "User", "user_view_type": "public", "site_admin": false}], "milestone": null, "comments": 28, "created_at": "2022-09-07T20:26:42Z", "updated_at": "2024-03-26T08:05:57Z", "closed_at": "2023-03-20T10:07:14Z", "assignee": {"login": "dranikpg", "id": 20553775, "node_id": "MDQ6VXNlcjIwNTUzNzc1", "avatar_url": "https://avatars.githubusercontent.com/u/20553775?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dranikpg", "html_url": "https://github.com/dranikpg", "followers_url": "https://api.github.com/users/dranikpg/followers", "following_url": "https://api.github.com/users/dranikpg/following{/other_user}", "gists_url": "https://api.github.com/users/dranikpg/gists{/gist_id}", "starred_url": "https://api.github.com/users/dranikpg/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dranikpg/subscriptions", "organizations_url": "https://api.github.com/users/dranikpg/orgs", "repos_url": "https://api.github.com/users/dranikpg/repos", "events_url": "https://api.github.com/users/dranikpg/events{/privacy}", "received_events_url": "https://api.github.com/users/dranikpg/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "author_association": "CONTRIBUTOR", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "**Describe the bug**\r\n\r\nDiscovered when testing #182. The following script: \r\n```lua\r\nlocal conj_ttl = redis.call('ttl', conj_key)\r\nif conj_ttl < timeout then\r\n    -- some code\r\nend\r\n```\r\nexpects `conj_ttl` always to be a number. Dragonfly instead returns errors as lua tables (aka js-like objects) with a detailed cause.\r\n\r\n**To Reproduce**\r\n\r\nDragonfly:\r\n```\r\n127.0.0.1:6379> EVAL \"return redis.call('ttl', 'nonexistent')\" 0\r\n(error) ERR script tried accessing undeclared key\r\n```\r\n\r\nRedis:\r\n```\r\n127.0.0.1:6379> EVAL \"return redis.call('ttl', 'nonexistent')\" 0\r\n(integer) -2\r\n```\r\n\r\n**Expected behavior**\r\n\r\nReturn sentinel errors in scripts as lua numbers\r\n", "closed_by": {"login": "dranikpg", "id": 20553775, "node_id": "MDQ6VXNlcjIwNTUzNzc1", "avatar_url": "https://avatars.githubusercontent.com/u/20553775?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dranikpg", "html_url": "https://github.com/dranikpg", "followers_url": "https://api.github.com/users/dranikpg/followers", "following_url": "https://api.github.com/users/dranikpg/following{/other_user}", "gists_url": "https://api.github.com/users/dranikpg/gists{/gist_id}", "starred_url": "https://api.github.com/users/dranikpg/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dranikpg/subscriptions", "organizations_url": "https://api.github.com/users/dranikpg/orgs", "repos_url": "https://api.github.com/users/dranikpg/repos", "events_url": "https://api.github.com/users/dranikpg/events{/privacy}", "received_events_url": "https://api.github.com/users/dranikpg/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/272/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/272/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/2066", "repository_url": "https://api.github.com/repos/dragonflydb/dragonfly", "labels_url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/2066/labels{/name}", "comments_url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/2066/comments", "events_url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/2066/events", "html_url": "https://github.com/dragonflydb/dragonfly/issues/2066", "id": 1959729408, "node_id": "I_kwDOGg_XLc50zxkA", "number": 2066, "title": "Duplicate fields in hashmap", "user": {"login": "fernandomacho", "id": 62182142, "node_id": "MDQ6VXNlcjYyMTgyMTQy", "avatar_url": "https://avatars.githubusercontent.com/u/62182142?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fernandomacho", "html_url": "https://github.com/fernandomacho", "followers_url": "https://api.github.com/users/fernandomacho/followers", "following_url": "https://api.github.com/users/fernandomacho/following{/other_user}", "gists_url": "https://api.github.com/users/fernandomacho/gists{/gist_id}", "starred_url": "https://api.github.com/users/fernandomacho/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fernandomacho/subscriptions", "organizations_url": "https://api.github.com/users/fernandomacho/orgs", "repos_url": "https://api.github.com/users/fernandomacho/repos", "events_url": "https://api.github.com/users/fernandomacho/events{/privacy}", "received_events_url": "https://api.github.com/users/fernandomacho/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 3632299438, "node_id": "LA_kwDOGg_XLc7YgH2u", "url": "https://api.github.com/repos/dragonflydb/dragonfly/labels/bug", "name": "bug", "color": "d73a4a", "default": true, "description": "Something isn't working"}], "state": "closed", "locked": false, "assignees": [{"login": "romange", "id": 3674760, "node_id": "MDQ6VXNlcjM2NzQ3NjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3674760?v=4", "gravatar_id": "", "url": "https://api.github.com/users/romange", "html_url": "https://github.com/romange", "followers_url": "https://api.github.com/users/romange/followers", "following_url": "https://api.github.com/users/romange/following{/other_user}", "gists_url": "https://api.github.com/users/romange/gists{/gist_id}", "starred_url": "https://api.github.com/users/romange/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/romange/subscriptions", "organizations_url": "https://api.github.com/users/romange/orgs", "repos_url": "https://api.github.com/users/romange/repos", "events_url": "https://api.github.com/users/romange/events{/privacy}", "received_events_url": "https://api.github.com/users/romange/received_events", "type": "User", "user_view_type": "public", "site_admin": false}], "milestone": null, "comments": 27, "created_at": "2023-10-24T17:24:11Z", "updated_at": "2023-10-29T06:39:37Z", "closed_at": "2023-10-29T06:39:37Z", "assignee": {"login": "romange", "id": 3674760, "node_id": "MDQ6VXNlcjM2NzQ3NjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3674760?v=4", "gravatar_id": "", "url": "https://api.github.com/users/romange", "html_url": "https://github.com/romange", "followers_url": "https://api.github.com/users/romange/followers", "following_url": "https://api.github.com/users/romange/following{/other_user}", "gists_url": "https://api.github.com/users/romange/gists{/gist_id}", "starred_url": "https://api.github.com/users/romange/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/romange/subscriptions", "organizations_url": "https://api.github.com/users/romange/orgs", "repos_url": "https://api.github.com/users/romange/repos", "events_url": "https://api.github.com/users/romange/events{/privacy}", "received_events_url": "https://api.github.com/users/romange/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "I have a 3 nodes running dragonfly 1 master and 2 replicas.\r\nThe access to dragonfly instances is over haproxy with 2 backend: 1 for write (master) and 1 for read (master/replica)\r\n\r\nThe kernel version on servers are 5.15.0-73-generic on all servers.\r\n\r\nThe hardware is:\r\nMaster: 96 cores and 376 Gb ram\r\nReplica 1: 48 cores and 256 Gb ram\r\nReplica 1: 48 cores and 256 Gb ram\r\n\r\nThe load of clients is:\r\n\r\nOn Master:\r\n# Clients\r\nconnected_clients:402\r\nclient_read_buffer_bytes:14292480\r\nblocked_clients:0\r\ndispatch_queue_entries:0\r\n\r\nOn replica 1:\r\n# Clients\r\nconnected_clients:188\r\nclient_read_buffer_bytes:52480\r\nblocked_clients:0\r\ndispatch_queue_entries:108365\r\n\r\nOn replica 2:\r\nconnected_clients:202\r\nclient_read_buffer_bytes:54272\r\nblocked_clients:0\r\ndispatch_queue_entries:61381\r\n\r\nThe replication status is:\r\nOn Master:\r\nrole:master\r\nconnected_slaves:2\r\nslave0:ip=172.16.0.23,port=6392,state=stable_sync,lag=74\r\nslave1:ip=172.16.0.25,port=6392,state=stable_sync,lag=61\r\nmaster_replid:2c604ff0c72153701e8be30d707aa72d8f9d4ca9\r\n\r\nOn replica 1:\r\nrole:replica\r\nmaster_host:172.16.0.24\r\nmaster_port:6392\r\nmaster_link_status:up\r\nmaster_last_io_seconds_ago:0\r\nmaster_sync_in_progress:0\r\n\r\nOn replica 2:\r\nrole:replica\r\nmaster_host:172.16.0.24\r\nmaster_port:6392\r\nmaster_link_status:up\r\nmaster_last_io_seconds_ago:0\r\nmaster_sync_in_progress:0\r\n\r\nThe CPU on master consum is over 20%\r\nThe CPU on replica 1 consum is over 370%\r\nThe CPU on replica 1 consum is over 300%\r\n\r\nAny log on dragonfly log files.\r\n\r\nThe nodes run sentinel and show multiple:\r\n1303:X 24 Oct 2023 19:02:26.831 # +sdown slave 172.16.0.23:6392 172.16.0.23 6392 @ ovh-innova 172.16.0.24 6392\r\n\r\nI think these errors are due to the high CPU load of the replica nodes\r\n\r\nHow is it possible that for many more clients the CPU load of the master is much lower than that of the replicas??\r\n\r\nI attach info command on all nodes.\r\n\r\nThanks\r\n[dfly_info.log](https://github.com/dragonflydb/dragonfly/files/13121950/dfly_info.log)\r\n", "closed_by": {"login": "romange", "id": 3674760, "node_id": "MDQ6VXNlcjM2NzQ3NjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3674760?v=4", "gravatar_id": "", "url": "https://api.github.com/users/romange", "html_url": "https://github.com/romange", "followers_url": "https://api.github.com/users/romange/followers", "following_url": "https://api.github.com/users/romange/following{/other_user}", "gists_url": "https://api.github.com/users/romange/gists{/gist_id}", "starred_url": "https://api.github.com/users/romange/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/romange/subscriptions", "organizations_url": "https://api.github.com/users/romange/orgs", "repos_url": "https://api.github.com/users/romange/repos", "events_url": "https://api.github.com/users/romange/events{/privacy}", "received_events_url": "https://api.github.com/users/romange/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/2066/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/2066/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/1285", "repository_url": "https://api.github.com/repos/dragonflydb/dragonfly", "labels_url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/1285/labels{/name}", "comments_url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/1285/comments", "events_url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/1285/events", "html_url": "https://github.com/dragonflydb/dragonfly/issues/1285", "id": 1723226995, "node_id": "I_kwDOGg_XLc5mtltz", "number": 1285, "title": "Dragonfly is about 10x slower than Redis when used by JuiceFS", "user": {"login": "zhijian-pro", "id": 31313340, "node_id": "MDQ6VXNlcjMxMzEzMzQw", "avatar_url": "https://avatars.githubusercontent.com/u/31313340?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zhijian-pro", "html_url": "https://github.com/zhijian-pro", "followers_url": "https://api.github.com/users/zhijian-pro/followers", "following_url": "https://api.github.com/users/zhijian-pro/following{/other_user}", "gists_url": "https://api.github.com/users/zhijian-pro/gists{/gist_id}", "starred_url": "https://api.github.com/users/zhijian-pro/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zhijian-pro/subscriptions", "organizations_url": "https://api.github.com/users/zhijian-pro/orgs", "repos_url": "https://api.github.com/users/zhijian-pro/repos", "events_url": "https://api.github.com/users/zhijian-pro/events{/privacy}", "received_events_url": "https://api.github.com/users/zhijian-pro/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 3632299438, "node_id": "LA_kwDOGg_XLc7YgH2u", "url": "https://api.github.com/repos/dragonflydb/dragonfly/labels/bug", "name": "bug", "color": "d73a4a", "default": true, "description": "Something isn't working"}], "state": "closed", "locked": false, "assignees": [{"login": "royjacobson", "id": 5706313, "node_id": "MDQ6VXNlcjU3MDYzMTM=", "avatar_url": "https://avatars.githubusercontent.com/u/5706313?v=4", "gravatar_id": "", "url": "https://api.github.com/users/royjacobson", "html_url": "https://github.com/royjacobson", "followers_url": "https://api.github.com/users/royjacobson/followers", "following_url": "https://api.github.com/users/royjacobson/following{/other_user}", "gists_url": "https://api.github.com/users/royjacobson/gists{/gist_id}", "starred_url": "https://api.github.com/users/royjacobson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/royjacobson/subscriptions", "organizations_url": "https://api.github.com/users/royjacobson/orgs", "repos_url": "https://api.github.com/users/royjacobson/repos", "events_url": "https://api.github.com/users/royjacobson/events{/privacy}", "received_events_url": "https://api.github.com/users/royjacobson/received_events", "type": "User", "user_view_type": "public", "site_admin": false}], "milestone": null, "comments": 27, "created_at": "2023-05-24T05:56:50Z", "updated_at": "2023-12-10T05:20:53Z", "closed_at": "2023-09-04T12:29:19Z", "assignee": {"login": "royjacobson", "id": 5706313, "node_id": "MDQ6VXNlcjU3MDYzMTM=", "avatar_url": "https://avatars.githubusercontent.com/u/5706313?v=4", "gravatar_id": "", "url": "https://api.github.com/users/royjacobson", "html_url": "https://github.com/royjacobson", "followers_url": "https://api.github.com/users/royjacobson/followers", "following_url": "https://api.github.com/users/royjacobson/following{/other_user}", "gists_url": "https://api.github.com/users/royjacobson/gists{/gist_id}", "starred_url": "https://api.github.com/users/royjacobson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/royjacobson/subscriptions", "organizations_url": "https://api.github.com/users/royjacobson/orgs", "repos_url": "https://api.github.com/users/royjacobson/repos", "events_url": "https://api.github.com/users/royjacobson/events{/privacy}", "received_events_url": "https://api.github.com/users/royjacobson/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "[JuiceFS](https://github.com/juicedata/juicefs) supports using redis as the metadata engine, and we had feedback from the community that they wanted to use dragonfly to replace redis, but after testing, I found that dragonfly is very unstable. It is about 10 times slower than the average redis latency.(calculated by the mean of the latency)  I'm not sure if it's my usage or dragonfly's own problem. I would like to ask for help to determine the cause.\r\n\r\nAs you can see on this graph, Dragonfly's performance is similar to that of Redis under normal circumstances, but there are often exceptionally slow requests, resulting in very large latency fluctuations.\r\n\r\n<img width=\"851\" alt=\"image\" src=\"https://github.com/dragonflydb/dragonfly/assets/31313340/abc1c3d5-94df-4ced-bcf4-7ff812002d89\">\r\n\r\n**To Reproduce**\r\n1. install dragonfly by binary, listen on 127.0.0.1:6378\r\n2. start dragonfly \r\n`./dragonfly --logtostderr  -dbnum 10 --bind 127.0.0.1 --port 6378`\r\n3. install redis by binary, listen on 127.0.0.1:6379\r\n1. install golang first\r\n   ```\r\n    wget https://go.dev/dl/go1.20.4.linux-amd64.tar.gz\r\n    rm -rf /usr/local/go && tar -C /usr/local -xzf go1.20.4.linux-amd64.tar.gz\r\n    export PATH=$PATH:/usr/local/go/bin\r\n   ```\r\n4. `git clone -b  test_for_dragonfly https://github.com/juicedata/juicefs.git && cd juicefs`\r\n5. `go mod tidy`\r\n6. test redis \r\n`addr=redis://127.0.0.1:6379/1 go test -count=1  -v  ./pkg/meta/... -run=TestDgfAndRedis`\r\n```\r\nroot@bench2:~/juicefs# addr=redis://127.0.0.1:6379/2 go test -count=1  -v  ./pkg/meta/... -run=TestDgfAndRedis\r\n=== RUN   TestDgfAndRedis\r\n2023/05/24 04:12:16.195448 juicefs[10992] <INFO>: Meta address: redis://127.0.0.1:6379/2 [interface.go:494]\r\n2023/05/24 04:12:16.196587 juicefs[10992] <INFO>: Ping redis latency: 97.831\u00b5s [redis.go:3523]\r\n2023/05/24 04:12:16.197723 juicefs[10992] <INFO>: Create session 1 OK with version: 1.1.0-dev+unknown [base.go:474]\r\n    benchmarks_test.go:673: number:  0: cost: 494 us\r\n    benchmarks_test.go:673: number:  1: cost: 523 us\r\n    benchmarks_test.go:673: number:  2: cost: 507 us\r\n    benchmarks_test.go:673: number:  3: cost: 493 us\r\n    benchmarks_test.go:673: number:  4: cost: 497 us\r\n    benchmarks_test.go:673: number:  5: cost: 555 us\r\n    benchmarks_test.go:673: number:  6: cost: 544 us\r\n    benchmarks_test.go:673: number:  7: cost: 514 us\r\n    benchmarks_test.go:673: number:  8: cost: 511 us\r\n    benchmarks_test.go:673: number:  9: cost: 524 us\r\n    benchmarks_test.go:673: number: 10: cost: 487 us\r\n    benchmarks_test.go:673: number: 11: cost: 485 us\r\n    benchmarks_test.go:673: number: 12: cost: 475 us\r\n    benchmarks_test.go:673: number: 13: cost: 477 us\r\n    benchmarks_test.go:673: number: 14: cost: 474 us\r\n    benchmarks_test.go:673: number: 15: cost: 484 us\r\n    benchmarks_test.go:673: number: 16: cost: 475 us\r\n    benchmarks_test.go:673: number: 17: cost: 509 us\r\n    benchmarks_test.go:673: number: 18: cost: 513 us\r\n    benchmarks_test.go:673: number: 19: cost: 477 us\r\n    benchmarks_test.go:673: number: 20: cost: 504 us\r\n    benchmarks_test.go:673: number: 21: cost: 486 us\r\n    benchmarks_test.go:673: number: 22: cost: 476 us\r\n    benchmarks_test.go:673: number: 23: cost: 475 us\r\n    benchmarks_test.go:673: number: 24: cost: 475 us\r\n    benchmarks_test.go:673: number: 25: cost: 528 us\r\n    benchmarks_test.go:673: number: 26: cost: 510 us\r\n    benchmarks_test.go:673: number: 27: cost: 488 us\r\n    benchmarks_test.go:673: number: 28: cost: 469 us\r\n    benchmarks_test.go:673: number: 29: cost: 469 us\r\n    benchmarks_test.go:673: number: 30: cost: 476 us\r\n    benchmarks_test.go:673: number: 31: cost: 470 us\r\n    benchmarks_test.go:673: number: 32: cost: 468 us\r\n    benchmarks_test.go:673: number: 33: cost: 474 us\r\n    benchmarks_test.go:673: number: 34: cost: 497 us\r\n    benchmarks_test.go:673: number: 35: cost: 522 us\r\n    benchmarks_test.go:673: number: 36: cost: 475 us\r\n    benchmarks_test.go:673: number: 37: cost: 469 us\r\n    benchmarks_test.go:673: number: 38: cost: 481 us\r\n    benchmarks_test.go:673: number: 39: cost: 479 us\r\n    benchmarks_test.go:673: number: 40: cost: 464 us\r\n    benchmarks_test.go:673: number: 41: cost: 495 us\r\n    benchmarks_test.go:673: number: 42: cost: 470 us\r\n    benchmarks_test.go:673: number: 43: cost: 478 us\r\n    benchmarks_test.go:673: number: 44: cost: 485 us\r\n    benchmarks_test.go:673: number: 45: cost: 595 us\r\n    benchmarks_test.go:673: number: 46: cost: 542 us\r\n    benchmarks_test.go:673: number: 47: cost: 514 us\r\n    benchmarks_test.go:673: number: 48: cost: 474 us\r\n    benchmarks_test.go:673: number: 49: cost: 484 us\r\n    benchmarks_test.go:673: number: 50: cost: 490 us\r\n    benchmarks_test.go:673: number: 51: cost: 490 us\r\n    benchmarks_test.go:673: number: 52: cost: 478 us\r\n    benchmarks_test.go:673: number: 53: cost: 493 us\r\n    benchmarks_test.go:673: number: 54: cost: 491 us\r\n    benchmarks_test.go:673: number: 55: cost: 541 us\r\n    benchmarks_test.go:673: number: 56: cost: 489 us\r\n    benchmarks_test.go:673: number: 57: cost: 487 us\r\n    benchmarks_test.go:673: number: 58: cost: 480 us\r\n    benchmarks_test.go:673: number: 59: cost: 486 us\r\n    benchmarks_test.go:673: number: 60: cost: 491 us\r\n    benchmarks_test.go:673: number: 61: cost: 487 us\r\n    benchmarks_test.go:673: number: 62: cost: 484 us\r\n    benchmarks_test.go:673: number: 63: cost: 489 us\r\n    benchmarks_test.go:673: number: 64: cost: 493 us\r\n    benchmarks_test.go:673: number: 65: cost: 542 us\r\n    benchmarks_test.go:673: number: 66: cost: 492 us\r\n    benchmarks_test.go:673: number: 67: cost: 512 us\r\n    benchmarks_test.go:673: number: 68: cost: 493 us\r\n    benchmarks_test.go:673: number: 69: cost: 490 us\r\n    benchmarks_test.go:673: number: 70: cost: 492 us\r\n    benchmarks_test.go:673: number: 71: cost: 478 us\r\n    benchmarks_test.go:673: number: 72: cost: 494 us\r\n    benchmarks_test.go:673: number: 73: cost: 510 us\r\n    benchmarks_test.go:673: number: 74: cost: 512 us\r\n    benchmarks_test.go:673: number: 75: cost: 501 us\r\n    benchmarks_test.go:673: number: 76: cost: 475 us\r\n    benchmarks_test.go:673: number: 77: cost: 483 us\r\n    benchmarks_test.go:673: number: 78: cost: 481 us\r\n    benchmarks_test.go:673: number: 79: cost: 584 us\r\n    benchmarks_test.go:673: number: 80: cost: 486 us\r\n    benchmarks_test.go:673: number: 81: cost: 518 us\r\n    benchmarks_test.go:673: number: 82: cost: 521 us\r\n    benchmarks_test.go:673: number: 83: cost: 476 us\r\n    benchmarks_test.go:673: number: 84: cost: 570 us\r\n    benchmarks_test.go:673: number: 85: cost: 577 us\r\n    benchmarks_test.go:673: number: 86: cost: 479 us\r\n    benchmarks_test.go:673: number: 87: cost: 475 us\r\n    benchmarks_test.go:673: number: 88: cost: 501 us\r\n    benchmarks_test.go:673: number: 89: cost: 514 us\r\n    benchmarks_test.go:673: number: 90: cost: 485 us\r\n    benchmarks_test.go:673: number: 91: cost: 489 us\r\n    benchmarks_test.go:673: number: 92: cost: 516 us\r\n    benchmarks_test.go:673: number: 93: cost: 492 us\r\n    benchmarks_test.go:673: number: 94: cost: 501 us\r\n    benchmarks_test.go:673: number: 95: cost: 478 us\r\n    benchmarks_test.go:673: number: 96: cost: 473 us\r\n    benchmarks_test.go:673: number: 97: cost: 478 us\r\n    benchmarks_test.go:673: number: 98: cost: 577 us\r\n    benchmarks_test.go:673: number: 99: cost: 478 us\r\n    benchmarks_test.go:676: --------------------test redis://127.0.0.1:6379/2--------------------\r\n    benchmarks_test.go:677: mean: 497.02, standard deviation: 27.18\r\n--- PASS: TestDgfAndRedis (0.05s)\r\nPASS\r\nok  \tgithub.com/juicedata/juicefs/pkg/meta\t0.070s\r\n```\r\n8.  test dragonfly\r\n`addr=redis://127.0.0.1:6378/1 go test -count=1  -v  ./pkg/meta/... -run=TestDgfAndRedis`\r\n```\r\nroot@bench2:~/juicefs# addr=redis://127.0.0.1:6378/2 go test -count=1  -v  ./pkg/meta/... -run=TestDgfAndRedis\r\n=== RUN   TestDgfAndRedis\r\n2023/05/24 04:11:15.817867 juicefs[10886] <INFO>: Meta address: redis://127.0.0.1:6378/2 [interface.go:494]\r\n2023/05/24 04:11:15.819105 juicefs[10886] <INFO>: Ping redis latency: 86.584\u00b5s [redis.go:3523]\r\n2023/05/24 04:11:15.819355 juicefs[10886] <WARNING>: Existing volume will be overwrited: {\r\n  \"Name\": \"benchmarkAll\",\r\n  \"UUID\": \"\",\r\n  \"Storage\": \"\",\r\n  \"Bucket\": \"\",\r\n  \"BlockSize\": 0,\r\n  \"TrashDays\": 0\r\n} [config.go:96]\r\n2023/05/24 04:11:15.820231 juicefs[10886] <INFO>: Create session 2 OK with version: 1.1.0-dev+unknown [base.go:474]\r\n2023/05/24 04:11:15.820845 juicefs[10886] <WARNING>: unexpected error for lookup: ERR Error running script (call to 8526c64984678fc27f67f44755c8ba7dcdf7ea60): @user_script:12: script tried accessing undeclared key [redis.go:695]\r\n    benchmarks_test.go:673: number:  0: cost: 714 us\r\n    benchmarks_test.go:673: number:  1: cost: 716 us\r\n    benchmarks_test.go:673: number:  2: cost: 722 us\r\n    benchmarks_test.go:673: number:  3: cost: 732 us\r\n    benchmarks_test.go:673: number:  4: cost: 690 us\r\n    benchmarks_test.go:673: number:  5: cost: 698 us\r\n    benchmarks_test.go:673: number:  6: cost: 731 us\r\n    benchmarks_test.go:673: number:  7: cost: 673 us\r\n    benchmarks_test.go:673: number:  8: cost: 615 us\r\n    benchmarks_test.go:673: number:  9: cost: 714 us\r\n    benchmarks_test.go:673: number: 10: cost: 717 us\r\n    benchmarks_test.go:673: number: 11: cost: 700 us\r\n    benchmarks_test.go:673: number: 12: cost: 710 us\r\n    benchmarks_test.go:673: number: 13: cost: 6720 us\r\n    benchmarks_test.go:673: number: 14: cost: 43235 us\r\n    benchmarks_test.go:673: number: 15: cost: 692 us\r\n    benchmarks_test.go:673: number: 16: cost: 694 us\r\n    benchmarks_test.go:673: number: 17: cost: 698 us\r\n    benchmarks_test.go:673: number: 18: cost: 715 us\r\n    benchmarks_test.go:673: number: 19: cost: 733 us\r\n    benchmarks_test.go:673: number: 20: cost: 856 us\r\n    benchmarks_test.go:673: number: 21: cost: 717 us\r\n    benchmarks_test.go:673: number: 22: cost: 683 us\r\n    benchmarks_test.go:673: number: 23: cost: 672 us\r\n    benchmarks_test.go:673: number: 24: cost: 640 us\r\n    benchmarks_test.go:673: number: 25: cost: 726 us\r\n    benchmarks_test.go:673: number: 26: cost: 703 us\r\n    benchmarks_test.go:673: number: 27: cost: 709 us\r\n    benchmarks_test.go:673: number: 28: cost: 699 us\r\n    benchmarks_test.go:673: number: 29: cost: 2740 us\r\n    benchmarks_test.go:673: number: 30: cost: 43136 us\r\n    benchmarks_test.go:673: number: 31: cost: 705 us\r\n    benchmarks_test.go:673: number: 32: cost: 618 us\r\n    benchmarks_test.go:673: number: 33: cost: 708 us\r\n    benchmarks_test.go:673: number: 34: cost: 740 us\r\n    benchmarks_test.go:673: number: 35: cost: 713 us\r\n    benchmarks_test.go:673: number: 36: cost: 704 us\r\n    benchmarks_test.go:673: number: 37: cost: 676 us\r\n    benchmarks_test.go:673: number: 38: cost: 672 us\r\n    benchmarks_test.go:673: number: 39: cost: 696 us\r\n    benchmarks_test.go:673: number: 40: cost: 705 us\r\n    benchmarks_test.go:673: number: 41: cost: 715 us\r\n    benchmarks_test.go:673: number: 42: cost: 44201 us\r\n    benchmarks_test.go:673: number: 43: cost: 710 us\r\n    benchmarks_test.go:673: number: 44: cost: 698 us\r\n    benchmarks_test.go:673: number: 45: cost: 728 us\r\n    benchmarks_test.go:673: number: 46: cost: 667 us\r\n    benchmarks_test.go:673: number: 47: cost: 724 us\r\n    benchmarks_test.go:673: number: 48: cost: 723 us\r\n    benchmarks_test.go:673: number: 49: cost: 724 us\r\n    benchmarks_test.go:673: number: 50: cost: 739 us\r\n    benchmarks_test.go:673: number: 51: cost: 710 us\r\n    benchmarks_test.go:673: number: 52: cost: 702 us\r\n    benchmarks_test.go:673: number: 53: cost: 708 us\r\n    benchmarks_test.go:673: number: 54: cost: 678 us\r\n    benchmarks_test.go:673: number: 55: cost: 610 us\r\n    benchmarks_test.go:673: number: 56: cost: 709 us\r\n    benchmarks_test.go:673: number: 57: cost: 692 us\r\n    benchmarks_test.go:673: number: 58: cost: 690 us\r\n    benchmarks_test.go:673: number: 59: cost: 44570 us\r\n    benchmarks_test.go:673: number: 60: cost: 712 us\r\n    benchmarks_test.go:673: number: 61: cost: 708 us\r\n    benchmarks_test.go:673: number: 62: cost: 672 us\r\n    benchmarks_test.go:673: number: 63: cost: 638 us\r\n    benchmarks_test.go:673: number: 64: cost: 4791 us\r\n    benchmarks_test.go:673: number: 65: cost: 44406 us\r\n    benchmarks_test.go:673: number: 66: cost: 717 us\r\n    benchmarks_test.go:673: number: 67: cost: 605 us\r\n    benchmarks_test.go:673: number: 68: cost: 724 us\r\n    benchmarks_test.go:673: number: 69: cost: 710 us\r\n    benchmarks_test.go:673: number: 70: cost: 706 us\r\n    benchmarks_test.go:673: number: 71: cost: 705 us\r\n    benchmarks_test.go:673: number: 72: cost: 646 us\r\n    benchmarks_test.go:673: number: 73: cost: 679 us\r\n    benchmarks_test.go:673: number: 74: cost: 694 us\r\n    benchmarks_test.go:673: number: 75: cost: 699 us\r\n    benchmarks_test.go:673: number: 76: cost: 689 us\r\n    benchmarks_test.go:673: number: 77: cost: 44305 us\r\n    benchmarks_test.go:673: number: 78: cost: 760 us\r\n    benchmarks_test.go:673: number: 79: cost: 694 us\r\n    benchmarks_test.go:673: number: 80: cost: 716 us\r\n    benchmarks_test.go:673: number: 81: cost: 6768 us\r\n    benchmarks_test.go:673: number: 82: cost: 47010 us\r\n    benchmarks_test.go:673: number: 83: cost: 748 us\r\n    benchmarks_test.go:673: number: 84: cost: 2813 us\r\n    benchmarks_test.go:673: number: 85: cost: 728 us\r\n    benchmarks_test.go:673: number: 86: cost: 700 us\r\n    benchmarks_test.go:673: number: 87: cost: 705 us\r\n    benchmarks_test.go:673: number: 88: cost: 698 us\r\n    benchmarks_test.go:673: number: 89: cost: 645 us\r\n    benchmarks_test.go:673: number: 90: cost: 723 us\r\n    benchmarks_test.go:673: number: 91: cost: 691 us\r\n    benchmarks_test.go:673: number: 92: cost: 712 us\r\n    benchmarks_test.go:673: number: 93: cost: 721 us\r\n    benchmarks_test.go:673: number: 94: cost: 691 us\r\n    benchmarks_test.go:673: number: 95: cost: 669 us\r\n    benchmarks_test.go:673: number: 96: cost: 44559 us\r\n    benchmarks_test.go:673: number: 97: cost: 677 us\r\n    benchmarks_test.go:673: number: 98: cost: 680 us\r\n    benchmarks_test.go:673: number: 99: cost: 804 us\r\n    benchmarks_test.go:676: --------------------test redis://127.0.0.1:6378/2--------------------\r\n    benchmarks_test.go:677: mean: 4402.53, standard deviation: 11906.39\r\n--- PASS: TestDgfAndRedis (2.45s)\r\nPASS\r\nok  \tgithub.com/juicedata/juicefs/pkg/meta\t2.469s\r\n```\r\n\r\n**Expected behavior**\r\nPerformance on the same order of magnitude as redis or better\r\n\r\n\r\n**Environment (please complete the following information):**\r\n - OS: [ubuntu 20.04]\r\n - Kernel: \r\n Linux bench2 5.4.0-1029-aws #30-Ubuntu SMP Tue Oct 20 10:06:38 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux\r\n - Dragonfly Version:  \r\n dragonfly v1.3.0-f80afca9c23e2f30373437520a162c591eaa2005\r\n build time: 2023-05-18 07:11:31", "closed_by": {"login": "royjacobson", "id": 5706313, "node_id": "MDQ6VXNlcjU3MDYzMTM=", "avatar_url": "https://avatars.githubusercontent.com/u/5706313?v=4", "gravatar_id": "", "url": "https://api.github.com/users/royjacobson", "html_url": "https://github.com/royjacobson", "followers_url": "https://api.github.com/users/royjacobson/followers", "following_url": "https://api.github.com/users/royjacobson/following{/other_user}", "gists_url": "https://api.github.com/users/royjacobson/gists{/gist_id}", "starred_url": "https://api.github.com/users/royjacobson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/royjacobson/subscriptions", "organizations_url": "https://api.github.com/users/royjacobson/orgs", "repos_url": "https://api.github.com/users/royjacobson/repos", "events_url": "https://api.github.com/users/royjacobson/events{/privacy}", "received_events_url": "https://api.github.com/users/royjacobson/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/1285/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/1285/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/5139", "repository_url": "https://api.github.com/repos/dragonflydb/dragonfly", "labels_url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/5139/labels{/name}", "comments_url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/5139/comments", "events_url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/5139/events", "html_url": "https://github.com/dragonflydb/dragonfly/issues/5139", "id": 3067095079, "node_id": "I_kwDOGg_XLc620Cgn", "number": 5139, "title": "PUBSUB Messages Sent As Command Replies", "user": {"login": "esatterwhite", "id": 148561, "node_id": "MDQ6VXNlcjE0ODU2MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/148561?v=4", "gravatar_id": "", "url": "https://api.github.com/users/esatterwhite", "html_url": "https://github.com/esatterwhite", "followers_url": "https://api.github.com/users/esatterwhite/followers", "following_url": "https://api.github.com/users/esatterwhite/following{/other_user}", "gists_url": "https://api.github.com/users/esatterwhite/gists{/gist_id}", "starred_url": "https://api.github.com/users/esatterwhite/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/esatterwhite/subscriptions", "organizations_url": "https://api.github.com/users/esatterwhite/orgs", "repos_url": "https://api.github.com/users/esatterwhite/repos", "events_url": "https://api.github.com/users/esatterwhite/events{/privacy}", "received_events_url": "https://api.github.com/users/esatterwhite/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 3632299438, "node_id": "LA_kwDOGg_XLc7YgH2u", "url": "https://api.github.com/repos/dragonflydb/dragonfly/labels/bug", "name": "bug", "color": "d73a4a", "default": true, "description": "Something isn't working"}, {"id": 5646965188, "node_id": "LA_kwDOGg_XLc8AAAABUJXZxA", "url": "https://api.github.com/repos/dragonflydb/dragonfly/labels/Next%20Up", "name": "Next Up", "color": "1d76db", "default": false, "description": "task that is ready to be worked on and should be added to working queue"}], "state": "closed", "locked": false, "assignees": [{"login": "mkaruza", "id": 3676457, "node_id": "MDQ6VXNlcjM2NzY0NTc=", "avatar_url": "https://avatars.githubusercontent.com/u/3676457?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mkaruza", "html_url": "https://github.com/mkaruza", "followers_url": "https://api.github.com/users/mkaruza/followers", "following_url": "https://api.github.com/users/mkaruza/following{/other_user}", "gists_url": "https://api.github.com/users/mkaruza/gists{/gist_id}", "starred_url": "https://api.github.com/users/mkaruza/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mkaruza/subscriptions", "organizations_url": "https://api.github.com/users/mkaruza/orgs", "repos_url": "https://api.github.com/users/mkaruza/repos", "events_url": "https://api.github.com/users/mkaruza/events{/privacy}", "received_events_url": "https://api.github.com/users/mkaruza/received_events", "type": "User", "user_view_type": "public", "site_admin": false}], "milestone": null, "comments": 25, "created_at": "2025-05-15T18:35:30Z", "updated_at": "2025-06-12T12:56:41Z", "closed_at": "2025-06-12T06:38:41Z", "assignee": {"login": "mkaruza", "id": 3676457, "node_id": "MDQ6VXNlcjM2NzY0NTc=", "avatar_url": "https://avatars.githubusercontent.com/u/3676457?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mkaruza", "html_url": "https://github.com/mkaruza", "followers_url": "https://api.github.com/users/mkaruza/followers", "following_url": "https://api.github.com/users/mkaruza/following{/other_user}", "gists_url": "https://api.github.com/users/mkaruza/gists{/gist_id}", "starred_url": "https://api.github.com/users/mkaruza/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mkaruza/subscriptions", "organizations_url": "https://api.github.com/users/mkaruza/orgs", "repos_url": "https://api.github.com/users/mkaruza/repos", "events_url": "https://api.github.com/users/mkaruza/events{/privacy}", "received_events_url": "https://api.github.com/users/mkaruza/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "**Describe the bug**\nWe are running into situations where we are seeing pubsub messages being sent to a client as a reply to a command, which of course it has no knowledge of cause errors to be thrown and the parent process to crash\n\n#### Normal Case\n\n```txl\n--- \nCOMMAND FOUND\n\nLAST COMMAND:  {\n  command: Command {\n    name: 'unsubscribe',\n    inTransaction: false,\n    isResolved: false,\n    transformed: true,\n    replyEncoding: 'utf8',\n    errorStack: undefined,\n    args: [ 'auth-provider-service' ],\n    callback: undefined,\n    resolve: [Function (anonymous)],\n    reject: [Function (anonymous)],\n    promise: Promise {\n      <pending>,\n      [Symbol(async_id_symbol)]: 35633,\n      [Symbol(trigger_async_id_symbol)]: 35578\n    }\n  },\n  stream: undefined,\n  select: 0\n}\n\nCURRENT REPLY unsubscribe,auth-provider-service,0\n---\n```\n\n#### Error Case\n\n```txl\n\n--- \nNO Command Found\n\nLAST Command:  {\n  command: Command {\n    name: 'unsubscribe',\n    inTransaction: false,\n    isResolved: true,\n    transformed: true,\n    replyEncoding: 'utf8',\n    errorStack: undefined,\n    args: [ 'auth-provider-service' ],\n    callback: undefined,\n    resolve: [Function (anonymous)],\n    reject: [Function (anonymous)],\n    promise: Promise {\n      0,\n      [Symbol(async_id_symbol)]: 9614,\n      [Symbol(trigger_async_id_symbol)]: 9559\n    }\n  },\n  stream: undefined,\n  select: 0\n}\n\nCURRENT REPLY message,auth-provider-service,[\"cache_purge\",\"682618652697514c436c5b61:AuthUser:auth-provider-service:0\", \"_id\":\"682618652697514c436c5b61\",\"email\":\"novella.okuneva@yahoo.com\",\"externalids\":],\"password\":\"5Kraig97\",\"salt\":\"404b3dbdc6\",\"permissionsMeta\":[],\"enterprise_permissions\":[],\"enterprise_ids\":[],\"enterprise_member\":[],\"groups\":[],\"firstname\":\"Robert\",\"lastname\":\"Cremin\",\"accounts\":[\"a3e5c12368\"],\"ip\":\"225.908.218.3\",\"ua\":\"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/38.0.2125.111 Safari/537.36\",\"isbanned\":false,\"otp\":{\"backupCodes\":[]},\"deactivated\":[],\"auth_roles\":[],\"auth_permissions\":[],\"_created\":\"2025-05-15T16:37:57.220Z\",\"_modified\":\"2025-05-15T16:37:57.220Z\",\"__v\":0,\"user_id\":\"682618652697514c436c5b61\",\"roles\":[],\"permissions\":[],\"pk\":\"682618652697514c436c5b61\",\"type\":\"user\",\"id\":\"682618652697514c436c5b61\"}]\n---\n```\n\n\n**To Reproduce**\nWe haven't been able to reproduce this in small or isolated setups. It happens in our larger applications and integration test.\nIt seems to be fairly consistent during our shutdown routines that will unsubscribe from a channel before issuing a `QUIT` command. The `quit` and `unsubscribe` are the only commands that show up in these errors\n\n**Expected behavior**\nPubSub messages should not be sent as replies to normal commands\n\n\n**Environment (please complete the following information):**\n - OS: Arch Linux \n - Kernel: `Linux 5.10.235-1-MANJARO #1 SMP PREEMPT Fri Mar 28 09:51:32 UTC 2025 x86_64 GNU/Linux`\n - Containerized?: Docker (dragonfly official image)\n - Dragonfly Version: 1.29.0\n\n\n**Additional context**\nWe have migrated from redis, to keydb and now migrating from keydb to dragonfly. Aside from swapping the severs, nothing about our applications have changed, and dragon fly is the only one to have this problem. It seems like when a client issues a quit command, dragonfly is sending messages to the wrong client as replies rather than a message. Generally setting io threads to 1 will silence the problem which suggests there may be some cross talk between threads in particular when a client connection quits / drops.\n\nOur applications have 2 active connections. 1 for subscribing to a channel, and 1 for publishing to that channel in addition to issuing regular commands. \n\nOr test suites run several ( 3-5 ) processes in parallel. each process is an in instance of the application creating its own connections, and publishing and subscribing to the same pubsub channel name.\n\nWe are running Node.JS w/ IORedis as the driver. I'm not sure how helpful it is, but we are getting to this point in the driver code \n\nhttps://github.com/redis/ioredis/blob/40ae7ee6348a833b6dbb55187e352bd3eca13255/lib/DataHandler.ts#L235-L238\n\n\n> Command queue state error. If you can reproduce this, please report it", "closed_by": {"login": "mkaruza", "id": 3676457, "node_id": "MDQ6VXNlcjM2NzY0NTc=", "avatar_url": "https://avatars.githubusercontent.com/u/3676457?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mkaruza", "html_url": "https://github.com/mkaruza", "followers_url": "https://api.github.com/users/mkaruza/followers", "following_url": "https://api.github.com/users/mkaruza/following{/other_user}", "gists_url": "https://api.github.com/users/mkaruza/gists{/gist_id}", "starred_url": "https://api.github.com/users/mkaruza/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mkaruza/subscriptions", "organizations_url": "https://api.github.com/users/mkaruza/orgs", "repos_url": "https://api.github.com/users/mkaruza/repos", "events_url": "https://api.github.com/users/mkaruza/events{/privacy}", "received_events_url": "https://api.github.com/users/mkaruza/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/5139/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/5139/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/2465", "repository_url": "https://api.github.com/repos/dragonflydb/dragonfly", "labels_url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/2465/labels{/name}", "comments_url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/2465/comments", "events_url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/2465/events", "html_url": "https://github.com/dragonflydb/dragonfly/issues/2465", "id": 2097838473, "node_id": "I_kwDOGg_XLc59CnmJ", "number": 2465, "title": "Periodic crash on new version", "user": {"login": "Object905", "id": 6928530, "node_id": "MDQ6VXNlcjY5Mjg1MzA=", "avatar_url": "https://avatars.githubusercontent.com/u/6928530?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Object905", "html_url": "https://github.com/Object905", "followers_url": "https://api.github.com/users/Object905/followers", "following_url": "https://api.github.com/users/Object905/following{/other_user}", "gists_url": "https://api.github.com/users/Object905/gists{/gist_id}", "starred_url": "https://api.github.com/users/Object905/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Object905/subscriptions", "organizations_url": "https://api.github.com/users/Object905/orgs", "repos_url": "https://api.github.com/users/Object905/repos", "events_url": "https://api.github.com/users/Object905/events{/privacy}", "received_events_url": "https://api.github.com/users/Object905/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 3632299438, "node_id": "LA_kwDOGg_XLc7YgH2u", "url": "https://api.github.com/repos/dragonflydb/dragonfly/labels/bug", "name": "bug", "color": "d73a4a", "default": true, "description": "Something isn't working"}, {"id": 5489742613, "node_id": "LA_kwDOGg_XLc8AAAABRzbTFQ", "url": "https://api.github.com/repos/dragonflydb/dragonfly/labels/urgent", "name": "urgent", "color": "cc0000", "default": false, "description": "Important issue that needs to be fixed asap"}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 24, "created_at": "2024-01-24T09:36:28Z", "updated_at": "2024-01-25T16:40:10Z", "closed_at": "2024-01-25T09:51:48Z", "assignee": null, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "**Describe the bug**\r\nDragonfly infrequently crashes.\r\nI've been using v1.11.0 before this, because after upgrade to v1.13 it crashed right away. While upgrade to v1.14.0 was somewhat successful.\r\nDon't really know how to debug this issue to find reproducible example. Suggestions are welcome.\r\n\r\n**To Reproduce**\r\nNot able to reproduce consistently. But this happened to me 2 times, since latest release (roughly once per day). \r\n\r\n**Expected behavior**\r\nNo crashes\r\n\r\n**Environment (please complete the following information):**\r\n - OS: ubuntu 22.04\r\n - Kernel: `Linux cache 5.15.0-87-generic #97-Ubuntu SMP Mon Oct 2 21:09:21 UTC 2023 x86_64 x86_64 x86_64 GNU/Linux`\r\n - Kubernetes, helm chart, single instance \r\n - Dragonfly Version: v1.14.0\r\n\r\n**Additional context**\r\n\r\nClients:\r\nDjango default cache\r\nhttps://github.com/Suor/django-cacheops\r\nhttps://github.com/ionelmc/python-redis-lock\r\n\r\nHelm config\r\n```\r\nextraArgs: [\r\n    \"--cache_mode\",\r\n    \"--tcp_nodelay\",\r\n    \"--default_lua_flags\",\r\n    \"allow-undeclared-keys\",\r\n    \"--dbfilename\",\r\n    \"\",\r\n    \"--pipeline_squash\",\r\n    \"0\",\r\n    \"--requirepass\",\r\n    \"*****\",\r\n  ]\r\n```\r\n\r\nLogs/Traceback\r\n```\r\n* Logs will be written to the first available of the following paths:\r\n/tmp/dragonfly.*\r\n./dragonfly.*\r\n* For the available flags type dragonfly [--help | --helpfull]\r\n* Documentation can be found at: https://www.dragonflydb.io/docs\r\nI20240123 16:19:40.417032     1 init.cc:70] dragonfly running in opt mode.\r\nI20240123 16:19:40.417266     1 dfly_main.cc:621] Starting dragonfly df-v1.14.0-cdbeb2f6c23d2e2310f902b41ac9b79b7bd6660d\r\nI20240123 16:19:40.417484     1 dfly_main.cc:665] maxmemory has not been specified. Deciding myself....\r\nI20240123 16:19:40.417495     1 dfly_main.cc:674] Found 18.25GiB available memory. Setting maxmemory to 14.60GiB\r\nI20240123 16:19:40.421366     8 uring_proactor.cc:154] IORing with 1024 entries, allocated 102720 bytes, cq_entries is 2048\r\nI20240123 16:19:40.496001     1 proactor_pool.cc:146] Running 4 io threads\r\nI20240123 16:19:40.519909     1 server_family.cc:645] Host OS: Linux 5.15.0-87-generic x86_64 with 4 threads\r\nI20240123 16:19:40.529071     9 listener_interface.cc:101] sock[11] AcceptServer - listening on port 6379\r\nF20240124 09:04:44.593178     8 compact_object.cc:1015] Check failed: 0U == u_.r_obj.type() (0 vs. 2)\r\n*** Check failure stack trace: ***\r\n    @     0x55c4036619f3  google::LogMessage::SendToLog()\r\n    @     0x55c40365a1b7  google::LogMessage::Flush()\r\n    @     0x55c40365bb3f  google::LogMessageFatal::~LogMessageFatal()\r\n    @     0x55c402f7ca1f  dfly::CompactObj::GetString()\r\n    @     0x55c402e1e0f3  dfly::(anonymous namespace)::OpMGet()\r\n    @     0x55c402e1e362  _ZN4absl12lts_2023080219functional_internal12InvokeObjectIZN4dfly12StringFamily4MGetENS0_4SpanINS5_IcEEEEPNS3_17ConnectionContextEEUlPNS3_11TransactionEPNS3_11EngineShardEE_NSA_14RunnableResultEJSB_SD_EEET0_NS1_7VoidPtrEDpNS1_8ForwardTIT1_E4typeE\r\n    @     0x55c402f624b9  dfly::Transaction::RunInShard()\r\n    @     0x55c402e92235  dfly::EngineShard::PollExecution()\r\n    @     0x55c402f5d32f  _ZNSt17_Function_handlerIFvvEZN4dfly11Transaction12ExecuteAsyncEvEUlvE0_E9_M_invokeERKSt9_Any_data\r\n    @     0x55c403465a8a  util::fb2::FiberQueue::Run()\r\n    @     0x55c402e8ea9e  _ZN5boost7context6detail11fiber_entryINS1_12fiber_recordINS0_5fiberENS0_21basic_fixedsize_stackINS0_12stack_traitsEEEZN4util3fb26detail15WorkerFiberImplIZN4dfly11EngineShardC4EPNS9_12ProactorBaseEP9mi_heap_sEUlvE0_JEEC4IS7_EESt17basic_string_viewIcSt11char_traitsIcEERKNS0_12preallocatedEOT_OSI_EUlOS4_E_EEEEvNS1_10transfer_tE\r\n    @     0x55c40347edaf  make_fcontext\r\n*** SIGABRT received at time=1706087084 on cpu 0 ***\r\nPC: @     0x7f46ae3ed00b  (unknown)  raise\r\n[failure_signal_handler.cc : 345] RAW: Signal 11 raised at PC=0x7f46ae3cc941 while already in AbslFailureSignalHandler()\r\n*** SIGSEGV received at time=1706087084 on cpu 0 ***\r\nPC: @     0x7f46ae3cc941  (unknown)  abort\r\n```\r\n", "closed_by": {"login": "romange", "id": 3674760, "node_id": "MDQ6VXNlcjM2NzQ3NjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3674760?v=4", "gravatar_id": "", "url": "https://api.github.com/users/romange", "html_url": "https://github.com/romange", "followers_url": "https://api.github.com/users/romange/followers", "following_url": "https://api.github.com/users/romange/following{/other_user}", "gists_url": "https://api.github.com/users/romange/gists{/gist_id}", "starred_url": "https://api.github.com/users/romange/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/romange/subscriptions", "organizations_url": "https://api.github.com/users/romange/orgs", "repos_url": "https://api.github.com/users/romange/repos", "events_url": "https://api.github.com/users/romange/events{/privacy}", "received_events_url": "https://api.github.com/users/romange/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/2465/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/2465/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/1908", "repository_url": "https://api.github.com/repos/dragonflydb/dragonfly", "labels_url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/1908/labels{/name}", "comments_url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/1908/comments", "events_url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/1908/events", "html_url": "https://github.com/dragonflydb/dragonfly/pull/1908", "id": 1905960177, "node_id": "PR_kwDOGg_XLc5a1dwp", "number": 1908, "title": "bug(streams): fixing xreadgroup's behavior to be compatible with Redis", "user": {"login": "theyueli", "id": 61070669, "node_id": "MDQ6VXNlcjYxMDcwNjY5", "avatar_url": "https://avatars.githubusercontent.com/u/61070669?v=4", "gravatar_id": "", "url": "https://api.github.com/users/theyueli", "html_url": "https://github.com/theyueli", "followers_url": "https://api.github.com/users/theyueli/followers", "following_url": "https://api.github.com/users/theyueli/following{/other_user}", "gists_url": "https://api.github.com/users/theyueli/gists{/gist_id}", "starred_url": "https://api.github.com/users/theyueli/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/theyueli/subscriptions", "organizations_url": "https://api.github.com/users/theyueli/orgs", "repos_url": "https://api.github.com/users/theyueli/repos", "events_url": "https://api.github.com/users/theyueli/events{/privacy}", "received_events_url": "https://api.github.com/users/theyueli/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 3632299438, "node_id": "LA_kwDOGg_XLc7YgH2u", "url": "https://api.github.com/repos/dragonflydb/dragonfly/labels/bug", "name": "bug", "color": "d73a4a", "default": true, "description": "Something isn't working"}], "state": "closed", "locked": false, "assignees": [{"login": "theyueli", "id": 61070669, "node_id": "MDQ6VXNlcjYxMDcwNjY5", "avatar_url": "https://avatars.githubusercontent.com/u/61070669?v=4", "gravatar_id": "", "url": "https://api.github.com/users/theyueli", "html_url": "https://github.com/theyueli", "followers_url": "https://api.github.com/users/theyueli/followers", "following_url": "https://api.github.com/users/theyueli/following{/other_user}", "gists_url": "https://api.github.com/users/theyueli/gists{/gist_id}", "starred_url": "https://api.github.com/users/theyueli/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/theyueli/subscriptions", "organizations_url": "https://api.github.com/users/theyueli/orgs", "repos_url": "https://api.github.com/users/theyueli/repos", "events_url": "https://api.github.com/users/theyueli/events{/privacy}", "received_events_url": "https://api.github.com/users/theyueli/received_events", "type": "User", "user_view_type": "public", "site_admin": false}], "milestone": null, "comments": 2, "created_at": "2023-09-21T02:14:07Z", "updated_at": "2023-09-27T13:45:29Z", "closed_at": "2023-09-24T09:32:43Z", "assignee": {"login": "theyueli", "id": 61070669, "node_id": "MDQ6VXNlcjYxMDcwNjY5", "avatar_url": "https://avatars.githubusercontent.com/u/61070669?v=4", "gravatar_id": "", "url": "https://api.github.com/users/theyueli", "html_url": "https://github.com/theyueli", "followers_url": "https://api.github.com/users/theyueli/followers", "following_url": "https://api.github.com/users/theyueli/following{/other_user}", "gists_url": "https://api.github.com/users/theyueli/gists{/gist_id}", "starred_url": "https://api.github.com/users/theyueli/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/theyueli/subscriptions", "organizations_url": "https://api.github.com/users/theyueli/orgs", "repos_url": "https://api.github.com/users/theyueli/repos", "events_url": "https://api.github.com/users/theyueli/events{/privacy}", "received_events_url": "https://api.github.com/users/theyueli/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "author_association": "CONTRIBUTOR", "type": null, "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/dragonflydb/dragonfly/pulls/1908", "html_url": "https://github.com/dragonflydb/dragonfly/pull/1908", "diff_url": "https://github.com/dragonflydb/dragonfly/pull/1908.diff", "patch_url": "https://github.com/dragonflydb/dragonfly/pull/1908.patch", "merged_at": "2023-09-24T09:32:43Z"}, "body": "fixes https://github.com/dragonflydb/dragonfly/issues/1860\r\n\r\nTherefore, now:\r\n\r\n```\r\n127.0.0.1:6379> flushdb\r\nOK\r\n127.0.0.1:6379> \"XREADGROUP\" \"GROUP\" group consumer COUNT 10 BLOCK 5000 STREAMS stream >\r\n(error) NOGROUP No such key 'stream' or consumer group 'group' in XREADGROUP with GROUP option\r\n```\r\n\r\n(used to block for 5 seconds..)\r\n\r\nand\r\n\r\n```\r\n127.0.0.1:6379> flushdb\r\nOK\r\n127.0.0.1:6379> \"XGROUP\" \"CREATE\" stream group \"0\" MKSTREAM\r\nOK\r\n127.0.0.1:6379> keys *\r\n1) \"stream\"\r\n127.0.0.1:6379> \"XREADGROUP\" \"GROUP\" group consumer COUNT 10 BLOCK 5000 STREAMS stream >\r\n(nil)\r\n(5.02s)\r\n```\r\n(used to return immediately without blocking)", "closed_by": {"login": "theyueli", "id": 61070669, "node_id": "MDQ6VXNlcjYxMDcwNjY5", "avatar_url": "https://avatars.githubusercontent.com/u/61070669?v=4", "gravatar_id": "", "url": "https://api.github.com/users/theyueli", "html_url": "https://github.com/theyueli", "followers_url": "https://api.github.com/users/theyueli/followers", "following_url": "https://api.github.com/users/theyueli/following{/other_user}", "gists_url": "https://api.github.com/users/theyueli/gists{/gist_id}", "starred_url": "https://api.github.com/users/theyueli/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/theyueli/subscriptions", "organizations_url": "https://api.github.com/users/theyueli/orgs", "repos_url": "https://api.github.com/users/theyueli/repos", "events_url": "https://api.github.com/users/theyueli/events{/privacy}", "received_events_url": "https://api.github.com/users/theyueli/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/1908/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/1908/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/3719", "repository_url": "https://api.github.com/repos/dragonflydb/dragonfly", "labels_url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/3719/labels{/name}", "comments_url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/3719/comments", "events_url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/3719/events", "html_url": "https://github.com/dragonflydb/dragonfly/issues/3719", "id": 2529299212, "node_id": "I_kwDOGg_XLc6WwgsM", "number": 3719, "title": "test failed acl_family_test.py::test_acl_cat_commands_multi_exec_squash", "user": {"login": "adiholden", "id": 117041239, "node_id": "U_kgDOBvnoVw", "avatar_url": "https://avatars.githubusercontent.com/u/117041239?v=4", "gravatar_id": "", "url": "https://api.github.com/users/adiholden", "html_url": "https://github.com/adiholden", "followers_url": "https://api.github.com/users/adiholden/followers", "following_url": "https://api.github.com/users/adiholden/following{/other_user}", "gists_url": "https://api.github.com/users/adiholden/gists{/gist_id}", "starred_url": "https://api.github.com/users/adiholden/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/adiholden/subscriptions", "organizations_url": "https://api.github.com/users/adiholden/orgs", "repos_url": "https://api.github.com/users/adiholden/repos", "events_url": "https://api.github.com/users/adiholden/events{/privacy}", "received_events_url": "https://api.github.com/users/adiholden/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 3632299438, "node_id": "LA_kwDOGg_XLc7YgH2u", "url": "https://api.github.com/repos/dragonflydb/dragonfly/labels/bug", "name": "bug", "color": "d73a4a", "default": true, "description": "Something isn't working"}, {"id": 6711446102, "node_id": "LA_kwDOGg_XLc8AAAABkAiKVg", "url": "https://api.github.com/repos/dragonflydb/dragonfly/labels/failing-test", "name": "failing-test", "color": "d4c5f9", "default": false, "description": ""}, {"id": 8075601580, "node_id": "LA_kwDOGg_XLc8AAAAB4VfmrA", "url": "https://api.github.com/repos/dragonflydb/dragonfly/labels/epoll", "name": "epoll", "color": "d4c5f9", "default": false, "description": "epoll backend"}], "state": "closed", "locked": false, "assignees": [{"login": "kostasrim", "id": 11015979, "node_id": "MDQ6VXNlcjExMDE1OTc5", "avatar_url": "https://avatars.githubusercontent.com/u/11015979?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kostasrim", "html_url": "https://github.com/kostasrim", "followers_url": "https://api.github.com/users/kostasrim/followers", "following_url": "https://api.github.com/users/kostasrim/following{/other_user}", "gists_url": "https://api.github.com/users/kostasrim/gists{/gist_id}", "starred_url": "https://api.github.com/users/kostasrim/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kostasrim/subscriptions", "organizations_url": "https://api.github.com/users/kostasrim/orgs", "repos_url": "https://api.github.com/users/kostasrim/repos", "events_url": "https://api.github.com/users/kostasrim/events{/privacy}", "received_events_url": "https://api.github.com/users/kostasrim/received_events", "type": "User", "user_view_type": "public", "site_admin": false}], "milestone": null, "comments": 23, "created_at": "2024-09-16T19:28:49Z", "updated_at": "2025-09-22T08:22:27Z", "closed_at": "2025-09-22T08:22:27Z", "assignee": {"login": "kostasrim", "id": 11015979, "node_id": "MDQ6VXNlcjExMDE1OTc5", "avatar_url": "https://avatars.githubusercontent.com/u/11015979?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kostasrim", "html_url": "https://github.com/kostasrim", "followers_url": "https://api.github.com/users/kostasrim/followers", "following_url": "https://api.github.com/users/kostasrim/following{/other_user}", "gists_url": "https://api.github.com/users/kostasrim/gists{/gist_id}", "starred_url": "https://api.github.com/users/kostasrim/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kostasrim/subscriptions", "organizations_url": "https://api.github.com/users/kostasrim/orgs", "repos_url": "https://api.github.com/users/kostasrim/repos", "events_url": "https://api.github.com/users/kostasrim/events{/privacy}", "received_events_url": "https://api.github.com/users/kostasrim/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "author_association": "CONTRIBUTOR", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "https://github.com/dragonflydb/dragonfly/actions/runs/10875338908/job/30173649023", "closed_by": {"login": "abhijat", "id": 462313, "node_id": "MDQ6VXNlcjQ2MjMxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/462313?v=4", "gravatar_id": "", "url": "https://api.github.com/users/abhijat", "html_url": "https://github.com/abhijat", "followers_url": "https://api.github.com/users/abhijat/followers", "following_url": "https://api.github.com/users/abhijat/following{/other_user}", "gists_url": "https://api.github.com/users/abhijat/gists{/gist_id}", "starred_url": "https://api.github.com/users/abhijat/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/abhijat/subscriptions", "organizations_url": "https://api.github.com/users/abhijat/orgs", "repos_url": "https://api.github.com/users/abhijat/repos", "events_url": "https://api.github.com/users/abhijat/events{/privacy}", "received_events_url": "https://api.github.com/users/abhijat/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/3719/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/3719/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/4526", "repository_url": "https://api.github.com/repos/dragonflydb/dragonfly", "labels_url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/4526/labels{/name}", "comments_url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/4526/comments", "events_url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/4526/events", "html_url": "https://github.com/dragonflydb/dragonfly/issues/4526", "id": 2818254482, "node_id": "I_kwDOGg_XLc6n-yaS", "number": 4526, "title": "TLS Handshake Error: \"wrong version number\" with --tls", "user": {"login": "jahnavilatha589", "id": 39006146, "node_id": "MDQ6VXNlcjM5MDA2MTQ2", "avatar_url": "https://avatars.githubusercontent.com/u/39006146?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jahnavilatha589", "html_url": "https://github.com/jahnavilatha589", "followers_url": "https://api.github.com/users/jahnavilatha589/followers", "following_url": "https://api.github.com/users/jahnavilatha589/following{/other_user}", "gists_url": "https://api.github.com/users/jahnavilatha589/gists{/gist_id}", "starred_url": "https://api.github.com/users/jahnavilatha589/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jahnavilatha589/subscriptions", "organizations_url": "https://api.github.com/users/jahnavilatha589/orgs", "repos_url": "https://api.github.com/users/jahnavilatha589/repos", "events_url": "https://api.github.com/users/jahnavilatha589/events{/privacy}", "received_events_url": "https://api.github.com/users/jahnavilatha589/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 3632299438, "node_id": "LA_kwDOGg_XLc7YgH2u", "url": "https://api.github.com/repos/dragonflydb/dragonfly/labels/bug", "name": "bug", "color": "d73a4a", "default": true, "description": "Something isn't working"}], "state": "closed", "locked": false, "assignees": [{"login": "kostasrim", "id": 11015979, "node_id": "MDQ6VXNlcjExMDE1OTc5", "avatar_url": "https://avatars.githubusercontent.com/u/11015979?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kostasrim", "html_url": "https://github.com/kostasrim", "followers_url": "https://api.github.com/users/kostasrim/followers", "following_url": "https://api.github.com/users/kostasrim/following{/other_user}", "gists_url": "https://api.github.com/users/kostasrim/gists{/gist_id}", "starred_url": "https://api.github.com/users/kostasrim/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kostasrim/subscriptions", "organizations_url": "https://api.github.com/users/kostasrim/orgs", "repos_url": "https://api.github.com/users/kostasrim/repos", "events_url": "https://api.github.com/users/kostasrim/events{/privacy}", "received_events_url": "https://api.github.com/users/kostasrim/received_events", "type": "User", "user_view_type": "public", "site_admin": false}], "milestone": null, "comments": 22, "created_at": "2025-01-29T13:40:08Z", "updated_at": "2025-02-12T10:34:48Z", "closed_at": "2025-02-12T10:34:08Z", "assignee": {"login": "kostasrim", "id": 11015979, "node_id": "MDQ6VXNlcjExMDE1OTc5", "avatar_url": "https://avatars.githubusercontent.com/u/11015979?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kostasrim", "html_url": "https://github.com/kostasrim", "followers_url": "https://api.github.com/users/kostasrim/followers", "following_url": "https://api.github.com/users/kostasrim/following{/other_user}", "gists_url": "https://api.github.com/users/kostasrim/gists{/gist_id}", "starred_url": "https://api.github.com/users/kostasrim/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kostasrim/subscriptions", "organizations_url": "https://api.github.com/users/kostasrim/orgs", "repos_url": "https://api.github.com/users/kostasrim/repos", "events_url": "https://api.github.com/users/kostasrim/events{/privacy}", "received_events_url": "https://api.github.com/users/kostasrim/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "I started Dragonfly with the flags --tls, --tls_key_file, and --tls_cert_file, but after the server starts, the following log message keeps appearing repeatedly.\n**W20250129 15:59:21.307173 1357310 dragonfly_connection.cc:696] Error handshaking error:1408F10B:SSL routines:ssl3_get_record:wrong version number** \n\nDoes DragonflyDB support specific TLS versions, and do I need to configure them explicitly?", "closed_by": {"login": "kostasrim", "id": 11015979, "node_id": "MDQ6VXNlcjExMDE1OTc5", "avatar_url": "https://avatars.githubusercontent.com/u/11015979?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kostasrim", "html_url": "https://github.com/kostasrim", "followers_url": "https://api.github.com/users/kostasrim/followers", "following_url": "https://api.github.com/users/kostasrim/following{/other_user}", "gists_url": "https://api.github.com/users/kostasrim/gists{/gist_id}", "starred_url": "https://api.github.com/users/kostasrim/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kostasrim/subscriptions", "organizations_url": "https://api.github.com/users/kostasrim/orgs", "repos_url": "https://api.github.com/users/kostasrim/repos", "events_url": "https://api.github.com/users/kostasrim/events{/privacy}", "received_events_url": "https://api.github.com/users/kostasrim/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/4526/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/4526/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/2454", "repository_url": "https://api.github.com/repos/dragonflydb/dragonfly", "labels_url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/2454/labels{/name}", "comments_url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/2454/comments", "events_url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/2454/events", "html_url": "https://github.com/dragonflydb/dragonfly/issues/2454", "id": 2093341453, "node_id": "I_kwDOGg_XLc58xdsN", "number": 2454, "title": "Incompatibility between DragonflyDB and redis/rueidis client", "user": {"login": "thisismz", "id": 25848626, "node_id": "MDQ6VXNlcjI1ODQ4NjI2", "avatar_url": "https://avatars.githubusercontent.com/u/25848626?v=4", "gravatar_id": "", "url": "https://api.github.com/users/thisismz", "html_url": "https://github.com/thisismz", "followers_url": "https://api.github.com/users/thisismz/followers", "following_url": "https://api.github.com/users/thisismz/following{/other_user}", "gists_url": "https://api.github.com/users/thisismz/gists{/gist_id}", "starred_url": "https://api.github.com/users/thisismz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/thisismz/subscriptions", "organizations_url": "https://api.github.com/users/thisismz/orgs", "repos_url": "https://api.github.com/users/thisismz/repos", "events_url": "https://api.github.com/users/thisismz/events{/privacy}", "received_events_url": "https://api.github.com/users/thisismz/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 3632299438, "node_id": "LA_kwDOGg_XLc7YgH2u", "url": "https://api.github.com/repos/dragonflydb/dragonfly/labels/bug", "name": "bug", "color": "d73a4a", "default": true, "description": "Something isn't working"}], "state": "closed", "locked": false, "assignees": [{"login": "kostasrim", "id": 11015979, "node_id": "MDQ6VXNlcjExMDE1OTc5", "avatar_url": "https://avatars.githubusercontent.com/u/11015979?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kostasrim", "html_url": "https://github.com/kostasrim", "followers_url": "https://api.github.com/users/kostasrim/followers", "following_url": "https://api.github.com/users/kostasrim/following{/other_user}", "gists_url": "https://api.github.com/users/kostasrim/gists{/gist_id}", "starred_url": "https://api.github.com/users/kostasrim/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kostasrim/subscriptions", "organizations_url": "https://api.github.com/users/kostasrim/orgs", "repos_url": "https://api.github.com/users/kostasrim/repos", "events_url": "https://api.github.com/users/kostasrim/events{/privacy}", "received_events_url": "https://api.github.com/users/kostasrim/received_events", "type": "User", "user_view_type": "public", "site_admin": false}], "milestone": null, "comments": 22, "created_at": "2024-01-22T08:20:40Z", "updated_at": "2025-01-18T08:43:32Z", "closed_at": "2024-03-14T08:07:25Z", "assignee": {"login": "kostasrim", "id": 11015979, "node_id": "MDQ6VXNlcjExMDE1OTc5", "avatar_url": "https://avatars.githubusercontent.com/u/11015979?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kostasrim", "html_url": "https://github.com/kostasrim", "followers_url": "https://api.github.com/users/kostasrim/followers", "following_url": "https://api.github.com/users/kostasrim/following{/other_user}", "gists_url": "https://api.github.com/users/kostasrim/gists{/gist_id}", "starred_url": "https://api.github.com/users/kostasrim/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kostasrim/subscriptions", "organizations_url": "https://api.github.com/users/kostasrim/orgs", "repos_url": "https://api.github.com/users/kostasrim/repos", "events_url": "https://api.github.com/users/kostasrim/events{/privacy}", "received_events_url": "https://api.github.com/users/kostasrim/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "**RESP3 support missing for rueidis DragonflyDB connection?**\r\n# Error when connecting to DragonflyDB with rueidis client\r\n\r\nWhen trying to connect to a DragonflyDB instance using the rueidis Redis client library in Go, I get the following panic:\r\n\r\n`panic: Unknown subcommand or wrong number of arguments for 'TRACKING'. Try CLIENT HELP.: ClientOption.DisableCache must be true for redis not supporting client-side caching or not supporting RESP3 [recovered] panic: Unknown subcommand or wrong number of arguments for 'TRACKING'. Try CLIENT HELP.: ClientOption.DisableCache must be true for redis not supporting client-side caching or not supporting RESP3`\r\n\r\n\r\nThis happens with the following code:\r\n\r\n```go\r\npackage main\r\n\r\nimport (\r\n\t\"context\"\r\n\t\"fmt\"\r\n\r\n\t\"github.com/redis/rueidis\"\r\n)\r\n\r\nfunc main() {\r\n\tclient, err := rueidis.NewClient(rueidis.ClientOption{InitAddress: []string{\"127.0.0.1:6379\"}})\r\n\tif err != nil {\r\n\t\tpanic(err)\r\n\t}\r\n\tdefer client.Close()\r\n\r\n\tctx := context.Background()\r\n\t// SET key val NX\r\n\terr = client.Do(ctx, client.B().Set().Key(\"key\").Value(\"val\").Nx().Build()).Error()\r\n\tif err != nil {\r\n\t\tpanic(err)\r\n\t}\r\n\tres, err := client.Do(ctx, client.B().Get().Key(\"key\").Build()).ToString()\r\n\tif err != nil {\r\n\t\tpanic(err)\r\n\t}\r\n\tfmt.Println(res)\r\n}\r\n\r\n```\r\nIt seems there may be an incompatibility between DragonflyDB and the rueidis client assumptions. Specifically the error suggests rueidis expects disabled client caching or RESP3 support.\r\n\r\nI checked the DragonflyDB docs but didn't see mention of RESP3 support or client caching handling.\r\n\r\nCould this be added to enable better compatibility with Redis clients like rueidis? Or is there another recommended approach for connecting to DragonflyDB from Go code?\r\n\r\nLet me know if any other details would be helpful in resolving this. Thanks!\r\n\r\n**Feel free to modify or improve this as needed. Hopefully it clearly explains the issue you are seeing. Let me know if you have any other questions!**", "closed_by": {"login": "kostasrim", "id": 11015979, "node_id": "MDQ6VXNlcjExMDE1OTc5", "avatar_url": "https://avatars.githubusercontent.com/u/11015979?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kostasrim", "html_url": "https://github.com/kostasrim", "followers_url": "https://api.github.com/users/kostasrim/followers", "following_url": "https://api.github.com/users/kostasrim/following{/other_user}", "gists_url": "https://api.github.com/users/kostasrim/gists{/gist_id}", "starred_url": "https://api.github.com/users/kostasrim/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kostasrim/subscriptions", "organizations_url": "https://api.github.com/users/kostasrim/orgs", "repos_url": "https://api.github.com/users/kostasrim/repos", "events_url": "https://api.github.com/users/kostasrim/events{/privacy}", "received_events_url": "https://api.github.com/users/kostasrim/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/2454/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/2454/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/2442", "repository_url": "https://api.github.com/repos/dragonflydb/dragonfly", "labels_url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/2442/labels{/name}", "comments_url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/2442/comments", "events_url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/2442/events", "html_url": "https://github.com/dragonflydb/dragonfly/issues/2442", "id": 2089025082, "node_id": "I_kwDOGg_XLc58g_46", "number": 2442, "title": "support Sidekiq Pro's reliable scheduler script by marking it with allow-undeclared-keys", "user": {"login": "mperham", "id": 2911, "node_id": "MDQ6VXNlcjI5MTE=", "avatar_url": "https://avatars.githubusercontent.com/u/2911?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mperham", "html_url": "https://github.com/mperham", "followers_url": "https://api.github.com/users/mperham/followers", "following_url": "https://api.github.com/users/mperham/following{/other_user}", "gists_url": "https://api.github.com/users/mperham/gists{/gist_id}", "starred_url": "https://api.github.com/users/mperham/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mperham/subscriptions", "organizations_url": "https://api.github.com/users/mperham/orgs", "repos_url": "https://api.github.com/users/mperham/repos", "events_url": "https://api.github.com/users/mperham/events{/privacy}", "received_events_url": "https://api.github.com/users/mperham/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 3632299438, "node_id": "LA_kwDOGg_XLc7YgH2u", "url": "https://api.github.com/repos/dragonflydb/dragonfly/labels/bug", "name": "bug", "color": "d73a4a", "default": true, "description": "Something isn't working"}, {"id": 5646965188, "node_id": "LA_kwDOGg_XLc8AAAABUJXZxA", "url": "https://api.github.com/repos/dragonflydb/dragonfly/labels/Next%20Up", "name": "Next Up", "color": "1d76db", "default": false, "description": "task that is ready to be worked on and should be added to working queue"}], "state": "closed", "locked": false, "assignees": [{"login": "chakaz", "id": 7992598, "node_id": "MDQ6VXNlcjc5OTI1OTg=", "avatar_url": "https://avatars.githubusercontent.com/u/7992598?v=4", "gravatar_id": "", "url": "https://api.github.com/users/chakaz", "html_url": "https://github.com/chakaz", "followers_url": "https://api.github.com/users/chakaz/followers", "following_url": "https://api.github.com/users/chakaz/following{/other_user}", "gists_url": "https://api.github.com/users/chakaz/gists{/gist_id}", "starred_url": "https://api.github.com/users/chakaz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/chakaz/subscriptions", "organizations_url": "https://api.github.com/users/chakaz/orgs", "repos_url": "https://api.github.com/users/chakaz/repos", "events_url": "https://api.github.com/users/chakaz/events{/privacy}", "received_events_url": "https://api.github.com/users/chakaz/received_events", "type": "User", "user_view_type": "public", "site_admin": false}], "milestone": null, "comments": 22, "created_at": "2024-01-18T20:47:31Z", "updated_at": "2025-01-29T17:30:03Z", "closed_at": "2025-01-29T16:23:09Z", "assignee": {"login": "chakaz", "id": 7992598, "node_id": "MDQ6VXNlcjc5OTI1OTg=", "avatar_url": "https://avatars.githubusercontent.com/u/7992598?v=4", "gravatar_id": "", "url": "https://api.github.com/users/chakaz", "html_url": "https://github.com/chakaz", "followers_url": "https://api.github.com/users/chakaz/followers", "following_url": "https://api.github.com/users/chakaz/following{/other_user}", "gists_url": "https://api.github.com/users/chakaz/gists{/gist_id}", "starred_url": "https://api.github.com/users/chakaz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/chakaz/subscriptions", "organizations_url": "https://api.github.com/users/chakaz/orgs", "repos_url": "https://api.github.com/users/chakaz/repos", "events_url": "https://api.github.com/users/chakaz/events{/privacy}", "received_events_url": "https://api.github.com/users/chakaz/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "Redis Lua requires the user to define all keys touched by a Lua script when invoking that script in order to run correctly in Redis Cluster.\r\n\r\nThe problem is that Sidekiq Pro's reliable scheduler does not know which queue (list) it will touch next when invoked. And Redis allows us to violate that requirement since Sidekiq does not support Redis Cluster.\r\n\r\nThe Lua scheduler is a simple loop:\r\n\r\n- Take the first job off ZSet \"scheduled\" where score is < Time.now.to_f.\r\n- Parse the JSON to get the `queue` element.\r\n- Push the job onto that named queue.\r\n\r\nAs you can see, we know the Lua script will touch `scheduled` but we don't know the name of the queue because the scheduled set holds future jobs for all queues and the job data itself tells us which queue to mutate.\r\n\r\nUnfortunately it looks like DragonflyDB enforces this Lua requirement, making Sidekiq Pro's reliable scheduler feature incompatible. Redis does allow it as long as it is not running in Cluster mode.", "closed_by": {"login": "mperham", "id": 2911, "node_id": "MDQ6VXNlcjI5MTE=", "avatar_url": "https://avatars.githubusercontent.com/u/2911?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mperham", "html_url": "https://github.com/mperham", "followers_url": "https://api.github.com/users/mperham/followers", "following_url": "https://api.github.com/users/mperham/following{/other_user}", "gists_url": "https://api.github.com/users/mperham/gists{/gist_id}", "starred_url": "https://api.github.com/users/mperham/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mperham/subscriptions", "organizations_url": "https://api.github.com/users/mperham/orgs", "repos_url": "https://api.github.com/users/mperham/repos", "events_url": "https://api.github.com/users/mperham/events{/privacy}", "received_events_url": "https://api.github.com/users/mperham/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/2442/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/2442/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/1730", "repository_url": "https://api.github.com/repos/dragonflydb/dragonfly", "labels_url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/1730/labels{/name}", "comments_url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/1730/comments", "events_url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/1730/events", "html_url": "https://github.com/dragonflydb/dragonfly/issues/1730", "id": 1864761773, "node_id": "I_kwDOGg_XLc5vJgGt", "number": 1730, "title": "Dragonfly as memcached crashes and can't load dump", "user": {"login": "sbkoto", "id": 138572227, "node_id": "U_kgDOCEJxww", "avatar_url": "https://avatars.githubusercontent.com/u/138572227?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sbkoto", "html_url": "https://github.com/sbkoto", "followers_url": "https://api.github.com/users/sbkoto/followers", "following_url": "https://api.github.com/users/sbkoto/following{/other_user}", "gists_url": "https://api.github.com/users/sbkoto/gists{/gist_id}", "starred_url": "https://api.github.com/users/sbkoto/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sbkoto/subscriptions", "organizations_url": "https://api.github.com/users/sbkoto/orgs", "repos_url": "https://api.github.com/users/sbkoto/repos", "events_url": "https://api.github.com/users/sbkoto/events{/privacy}", "received_events_url": "https://api.github.com/users/sbkoto/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 3632299438, "node_id": "LA_kwDOGg_XLc7YgH2u", "url": "https://api.github.com/repos/dragonflydb/dragonfly/labels/bug", "name": "bug", "color": "d73a4a", "default": true, "description": "Something isn't working"}, {"id": 5818912070, "node_id": "LA_kwDOGg_XLc8AAAABWtWNRg", "url": "https://api.github.com/repos/dragonflydb/dragonfly/labels/important", "name": "important", "color": "F9D0C4", "default": false, "description": "higher priority than the usual ongoing development tasks"}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 22, "created_at": "2023-08-24T09:26:39Z", "updated_at": "2023-10-26T18:38:48Z", "closed_at": "2023-10-26T18:38:48Z", "assignee": null, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "**Describe the bug**\r\nDragonfly periodically crashes and after loading does not load the dump. It used as memcached with port 11211. \r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n`ExecStart=/usr/bin/dragonfly --log_dir=/var/log/dragonfly --dir=/var/lib/dragonfly --dbfilename=dragonfly_dump --maxmemory=35gb --memcached_port=11211 --snapshot_cron=\"*/5 * * * *\" --logtostderr`\r\n\r\n**Screenshots**\r\n![image](https://github.com/dragonflydb/dragonfly/assets/138572227/f8939a09-413b-470c-9508-8675b87b4033)\r\n\r\n**Environment (please complete the following information):**\r\n```\r\n - OS: [ubuntu 20.04]\r\n - Kernel: Linux 5.15.0-79-generic #86~20.04.2-Ubuntu SMP Mon Jul 17 23:27:17 UTC 2023 x86_64 x86_64 x86_64 GNU/Linux\r\n - Containerized?: bare metal\r\n - Dragonfly Version: 1.8.0 from binary\r\n```\r\n\r\n**Additional context**\r\nCrash with:\r\n`dragonfly[8873]: F20230824 03:35:00.286943  8879 db_slice.cc:497] Check failed: 1u == db->mcflag.Erase(it->first) (1 vs. 0)\r\n`\r\n[log_crash.txt](https://github.com/dragonflydb/dragonfly/files/12427800/log_crash.txt)\r\n\r\nCant start with:\r\n`Aug 24 03:35:00  dragonfly[15899]: F20230824 03:35:00.996003 15900 facade.cc:134] Check failed: Protocol::REDIS == protocol()`\r\n[log_start.txt](https://github.com/dragonflydb/dragonfly/files/12427801/log_start.txt)\r\n\r\n\r\n", "closed_by": {"login": "romange", "id": 3674760, "node_id": "MDQ6VXNlcjM2NzQ3NjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3674760?v=4", "gravatar_id": "", "url": "https://api.github.com/users/romange", "html_url": "https://github.com/romange", "followers_url": "https://api.github.com/users/romange/followers", "following_url": "https://api.github.com/users/romange/following{/other_user}", "gists_url": "https://api.github.com/users/romange/gists{/gist_id}", "starred_url": "https://api.github.com/users/romange/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/romange/subscriptions", "organizations_url": "https://api.github.com/users/romange/orgs", "repos_url": "https://api.github.com/users/romange/repos", "events_url": "https://api.github.com/users/romange/events{/privacy}", "received_events_url": "https://api.github.com/users/romange/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/1730/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/dragonflydb/dragonfly/issues/1730/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}]}