{"d": [{"url": "https://api.github.com/repos/immich-app/immich/issues/5917", "repository_url": "https://api.github.com/repos/immich-app/immich", "labels_url": "https://api.github.com/repos/immich-app/immich/issues/5917/labels{/name}", "comments_url": "https://api.github.com/repos/immich-app/immich/issues/5917/comments", "events_url": "https://api.github.com/repos/immich-app/immich/issues/5917/events", "html_url": "https://github.com/immich-app/immich/pull/5917", "id": 2053140015, "node_id": "PR_kwDOGyI-8M5inDDN", "number": 5917, "title": "feat: storage template file move hardening", "user": {"login": "zackpollard", "id": 1313578, "node_id": "MDQ6VXNlcjEzMTM1Nzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1313578?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zackpollard", "html_url": "https://github.com/zackpollard", "followers_url": "https://api.github.com/users/zackpollard/followers", "following_url": "https://api.github.com/users/zackpollard/following{/other_user}", "gists_url": "https://api.github.com/users/zackpollard/gists{/gist_id}", "starred_url": "https://api.github.com/users/zackpollard/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zackpollard/subscriptions", "organizations_url": "https://api.github.com/users/zackpollard/orgs", "repos_url": "https://api.github.com/users/zackpollard/repos", "events_url": "https://api.github.com/users/zackpollard/events{/privacy}", "received_events_url": "https://api.github.com/users/zackpollard/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 5562513270, "node_id": "LA_kwDOGyI-8M8AAAABS403dg", "url": "https://api.github.com/repos/immich-app/immich/labels/%F0%9F%97%84%EF%B8%8Fserver", "name": "\ud83d\uddc4\ufe0fserver", "color": "C5DEF5", "default": false, "description": ""}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 9, "created_at": "2023-12-21T22:40:41Z", "updated_at": "2023-12-29T18:41:34Z", "closed_at": "2023-12-29T18:41:33Z", "assignee": null, "author_association": "MEMBER", "type": null, "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/immich-app/immich/pulls/5917", "html_url": "https://github.com/immich-app/immich/pull/5917", "diff_url": "https://github.com/immich-app/immich/pull/5917.diff", "patch_url": "https://github.com/immich-app/immich/pull/5917.patch", "merged_at": "2023-12-29T18:41:33Z"}, "body": "Storage template moving can sometimes fail and cause data corruption when the upload folder and library folder are not the same filesystem. This PR aims to address the existing problem and add validation of the file operations to ensure the moved file data matches the original asset data by the way of file size checks and optional hash checks.\r\n\r\nTODO:\r\n- [x] When file is copied rather than renamed, validate filesize in database matches filesize on disk\r\n- [x] When file is copied rather than renamed, validate hash in database matches hash of copied asset\r\n- [x] Change job concurrency to one and remove configuration options for this\r\n- [x] Add setting to enable and disable storage template system entirely, default storage template system to off\r\n- [ ] ~~Change structure of default upload folder to split GUIDs into seperate folders to improve performance~~ **Will be done in seperate PR**\r\n\r\nOptional TODO:\r\n- [ ] ~~Have the filename itself indicate if it is partial or not (.tmp suffix?)~~ **This actually substantially increases complexity with the move table, not going ahead with this for now**\r\n- [ ] ~~Keep an audit log of moves/file operations in the database~~ **Could be done in seperate PR**\r\n- [ ] ~~Use database locks to force template migration concurrency to one, avoiding race conditions where two processes move a file with the same name to the same location, not appending a +n~~ Done in #6054", "closed_by": {"login": "zackpollard", "id": 1313578, "node_id": "MDQ6VXNlcjEzMTM1Nzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1313578?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zackpollard", "html_url": "https://github.com/zackpollard", "followers_url": "https://api.github.com/users/zackpollard/followers", "following_url": "https://api.github.com/users/zackpollard/following{/other_user}", "gists_url": "https://api.github.com/users/zackpollard/gists{/gist_id}", "starred_url": "https://api.github.com/users/zackpollard/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zackpollard/subscriptions", "organizations_url": "https://api.github.com/users/zackpollard/orgs", "repos_url": "https://api.github.com/users/zackpollard/repos", "events_url": "https://api.github.com/users/zackpollard/events{/privacy}", "received_events_url": "https://api.github.com/users/zackpollard/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/immich-app/immich/issues/5917/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/immich-app/immich/issues/5917/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/immich-app/immich/issues/108", "repository_url": "https://api.github.com/repos/immich-app/immich", "labels_url": "https://api.github.com/repos/immich-app/immich/issues/108/labels{/name}", "comments_url": "https://api.github.com/repos/immich-app/immich/issues/108/comments", "events_url": "https://api.github.com/repos/immich-app/immich/issues/108/events", "html_url": "https://github.com/immich-app/immich/pull/108", "id": 1192599316, "node_id": "PR_kwDOGyI-8M41oNo-", "number": 108, "title": "Backup stuck at unsupported format", "user": {"login": "alextran1502", "id": 27055614, "node_id": "MDQ6VXNlcjI3MDU1NjE0", "avatar_url": "https://avatars.githubusercontent.com/u/27055614?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alextran1502", "html_url": "https://github.com/alextran1502", "followers_url": "https://api.github.com/users/alextran1502/followers", "following_url": "https://api.github.com/users/alextran1502/following{/other_user}", "gists_url": "https://api.github.com/users/alextran1502/gists{/gist_id}", "starred_url": "https://api.github.com/users/alextran1502/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alextran1502/subscriptions", "organizations_url": "https://api.github.com/users/alextran1502/orgs", "repos_url": "https://api.github.com/users/alextran1502/repos", "events_url": "https://api.github.com/users/alextran1502/events{/privacy}", "received_events_url": "https://api.github.com/users/alextran1502/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 1, "created_at": "2022-04-05T04:32:44Z", "updated_at": "2022-04-05T04:37:55Z", "closed_at": "2022-04-05T04:37:48Z", "assignee": null, "author_association": "MEMBER", "type": null, "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/immich-app/immich/pulls/108", "html_url": "https://github.com/immich-app/immich/pull/108", "diff_url": "https://github.com/immich-app/immich/pull/108.diff", "patch_url": "https://github.com/immich-app/immich/pull/108.patch", "merged_at": "2022-04-05T04:37:48Z"}, "body": null, "closed_by": {"login": "alextran1502", "id": 27055614, "node_id": "MDQ6VXNlcjI3MDU1NjE0", "avatar_url": "https://avatars.githubusercontent.com/u/27055614?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alextran1502", "html_url": "https://github.com/alextran1502", "followers_url": "https://api.github.com/users/alextran1502/followers", "following_url": "https://api.github.com/users/alextran1502/following{/other_user}", "gists_url": "https://api.github.com/users/alextran1502/gists{/gist_id}", "starred_url": "https://api.github.com/users/alextran1502/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alextran1502/subscriptions", "organizations_url": "https://api.github.com/users/alextran1502/orgs", "repos_url": "https://api.github.com/users/alextran1502/repos", "events_url": "https://api.github.com/users/alextran1502/events{/privacy}", "received_events_url": "https://api.github.com/users/alextran1502/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/immich-app/immich/issues/108/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/immich-app/immich/issues/108/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/immich-app/immich/issues/150", "repository_url": "https://api.github.com/repos/immich-app/immich", "labels_url": "https://api.github.com/repos/immich-app/immich/issues/150/labels{/name}", "comments_url": "https://api.github.com/repos/immich-app/immich/issues/150/comments", "events_url": "https://api.github.com/repos/immich-app/immich/issues/150/events", "html_url": "https://github.com/immich-app/immich/pull/150", "id": 1228866722, "node_id": "PR_kwDOGyI-8M43dbb_", "number": 150, "title": "Bug/fixed permission not requested android 10", "user": {"login": "alextran1502", "id": 27055614, "node_id": "MDQ6VXNlcjI3MDU1NjE0", "avatar_url": "https://avatars.githubusercontent.com/u/27055614?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alextran1502", "html_url": "https://github.com/alextran1502", "followers_url": "https://api.github.com/users/alextran1502/followers", "following_url": "https://api.github.com/users/alextran1502/following{/other_user}", "gists_url": "https://api.github.com/users/alextran1502/gists{/gist_id}", "starred_url": "https://api.github.com/users/alextran1502/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alextran1502/subscriptions", "organizations_url": "https://api.github.com/users/alextran1502/orgs", "repos_url": "https://api.github.com/users/alextran1502/repos", "events_url": "https://api.github.com/users/alextran1502/events{/privacy}", "received_events_url": "https://api.github.com/users/alextran1502/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 0, "created_at": "2022-05-08T11:46:23Z", "updated_at": "2022-05-08T11:47:42Z", "closed_at": "2022-05-08T11:47:39Z", "assignee": null, "author_association": "MEMBER", "type": null, "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/immich-app/immich/pulls/150", "html_url": "https://github.com/immich-app/immich/pull/150", "diff_url": "https://github.com/immich-app/immich/pull/150.diff", "patch_url": "https://github.com/immich-app/immich/pull/150.patch", "merged_at": "2022-05-08T11:47:39Z"}, "body": "Fixed issue in #146 ", "closed_by": {"login": "alextran1502", "id": 27055614, "node_id": "MDQ6VXNlcjI3MDU1NjE0", "avatar_url": "https://avatars.githubusercontent.com/u/27055614?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alextran1502", "html_url": "https://github.com/alextran1502", "followers_url": "https://api.github.com/users/alextran1502/followers", "following_url": "https://api.github.com/users/alextran1502/following{/other_user}", "gists_url": "https://api.github.com/users/alextran1502/gists{/gist_id}", "starred_url": "https://api.github.com/users/alextran1502/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alextran1502/subscriptions", "organizations_url": "https://api.github.com/users/alextran1502/orgs", "repos_url": "https://api.github.com/users/alextran1502/repos", "events_url": "https://api.github.com/users/alextran1502/events{/privacy}", "received_events_url": "https://api.github.com/users/alextran1502/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/immich-app/immich/issues/150/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/immich-app/immich/issues/150/timeline", "performed_via_github_app": null, "state_reason": null}]}