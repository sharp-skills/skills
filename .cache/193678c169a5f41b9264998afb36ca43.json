{"d": [{"url": "https://api.github.com/repos/ory/kratos/issues/615", "repository_url": "https://api.github.com/repos/ory/kratos", "labels_url": "https://api.github.com/repos/ory/kratos/issues/615/labels{/name}", "comments_url": "https://api.github.com/repos/ory/kratos/issues/615/comments", "events_url": "https://api.github.com/repos/ory/kratos/issues/615/events", "html_url": "https://github.com/ory/kratos/issues/615", "id": 669466190, "node_id": "MDU6SXNzdWU2Njk0NjYxOTA=", "number": 615, "title": "Refresh Sessions Without Having to Log In Again", "user": {"login": "ellioseven", "id": 4191120, "node_id": "MDQ6VXNlcjQxOTExMjA=", "avatar_url": "https://avatars.githubusercontent.com/u/4191120?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ellioseven", "html_url": "https://github.com/ellioseven", "followers_url": "https://api.github.com/users/ellioseven/followers", "following_url": "https://api.github.com/users/ellioseven/following{/other_user}", "gists_url": "https://api.github.com/users/ellioseven/gists{/gist_id}", "starred_url": "https://api.github.com/users/ellioseven/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ellioseven/subscriptions", "organizations_url": "https://api.github.com/users/ellioseven/orgs", "repos_url": "https://api.github.com/users/ellioseven/repos", "events_url": "https://api.github.com/users/ellioseven/events{/privacy}", "received_events_url": "https://api.github.com/users/ellioseven/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 948357241, "node_id": "MDU6TGFiZWw5NDgzNTcyNDE=", "url": "https://api.github.com/repos/ory/kratos/labels/bug", "name": "bug", "color": "F44336", "default": true, "description": "Something is not working."}], "state": "closed", "locked": false, "assignees": [{"login": "aeneasr", "id": 3372410, "node_id": "MDQ6VXNlcjMzNzI0MTA=", "avatar_url": "https://avatars.githubusercontent.com/u/3372410?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aeneasr", "html_url": "https://github.com/aeneasr", "followers_url": "https://api.github.com/users/aeneasr/followers", "following_url": "https://api.github.com/users/aeneasr/following{/other_user}", "gists_url": "https://api.github.com/users/aeneasr/gists{/gist_id}", "starred_url": "https://api.github.com/users/aeneasr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aeneasr/subscriptions", "organizations_url": "https://api.github.com/users/aeneasr/orgs", "repos_url": "https://api.github.com/users/aeneasr/repos", "events_url": "https://api.github.com/users/aeneasr/events{/privacy}", "received_events_url": "https://api.github.com/users/aeneasr/received_events", "type": "User", "user_view_type": "public", "site_admin": false}], "milestone": {"url": "https://api.github.com/repos/ory/kratos/milestones/14", "html_url": "https://github.com/ory/kratos/milestone/14", "labels_url": "https://api.github.com/repos/ory/kratos/milestones/14/labels", "id": 7065813, "node_id": "MI_kwDOCBDZBc4Aa9DV", "number": 14, "title": "Incubating Release", "description": "This milestone tracks all issues we want to resolve before Ory Kratos goes into incubating phase.", "creator": {"login": "aeneasr", "id": 3372410, "node_id": "MDQ6VXNlcjMzNzI0MTA=", "avatar_url": "https://avatars.githubusercontent.com/u/3372410?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aeneasr", "html_url": "https://github.com/aeneasr", "followers_url": "https://api.github.com/users/aeneasr/followers", "following_url": "https://api.github.com/users/aeneasr/following{/other_user}", "gists_url": "https://api.github.com/users/aeneasr/gists{/gist_id}", "starred_url": "https://api.github.com/users/aeneasr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aeneasr/subscriptions", "organizations_url": "https://api.github.com/users/aeneasr/orgs", "repos_url": "https://api.github.com/users/aeneasr/repos", "events_url": "https://api.github.com/users/aeneasr/events{/privacy}", "received_events_url": "https://api.github.com/users/aeneasr/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "open_issues": 0, "closed_issues": 27, "state": "closed", "created_at": "2021-08-17T10:12:24Z", "updated_at": "2022-05-30T10:13:49Z", "due_on": null, "closed_at": "2022-05-30T10:13:49Z"}, "comments": 35, "created_at": "2020-07-31T06:35:16Z", "updated_at": "2022-03-28T11:02:19Z", "closed_at": "2022-03-28T11:02:19Z", "assignee": {"login": "aeneasr", "id": 3372410, "node_id": "MDQ6VXNlcjMzNzI0MTA=", "avatar_url": "https://avatars.githubusercontent.com/u/3372410?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aeneasr", "html_url": "https://github.com/aeneasr", "followers_url": "https://api.github.com/users/aeneasr/followers", "following_url": "https://api.github.com/users/aeneasr/following{/other_user}", "gists_url": "https://api.github.com/users/aeneasr/gists{/gist_id}", "starred_url": "https://api.github.com/users/aeneasr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aeneasr/subscriptions", "organizations_url": "https://api.github.com/users/aeneasr/orgs", "repos_url": "https://api.github.com/users/aeneasr/repos", "events_url": "https://api.github.com/users/aeneasr/events{/privacy}", "received_events_url": "https://api.github.com/users/aeneasr/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "**Is your feature request related to a problem? Please describe.**\r\n\r\nI've got a React application that needs to handle expired sessions. The only way to do that currently is with the `login?refresh=true` endpoint. However the user has to enter their password, which isn't really ideal in this case. \r\n\r\nThis means I have to set a long session expiry, say 24 hours (hopefully more). I'm not really sure if there are security implications here.\r\n\r\nIs there a way for a user to extend their session without having to \"log in again\"? Ideally I could run this in a JS interval or page click. That way the user retains an active session. \r\n\r\n**Describe the solution you'd like**\r\n\r\nA public API endpoint that allows the user to recreate a session without having to login again. The user may need to redirect to do this, however it would be nice to do this over AJAX/Fetch so that the UX isn't disturbed (maybe not possible).\r\n\r\n**Describe alternatives you've considered**\r\n\r\nI tried using the `login?refresh=true` endpoint, but that displays a login screen. Coming from a UX perspective, I don't really want the user to have to login every 24 hours.\r\n\r\n**Additional context**\r\n\r\nSlack: https://ory-community.slack.com/archives/C012RJ2MQ1H/p1596070200091000\r\n", "closed_by": {"login": "aeneasr", "id": 3372410, "node_id": "MDQ6VXNlcjMzNzI0MTA=", "avatar_url": "https://avatars.githubusercontent.com/u/3372410?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aeneasr", "html_url": "https://github.com/aeneasr", "followers_url": "https://api.github.com/users/aeneasr/followers", "following_url": "https://api.github.com/users/aeneasr/following{/other_user}", "gists_url": "https://api.github.com/users/aeneasr/gists{/gist_id}", "starred_url": "https://api.github.com/users/aeneasr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aeneasr/subscriptions", "organizations_url": "https://api.github.com/users/aeneasr/orgs", "repos_url": "https://api.github.com/users/aeneasr/repos", "events_url": "https://api.github.com/users/aeneasr/events{/privacy}", "received_events_url": "https://api.github.com/users/aeneasr/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/ory/kratos/issues/615/reactions", "total_count": 19, "+1": 19, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/ory/kratos/issues/615/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/ory/kratos/issues/1889", "repository_url": "https://api.github.com/repos/ory/kratos", "labels_url": "https://api.github.com/repos/ory/kratos/issues/1889/labels{/name}", "comments_url": "https://api.github.com/repos/ory/kratos/issues/1889/comments", "events_url": "https://api.github.com/repos/ory/kratos/issues/1889/events", "html_url": "https://github.com/ory/kratos/issues/1889", "id": 1036651712, "node_id": "I_kwDOCBDZBc49ygzA", "number": 1889, "title": "Ask to re-authenticate despite only updating non-privileged fields.", "user": {"login": "Quasarman", "id": 30523269, "node_id": "MDQ6VXNlcjMwNTIzMjY5", "avatar_url": "https://avatars.githubusercontent.com/u/30523269?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Quasarman", "html_url": "https://github.com/Quasarman", "followers_url": "https://api.github.com/users/Quasarman/followers", "following_url": "https://api.github.com/users/Quasarman/following{/other_user}", "gists_url": "https://api.github.com/users/Quasarman/gists{/gist_id}", "starred_url": "https://api.github.com/users/Quasarman/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Quasarman/subscriptions", "organizations_url": "https://api.github.com/users/Quasarman/orgs", "repos_url": "https://api.github.com/users/Quasarman/repos", "events_url": "https://api.github.com/users/Quasarman/events{/privacy}", "received_events_url": "https://api.github.com/users/Quasarman/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 948357241, "node_id": "MDU6TGFiZWw5NDgzNTcyNDE=", "url": "https://api.github.com/repos/ory/kratos/labels/bug", "name": "bug", "color": "F44336", "default": true, "description": "Something is not working."}], "state": "closed", "locked": false, "assignees": [{"login": "zepatrik", "id": 5354445, "node_id": "MDQ6VXNlcjUzNTQ0NDU=", "avatar_url": "https://avatars.githubusercontent.com/u/5354445?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zepatrik", "html_url": "https://github.com/zepatrik", "followers_url": "https://api.github.com/users/zepatrik/followers", "following_url": "https://api.github.com/users/zepatrik/following{/other_user}", "gists_url": "https://api.github.com/users/zepatrik/gists{/gist_id}", "starred_url": "https://api.github.com/users/zepatrik/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zepatrik/subscriptions", "organizations_url": "https://api.github.com/users/zepatrik/orgs", "repos_url": "https://api.github.com/users/zepatrik/repos", "events_url": "https://api.github.com/users/zepatrik/events{/privacy}", "received_events_url": "https://api.github.com/users/zepatrik/received_events", "type": "User", "user_view_type": "public", "site_admin": false}], "milestone": {"url": "https://api.github.com/repos/ory/kratos/milestones/15", "html_url": "https://github.com/ory/kratos/milestone/15", "labels_url": "https://api.github.com/repos/ory/kratos/milestones/15/labels", "id": 7065816, "node_id": "MI_kwDOCBDZBc4Aa9DY", "number": 15, "title": "v1.0.0", "description": "", "creator": {"login": "aeneasr", "id": 3372410, "node_id": "MDQ6VXNlcjMzNzI0MTA=", "avatar_url": "https://avatars.githubusercontent.com/u/3372410?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aeneasr", "html_url": "https://github.com/aeneasr", "followers_url": "https://api.github.com/users/aeneasr/followers", "following_url": "https://api.github.com/users/aeneasr/following{/other_user}", "gists_url": "https://api.github.com/users/aeneasr/gists{/gist_id}", "starred_url": "https://api.github.com/users/aeneasr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aeneasr/subscriptions", "organizations_url": "https://api.github.com/users/aeneasr/orgs", "repos_url": "https://api.github.com/users/aeneasr/repos", "events_url": "https://api.github.com/users/aeneasr/events{/privacy}", "received_events_url": "https://api.github.com/users/aeneasr/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "open_issues": 4, "closed_issues": 89, "state": "open", "created_at": "2021-08-17T10:14:38Z", "updated_at": "2025-11-10T00:03:30Z", "due_on": null, "closed_at": null}, "comments": 21, "created_at": "2021-10-26T19:16:53Z", "updated_at": "2023-08-08T07:54:59Z", "closed_at": "2023-08-08T07:54:58Z", "assignee": null, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "**Describe the bug**\r\n\r\nWhen wanting to update non-privileged traits like first/last names of an identity and the ```privileged_session_max_age``` has already passed I get an error stating the the login session needs to be refreshed (error.id === ```session_refresh_required```). From the documentation I see that this should only be the case for sensitive fields like the password, username and email.\r\n\r\n![image](https://user-images.githubusercontent.com/30523269/138944723-89f6426a-669c-4ab9-a530-cb88ffe1fada.png)\r\n\r\nThe request payload I am sending (Note: neither the username, email or tos_accepted fields have changed. I only supplied them in the payload so it wont cause other errors telling me that required fields are missing.) I just want to update the first_name trait.\r\n\r\n![image](https://user-images.githubusercontent.com/30523269/138945368-57c4f1d9-5333-4fba-86e2-1b29aa5941bf.png)\r\n\r\nThe response I got after waiting for ```privileged_session_max_age``` time to pass.\r\n\r\n![image](https://user-images.githubusercontent.com/30523269/138945526-39f8db4e-8434-4bd1-a053-8c250b046eef.png)\r\n\r\nI am using the \"Complete Settings Flow\" in \"profile\" mode. Is this the correct approach? Or is updating such traits handled differently?\r\n\r\nHow can I achieve updating trivial traits without asking the user to refresh their session.\r\n\r\n**Reproducing the bug**\r\n\r\nWaiting till the ```privileged_session_max_age``` as passed and try to modify any traits that are not security critical.\r\n\r\n**Expected behavior**\r\n\r\nUpdating of non-privileged traits like first/last name does not require re-authentication after the ```privileged_session_max_age``` has passed.\r\n\r\n**Environment**\r\n\r\nDocker v0.8.0\r\n\r\n**Additional context**\r\n\r\nNone.\r\n", "closed_by": {"login": "zepatrik", "id": 5354445, "node_id": "MDQ6VXNlcjUzNTQ0NDU=", "avatar_url": "https://avatars.githubusercontent.com/u/5354445?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zepatrik", "html_url": "https://github.com/zepatrik", "followers_url": "https://api.github.com/users/zepatrik/followers", "following_url": "https://api.github.com/users/zepatrik/following{/other_user}", "gists_url": "https://api.github.com/users/zepatrik/gists{/gist_id}", "starred_url": "https://api.github.com/users/zepatrik/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zepatrik/subscriptions", "organizations_url": "https://api.github.com/users/zepatrik/orgs", "repos_url": "https://api.github.com/users/zepatrik/repos", "events_url": "https://api.github.com/users/zepatrik/events{/privacy}", "received_events_url": "https://api.github.com/users/zepatrik/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/ory/kratos/issues/1889/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/ory/kratos/issues/1889/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/ory/kratos/issues/1142", "repository_url": "https://api.github.com/repos/ory/kratos", "labels_url": "https://api.github.com/repos/ory/kratos/issues/1142/labels{/name}", "comments_url": "https://api.github.com/repos/ory/kratos/issues/1142/comments", "events_url": "https://api.github.com/repos/ory/kratos/issues/1142/events", "html_url": "https://github.com/ory/kratos/issues/1142", "id": 830184389, "node_id": "MDU6SXNzdWU4MzAxODQzODk=", "number": 1142, "title": "recovery link is open by email app", "user": {"login": "ghost", "id": 10137, "node_id": "MDQ6VXNlcjEwMTM3", "avatar_url": "https://avatars.githubusercontent.com/u/10137?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ghost", "html_url": "https://github.com/ghost", "followers_url": "https://api.github.com/users/ghost/followers", "following_url": "https://api.github.com/users/ghost/following{/other_user}", "gists_url": "https://api.github.com/users/ghost/gists{/gist_id}", "starred_url": "https://api.github.com/users/ghost/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ghost/subscriptions", "organizations_url": "https://api.github.com/users/ghost/orgs", "repos_url": "https://api.github.com/users/ghost/repos", "events_url": "https://api.github.com/users/ghost/events{/privacy}", "received_events_url": "https://api.github.com/users/ghost/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 948357241, "node_id": "MDU6TGFiZWw5NDgzNTcyNDE=", "url": "https://api.github.com/repos/ory/kratos/labels/bug", "name": "bug", "color": "F44336", "default": true, "description": "Something is not working."}], "state": "closed", "locked": false, "assignees": [], "milestone": {"url": "https://api.github.com/repos/ory/kratos/milestones/11", "html_url": "https://github.com/ory/kratos/milestone/11", "labels_url": "https://api.github.com/repos/ory/kratos/milestones/11/labels", "id": 6942505, "node_id": "MDk6TWlsZXN0b25lNjk0MjUwNQ==", "number": 11, "title": "v0.9.0-alpha.1", "description": "This milestone focuses on passwordless authentication and improved recovery and verification flows.", "creator": {"login": "aeneasr", "id": 3372410, "node_id": "MDQ6VXNlcjMzNzI0MTA=", "avatar_url": "https://avatars.githubusercontent.com/u/3372410?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aeneasr", "html_url": "https://github.com/aeneasr", "followers_url": "https://api.github.com/users/aeneasr/followers", "following_url": "https://api.github.com/users/aeneasr/following{/other_user}", "gists_url": "https://api.github.com/users/aeneasr/gists{/gist_id}", "starred_url": "https://api.github.com/users/aeneasr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aeneasr/subscriptions", "organizations_url": "https://api.github.com/users/aeneasr/orgs", "repos_url": "https://api.github.com/users/aeneasr/repos", "events_url": "https://api.github.com/users/aeneasr/events{/privacy}", "received_events_url": "https://api.github.com/users/aeneasr/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "open_issues": 0, "closed_issues": 7, "state": "closed", "created_at": "2021-07-13T15:29:56Z", "updated_at": "2022-05-30T10:15:12Z", "due_on": null, "closed_at": "2022-05-30T10:15:12Z"}, "comments": 20, "created_at": "2021-03-12T14:43:22Z", "updated_at": "2021-08-02T18:22:30Z", "closed_at": "2021-08-02T18:22:30Z", "assignee": null, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "Certain email apps (like office outlook) use link preview, Which visits the link and \"uses\" the token so by the time the user tries to recover the account the token is invalid.\r\n\r\nEither account recovery is specifically for setting passwords instead temporary login.\r\n\r\nThe current work-around we are investigating is delaying the request to kratos until there is user interaction (clicking a link). which would remove the security of invalidating the token on request. But the problem is a blocking issue for us.\r\n", "closed_by": {"login": "aeneasr", "id": 3372410, "node_id": "MDQ6VXNlcjMzNzI0MTA=", "avatar_url": "https://avatars.githubusercontent.com/u/3372410?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aeneasr", "html_url": "https://github.com/aeneasr", "followers_url": "https://api.github.com/users/aeneasr/followers", "following_url": "https://api.github.com/users/aeneasr/following{/other_user}", "gists_url": "https://api.github.com/users/aeneasr/gists{/gist_id}", "starred_url": "https://api.github.com/users/aeneasr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aeneasr/subscriptions", "organizations_url": "https://api.github.com/users/aeneasr/orgs", "repos_url": "https://api.github.com/users/aeneasr/repos", "events_url": "https://api.github.com/users/aeneasr/events{/privacy}", "received_events_url": "https://api.github.com/users/aeneasr/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/ory/kratos/issues/1142/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/ory/kratos/issues/1142/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/ory/kratos/issues/3258", "repository_url": "https://api.github.com/repos/ory/kratos", "labels_url": "https://api.github.com/repos/ory/kratos/issues/3258/labels{/name}", "comments_url": "https://api.github.com/repos/ory/kratos/issues/3258/comments", "events_url": "https://api.github.com/repos/ory/kratos/issues/3258/events", "html_url": "https://github.com/ory/kratos/issues/3258", "id": 1685706894, "node_id": "I_kwDOCBDZBc5kediO", "number": 3258, "title": "Webhook failing with timeout while it never failed before", "user": {"login": "hugotiburtino", "id": 45924645, "node_id": "MDQ6VXNlcjQ1OTI0NjQ1", "avatar_url": "https://avatars.githubusercontent.com/u/45924645?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hugotiburtino", "html_url": "https://github.com/hugotiburtino", "followers_url": "https://api.github.com/users/hugotiburtino/followers", "following_url": "https://api.github.com/users/hugotiburtino/following{/other_user}", "gists_url": "https://api.github.com/users/hugotiburtino/gists{/gist_id}", "starred_url": "https://api.github.com/users/hugotiburtino/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hugotiburtino/subscriptions", "organizations_url": "https://api.github.com/users/hugotiburtino/orgs", "repos_url": "https://api.github.com/users/hugotiburtino/repos", "events_url": "https://api.github.com/users/hugotiburtino/events{/privacy}", "received_events_url": "https://api.github.com/users/hugotiburtino/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 948357241, "node_id": "MDU6TGFiZWw5NDgzNTcyNDE=", "url": "https://api.github.com/repos/ory/kratos/labels/bug", "name": "bug", "color": "F44336", "default": true, "description": "Something is not working."}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 17, "created_at": "2023-04-26T20:51:33Z", "updated_at": "2024-05-15T18:04:31Z", "closed_at": "2023-07-14T10:05:56Z", "assignee": null, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### Preflight checklist\r\n\r\n- [X] I could not find a solution in the existing issues, docs, nor discussions.\r\n- [X] I agree to follow this project's [Code of Conduct](https://github.com/ory/kratos/blob/master/CODE_OF_CONDUCT.md).\r\n- [X] I have read and am following this repository's [Contribution Guidelines](https://github.com/ory/kratos/blob/master/CONTRIBUTING.md).\r\n- [ ] This issue affects my [Ory Network](https://www.ory.sh/) project.\r\n- [X] I have joined the [Ory Community Slack](https://slack.ory.sh).\r\n- [X] I am signed up to the [Ory Security Patch Newsletter](https://ory.us10.list-manage.com/subscribe?u=ffb1a878e4ec6c0ed312a3480&id=f605a41b53).\r\n\r\n### Describe the bug\r\n\r\nWhen our kratos was deployed on this [custom commit](https://github.com/serlo/kratos/tree/next) the post registration webhook never failed and that was from 12 December 2022 until 8 April. Impressive 1461 times in which it always worked.\r\n\r\nSince 23 April we are using the version 0.13.0 and it failed 2 times out of 60. \r\n\r\nFor more info see https://github.com/serlo/infrastructure-modules-shared/issues/43\r\n\r\nMaybe side effect of https://github.com/ory/kratos/pull/3200\r\n\r\n### Reproducing the bug\r\n\r\nIt is hard to reproduce, even though I think some actions can be taken, like reverting it to the previous behavior without timeout. And is it doing retry?\r\n\r\n### Relevant log output\r\nBoth had timeout\r\n>```\"time=2023-04-24T14:29:35Z level=error msg=Webhook request failed audience=application duration=5m0.00090309s error=map[message:context deadline exceeded] otel=map[span_id:0000000000000000 trace_id:00000000000000000000000000000000] service_name=Ory Kratos service_version=v0.13.0\"```\r\n\r\nNevertheless, I doubt that the response took so long from the webhook endpoint.\r\n\r\n### Relevant configuration\r\n\r\n```yml\r\n      registration:\r\n          lifespan: 10m\r\n          ui_url: https://serlo-staging.dev/auth/registration\r\n          after:\r\n            hooks:\r\n              - hook: web_hook\r\n                config:\r\n                  url: https://api.serlo-staging.dev/kratos/register\r\n                  method: POST\r\n                  # function (ctx) { userId: ctx.identity.id }\r\n                  body: base64://ZnVuY3Rpb24gKGN0eCkgeyB1c2VySWQ6IGN0eC5pZGVudGl0eS5pZCB9Cg==\r\n                  auth:\r\n                    type: api_key\r\n                    config:\r\n                      name: x-kratos-key\r\n                      value: ${kratos_secret}\r\n                      in: header\r\n```\r\nSee https://github.com/serlo/infrastructure-modules-shared/blob/main/kratos/values.yaml#L99-L115\r\n\r\n### Version\r\n\r\n0.13.0\r\n\r\n### In which environment are you deploying?\r\n\r\nKubernetes with Helm\r\n", "closed_by": {"login": "alnr", "id": 3969502, "node_id": "MDQ6VXNlcjM5Njk1MDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3969502?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alnr", "html_url": "https://github.com/alnr", "followers_url": "https://api.github.com/users/alnr/followers", "following_url": "https://api.github.com/users/alnr/following{/other_user}", "gists_url": "https://api.github.com/users/alnr/gists{/gist_id}", "starred_url": "https://api.github.com/users/alnr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alnr/subscriptions", "organizations_url": "https://api.github.com/users/alnr/orgs", "repos_url": "https://api.github.com/users/alnr/repos", "events_url": "https://api.github.com/users/alnr/events{/privacy}", "received_events_url": "https://api.github.com/users/alnr/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/ory/kratos/issues/3258/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/ory/kratos/issues/3258/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/ory/kratos/issues/1915", "repository_url": "https://api.github.com/repos/ory/kratos", "labels_url": "https://api.github.com/repos/ory/kratos/issues/1915/labels{/name}", "comments_url": "https://api.github.com/repos/ory/kratos/issues/1915/comments", "events_url": "https://api.github.com/repos/ory/kratos/issues/1915/events", "html_url": "https://github.com/ory/kratos/issues/1915", "id": 1040754456, "node_id": "I_kwDOCBDZBc4-CKcY", "number": 1915, "title": "Failed to upgrade from 0.7.6-alpha1 -> 0.8.0-alpha3", "user": {"login": "meotimdihia", "id": 300961, "node_id": "MDQ6VXNlcjMwMDk2MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/300961?v=4", "gravatar_id": "", "url": "https://api.github.com/users/meotimdihia", "html_url": "https://github.com/meotimdihia", "followers_url": "https://api.github.com/users/meotimdihia/followers", "following_url": "https://api.github.com/users/meotimdihia/following{/other_user}", "gists_url": "https://api.github.com/users/meotimdihia/gists{/gist_id}", "starred_url": "https://api.github.com/users/meotimdihia/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/meotimdihia/subscriptions", "organizations_url": "https://api.github.com/users/meotimdihia/orgs", "repos_url": "https://api.github.com/users/meotimdihia/repos", "events_url": "https://api.github.com/users/meotimdihia/events{/privacy}", "received_events_url": "https://api.github.com/users/meotimdihia/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 948357241, "node_id": "MDU6TGFiZWw5NDgzNTcyNDE=", "url": "https://api.github.com/repos/ory/kratos/labels/bug", "name": "bug", "color": "F44336", "default": true, "description": "Something is not working."}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 17, "created_at": "2021-11-01T04:33:48Z", "updated_at": "2021-12-28T04:45:13Z", "closed_at": "2021-11-02T15:02:19Z", "assignee": null, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### Preflight checklist\n\n- [X] I could not find a solution in the existing issues, docs, nor discussions.\n- [X] I agree to follow this project's [Code of Conduct](https://github.com/ory/kratos/blob/master/CODE_OF_CONDUCT.md).\n- [X] I have read and am following this repository's [Contribution Guidelines](https://github.com/ory/kratos/blob/master/CONTRIBUTING.md).\n- [ ] This issue affects my [Ory Cloud](https://www.ory.sh/) project.\n- [X] I have joined the [Ory Community Slack](https://slack.ory.sh).\n- [ ] I am signed up to the [Ory Security Patch Newsletter](https://ory.us10.list-manage.com/subscribe?u=ffb1a878e4ec6c0ed312a3480&id=f605a41b53).\n\n### Describe the bug\n\nI have got these errors from migration logs: \r\n\r\n```shell\r\nkratos-migrate_1  | time=2021-11-01T04:27:48Z level=debug msg=Migration has not been applied but it might be a legacy migration, investigating. audience=application service_name=Ory Kratos service_version=v0.8.0-alpha.3 version=20210504121624000000\r\nkratos-migrate_1  | time=2021-11-01T04:27:48Z level=debug msg=Migration has not yet been applied, running migration. audience=application service_name=Ory Kratos service_version=v0.8.0-alpha.3 version=20210504121624000000\r\nkratos-migrate_1  | time=2021-11-01T04:27:48Z level=debug msg=0.2572 seconds audience=application service_name=Ory Kratos service_version=v0.8.0-alpha.3\r\nkratos-migrate_1  | time=2021-11-01T04:27:48Z level=warning msg=Migrator: unable to dump schema audience=application error=map[message:open schema.sql: permission denied] service_name=Ory Kratos service_version=v0.8.0-alpha.3\r\nkratos-migrate_1  | An error occurred while connecting to SQL: error executing migrations/sql/20210504121624000000_add_identity_states.postgres.up.sql, sql: ALTER TABLE \"identities\" ADD COLUMN \"state\" VARCHAR (255) NOT NULL DEFAULT 'active';: ERROR: column \"state\" of relation \"identities\" already exists (SQLSTATE 42701)\r\nlocalhost_kratos-migrate_1 exited with code 1\r\n```\r\n\r\nMigration hasn't been finished. An error occurred when I tried to log in.\r\n```\r\n{\"id\":\"d550f409-2d78-4ecc-94a7-27381c3dee39\",\"error\":{\"code\":500,\"status\":\"Internal Server Error\",\"message\":\"ERROR: column \\\"internal_context\\\" of relation \\\"selfservice_login_flows\\\" does not exist (SQLSTATE 42703)\"},\"created_at\":\"2021-11-01T04:27:41.524363Z\",\"updated_at\":\"2021-11-01T04:27:41.524363Z\"}\r\n```\r\n\r\n![WindowsTerminal_2021-11-01_11-32-48](https://user-images.githubusercontent.com/300961/139622043-9e8a3414-a307-4125-a6b2-21cb356c3f85.png)\r\n\n\n### Reproducing the bug\n\n`docker-compose -f quickstart.yml  up --build --force-recreate`\n\n### Relevant log output\n\n_No response_\n\n### Relevant configuration\n\n_No response_\n\n### Version\n\n0.7.6-alpha1\n\n### On which operating system are you observing this issue?\n\nWindows\n\n### In which environment are you deploying?\n\nDocker Compose\n\n### Additional Context\n\n_No response_", "closed_by": {"login": "meotimdihia", "id": 300961, "node_id": "MDQ6VXNlcjMwMDk2MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/300961?v=4", "gravatar_id": "", "url": "https://api.github.com/users/meotimdihia", "html_url": "https://github.com/meotimdihia", "followers_url": "https://api.github.com/users/meotimdihia/followers", "following_url": "https://api.github.com/users/meotimdihia/following{/other_user}", "gists_url": "https://api.github.com/users/meotimdihia/gists{/gist_id}", "starred_url": "https://api.github.com/users/meotimdihia/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/meotimdihia/subscriptions", "organizations_url": "https://api.github.com/users/meotimdihia/orgs", "repos_url": "https://api.github.com/users/meotimdihia/repos", "events_url": "https://api.github.com/users/meotimdihia/events{/privacy}", "received_events_url": "https://api.github.com/users/meotimdihia/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/ory/kratos/issues/1915/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/ory/kratos/issues/1915/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/ory/kratos/issues/1351", "repository_url": "https://api.github.com/repos/ory/kratos", "labels_url": "https://api.github.com/repos/ory/kratos/issues/1351/labels{/name}", "comments_url": "https://api.github.com/repos/ory/kratos/issues/1351/comments", "events_url": "https://api.github.com/repos/ory/kratos/issues/1351/events", "html_url": "https://github.com/ory/kratos/issues/1351", "id": 893479471, "node_id": "MDU6SXNzdWU4OTM0Nzk0NzE=", "number": 1351, "title": "Invalid courier template file called email.body.plaintext.gotmpl", "user": {"login": "anonrig", "id": 1935246, "node_id": "MDQ6VXNlcjE5MzUyNDY=", "avatar_url": "https://avatars.githubusercontent.com/u/1935246?v=4", "gravatar_id": "", "url": "https://api.github.com/users/anonrig", "html_url": "https://github.com/anonrig", "followers_url": "https://api.github.com/users/anonrig/followers", "following_url": "https://api.github.com/users/anonrig/following{/other_user}", "gists_url": "https://api.github.com/users/anonrig/gists{/gist_id}", "starred_url": "https://api.github.com/users/anonrig/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/anonrig/subscriptions", "organizations_url": "https://api.github.com/users/anonrig/orgs", "repos_url": "https://api.github.com/users/anonrig/repos", "events_url": "https://api.github.com/users/anonrig/events{/privacy}", "received_events_url": "https://api.github.com/users/anonrig/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 948357241, "node_id": "MDU6TGFiZWw5NDgzNTcyNDE=", "url": "https://api.github.com/repos/ory/kratos/labels/bug", "name": "bug", "color": "F44336", "default": true, "description": "Something is not working."}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 17, "created_at": "2021-05-17T15:58:44Z", "updated_at": "2021-05-21T19:40:54Z", "closed_at": "2021-05-21T19:40:54Z", "assignee": null, "author_association": "CONTRIBUTOR", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "**Describe the bug**\r\n\r\nI'm receiving an error on forgot password action, and even though I have the necessary templates, and it did work before the 0.6 release, it now throws an error:\r\n\r\nopen /conf/courier-templates/recovery/invalid/email.body.plaintext.gotmpl: no such file or directory \r\n \r\n**Reproducing the bug**\r\n\r\nSteps to reproduce the behavior:\r\n\r\n1. Deploy using the helm chart\r\n2. Use v0.6.2-alpha.1\r\n\r\n_Server logs_\r\n\r\n```\r\ntime=2021-05-17T15:39:30Z level=info msg=Encountered self-service recovery error. audience=audit error=map[message:open /conf/courier-templates/recovery/invalid/email.body.plaintext.gotmpl: no such file or directory] http_request=map[headers:map[accept:text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9 accept-encoding:gzip accept-language:en-US,en;q=0.9,tr;q=0.8 cache-control:max-age=0 cookie:Value is sensitive and has been redacted. To see the value set config key \"log.leak_sensitive_values = true\" or environment variable \"LOG_LEAK_SENSITIVE_VALUES=true\". origin:https://WEB_DOMAIN_URL referer:https://WEB_DOMAIN_URL/ user-agent:Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/90.0.4430.93 Safari/537.36 Edg/90.0.818.56 x-forwarded-for:XFORWARDEDFOR x-forwarded-proto:http] host:KRATOS_URL method:POST path:/self-service/recovery query:Value is sensitive and has been redacted. To see the value set config key \"log.leak_sensitive_values = true\" or environment variable \"LOG_LEAK_SENSITIVE_VALUES=true\". remote:10.244.0.187:58618 scheme:http] recovery_flow=&{afda7f1a-bda2-4b46-9c94-41b934002055 browser 2021-05-17 16:39:14.250301 +0000 UTC 2021-05-17 15:39:14.250301 +0000 UTC http://KRATOS_URL/self-service/recovery/browser 0xc000bac730 choose_method qHD1dh7UexjU1BNpuJl+RAwvqCcmvRcaKpvKViIV/zmgVAM3Ke7ltYeQwuHQYYLoVQoRk4aCiaNl4aNbcpgz+g== 2021-05-17 15:39:14.25136 +0000 UTC 2021-05-17 15:39:14.25136 +0000 UTC {00000000-0000-0000-0000-000000000000 false} 8f5b721e-862a-43c1-ba4f-6137567952c2} service_name=Ory Kratos service_version=v0.6.2-alpha.1\r\ntime=2021-05-17T15:39:30Z level=error msg=An error occurred and is being forwarded to the error user interface. audience=application error=map[message:open /conf/courier-templates/recovery/invalid/email.body.plaintext.gotmpl: no such file or directory] http_request=map[headers:map[accept:text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9 accept-encoding:gzip accept-language:en-US,en;q=0.9,tr;q=0.8 cache-control:max-age=0 cookie:Value is sensitive and has been redacted. To see the value set config key \"log.leak_sensitive_values = true\" or environment variable \"LOG_LEAK_SENSITIVE_VALUES=true\". origin:https://WEB_DOMAIN_URL referer:https://WEB_DOMAIN_URL/ user-agent:Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/90.0.4430.93 Safari/537.36 Edg/90.0.818.56 x-forwarded-for:XFORWARDEDFOR x-forwarded-proto:http] host:KRATOS_URL method:POST path:/self-service/recovery query:Value is sensitive and has been redacted. To see the value set config key \"log.leak_sensitive_values = true\" or environment variable \"LOG_LEAK_SENSITIVE_VALUES=true\". remote:10.244.0.187:58618 scheme:http] service_name=Ory Kratos service_version=v0.6.2-alpha.1\r\n```\r\n\r\n_Server configuration_\r\n\r\n```yaml\r\n  emailTemplates:\r\n    recovery:\r\n      valid:\r\n        subject: Recover access to your account\r\n        body: |-\r\n          EMAIL\r\n      invalid:\r\n        subject: Account access attempted\r\n        body: |-\r\n          EMAIL\r\n    verification:\r\n      valid:\r\n        subject: Please verify your email address\r\n        body: |-\r\n          EMAIL\r\n      invalid:\r\n        subject:\r\n        body:\r\n```\r\n\r\n**Expected behavior**\r\n\r\nIt should send a proper password recovery email.\r\n\r\n**Environment**\r\n\r\n- Version: v0.6.2-alpha.1\r\n- Environment: Helm\r\n\r\n**Additional context**\r\n\r\nI checked, /conf/courier-templates/recovery/invalid/email.body.plaintext.gotmpl file does not exist but email.body.gotmpl exists.\r\n", "closed_by": {"login": "aeneasr", "id": 3372410, "node_id": "MDQ6VXNlcjMzNzI0MTA=", "avatar_url": "https://avatars.githubusercontent.com/u/3372410?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aeneasr", "html_url": "https://github.com/aeneasr", "followers_url": "https://api.github.com/users/aeneasr/followers", "following_url": "https://api.github.com/users/aeneasr/following{/other_user}", "gists_url": "https://api.github.com/users/aeneasr/gists{/gist_id}", "starred_url": "https://api.github.com/users/aeneasr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aeneasr/subscriptions", "organizations_url": "https://api.github.com/users/aeneasr/orgs", "repos_url": "https://api.github.com/users/aeneasr/repos", "events_url": "https://api.github.com/users/aeneasr/events{/privacy}", "received_events_url": "https://api.github.com/users/aeneasr/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/ory/kratos/issues/1351/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/ory/kratos/issues/1351/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/ory/kratos/issues/1141", "repository_url": "https://api.github.com/repos/ory/kratos", "labels_url": "https://api.github.com/repos/ory/kratos/issues/1141/labels{/name}", "comments_url": "https://api.github.com/repos/ory/kratos/issues/1141/comments", "events_url": "https://api.github.com/repos/ory/kratos/issues/1141/events", "html_url": "https://github.com/ory/kratos/issues/1141", "id": 829768378, "node_id": "MDU6SXNzdWU4Mjk3NjgzNzg=", "number": 1141, "title": "Account Recovery API flow requires CSRF cookie", "user": {"login": "zhengm-hub", "id": 12727813, "node_id": "MDQ6VXNlcjEyNzI3ODEz", "avatar_url": "https://avatars.githubusercontent.com/u/12727813?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zhengm-hub", "html_url": "https://github.com/zhengm-hub", "followers_url": "https://api.github.com/users/zhengm-hub/followers", "following_url": "https://api.github.com/users/zhengm-hub/following{/other_user}", "gists_url": "https://api.github.com/users/zhengm-hub/gists{/gist_id}", "starred_url": "https://api.github.com/users/zhengm-hub/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zhengm-hub/subscriptions", "organizations_url": "https://api.github.com/users/zhengm-hub/orgs", "repos_url": "https://api.github.com/users/zhengm-hub/repos", "events_url": "https://api.github.com/users/zhengm-hub/events{/privacy}", "received_events_url": "https://api.github.com/users/zhengm-hub/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 948357241, "node_id": "MDU6TGFiZWw5NDgzNTcyNDE=", "url": "https://api.github.com/repos/ory/kratos/labels/bug", "name": "bug", "color": "F44336", "default": true, "description": "Something is not working."}], "state": "closed", "locked": false, "assignees": [{"login": "aeneasr", "id": 3372410, "node_id": "MDQ6VXNlcjMzNzI0MTA=", "avatar_url": "https://avatars.githubusercontent.com/u/3372410?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aeneasr", "html_url": "https://github.com/aeneasr", "followers_url": "https://api.github.com/users/aeneasr/followers", "following_url": "https://api.github.com/users/aeneasr/following{/other_user}", "gists_url": "https://api.github.com/users/aeneasr/gists{/gist_id}", "starred_url": "https://api.github.com/users/aeneasr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aeneasr/subscriptions", "organizations_url": "https://api.github.com/users/aeneasr/orgs", "repos_url": "https://api.github.com/users/aeneasr/repos", "events_url": "https://api.github.com/users/aeneasr/events{/privacy}", "received_events_url": "https://api.github.com/users/aeneasr/received_events", "type": "User", "user_view_type": "public", "site_admin": false}], "milestone": {"url": "https://api.github.com/repos/ory/kratos/milestones/9", "html_url": "https://github.com/ory/kratos/milestone/9", "labels_url": "https://api.github.com/repos/ory/kratos/milestones/9/labels", "id": 5702023, "node_id": "MDk6TWlsZXN0b25lNTcwMjAyMw==", "number": 9, "title": "v0.7.0-alpha.1", "description": null, "creator": {"login": "aeneasr", "id": 3372410, "node_id": "MDQ6VXNlcjMzNzI0MTA=", "avatar_url": "https://avatars.githubusercontent.com/u/3372410?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aeneasr", "html_url": "https://github.com/aeneasr", "followers_url": "https://api.github.com/users/aeneasr/followers", "following_url": "https://api.github.com/users/aeneasr/following{/other_user}", "gists_url": "https://api.github.com/users/aeneasr/gists{/gist_id}", "starred_url": "https://api.github.com/users/aeneasr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aeneasr/subscriptions", "organizations_url": "https://api.github.com/users/aeneasr/orgs", "repos_url": "https://api.github.com/users/aeneasr/repos", "events_url": "https://api.github.com/users/aeneasr/events{/privacy}", "received_events_url": "https://api.github.com/users/aeneasr/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "open_issues": 0, "closed_issues": 37, "state": "closed", "created_at": "2020-07-27T10:23:37Z", "updated_at": "2021-07-13T15:29:36Z", "due_on": null, "closed_at": "2021-07-13T15:29:36Z"}, "comments": 16, "created_at": "2021-03-12T05:21:03Z", "updated_at": "2021-05-20T16:03:55Z", "closed_at": "2021-05-17T12:09:13Z", "assignee": {"login": "aeneasr", "id": 3372410, "node_id": "MDQ6VXNlcjMzNzI0MTA=", "avatar_url": "https://avatars.githubusercontent.com/u/3372410?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aeneasr", "html_url": "https://github.com/aeneasr", "followers_url": "https://api.github.com/users/aeneasr/followers", "following_url": "https://api.github.com/users/aeneasr/following{/other_user}", "gists_url": "https://api.github.com/users/aeneasr/gists{/gist_id}", "starred_url": "https://api.github.com/users/aeneasr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aeneasr/subscriptions", "organizations_url": "https://api.github.com/users/aeneasr/orgs", "repos_url": "https://api.github.com/users/aeneasr/repos", "events_url": "https://api.github.com/users/aeneasr/events{/privacy}", "received_events_url": "https://api.github.com/users/aeneasr/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "tool: POSTMAN\r\n1. GET http://127.0.0.1:4433/self-service/recovery/api\r\nresponse: \r\n{\r\n    \"id\": \"d2fa5fe6-bb5e-4cfe-8ae3-3c4d807859de\",\r\n    \"type\": \"api\",\r\n    \"expires_at\": \"2021-03-12T05:14:44.337986Z\",\r\n    \"issued_at\": \"2021-03-12T04:14:44.337986Z\",\r\n    \"request_url\": \"http://127.0.0.1:4433/self-service/recovery/api\",\r\n    \"messages\": null,\r\n    \"methods\": {\r\n        \"link\": {\r\n            \"method\": \"link\",\r\n            \"config\": {\r\n                \"action\": \"http://127.0.0.1:4433/self-service/recovery/methods/link?flow=d2fa5fe6-bb5e-4cfe-8ae3-3c4d807859de\",\r\n                \"method\": \"POST\",\r\n                \"fields\": [\r\n                    {\r\n                        \"name\": \"csrf_token\",\r\n                        \"type\": \"hidden\",\r\n                        \"required\": true,\r\n                        \"value\": \"\"\r\n                    },\r\n                    {\r\n                        \"name\": \"email\",\r\n                        \"type\": \"email\",\r\n                        \"required\": true\r\n                    }\r\n                ]\r\n            }\r\n        }\r\n    },\r\n    \"state\": \"choose_method\"\r\n}\r\n2. POLT http://127.0.0.1:4433/self-service/recovery/methods/link?flow=d2fa5fe6-bb5e-4cfe-8ae3-3c4d807859de\r\nbody: \r\n{\r\n  \"email\":\"zh_ming@aliyun.com\"\r\n}\r\nresponse: \r\n{\r\n    \"error\": {\r\n        \"code\": 400,\r\n        \"status\": \"Bad Request\",\r\n        \"reason\": \"CSRF token is missing or invalid.\",\r\n        \"message\": \"The request was malformed or contained invalid parameters\"\r\n    }\r\n}\r\n\r\nWhy is that? I wonder\r\n\r\n", "closed_by": {"login": "aeneasr", "id": 3372410, "node_id": "MDQ6VXNlcjMzNzI0MTA=", "avatar_url": "https://avatars.githubusercontent.com/u/3372410?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aeneasr", "html_url": "https://github.com/aeneasr", "followers_url": "https://api.github.com/users/aeneasr/followers", "following_url": "https://api.github.com/users/aeneasr/following{/other_user}", "gists_url": "https://api.github.com/users/aeneasr/gists{/gist_id}", "starred_url": "https://api.github.com/users/aeneasr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aeneasr/subscriptions", "organizations_url": "https://api.github.com/users/aeneasr/orgs", "repos_url": "https://api.github.com/users/aeneasr/repos", "events_url": "https://api.github.com/users/aeneasr/events{/privacy}", "received_events_url": "https://api.github.com/users/aeneasr/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/ory/kratos/issues/1141/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/ory/kratos/issues/1141/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/ory/kratos/issues/3317", "repository_url": "https://api.github.com/repos/ory/kratos", "labels_url": "https://api.github.com/repos/ory/kratos/issues/3317/labels{/name}", "comments_url": "https://api.github.com/repos/ory/kratos/issues/3317/comments", "events_url": "https://api.github.com/repos/ory/kratos/issues/3317/events", "html_url": "https://github.com/ory/kratos/pull/3317", "id": 1756563271, "node_id": "PR_kwDOCBDZBc5S-fTj", "number": 3317, "title": "fix: don't assume the login challenge to be a UUID", "user": {"login": "hperl", "id": 34397, "node_id": "MDQ6VXNlcjM0Mzk3", "avatar_url": "https://avatars.githubusercontent.com/u/34397?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hperl", "html_url": "https://github.com/hperl", "followers_url": "https://api.github.com/users/hperl/followers", "following_url": "https://api.github.com/users/hperl/following{/other_user}", "gists_url": "https://api.github.com/users/hperl/gists{/gist_id}", "starred_url": "https://api.github.com/users/hperl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hperl/subscriptions", "organizations_url": "https://api.github.com/users/hperl/orgs", "repos_url": "https://api.github.com/users/hperl/repos", "events_url": "https://api.github.com/users/hperl/events{/privacy}", "received_events_url": "https://api.github.com/users/hperl/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 948357241, "node_id": "MDU6TGFiZWw5NDgzNTcyNDE=", "url": "https://api.github.com/repos/ory/kratos/labels/bug", "name": "bug", "color": "F44336", "default": true, "description": "Something is not working."}], "state": "closed", "locked": false, "assignees": [{"login": "hperl", "id": 34397, "node_id": "MDQ6VXNlcjM0Mzk3", "avatar_url": "https://avatars.githubusercontent.com/u/34397?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hperl", "html_url": "https://github.com/hperl", "followers_url": "https://api.github.com/users/hperl/followers", "following_url": "https://api.github.com/users/hperl/following{/other_user}", "gists_url": "https://api.github.com/users/hperl/gists{/gist_id}", "starred_url": "https://api.github.com/users/hperl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hperl/subscriptions", "organizations_url": "https://api.github.com/users/hperl/orgs", "repos_url": "https://api.github.com/users/hperl/repos", "events_url": "https://api.github.com/users/hperl/events{/privacy}", "received_events_url": "https://api.github.com/users/hperl/received_events", "type": "User", "user_view_type": "public", "site_admin": false}], "milestone": null, "comments": 1, "created_at": "2023-06-14T10:26:57Z", "updated_at": "2023-06-19T11:59:04Z", "closed_at": "2023-06-19T11:59:03Z", "assignee": {"login": "hperl", "id": 34397, "node_id": "MDQ6VXNlcjM0Mzk3", "avatar_url": "https://avatars.githubusercontent.com/u/34397?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hperl", "html_url": "https://github.com/hperl", "followers_url": "https://api.github.com/users/hperl/followers", "following_url": "https://api.github.com/users/hperl/following{/other_user}", "gists_url": "https://api.github.com/users/hperl/gists{/gist_id}", "starred_url": "https://api.github.com/users/hperl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hperl/subscriptions", "organizations_url": "https://api.github.com/users/hperl/orgs", "repos_url": "https://api.github.com/users/hperl/repos", "events_url": "https://api.github.com/users/hperl/events{/privacy}", "received_events_url": "https://api.github.com/users/hperl/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "author_association": "CONTRIBUTOR", "type": null, "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/ory/kratos/pulls/3317", "html_url": "https://github.com/ory/kratos/pull/3317", "diff_url": "https://github.com/ory/kratos/pull/3317.diff", "patch_url": "https://github.com/ory/kratos/pull/3317.patch", "merged_at": "2023-06-19T11:59:03Z"}, "body": "\n<!--\nDescribe the big picture of your changes here to communicate to the maintainers why we should accept this pull request.\n\nThis text will be included in the changelog. If applicable, include links to documentation or pieces of code.\nIf your change includes breaking changes please add a code block documenting the breaking change:\n\n```\nBREAKING CHANGES: This patch changes the behavior of configuration item `foo` to do bar. To keep the existing\nbehavior please do baz.\n```\n-->\n\n## Related issue(s)\n\n<!--\nIf this pull request\n\n1. is a fix for a known bug, link the issue where the bug was reported in the format of `#1234`;\n2. is a fix for a previously unknown bug, explain the bug and how to reproduce it in this pull request;\n3. implements a new feature, link the issue containing the design document in the format of `#1234`;\n4. improves the documentation, no issue reference is required.\n\nPull requests introducing new features, which do not have a design document linked are more likely to be rejected and take on average 2-8 weeks longer to\nget merged.\n\nYou can discuss changes with maintainers either in the Github Discussions in this repository or\njoin the [Ory Chat](https://www.ory.sh/chat).\n-->\n\n## Checklist\n\n<!--\nPut an `x` in the boxes that apply. You can also fill these out after creating the PR.\n\nPlease be aware that pull requests must have all boxes ticked in order to be merged.\n\nIf you're unsure about any of them, don't hesitate to ask. We're here to help!\n-->\n\n- [ ] I have read the [contributing guidelines](../blob/master/CONTRIBUTING.md).\n- [ ] I have referenced an issue containing the design document if my change\n      introduces a new feature.\n- [ ] I am following the\n      [contributing code guidelines](../blob/master/CONTRIBUTING.md#contributing-code).\n- [ ] I have read the [security policy](../security/policy).\n- [ ] I confirm that this pull request does not address a security\n      vulnerability. If this pull request addresses a security vulnerability, I\n      confirm that I got the approval (please contact\n      [security@ory.sh](mailto:security@ory.sh)) from the maintainers to push\n      the changes.\n- [ ] I have added tests that prove my fix is effective or that my feature\n      works.\n- [ ] I have added or changed [the documentation](https://github.com/ory/docs).\n\n## Further Comments\n\n<!--\nIf this is a relatively large or complex change, kick off the discussion by explaining why you chose the solution\nyou did and what alternatives you considered, etc...\n-->\n", "closed_by": {"login": "aeneasr", "id": 3372410, "node_id": "MDQ6VXNlcjMzNzI0MTA=", "avatar_url": "https://avatars.githubusercontent.com/u/3372410?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aeneasr", "html_url": "https://github.com/aeneasr", "followers_url": "https://api.github.com/users/aeneasr/followers", "following_url": "https://api.github.com/users/aeneasr/following{/other_user}", "gists_url": "https://api.github.com/users/aeneasr/gists{/gist_id}", "starred_url": "https://api.github.com/users/aeneasr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aeneasr/subscriptions", "organizations_url": "https://api.github.com/users/aeneasr/orgs", "repos_url": "https://api.github.com/users/aeneasr/repos", "events_url": "https://api.github.com/users/aeneasr/events{/privacy}", "received_events_url": "https://api.github.com/users/aeneasr/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/ory/kratos/issues/3317/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/ory/kratos/issues/3317/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/ory/kratos/issues/2922", "repository_url": "https://api.github.com/repos/ory/kratos", "labels_url": "https://api.github.com/repos/ory/kratos/issues/2922/labels{/name}", "comments_url": "https://api.github.com/repos/ory/kratos/issues/2922/comments", "events_url": "https://api.github.com/repos/ory/kratos/issues/2922/events", "html_url": "https://github.com/ory/kratos/issues/2922", "id": 1473071962, "node_id": "I_kwDOCBDZBc5XzUta", "number": 2922, "title": "CORS Headers aren't being added to response", "user": {"login": "jwmay2012", "id": 7596383, "node_id": "MDQ6VXNlcjc1OTYzODM=", "avatar_url": "https://avatars.githubusercontent.com/u/7596383?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwmay2012", "html_url": "https://github.com/jwmay2012", "followers_url": "https://api.github.com/users/jwmay2012/followers", "following_url": "https://api.github.com/users/jwmay2012/following{/other_user}", "gists_url": "https://api.github.com/users/jwmay2012/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwmay2012/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwmay2012/subscriptions", "organizations_url": "https://api.github.com/users/jwmay2012/orgs", "repos_url": "https://api.github.com/users/jwmay2012/repos", "events_url": "https://api.github.com/users/jwmay2012/events{/privacy}", "received_events_url": "https://api.github.com/users/jwmay2012/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 948357241, "node_id": "MDU6TGFiZWw5NDgzNTcyNDE=", "url": "https://api.github.com/repos/ory/kratos/labels/bug", "name": "bug", "color": "F44336", "default": true, "description": "Something is not working."}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 15, "created_at": "2022-12-02T15:46:41Z", "updated_at": "2023-01-10T17:08:17Z", "closed_at": "2022-12-07T14:23:33Z", "assignee": null, "author_association": "CONTRIBUTOR", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### Preflight checklist\n\n- [X] I could not find a solution in the existing issues, docs, nor discussions.\n- [X] I agree to follow this project's [Code of Conduct](https://github.com/ory/kratos/blob/master/CODE_OF_CONDUCT.md).\n- [X] I have read and am following this repository's [Contribution Guidelines](https://github.com/ory/kratos/blob/master/CONTRIBUTING.md).\n- [ ] This issue affects my [Ory Network](https://www.ory.sh/) project.\n- [X] I have joined the [Ory Community Slack](https://slack.ory.sh).\n- [ ] I am signed up to the [Ory Security Patch Newsletter](https://ory.us10.list-manage.com/subscribe?u=ffb1a878e4ec6c0ed312a3480&id=f605a41b53).\n\n### Describe the bug\n\nCORS related headers are claimed by kratos logs to be added to `/self-service/login/browser` response, but no such headers are present.\r\n\r\n\n\n### Reproducing the bug\n\n`curl -v -H \"Origin: https://mydomain.com/\" -H \"Accept: application/json\" http://auth.mydomain.com/self-service/login/browser`\r\n\r\n```\r\n...\r\n< HTTP/1.1 200 OK\r\n< Cache-Control: private, no-cache, no-store, must-revalidate\r\n< Content-Type: application/json; charset=utf-8\r\n< Set-Cookie: csrf_token_5c51a995dd623ddb0e303f9eaf4401a59ccc98b62b61aebc2deae2ca0c291484=gFj0H6qF1crfDdy2yedTkVggypxI3Lx9tsFzSqyzprg=; Path=/; Domain=mydomain.com; Max-Age=31536000; HttpOnly; Secure; SameSite=Lax\r\n< Vary: Cookie\r\n< Date: Thu, 01 Dec 2022 22:06:17 GMT\r\n< Content-Length: 1983\r\n...\r\n```\r\nNotice absence of any CORS headers.\r\n\r\n`[cors]` logs claim proper headers were added. CURL/Browser disagrees. \n\n### Relevant log output\n\n```shell\ntime=2022-12-01T22:07:07Z level=info msg=started handling request http_request=map[headers:map[accept:application/json origin:https://mydomain.com/ user-agent:curl/7.86.0] host:kratos-public method:GET path:/self-service/login/browser query:<nil> remote:252.64.130.136:55654 scheme:http]\r\n[cors] 2022/12/01 22:07:07 ServeHTTP: Actual request\r\n\r\n[cors] 2022/12/01 22:07:07   Actual response added headers: map[Access-Control-Allow-Credentials:[true] Access-Control-Allow-Origin:[https://mydoamin.com] Access-Control-Expose-Headers:[Content-Type, Set-Cookie] Cache-Control:[private, no-cache, no-store, must-revalidate] Content-Type:[application/json; charset=utf-8] Set-Cookie:[csrf_token_5c51a995dd623ddb0e303f9eaf4401a59ccc98b62b61aebc2deae2ca0c291484=WZg0C6YgiwgCbm/xCYlQzqFN1b9iOdmabk41fSA72Fs=; Path=/; Domain=mydomain.com; Max-Age=31536000; HttpOnly; Secure; SameSite=Lax] Vary:[Cookie Origin]]\r\n\r\ntime=2022-12-01T22:07:07Z level=info msg=completed handling request http_request=map[headers:map[accept:application/json origin:https://mydomain.com/ user-agent:curl/7.86.0] host:kratos-public method:GET path:/self-service/login/browser query:<nil> remote:252.64.130.136:55654 scheme:http] http_response=map[headers:map[access-control-allow-credentials:true access-control-allow-origin:https://mydoamin.com access-control-expose-headers:Content-Type, Set-Cookie cache-control:private, no-cache, no-store, must-revalidate content-type:application/json; charset=utf-8 set-cookie:[csrf_token_5c51a995dd623ddb0e303f9eaf4401a59ccc98b62b61aebc2deae2ca0c291484=WZg0C6YgiwgCbm/xCYlQzqFN1b9iOdmabk41fSA72Fs=; Path=/; Domain=mydomain.com; Max-Age=31536000; HttpOnly; Secure; SameSite=Lax] vary:Cookie] size:1983 status:200 text_status:OK took:10.017559ms]\n```\n\n\n### Relevant configuration\n\n```yml\nserve:\r\n  public:\r\n    base_url: https://auth.mydomain.com/\r\n    cors:\r\n      enabled: true\r\n      debug: true\r\n      allowed_origins:\r\n      - https://mydomain.com/\r\n      allowed_methods:\r\n      - POST\r\n      - GET\r\n      - PUT\r\n      - PATCH\r\n      - DELETE\r\n      allowed_headers:\r\n      - Authorization\r\n      - Cookie\r\n      - Content-Type\r\n      exposed_headers:\r\n      - Content-Type\r\n      - Set-Cookie\n```\n\n\n### Version\n\nv0.11.0-alpha.0.pre.2\n\n### On which operating system are you observing this issue?\n\nLinux\n\n### In which environment are you deploying?\n\nKubernetes\n\n### Additional Context\n\nBrowser's view:\r\n```\r\nAccess to XMLHttpRequest at 'https://auth.mydomain.com/self-service/login/browser' from origin 'https://mydomain.com/' has been blocked by CORS policy: No 'Access-Control-Allow-Origin' header is present on the requested resource.\r\n```\r\n\r\nWorkaround is to manually set the CORS headers with a reverse proxy like Traefik.", "closed_by": {"login": "alnr", "id": 3969502, "node_id": "MDQ6VXNlcjM5Njk1MDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3969502?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alnr", "html_url": "https://github.com/alnr", "followers_url": "https://api.github.com/users/alnr/followers", "following_url": "https://api.github.com/users/alnr/following{/other_user}", "gists_url": "https://api.github.com/users/alnr/gists{/gist_id}", "starred_url": "https://api.github.com/users/alnr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alnr/subscriptions", "organizations_url": "https://api.github.com/users/alnr/orgs", "repos_url": "https://api.github.com/users/alnr/repos", "events_url": "https://api.github.com/users/alnr/events{/privacy}", "received_events_url": "https://api.github.com/users/alnr/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/ory/kratos/issues/2922/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/ory/kratos/issues/2922/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/ory/kratos/issues/1960", "repository_url": "https://api.github.com/repos/ory/kratos", "labels_url": "https://api.github.com/repos/ory/kratos/issues/1960/labels{/name}", "comments_url": "https://api.github.com/repos/ory/kratos/issues/1960/comments", "events_url": "https://api.github.com/repos/ory/kratos/issues/1960/events", "html_url": "https://github.com/ory/kratos/issues/1960", "id": 1056643785, "node_id": "I_kwDOCBDZBc4--xrJ", "number": 1960, "title": "Kratos courier: can't evaluate field Identity", "user": {"login": "viters", "id": 13100466, "node_id": "MDQ6VXNlcjEzMTAwNDY2", "avatar_url": "https://avatars.githubusercontent.com/u/13100466?v=4", "gravatar_id": "", "url": "https://api.github.com/users/viters", "html_url": "https://github.com/viters", "followers_url": "https://api.github.com/users/viters/followers", "following_url": "https://api.github.com/users/viters/following{/other_user}", "gists_url": "https://api.github.com/users/viters/gists{/gist_id}", "starred_url": "https://api.github.com/users/viters/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/viters/subscriptions", "organizations_url": "https://api.github.com/users/viters/orgs", "repos_url": "https://api.github.com/users/viters/repos", "events_url": "https://api.github.com/users/viters/events{/privacy}", "received_events_url": "https://api.github.com/users/viters/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 948357241, "node_id": "MDU6TGFiZWw5NDgzNTcyNDE=", "url": "https://api.github.com/repos/ory/kratos/labels/bug", "name": "bug", "color": "F44336", "default": true, "description": "Something is not working."}], "state": "closed", "locked": false, "assignees": [], "milestone": {"url": "https://api.github.com/repos/ory/kratos/milestones/15", "html_url": "https://github.com/ory/kratos/milestone/15", "labels_url": "https://api.github.com/repos/ory/kratos/milestones/15/labels", "id": 7065816, "node_id": "MI_kwDOCBDZBc4Aa9DY", "number": 15, "title": "v1.0.0", "description": "", "creator": {"login": "aeneasr", "id": 3372410, "node_id": "MDQ6VXNlcjMzNzI0MTA=", "avatar_url": "https://avatars.githubusercontent.com/u/3372410?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aeneasr", "html_url": "https://github.com/aeneasr", "followers_url": "https://api.github.com/users/aeneasr/followers", "following_url": "https://api.github.com/users/aeneasr/following{/other_user}", "gists_url": "https://api.github.com/users/aeneasr/gists{/gist_id}", "starred_url": "https://api.github.com/users/aeneasr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aeneasr/subscriptions", "organizations_url": "https://api.github.com/users/aeneasr/orgs", "repos_url": "https://api.github.com/users/aeneasr/repos", "events_url": "https://api.github.com/users/aeneasr/events{/privacy}", "received_events_url": "https://api.github.com/users/aeneasr/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "open_issues": 4, "closed_issues": 89, "state": "open", "created_at": "2021-08-17T10:14:38Z", "updated_at": "2025-11-10T00:03:30Z", "due_on": null, "closed_at": null}, "comments": 15, "created_at": "2021-11-17T21:20:39Z", "updated_at": "2023-03-13T19:44:27Z", "closed_at": "2022-08-12T09:58:31Z", "assignee": null, "author_association": "CONTRIBUTOR", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### Preflight checklist\r\n\r\n- [X] I could not find a solution in the existing issues, docs, nor discussions.\r\n- [X] I agree to follow this project's [Code of Conduct](https://github.com/ory/kratos/blob/master/CODE_OF_CONDUCT.md).\r\n- [X] I have read and am following this repository's [Contribution Guidelines](https://github.com/ory/kratos/blob/master/CONTRIBUTING.md).\r\n- [ ] This issue affects my [Ory Cloud](https://www.ory.sh/) project.\r\n- [ ] I have joined the [Ory Community Slack](https://slack.ory.sh).\r\n- [ ] I am signed up to the [Ory Security Patch Newsletter](https://ory.us10.list-manage.com/subscribe?u=ffb1a878e4ec6c0ed312a3480&id=f605a41b53).\r\n\r\n### Describe the bug\r\n\r\nI am trying to use Identity in email templates, according to documentation https://www.ory.sh/kratos/docs/concepts/email-sms/#the-identity-attribute.\r\n\r\nIf I use `.Identity` in template, process breaks.\r\n![obraz](https://user-images.githubusercontent.com/13100466/142287055-ea19c7a4-3825-47b8-9633-14e77b669430.png)\r\n\r\n\r\n### Reproducing the bug\r\n\r\n1. Run Kratos without courier.\r\n2. Run standalone courier.\r\n3. Mount templates to both Kratos and Courier and use `.Identity`.\r\n4. Send email.\r\n\r\n### Relevant log output\r\n\r\n```shell\r\ntime=2021-11-17T21:11:17Z level=error msg=Unable to get email body from template. audience=application error=map[message:template: verification/valid/email.body.gotmpl:144:167: executing \"verification/valid/email.body.gotmpl\" at <.Identity.traits.name.first>: can't evaluate field Identity in type *template.VerificationValidModel] message_id=bfa3fcf7-3130-4a0b-861f-3f2168bb9d6e service_name=Ory Kratos service_version=v0.8.0-alpha.3\r\ntime=2021-11-17T21:15:46Z level=error msg=Unable to get email body from template. audience=application error=map[message:template: recovery/valid/email.body.gotmpl:144:167: executing \"recovery/valid/email.body.gotmpl\" at <.Identity.traits.name.first>: can't evaluate field Identity in type *template.RecoveryValidModel] message_id=f59ae8a4-5738-4069-a808-07a7f91ece27 service_name=Ory Kratos service_version=v0.8.0-alpha.3\r\n```\r\n\r\n\r\n### Relevant configuration\r\n\r\n_No response_\r\n\r\n### Version\r\n\r\nv0.8.0-alpha.3\r\n\r\n### On which operating system are you observing this issue?\r\n\r\nLinux\r\n\r\n### In which environment are you deploying?\r\n\r\nKubernetes\r\n\r\n### Additional Context\r\n\r\n_No response_", "closed_by": {"login": "viters", "id": 13100466, "node_id": "MDQ6VXNlcjEzMTAwNDY2", "avatar_url": "https://avatars.githubusercontent.com/u/13100466?v=4", "gravatar_id": "", "url": "https://api.github.com/users/viters", "html_url": "https://github.com/viters", "followers_url": "https://api.github.com/users/viters/followers", "following_url": "https://api.github.com/users/viters/following{/other_user}", "gists_url": "https://api.github.com/users/viters/gists{/gist_id}", "starred_url": "https://api.github.com/users/viters/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/viters/subscriptions", "organizations_url": "https://api.github.com/users/viters/orgs", "repos_url": "https://api.github.com/users/viters/repos", "events_url": "https://api.github.com/users/viters/events{/privacy}", "received_events_url": "https://api.github.com/users/viters/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/ory/kratos/issues/1960/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/ory/kratos/issues/1960/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/ory/kratos/issues/3384", "repository_url": "https://api.github.com/repos/ory/kratos", "labels_url": "https://api.github.com/repos/ory/kratos/issues/3384/labels{/name}", "comments_url": "https://api.github.com/repos/ory/kratos/issues/3384/comments", "events_url": "https://api.github.com/repos/ory/kratos/issues/3384/events", "html_url": "https://github.com/ory/kratos/issues/3384", "id": 1816296778, "node_id": "I_kwDOCBDZBc5sQn1K", "number": 3384, "title": "Google OIDC not containing the necessary cookie to resume session when using HTTP API", "user": {"login": "eddingston", "id": 40420154, "node_id": "MDQ6VXNlcjQwNDIwMTU0", "avatar_url": "https://avatars.githubusercontent.com/u/40420154?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eddingston", "html_url": "https://github.com/eddingston", "followers_url": "https://api.github.com/users/eddingston/followers", "following_url": "https://api.github.com/users/eddingston/following{/other_user}", "gists_url": "https://api.github.com/users/eddingston/gists{/gist_id}", "starred_url": "https://api.github.com/users/eddingston/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eddingston/subscriptions", "organizations_url": "https://api.github.com/users/eddingston/orgs", "repos_url": "https://api.github.com/users/eddingston/repos", "events_url": "https://api.github.com/users/eddingston/events{/privacy}", "received_events_url": "https://api.github.com/users/eddingston/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 948357241, "node_id": "MDU6TGFiZWw5NDgzNTcyNDE=", "url": "https://api.github.com/repos/ory/kratos/labels/bug", "name": "bug", "color": "F44336", "default": true, "description": "Something is not working."}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 14, "created_at": "2023-07-21T19:34:22Z", "updated_at": "2023-10-20T08:25:18Z", "closed_at": "2023-09-01T12:04:15Z", "assignee": null, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### Preflight checklist\r\n\r\n- [X] I could not find a solution in the existing issues, docs, nor discussions.\r\n- [X] I agree to follow this project's [Code of Conduct](https://github.com/ory/kratos/blob/master/CODE_OF_CONDUCT.md).\r\n- [X] I have read and am following this repository's [Contribution Guidelines](https://github.com/ory/kratos/blob/master/CONTRIBUTING.md).\r\n- [ ] This issue affects my [Ory Network](https://www.ory.sh/) project.\r\n- [X] I have joined the [Ory Community Slack](https://slack.ory.sh).\r\n- [ ] I am signed up to the [Ory Security Patch Newsletter](https://ory.us10.list-manage.com/subscribe?u=ffb1a878e4ec6c0ed312a3480&id=f605a41b53).\r\n\r\n### Describe the bug\r\n\r\nI am trying to set up Google social login in my Sveltekit Application using the Ory Kratos HTTP API. \r\n\r\nSo far, I have been successful with setting up Registration, Login, and Logout flows. \r\n\r\nBut now I am having troubles with the Google OIDC. \r\n\r\nI am able to get to the Google sign in page but when I choose my account, I get the following error:\r\n\r\n`An error occurred with the following message: The browser does not contain the necessary cookie to resume the session. This is a security violation and was blocked. Please clear your browser's cookies and cache and try again!`\r\n\r\nIt is unclear to me what I am missing. Vincent(ORY) has suggested that I need to include the CSRF cookie and the Ory Session cookie. In the other flows (Registration, Login, Logout), I passed the data in the `Set-Cookie` and the body of the HTTP request as `'Content-Type': 'application/json'`, but that does not seem to work for this situation.\r\n\r\nI have a trimmed down version of the issue posted here:\r\n- https://github.com/eddingston/ory-kratos-google-issue\r\n\r\nThe flow starts at https://github.com/eddingston/ory-kratos-google-issue/blob/master/src/routes/%2Bpage.svelte. \r\n- This page is preloaded with the initial login flow data by going through the following path:\r\n  - https://github.com/eddingston/ory-kratos-google-issue/blob/master/src/routes/%2Bpage.ts - (SSR that loads the data after retrieving it from below)\r\n  - https://github.com/eddingston/ory-kratos-google-issue/blob/master/src/lib/auth/frontend/auth.ts - (Frontend HTTP request to the backend to workaround CORS issues with Ory Kratos Server) \r\n  - https://github.com/eddingston/ory-kratos-google-issue/blob/master/src/routes/api/auth/login/%2Bserver.ts - (Backend handler for the HTTP request above which initializes the login flow and retrieves the form details through helper functions that make HTTP requests to the Ory Kratos Server)\r\n  - https://github.com/eddingston/ory-kratos-google-issue/blob/master/src/lib/auth/backend/auth.ts (Helper functions for the handler above)\r\n  \r\n The above is what retrieves the CSRF cookie. I don't think a session is active at this point because we have no logged in with any users. \r\n\r\nFinally, at https://github.com/eddingston/ory-kratos-google-issue/blob/master/src/routes/%2Bpage.svelte, if we click the 'Sign in with Google' button, it will run the handler above in the same file. This will make a call to https://github.com/eddingston/ory-kratos-google-issue/blob/master/src/routes/api/auth/google/%2Bserver.ts, which returns a redirection url. \r\n\r\nThe frontend should now be redirected to the Google sign in page. If we pick an account it will show the error. \r\n- `An error occurred with the following message: The browser does not contain the necessary cookie to resume the session. This is a security violation and was blocked. Please clear your browser's cookies and cache and try again!`\r\n \r\n \r\n Thank you for your time! I look forward to hearing from the Ory team!\r\n\r\n### Reproducing the bug\r\n\r\nEDIT: At the time of editing this, it is required to add `127.0.0.1\tedd-test.com` to `/etc/hosts` for the app to work. \r\n\r\n1. `git clone git@github.com:eddingston/ory-kratos-google-issue.git`\r\n2. `cd ory-kratos-google-issue`\r\n3. Open up the `kratos.yml` and make sure that a valid Google client_id and client_secret has been set.\r\n3. `cd kratos && docker-compose up -d`\r\n4. `cd .. && npm install && npm run dev`\r\n5. Go to ~~http://localhost:5173/~~ http://edd-test.com:5173\r\n6. Click the 'Sign in with Google' button\r\n7. You should have been redirected to the Google sign in page. Please login/select an account. \r\n8. You should now see the error. \r\n\r\n### Relevant log output\r\n\r\n```shell\r\nAn error occurred with the following message: The browser does not contain the necessary cookie to resume the session. This is a security violation and was blocked. Please clear your browser's cookies and cache and try again!\r\n```\r\n\r\n\r\n### Relevant configuration\r\n\r\n```yml\r\nOry Kratos Server Configs:\r\nhttps://github.com/eddingston/ory-kratos-google-issue/tree/master/kratos\r\n```\r\n\r\n\r\n### Version\r\n\r\noryd/kratos:v0.13.0\r\n\r\n### On which operating system are you observing this issue?\r\n\r\nLinux\r\n\r\n### In which environment are you deploying?\r\n\r\nDocker Compose\r\n\r\n### Additional Context\r\n\r\n_No response_", "closed_by": {"login": "aeneasr", "id": 3372410, "node_id": "MDQ6VXNlcjMzNzI0MTA=", "avatar_url": "https://avatars.githubusercontent.com/u/3372410?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aeneasr", "html_url": "https://github.com/aeneasr", "followers_url": "https://api.github.com/users/aeneasr/followers", "following_url": "https://api.github.com/users/aeneasr/following{/other_user}", "gists_url": "https://api.github.com/users/aeneasr/gists{/gist_id}", "starred_url": "https://api.github.com/users/aeneasr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aeneasr/subscriptions", "organizations_url": "https://api.github.com/users/aeneasr/orgs", "repos_url": "https://api.github.com/users/aeneasr/repos", "events_url": "https://api.github.com/users/aeneasr/events{/privacy}", "received_events_url": "https://api.github.com/users/aeneasr/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/ory/kratos/issues/3384/reactions", "total_count": 5, "+1": 3, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 2}, "timeline_url": "https://api.github.com/repos/ory/kratos/issues/3384/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/ory/kratos/issues/3085", "repository_url": "https://api.github.com/repos/ory/kratos", "labels_url": "https://api.github.com/repos/ory/kratos/issues/3085/labels{/name}", "comments_url": "https://api.github.com/repos/ory/kratos/issues/3085/comments", "events_url": "https://api.github.com/repos/ory/kratos/issues/3085/events", "html_url": "https://github.com/ory/kratos/pull/3085", "id": 1576747678, "node_id": "PR_kwDOCBDZBc5Jjvx1", "number": 3085, "title": "fix: report correct errors for json schema validation", "user": {"login": "CaptainStandby", "id": 18215579, "node_id": "MDQ6VXNlcjE4MjE1NTc5", "avatar_url": "https://avatars.githubusercontent.com/u/18215579?v=4", "gravatar_id": "", "url": "https://api.github.com/users/CaptainStandby", "html_url": "https://github.com/CaptainStandby", "followers_url": "https://api.github.com/users/CaptainStandby/followers", "following_url": "https://api.github.com/users/CaptainStandby/following{/other_user}", "gists_url": "https://api.github.com/users/CaptainStandby/gists{/gist_id}", "starred_url": "https://api.github.com/users/CaptainStandby/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/CaptainStandby/subscriptions", "organizations_url": "https://api.github.com/users/CaptainStandby/orgs", "repos_url": "https://api.github.com/users/CaptainStandby/repos", "events_url": "https://api.github.com/users/CaptainStandby/events{/privacy}", "received_events_url": "https://api.github.com/users/CaptainStandby/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 948357241, "node_id": "MDU6TGFiZWw5NDgzNTcyNDE=", "url": "https://api.github.com/repos/ory/kratos/labels/bug", "name": "bug", "color": "F44336", "default": true, "description": "Something is not working."}, {"id": 3703670374, "node_id": "LA_kwDOCBDZBc7cwYZm", "url": "https://api.github.com/repos/ory/kratos/labels/area/identity", "name": "area/identity", "color": "7169D5", "default": false, "description": "This issue affects Ory's identity services."}], "state": "closed", "locked": false, "assignees": [{"login": "CaptainStandby", "id": 18215579, "node_id": "MDQ6VXNlcjE4MjE1NTc5", "avatar_url": "https://avatars.githubusercontent.com/u/18215579?v=4", "gravatar_id": "", "url": "https://api.github.com/users/CaptainStandby", "html_url": "https://github.com/CaptainStandby", "followers_url": "https://api.github.com/users/CaptainStandby/followers", "following_url": "https://api.github.com/users/CaptainStandby/following{/other_user}", "gists_url": "https://api.github.com/users/CaptainStandby/gists{/gist_id}", "starred_url": "https://api.github.com/users/CaptainStandby/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/CaptainStandby/subscriptions", "organizations_url": "https://api.github.com/users/CaptainStandby/orgs", "repos_url": "https://api.github.com/users/CaptainStandby/repos", "events_url": "https://api.github.com/users/CaptainStandby/events{/privacy}", "received_events_url": "https://api.github.com/users/CaptainStandby/received_events", "type": "User", "user_view_type": "public", "site_admin": false}], "milestone": null, "comments": 8, "created_at": "2023-02-08T20:18:09Z", "updated_at": "2023-08-23T10:42:43Z", "closed_at": "2023-02-10T13:55:01Z", "assignee": {"login": "CaptainStandby", "id": 18215579, "node_id": "MDQ6VXNlcjE4MjE1NTc5", "avatar_url": "https://avatars.githubusercontent.com/u/18215579?v=4", "gravatar_id": "", "url": "https://api.github.com/users/CaptainStandby", "html_url": "https://github.com/CaptainStandby", "followers_url": "https://api.github.com/users/CaptainStandby/followers", "following_url": "https://api.github.com/users/CaptainStandby/following{/other_user}", "gists_url": "https://api.github.com/users/CaptainStandby/gists{/gist_id}", "starred_url": "https://api.github.com/users/CaptainStandby/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/CaptainStandby/subscriptions", "organizations_url": "https://api.github.com/users/CaptainStandby/orgs", "repos_url": "https://api.github.com/users/CaptainStandby/repos", "events_url": "https://api.github.com/users/CaptainStandby/events{/privacy}", "received_events_url": "https://api.github.com/users/CaptainStandby/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "author_association": "CONTRIBUTOR", "type": null, "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/ory/kratos/pulls/3085", "html_url": "https://github.com/ory/kratos/pull/3085", "diff_url": "https://github.com/ory/kratos/pull/3085.diff", "patch_url": "https://github.com/ory/kratos/pull/3085.patch", "merged_at": "2023-02-10T13:55:01Z"}, "body": "- Implemented the translation of `jsonschema.ValidationError` to errors codes documented [here](https://www.ory.sh/docs/kratos/concepts/ui-user-interface#machine-readable-format)\r\n- Added missing error codes for relevant schema errors\r\n  | Validation         | Name                            | ID      |\r\n  | ------------------ | ------------------------------- | ------- |\r\n  | `maxLength`        | ErrorValidationMaxLength        | 4000017 |\r\n  | `minimum`          | ErrorValidationMinimum.         | 4000018 |\r\n  | `exclusiveMinimum` | ErrorValidationExclusiveMinimum | 4000019 |\r\n  | `maximum`          | ErrorValidationMaximum          | 4000020 |\r\n  | `exclusiveMaximum` | ErrorValidationExclusiveMaximum | 4000021 |\r\n  | `multipleOf`       | ErrorValidationMultipleOf       | 4000022 |\r\n  | `maxItems`         | ErrorValidationMaxItems         | 4000023 |\r\n  | `minItems`         | ErrorValidationMinItems         | 4000024 |\r\n  | `uniqueItems`      | ErrorValidationUniqueItems      | 4000025 |\r\n  | `type`             | ErrorValidationWrongType        | 4000026 |\r\n- Updated e2e tests to check these IDs explicitly\r\n\r\n<!--\r\nDescribe the big picture of your changes here to communicate to the maintainers why we should accept this pull request.\r\n\r\nThis text will be included in the changelog. If applicable, include links to documentation or pieces of code.\r\nIf your change includes breaking changes please add a code block documenting the breaking change:\r\n\r\n```\r\nBREAKING CHANGES: This patch changes the behavior of configuration item `foo` to do bar. To keep the existing\r\nbehavior please do baz.\r\n```\r\n-->\r\n\r\n## Related issue(s)\r\n\r\n#2974 \r\n\r\n## Checklist\r\n\r\n<!--\r\nPut an `x` in the boxes that apply. You can also fill these out after creating the PR.\r\n\r\nPlease be aware that pull requests must have all boxes ticked in order to be merged.\r\n\r\nIf you're unsure about any of them, don't hesitate to ask. We're here to help!\r\n-->\r\n\r\n- [x] I have read the [contributing guidelines](../blob/master/CONTRIBUTING.md).\r\n- [x] I have referenced an issue containing the design document if my change\r\n      introduces a new feature.\r\n- [x] I am following the\r\n      [contributing code guidelines](../blob/master/CONTRIBUTING.md#contributing-code).\r\n- [x] I have read the [security policy](../security/policy).\r\n- [x] I confirm that this pull request does not address a security\r\n      vulnerability. If this pull request addresses a security vulnerability, I\r\n      confirm that I got the approval (please contact\r\n      [security@ory.sh](mailto:security@ory.sh)) from the maintainers to push\r\n      the changes.\r\n- [x] I have added tests that prove my fix is effective or that my feature\r\n      works.\r\n- [ ] I have added or changed [the documentation](https://github.com/ory/docs).\r\n\r\n## Further Comments\r\n\r\n<!--\r\nIf this is a relatively large or complex change, kick off the discussion by explaining why you chose the solution\r\nyou did and what alternatives you considered, etc...\r\n-->\r\n", "closed_by": {"login": "CaptainStandby", "id": 18215579, "node_id": "MDQ6VXNlcjE4MjE1NTc5", "avatar_url": "https://avatars.githubusercontent.com/u/18215579?v=4", "gravatar_id": "", "url": "https://api.github.com/users/CaptainStandby", "html_url": "https://github.com/CaptainStandby", "followers_url": "https://api.github.com/users/CaptainStandby/followers", "following_url": "https://api.github.com/users/CaptainStandby/following{/other_user}", "gists_url": "https://api.github.com/users/CaptainStandby/gists{/gist_id}", "starred_url": "https://api.github.com/users/CaptainStandby/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/CaptainStandby/subscriptions", "organizations_url": "https://api.github.com/users/CaptainStandby/orgs", "repos_url": "https://api.github.com/users/CaptainStandby/repos", "events_url": "https://api.github.com/users/CaptainStandby/events{/privacy}", "received_events_url": "https://api.github.com/users/CaptainStandby/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/ory/kratos/issues/3085/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/ory/kratos/issues/3085/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/ory/kratos/issues/2043", "repository_url": "https://api.github.com/repos/ory/kratos", "labels_url": "https://api.github.com/repos/ory/kratos/issues/2043/labels{/name}", "comments_url": "https://api.github.com/repos/ory/kratos/issues/2043/comments", "events_url": "https://api.github.com/repos/ory/kratos/issues/2043/events", "html_url": "https://github.com/ory/kratos/issues/2043", "id": 1073911454, "node_id": "I_kwDOCBDZBc5AApae", "number": 2043, "title": "Documentation for self-service is confusing about what is the difference between browser and API flows", "user": {"login": "mitar", "id": 585279, "node_id": "MDQ6VXNlcjU4NTI3OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/585279?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mitar", "html_url": "https://github.com/mitar", "followers_url": "https://api.github.com/users/mitar/followers", "following_url": "https://api.github.com/users/mitar/following{/other_user}", "gists_url": "https://api.github.com/users/mitar/gists{/gist_id}", "starred_url": "https://api.github.com/users/mitar/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mitar/subscriptions", "organizations_url": "https://api.github.com/users/mitar/orgs", "repos_url": "https://api.github.com/users/mitar/repos", "events_url": "https://api.github.com/users/mitar/events{/privacy}", "received_events_url": "https://api.github.com/users/mitar/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 948357241, "node_id": "MDU6TGFiZWw5NDgzNTcyNDE=", "url": "https://api.github.com/repos/ory/kratos/labels/bug", "name": "bug", "color": "F44336", "default": true, "description": "Something is not working."}], "state": "closed", "locked": false, "assignees": [], "milestone": {"url": "https://api.github.com/repos/ory/kratos/milestones/15", "html_url": "https://github.com/ory/kratos/milestone/15", "labels_url": "https://api.github.com/repos/ory/kratos/milestones/15/labels", "id": 7065816, "node_id": "MI_kwDOCBDZBc4Aa9DY", "number": 15, "title": "v1.0.0", "description": "", "creator": {"login": "aeneasr", "id": 3372410, "node_id": "MDQ6VXNlcjMzNzI0MTA=", "avatar_url": "https://avatars.githubusercontent.com/u/3372410?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aeneasr", "html_url": "https://github.com/aeneasr", "followers_url": "https://api.github.com/users/aeneasr/followers", "following_url": "https://api.github.com/users/aeneasr/following{/other_user}", "gists_url": "https://api.github.com/users/aeneasr/gists{/gist_id}", "starred_url": "https://api.github.com/users/aeneasr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aeneasr/subscriptions", "organizations_url": "https://api.github.com/users/aeneasr/orgs", "repos_url": "https://api.github.com/users/aeneasr/repos", "events_url": "https://api.github.com/users/aeneasr/events{/privacy}", "received_events_url": "https://api.github.com/users/aeneasr/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "open_issues": 4, "closed_issues": 89, "state": "open", "created_at": "2021-08-17T10:14:38Z", "updated_at": "2025-11-10T00:03:30Z", "due_on": null, "closed_at": null}, "comments": 14, "created_at": "2021-12-08T01:29:21Z", "updated_at": "2023-07-27T14:32:58Z", "closed_at": "2023-07-27T14:32:57Z", "assignee": null, "author_association": "CONTRIBUTOR", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### Preflight checklist\n\n- [X] I could not find a solution in the existing issues, docs, nor discussions.\n- [X] I agree to follow this project's [Code of Conduct](https://github.com/ory/kratos/blob/master/CODE_OF_CONDUCT.md).\n- [X] I have read and am following this repository's [Contribution Guidelines](https://github.com/ory/kratos/blob/master/CONTRIBUTING.md).\n- [ ] This issue affects my [Ory Cloud](https://www.ory.sh/) project.\n- [X] I have joined the [Ory Community Slack](https://slack.ory.sh).\n- [ ] I am signed up to the [Ory Security Patch Newsletter](https://ory.us10.list-manage.com/subscribe?u=ffb1a878e4ec6c0ed312a3480&id=f605a41b53).\n\n### Describe the bug\n\nI am reading [documentation](https://www.ory.sh/kratos/docs/next/self-service/) and I must say I do not get what is the difference between browser and API flows. The issue is also that flow diagrams are almost exactly the same:\r\n\r\n![Screenshot 2021-12-08 at 02-23-50 Self-Service Flows Ory Kratos](https://user-images.githubusercontent.com/585279/145131665-6a888e52-1ef1-4b18-b515-54ffedecd65a.png)\r\n\r\n![Screenshot 2021-12-08 at 02-23-30 Self-Service Flows Ory Kratos](https://user-images.githubusercontent.com/585279/145131669-8b08c216-ea22-49c3-ac29-f6754f36e54e.png)\r\n\r\nSo the only difference is that browser flow sets cookies while API flow does not? So if your HTTP client for API calls respect cookies you could also call browser flow endpoints and have the same behavior?\r\n\r\nThe following text confuses me:\r\n\r\n> While the Browser flow redirects the client and uses cookies to protect against CSRF and session hijacking attacks, the API flow answers with a fresh flow formatted as application/json right away. The client would then use that information to render the UI. \r\n\r\nI do not think browser flow redirects at all? Both the API and browser flows answer with application/json right away. No?\n\n### Reproducing the bug\n\nSee description.\n\n### Relevant log output\n\n_No response_\n\n### Relevant configuration\n\n_No response_\n\n### Version\n\nv0.8.0-alpha.3\n\n### On which operating system are you observing this issue?\n\nLinux\n\n### In which environment are you deploying?\n\nDocker Compose\n\n### Additional Context\n\n_No response_", "closed_by": {"login": "aeneasr", "id": 3372410, "node_id": "MDQ6VXNlcjMzNzI0MTA=", "avatar_url": "https://avatars.githubusercontent.com/u/3372410?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aeneasr", "html_url": "https://github.com/aeneasr", "followers_url": "https://api.github.com/users/aeneasr/followers", "following_url": "https://api.github.com/users/aeneasr/following{/other_user}", "gists_url": "https://api.github.com/users/aeneasr/gists{/gist_id}", "starred_url": "https://api.github.com/users/aeneasr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aeneasr/subscriptions", "organizations_url": "https://api.github.com/users/aeneasr/orgs", "repos_url": "https://api.github.com/users/aeneasr/repos", "events_url": "https://api.github.com/users/aeneasr/events{/privacy}", "received_events_url": "https://api.github.com/users/aeneasr/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/ory/kratos/issues/2043/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/ory/kratos/issues/2043/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/ory/kratos/issues/4076", "repository_url": "https://api.github.com/repos/ory/kratos", "labels_url": "https://api.github.com/repos/ory/kratos/issues/4076/labels{/name}", "comments_url": "https://api.github.com/repos/ory/kratos/issues/4076/comments", "events_url": "https://api.github.com/repos/ory/kratos/issues/4076/events", "html_url": "https://github.com/ory/kratos/issues/4076", "id": 2505016952, "node_id": "I_kwDOCBDZBc6VT4Z4", "number": 4076, "title": "Credential Identifiers Are Appended, Not Updated, When Changing the `email` Trait", "user": {"login": "3schwartz", "id": 40674593, "node_id": "MDQ6VXNlcjQwNjc0NTkz", "avatar_url": "https://avatars.githubusercontent.com/u/40674593?v=4", "gravatar_id": "", "url": "https://api.github.com/users/3schwartz", "html_url": "https://github.com/3schwartz", "followers_url": "https://api.github.com/users/3schwartz/followers", "following_url": "https://api.github.com/users/3schwartz/following{/other_user}", "gists_url": "https://api.github.com/users/3schwartz/gists{/gist_id}", "starred_url": "https://api.github.com/users/3schwartz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/3schwartz/subscriptions", "organizations_url": "https://api.github.com/users/3schwartz/orgs", "repos_url": "https://api.github.com/users/3schwartz/repos", "events_url": "https://api.github.com/users/3schwartz/events{/privacy}", "received_events_url": "https://api.github.com/users/3schwartz/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 948357241, "node_id": "MDU6TGFiZWw5NDgzNTcyNDE=", "url": "https://api.github.com/repos/ory/kratos/labels/bug", "name": "bug", "color": "F44336", "default": true, "description": "Something is not working."}], "state": "closed", "locked": false, "assignees": [{"login": "aeneasr", "id": 3372410, "node_id": "MDQ6VXNlcjMzNzI0MTA=", "avatar_url": "https://avatars.githubusercontent.com/u/3372410?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aeneasr", "html_url": "https://github.com/aeneasr", "followers_url": "https://api.github.com/users/aeneasr/followers", "following_url": "https://api.github.com/users/aeneasr/following{/other_user}", "gists_url": "https://api.github.com/users/aeneasr/gists{/gist_id}", "starred_url": "https://api.github.com/users/aeneasr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aeneasr/subscriptions", "organizations_url": "https://api.github.com/users/aeneasr/orgs", "repos_url": "https://api.github.com/users/aeneasr/repos", "events_url": "https://api.github.com/users/aeneasr/events{/privacy}", "received_events_url": "https://api.github.com/users/aeneasr/received_events", "type": "User", "user_view_type": "public", "site_admin": false}], "milestone": null, "comments": 12, "created_at": "2024-09-04T11:04:06Z", "updated_at": "2024-09-26T13:00:43Z", "closed_at": "2024-09-26T13:00:43Z", "assignee": {"login": "aeneasr", "id": 3372410, "node_id": "MDQ6VXNlcjMzNzI0MTA=", "avatar_url": "https://avatars.githubusercontent.com/u/3372410?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aeneasr", "html_url": "https://github.com/aeneasr", "followers_url": "https://api.github.com/users/aeneasr/followers", "following_url": "https://api.github.com/users/aeneasr/following{/other_user}", "gists_url": "https://api.github.com/users/aeneasr/gists{/gist_id}", "starred_url": "https://api.github.com/users/aeneasr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aeneasr/subscriptions", "organizations_url": "https://api.github.com/users/aeneasr/orgs", "repos_url": "https://api.github.com/users/aeneasr/repos", "events_url": "https://api.github.com/users/aeneasr/events{/privacy}", "received_events_url": "https://api.github.com/users/aeneasr/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### Preflight checklist\n\n- [X] I could not find a solution in the existing issues, docs, nor discussions.\n- [X] I agree to follow this project's [Code of Conduct](https://github.com/ory/kratos/blob/master/CODE_OF_CONDUCT.md).\n- [X] I have read and am following this repository's [Contribution Guidelines](https://github.com/ory/kratos/blob/master/CONTRIBUTING.md).\n- [ ] I have joined the [Ory Community Slack](https://slack.ory.sh).\n- [ ] I am signed up to the [Ory Security Patch Newsletter](https://www.ory.sh/l/sign-up-newsletter).\n\n### Ory Network Project\n\n_No response_\n\n### Describe the bug\n\nIn the past two weeks, we've observed that previous credential identifiers are now being retained for an identity, even after an update.\r\n\r\nWe have some integration tests that have started failing. These tests validated that when the email trait was changed, it was no longer possible to retrieve identities using the old email address.\r\n\r\nPreviously, when the email trait was updated, the credential identifier would also change. As a result, querying for identities using the old email would return no results.\r\n\r\nHowever, now after updating an email, querying with the old email still returns the identity.\r\n\r\nWe would like to be able to \"delete\" the old email as a credential, which was previously possible.\n\n### Reproducing the bug\n\nBelow code is using python SDK `ory_client==1.6.1`.\r\n\r\nSet variables and import relevant libraries\r\n```\r\nimport ory_client\r\nfrom ory_client.model.identity import Identity\r\nfrom ory_client.model.create_identity_body import CreateIdentityBody\r\nfrom ory_client.api import identity_api\r\nfrom typing import List\r\nfrom ory_client.model.update_identity_body import UpdateIdentityBody\r\n\r\nORY_HOST = \"some_host\"\r\nORY_AUTH_TOKEN = \"some_auth_token\"\r\n\r\nTRAIT_EMAIL_KEY: str = \"email\"\r\nIDENTITY_SCHEMA = \"preset://email\"\r\n\r\nconfigurations = ory_client.Configuration(\r\n            host=ORY_HOST, access_token=ORY_AUTH_TOKEN\r\n        )\r\n```\r\n\r\nNow create a new identity\r\n```\r\nfirst_email = \"first@example.com\"\r\n\r\nwith ory_client.ApiClient(configurations) as api_client:\r\n    api_instance = identity_api.IdentityApi(api_client)\r\n    create_identity_body = CreateIdentityBody(\r\n        schema_id=IDENTITY_SCHEMA,\r\n        traits={\r\n            TRAIT_EMAIL_KEY: first_email,\r\n        },\r\n    )\r\n    api_response: Identity = api_instance.create_identity(\r\n            create_identity_body=create_identity_body\r\n        )\r\n    print(api_response)\r\n```\r\nThe identity is created with credential identifier `first@example.com`.\r\n\r\nThe identity can be fetched using the mail `first@example.com`\r\n```\r\nwith ory_client.ApiClient(configurations) as api_client:\r\n    api_instance = identity_api.IdentityApi(api_client)\r\n    \r\n    api_response: List[Identity] = api_instance.list_identities(\r\n        credentials_identifier=first_email, consistency=\"strong\"\r\n    )\r\n    if len(api_response) == 0:\r\n        raise Exception(f\"Identity {first_email} not found\")\r\n    if len(api_response) > 1:\r\n        raise Exception(f\"Identity {first_email} has multiple identities\"\r\n        )\r\n    print(api_response[0])\r\n    identity = api_response[0]\r\n```\r\n\r\nNow update the client such that the email trait is `bar@foo.com`.\r\n```\r\nsecond_email = \"second@example.com\"\r\n\r\nwith ory_client.ApiClient(configurations) as api_client:\r\n    api_instance = identity_api.IdentityApi(api_client)\r\n    update_identity_body = UpdateIdentityBody(\r\n        schema_id=IDENTITY_SCHEMA,\r\n        state=\"active\",\r\n        traits={\r\n            TRAIT_EMAIL_KEY: second_email,\r\n        },\r\n    )\r\n    \r\n    api_response: Identity = api_instance.update_identity(\r\n        id=identity.id, update_identity_body=update_identity_body\r\n    )\r\n    print(api_response)\r\n```\r\n\r\nPreviously, when we tried fetch the identity with the old mail `first@example.com`, it failed (or returned none). Now however the identity is returned.\r\n\r\nLooking into the UI of the identity in the Ory Console both emails are also listed under \u201cCredential Identifiers\u201d.\r\n\r\nTraits are correctly updated\r\n```\r\n..\r\n'traits': {'email': 'second@example.com\u2019},\r\n...\r\n```\r\n\r\nBut credentials has both email adresses.\r\n```\r\n'credentials': ...\r\n    'identifiers': ['second@example.com', 'first@example.com'],\r\n```\r\n\n\n### Relevant log output\n\n_No response_\n\n### Relevant configuration\n\n_No response_\n\n### Version\n\nPython SDK `ory_client==1.6.1`\n\n### On which operating system are you observing this issue?\n\nNone\n\n### In which environment are you deploying?\n\nOry Network\n\n### Additional Context\n\n_No response_", "closed_by": {"login": "3schwartz", "id": 40674593, "node_id": "MDQ6VXNlcjQwNjc0NTkz", "avatar_url": "https://avatars.githubusercontent.com/u/40674593?v=4", "gravatar_id": "", "url": "https://api.github.com/users/3schwartz", "html_url": "https://github.com/3schwartz", "followers_url": "https://api.github.com/users/3schwartz/followers", "following_url": "https://api.github.com/users/3schwartz/following{/other_user}", "gists_url": "https://api.github.com/users/3schwartz/gists{/gist_id}", "starred_url": "https://api.github.com/users/3schwartz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/3schwartz/subscriptions", "organizations_url": "https://api.github.com/users/3schwartz/orgs", "repos_url": "https://api.github.com/users/3schwartz/repos", "events_url": "https://api.github.com/users/3schwartz/events{/privacy}", "received_events_url": "https://api.github.com/users/3schwartz/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/ory/kratos/issues/4076/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/ory/kratos/issues/4076/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/ory/kratos/issues/3807", "repository_url": "https://api.github.com/repos/ory/kratos", "labels_url": "https://api.github.com/repos/ory/kratos/issues/3807/labels{/name}", "comments_url": "https://api.github.com/repos/ory/kratos/issues/3807/comments", "events_url": "https://api.github.com/repos/ory/kratos/issues/3807/events", "html_url": "https://github.com/ory/kratos/issues/3807", "id": 2175596467, "node_id": "I_kwDOCBDZBc6BrPez", "number": 3807, "title": "Kratos Java client 1.1.0 throws exception on parsing response from `updateRegistrationFlow`", "user": {"login": "kamilkloch", "id": 807154, "node_id": "MDQ6VXNlcjgwNzE1NA==", "avatar_url": "https://avatars.githubusercontent.com/u/807154?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kamilkloch", "html_url": "https://github.com/kamilkloch", "followers_url": "https://api.github.com/users/kamilkloch/followers", "following_url": "https://api.github.com/users/kamilkloch/following{/other_user}", "gists_url": "https://api.github.com/users/kamilkloch/gists{/gist_id}", "starred_url": "https://api.github.com/users/kamilkloch/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kamilkloch/subscriptions", "organizations_url": "https://api.github.com/users/kamilkloch/orgs", "repos_url": "https://api.github.com/users/kamilkloch/repos", "events_url": "https://api.github.com/users/kamilkloch/events{/privacy}", "received_events_url": "https://api.github.com/users/kamilkloch/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 948357241, "node_id": "MDU6TGFiZWw5NDgzNTcyNDE=", "url": "https://api.github.com/repos/ory/kratos/labels/bug", "name": "bug", "color": "F44336", "default": true, "description": "Something is not working."}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 12, "created_at": "2024-03-08T09:05:56Z", "updated_at": "2024-04-29T07:47:03Z", "closed_at": "2024-04-29T07:47:03Z", "assignee": null, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### Preflight checklist\n\n- [X] I could not find a solution in the existing issues, docs, nor discussions.\n- [X] I agree to follow this project's [Code of Conduct](https://github.com/ory/kratos/blob/master/CODE_OF_CONDUCT.md).\n- [X] I have read and am following this repository's [Contribution Guidelines](https://github.com/ory/kratos/blob/master/CONTRIBUTING.md).\n- [X] I have joined the [Ory Community Slack](https://slack.ory.sh).\n- [ ] I am signed up to the [Ory Security Patch Newsletter](https://ory.us10.list-manage.com/subscribe?u=ffb1a878e4ec6c0ed312a3480&id=f605a41b53).\n\n### Ory Network Project\n\n_No response_\n\n### Describe the bug\n\nKratos Java client 1.1.0 throws exception on parsing response from `updateRegistrationFlow`.\n\n### Reproducing the bug\n\n```scala\r\nval registrationFlow = frontendApi.createNativeRegistrationFlow(false, null)\r\n```\r\nKratos logs (all OK, 200):\r\n```\r\n{\"http_request\":{\"headers\":{\"accept\":\"application/json\",\"accept-encoding\":\"gzip\",\"connection\":\"close\",\"user-agent\":\"OpenAPI-Generator/v1.1.0/java\",\"x-forwarded-for\":\"192.168.93.61\",\"x-forwarded-port\":\"443\",\"x-forwarded-proto\":\"https\"},\"host\":\"_redacted_\",\"method\":\"GET\",\"path\":\"/self-service/registration/api\",\"query\":\"return_session_token_exchange_code=false\",\"remote\":\"172.19.0.11:35398\",\"scheme\":\"http\"},\"level\":\"info\",\"msg\":\"started handling request\",\"time\":\"2024-03-08T08:55:02.21148157Z\"}\r\n[cors] 2024/03/08 08:55:02 ServeHTTP: Actual request\r\n[cors] 2024/03/08 08:55:02   Actual request no headers added: missing origin\r\n{\"http_request\":{\"headers\":{\"accept\":\"application/json\",\"accept-encoding\":\"gzip\",\"connection\":\"close\",\"user-agent\":\"OpenAPI-Generator/v1.1.0/java\",\"x-forwarded-for\":\"192.168.93.61\",\"x-forwarded-port\":\"443\",\"x-forwarded-proto\":\"https\"},\"host\":\"_redacted_\",\"method\":\"GET\",\"path\":\"/self-service/registration/api\",\"query\":\"return_session_token_exchange_code=false\",\"remote\":\"172.19.0.11:35398\",\"scheme\":\"http\"},\"http_response\":{\"headers\":{\"cache-control\":\"private, no-cache, no-store, must-revalidate\",\"content-type\":\"application/json; charset=utf-8\",\"vary\":\"Origin\"},\"size\":1381,\"status\":200,\"text_status\":\"OK\",\"took\":3820889},\"level\":\"info\",\"msg\":\"completed handling request\",\"time\":\"2024-03-08T08:55:02.21528678Z\"}\r\n\r\n```\r\n```scala\r\nval flow = new UpdateRegistrationFlowBody(\r\n      new UpdateRegistrationFlowWithPasswordMethod()\r\n        .traits(...)\r\n        .password(...)\r\n        .method(\"password\")\r\n    )\r\n\r\nfrontendApi.updateRegistrationFlow(registrationFlow.getId, flow, null)\r\n```\r\nKratos logs (all OK, 200):\r\n```\r\n{\"http_request\":{\"headers\":{\"accept\":\"application/json\",\"accept-encoding\":\"gzip\",\"connection\":\"close\",\"content-length\":\"91\",\"content-type\":\"application/json; charset=utf-8\",\"user-agent\":\"OpenAPI-Generator/v1.1.0/java\",\"x-forwarded-for\":\"192.168.93.61\",\"x-forwarded-port\":\"443\",\"x-forwarded-proto\":\"https\"},\"host\":\"_redacted_\",\"method\":\"POST\",\"path\":\"/self-service/registration\",\"query\":\"flow=2edb5990-62a3-4eb9-9448-43cc12168182\",\"remote\":\"172.19.0.11:47624\",\"scheme\":\"http\"},\"http_response\":{\"headers\":{\"cache-control\":\"private, no-cache, no-store, must-revalidate\",\"content-type\":\"application/json; charset=utf-8\",\"vary\":\"Origin\"},\"size\":970,\"status\":200,\"text_status\":\"OK\",\"took\":57765999},\"level\":\"info\",\"msg\":\"completed handling request\",\"time\":\"2024-03-08T08:54:07.913009096Z\"}\r\n```\r\nJava client fails to parse the response:\r\n```\r\njava.io.IOException: The JSON string is invalid for ContinueWith with oneOf schemas: ContinueWithRecoveryUi, ContinueWithSetOrySessionToken, ContinueWithSettingsUi, ContinueWithVerificationUi. 3 class(es) match the result, expected 1. Detailed failure message for oneOf schemas: [Deserialization for ContinueWithSetOrySessionToken failed with `The required field `ory_session_token` is not found in the JSON string: {\"action\":\"show_verification_ui\",\"flow\":{\"id\":\"de6aa395-89c2-4641-955c-385f6105737d\",\"verifiable_address\":\"a@aubbxjxjner.com\"}}`.]. JSON: {\"action\":\"show_verification_ui\",\"flow\":{\"id\":\"de6aa395-89c2-4641-955c-385f6105737d\",\"verifiable_address\":\"a@aubbxjxjner.com\"}}\r\ncom.google.gson.JsonSyntaxException: java.io.IOException: The JSON string is invalid for ContinueWith with oneOf schemas: ContinueWithRecoveryUi, ContinueWithSetOrySessionToken, ContinueWithSettingsUi, ContinueWithVerificationUi. 3 class(es) match the result, expected 1. Detailed failure message for oneOf schemas: [Deserialization for ContinueWithSetOrySessionToken failed with `The required field `ory_session_token` is not found in the JSON string: {\"action\":\"show_verification_ui\",\"flow\":{\"id\":\"de6aa395-89c2-4641-955c-385f6105737d\",\"verifiable_address\":\"a@aubbxjxjner.com\"}}`.]. JSON: {\"action\":\"show_verification_ui\",\"flow\":{\"id\":\"de6aa395-89c2-4641-955c-385f6105737d\",\"verifiable_address\":\"a@aubbxjxjner.com\"}}\r\n\tat com.google.gson.Gson.fromJson(Gson.java:1073)\r\n\tat com.google.gson.Gson.fromJson(Gson.java:1016)\r\n\tat com.google.gson.Gson.fromJson(Gson.java:959)\r\n\tat sh.ory.kratos.JSON.deserialize(JSON.java:374)\r\n\tat sh.ory.kratos.ApiClient.deserialize(ApiClient.java:847)\r\n\tat sh.ory.kratos.ApiClient.handleResponse(ApiClient.java:1057)\r\n\tat sh.ory.kratos.ApiClient.execute(ApiClient.java:981)\r\n\tat sh.ory.kratos.api.FrontendApi.updateRegistrationFlowWithHttpInfo(FrontendApi.java:4168)\r\n\tat sh.ory.kratos.api.FrontendApi.updateRegistrationFlow(FrontendApi.java:4142)\r\n```\n\n### Relevant log output\n\n_No response_\n\n### Relevant configuration\n\n_No response_\n\n### Version\n\n1.1.0\n\n### On which operating system are you observing this issue?\n\nLinux\n\n### In which environment are you deploying?\n\nDocker Compose\n\n### Additional Context\n\n_No response_", "closed_by": {"login": "aeneasr", "id": 3372410, "node_id": "MDQ6VXNlcjMzNzI0MTA=", "avatar_url": "https://avatars.githubusercontent.com/u/3372410?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aeneasr", "html_url": "https://github.com/aeneasr", "followers_url": "https://api.github.com/users/aeneasr/followers", "following_url": "https://api.github.com/users/aeneasr/following{/other_user}", "gists_url": "https://api.github.com/users/aeneasr/gists{/gist_id}", "starred_url": "https://api.github.com/users/aeneasr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aeneasr/subscriptions", "organizations_url": "https://api.github.com/users/aeneasr/orgs", "repos_url": "https://api.github.com/users/aeneasr/repos", "events_url": "https://api.github.com/users/aeneasr/events{/privacy}", "received_events_url": "https://api.github.com/users/aeneasr/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/ory/kratos/issues/3807/reactions", "total_count": 2, "+1": 2, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/ory/kratos/issues/3807/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/ory/kratos/issues/3126", "repository_url": "https://api.github.com/repos/ory/kratos", "labels_url": "https://api.github.com/repos/ory/kratos/issues/3126/labels{/name}", "comments_url": "https://api.github.com/repos/ory/kratos/issues/3126/comments", "events_url": "https://api.github.com/repos/ory/kratos/issues/3126/events", "html_url": "https://github.com/ory/kratos/issues/3126", "id": 1596751085, "node_id": "I_kwDOCBDZBc5fLHzt", "number": 3126, "title": " ,", "user": {"login": "w0aw", "id": 103448473, "node_id": "U_kgDOBip_mQ", "avatar_url": "https://avatars.githubusercontent.com/u/103448473?v=4", "gravatar_id": "", "url": "https://api.github.com/users/w0aw", "html_url": "https://github.com/w0aw", "followers_url": "https://api.github.com/users/w0aw/followers", "following_url": "https://api.github.com/users/w0aw/following{/other_user}", "gists_url": "https://api.github.com/users/w0aw/gists{/gist_id}", "starred_url": "https://api.github.com/users/w0aw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/w0aw/subscriptions", "organizations_url": "https://api.github.com/users/w0aw/orgs", "repos_url": "https://api.github.com/users/w0aw/repos", "events_url": "https://api.github.com/users/w0aw/events{/privacy}", "received_events_url": "https://api.github.com/users/w0aw/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 948357241, "node_id": "MDU6TGFiZWw5NDgzNTcyNDE=", "url": "https://api.github.com/repos/ory/kratos/labels/bug", "name": "bug", "color": "F44336", "default": true, "description": "Something is not working."}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 12, "created_at": "2023-02-23T12:14:56Z", "updated_at": "2024-01-20T07:24:25Z", "closed_at": "2023-09-08T15:42:50Z", "assignee": null, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": null, "closed_by": {"login": "w0aw", "id": 103448473, "node_id": "U_kgDOBip_mQ", "avatar_url": "https://avatars.githubusercontent.com/u/103448473?v=4", "gravatar_id": "", "url": "https://api.github.com/users/w0aw", "html_url": "https://github.com/w0aw", "followers_url": "https://api.github.com/users/w0aw/followers", "following_url": "https://api.github.com/users/w0aw/following{/other_user}", "gists_url": "https://api.github.com/users/w0aw/gists{/gist_id}", "starred_url": "https://api.github.com/users/w0aw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/w0aw/subscriptions", "organizations_url": "https://api.github.com/users/w0aw/orgs", "repos_url": "https://api.github.com/users/w0aw/repos", "events_url": "https://api.github.com/users/w0aw/events{/privacy}", "received_events_url": "https://api.github.com/users/w0aw/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/ory/kratos/issues/3126/reactions", "total_count": 2, "+1": 2, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/ory/kratos/issues/3126/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/ory/kratos/issues/2975", "repository_url": "https://api.github.com/repos/ory/kratos", "labels_url": "https://api.github.com/repos/ory/kratos/issues/2975/labels{/name}", "comments_url": "https://api.github.com/repos/ory/kratos/issues/2975/comments", "events_url": "https://api.github.com/repos/ory/kratos/issues/2975/events", "html_url": "https://github.com/ory/kratos/issues/2975", "id": 1506591212, "node_id": "I_kwDOCBDZBc5ZzMHs", "number": 2975, "title": "Unable to get verification flow id after registration when using code method.", "user": {"login": "bhdurak", "id": 30463437, "node_id": "MDQ6VXNlcjMwNDYzNDM3", "avatar_url": "https://avatars.githubusercontent.com/u/30463437?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bhdurak", "html_url": "https://github.com/bhdurak", "followers_url": "https://api.github.com/users/bhdurak/followers", "following_url": "https://api.github.com/users/bhdurak/following{/other_user}", "gists_url": "https://api.github.com/users/bhdurak/gists{/gist_id}", "starred_url": "https://api.github.com/users/bhdurak/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bhdurak/subscriptions", "organizations_url": "https://api.github.com/users/bhdurak/orgs", "repos_url": "https://api.github.com/users/bhdurak/repos", "events_url": "https://api.github.com/users/bhdurak/events{/privacy}", "received_events_url": "https://api.github.com/users/bhdurak/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 948357241, "node_id": "MDU6TGFiZWw5NDgzNTcyNDE=", "url": "https://api.github.com/repos/ory/kratos/labels/bug", "name": "bug", "color": "F44336", "default": true, "description": "Something is not working."}], "state": "closed", "locked": false, "assignees": [{"login": "jonas-jonas", "id": 5540255, "node_id": "MDQ6VXNlcjU1NDAyNTU=", "avatar_url": "https://avatars.githubusercontent.com/u/5540255?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-jonas", "html_url": "https://github.com/jonas-jonas", "followers_url": "https://api.github.com/users/jonas-jonas/followers", "following_url": "https://api.github.com/users/jonas-jonas/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-jonas/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-jonas/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-jonas/subscriptions", "organizations_url": "https://api.github.com/users/jonas-jonas/orgs", "repos_url": "https://api.github.com/users/jonas-jonas/repos", "events_url": "https://api.github.com/users/jonas-jonas/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-jonas/received_events", "type": "User", "user_view_type": "public", "site_admin": false}], "milestone": null, "comments": 12, "created_at": "2022-12-21T16:32:28Z", "updated_at": "2023-03-23T09:59:36Z", "closed_at": "2023-03-23T09:59:36Z", "assignee": {"login": "jonas-jonas", "id": 5540255, "node_id": "MDQ6VXNlcjU1NDAyNTU=", "avatar_url": "https://avatars.githubusercontent.com/u/5540255?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-jonas", "html_url": "https://github.com/jonas-jonas", "followers_url": "https://api.github.com/users/jonas-jonas/followers", "following_url": "https://api.github.com/users/jonas-jonas/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-jonas/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-jonas/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-jonas/subscriptions", "organizations_url": "https://api.github.com/users/jonas-jonas/orgs", "repos_url": "https://api.github.com/users/jonas-jonas/repos", "events_url": "https://api.github.com/users/jonas-jonas/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-jonas/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### Preflight checklist\r\n\r\n- [X] I could not find a solution in the existing issues, docs, nor discussions.\r\n- [X] I agree to follow this project's [Code of Conduct](https://github.com/ory/kratos/blob/master/CODE_OF_CONDUCT.md).\r\n- [X] I have read and am following this repository's [Contribution Guidelines](https://github.com/ory/kratos/blob/master/CONTRIBUTING.md).\r\n- [X] This issue affects my [Ory Network](https://www.ory.sh/) project.\r\n- [ ] I have joined the [Ory Community Slack](https://slack.ory.sh).\r\n- [ ] I am signed up to the [Ory Security Patch Newsletter](https://ory.us10.list-manage.com/subscribe?u=ffb1a878e4ec6c0ed312a3480&id=f605a41b53).\r\n\r\n### Describe the bug\r\n\r\nGreetings,\r\n\r\nWe are using ory Kratos (v.0.11.0) with the FrontendApi in our React Native app. We were previously using link as verification method and now we have migrated to code. And after calling the `updateRegistrationFlow` function, the verification code is sent automatically, without us creating a Native Verification Flow manually by calling `createNativeVerificationFlow`. Hence, since we don't know the id of the verification flow which was just created, we can't really call the `updateVerificationFlow` function when the code is entered. We tried to use the id from the Registration flow, thinking that since it creates the Verification Flow the id's might be the same. But obviously that was not the case. \r\n\r\nHere the question is, how to access the id of the Verification flow so that we can call the update function and do the verification? \r\n\r\nIn the relevant fields of kratos.yml we have :\r\n```\r\nmethods:\r\n    password:\r\n      enabled: true\r\n    link:\r\n      enabled: true\r\n    code:\r\n      enabled: true\r\n    ...\r\nflows:\r\n    ...\r\n    verification:\r\n      enabled: true\r\n      use: code\r\n      ...\r\n      \r\n```\r\nWe call the registration flow as follows: \r\n```\r\nconst flow = (await kratosApi().createNativeRegistrationFlow()).data;\r\n      const data = await kratosApi().updateRegistrationFlow({\r\n        flow: flow.id,\r\n        updateRegistrationFlowBody: {\r\n          csrf_token: \"\",\r\n          method: \"password\",\r\n          password: state.password,\r\n          traits: {\r\n            email,\r\n            ...\r\n          },\r\n        },\r\n      });\r\n```\r\n\r\nWith kratosApi being \r\n``` return new FrontendApi(\r\n    new Configuration({\r\n      basePath,\r\n      apiKey: token,\r\n      baseOptions: {\r\n        withCredentials: false,\r\n      },\r\n    }),\r\n    \"\",\r\n    axios\r\n  );\r\n\r\n```\r\n  \r\nWhen we call the flow like this, we do get an email with the code inside to the email address that's specified in the `traits.email` field. Alongside, we also get the id of the verification flow which was created by the registration flow. But we need to get the id in the code somehow in order to use it in verification for the `flow` field which can be seen in the next code block.\r\n  \r\n  And finally, we are trying to get the verification as follows: \r\n  ```\r\n  updateVerificationFlow({\r\n        flow: <id of the Registration Flow (to be changed with the actual id of verification flow)>,\r\n        updateVerificationFlowBody: { code, email }\r\n      })\r\n  ```\r\n  \r\n Thank you and best regards, \r\n\r\n### Reproducing the bug\r\n\r\nAdding kratos v0.11.0 to the application and specifying the kratos version in docker-compose.yml & kube-kratos-values.yml\r\n\r\nEnabling and adding code as verification method in kratos.yml\r\n\r\nCreating a Native Registration flow with FrontendApi and updating the flow with the account parameters needed. \r\n\r\nThe verification flow will have been automatically created, mail will be sent to the email address stated in traits with the id, but the id of verification flow is unreachable to the code to call `updateVerificationFlow` with it.\r\n\r\n### Relevant log output\r\n\r\n_No response_\r\n\r\n### Relevant configuration\r\n\r\n_No response_\r\n\r\n### Version\r\n\r\n0.11.0\r\n\r\n### On which operating system are you observing this issue?\r\n\r\nLinux\r\n\r\n### In which environment are you deploying?\r\n\r\nDocker Compose\r\n\r\n### Additional Context\r\n\r\n_No response_", "closed_by": {"login": "aeneasr", "id": 3372410, "node_id": "MDQ6VXNlcjMzNzI0MTA=", "avatar_url": "https://avatars.githubusercontent.com/u/3372410?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aeneasr", "html_url": "https://github.com/aeneasr", "followers_url": "https://api.github.com/users/aeneasr/followers", "following_url": "https://api.github.com/users/aeneasr/following{/other_user}", "gists_url": "https://api.github.com/users/aeneasr/gists{/gist_id}", "starred_url": "https://api.github.com/users/aeneasr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aeneasr/subscriptions", "organizations_url": "https://api.github.com/users/aeneasr/orgs", "repos_url": "https://api.github.com/users/aeneasr/repos", "events_url": "https://api.github.com/users/aeneasr/events{/privacy}", "received_events_url": "https://api.github.com/users/aeneasr/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/ory/kratos/issues/2975/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/ory/kratos/issues/2975/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/ory/kratos/issues/2003", "repository_url": "https://api.github.com/repos/ory/kratos", "labels_url": "https://api.github.com/repos/ory/kratos/issues/2003/labels{/name}", "comments_url": "https://api.github.com/repos/ory/kratos/issues/2003/comments", "events_url": "https://api.github.com/repos/ory/kratos/issues/2003/events", "html_url": "https://github.com/ory/kratos/issues/2003", "id": 1065126248, "node_id": "I_kwDOCBDZBc4_fIlo", "number": 2003, "title": "POST /self-service/registration route not accepting CSRF token", "user": {"login": "brycesteinhoff", "id": 5203373, "node_id": "MDQ6VXNlcjUyMDMzNzM=", "avatar_url": "https://avatars.githubusercontent.com/u/5203373?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brycesteinhoff", "html_url": "https://github.com/brycesteinhoff", "followers_url": "https://api.github.com/users/brycesteinhoff/followers", "following_url": "https://api.github.com/users/brycesteinhoff/following{/other_user}", "gists_url": "https://api.github.com/users/brycesteinhoff/gists{/gist_id}", "starred_url": "https://api.github.com/users/brycesteinhoff/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brycesteinhoff/subscriptions", "organizations_url": "https://api.github.com/users/brycesteinhoff/orgs", "repos_url": "https://api.github.com/users/brycesteinhoff/repos", "events_url": "https://api.github.com/users/brycesteinhoff/events{/privacy}", "received_events_url": "https://api.github.com/users/brycesteinhoff/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 948357241, "node_id": "MDU6TGFiZWw5NDgzNTcyNDE=", "url": "https://api.github.com/repos/ory/kratos/labels/bug", "name": "bug", "color": "F44336", "default": true, "description": "Something is not working."}], "state": "closed", "locked": false, "assignees": [], "milestone": {"url": "https://api.github.com/repos/ory/kratos/milestones/13", "html_url": "https://github.com/ory/kratos/milestone/13", "labels_url": "https://api.github.com/repos/ory/kratos/milestones/13/labels", "id": 7050802, "node_id": "MI_kwDOCBDZBc4Aa5Yy", "number": 13, "title": "v0.10.0", "description": "", "creator": {"login": "aeneasr", "id": 3372410, "node_id": "MDQ6VXNlcjMzNzI0MTA=", "avatar_url": "https://avatars.githubusercontent.com/u/3372410?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aeneasr", "html_url": "https://github.com/aeneasr", "followers_url": "https://api.github.com/users/aeneasr/followers", "following_url": "https://api.github.com/users/aeneasr/following{/other_user}", "gists_url": "https://api.github.com/users/aeneasr/gists{/gist_id}", "starred_url": "https://api.github.com/users/aeneasr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aeneasr/subscriptions", "organizations_url": "https://api.github.com/users/aeneasr/orgs", "repos_url": "https://api.github.com/users/aeneasr/repos", "events_url": "https://api.github.com/users/aeneasr/events{/privacy}", "received_events_url": "https://api.github.com/users/aeneasr/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "open_issues": 0, "closed_issues": 4, "state": "closed", "created_at": "2021-08-11T13:45:51Z", "updated_at": "2022-05-30T10:15:29Z", "due_on": null, "closed_at": "2022-05-30T10:15:29Z"}, "comments": 12, "created_at": "2021-11-27T20:31:01Z", "updated_at": "2022-05-13T16:19:13Z", "closed_at": "2022-05-13T16:19:13Z", "assignee": null, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### Preflight checklist\n\n- [X] I could not find a solution in the existing issues, docs, nor discussions.\n- [X] I agree to follow this project's [Code of Conduct](https://github.com/ory/kratos/blob/master/CODE_OF_CONDUCT.md).\n- [X] I have read and am following this repository's [Contribution Guidelines](https://github.com/ory/kratos/blob/master/CONTRIBUTING.md).\n- [ ] This issue affects my [Ory Cloud](https://www.ory.sh/) project.\n- [ ] I have joined the [Ory Community Slack](https://slack.ory.sh).\n- [ ] I am signed up to the [Ory Security Patch Newsletter](https://ory.us10.list-manage.com/subscribe?u=ffb1a878e4ec6c0ed312a3480&id=f605a41b53).\n\n### Describe the bug\n\nI'm attempting to call the POST /self-service/registration endpoint from a backend Go application using the Go SDK.\r\n\r\nI am setting the CSRF token on the SubmitSelfServiceRegistrationFlowBody like so:\r\n\r\n```\r\nsubmitSelfServiceRegistrationFlowWithPasswordMethodBody := kratos.NewSubmitSelfServiceRegistrationFlowWithPasswordMethodBody(\r\n\t\"password\",\r\n\tpassword,\r\n\ttraits,\r\n)\r\n\r\n// CSRF token set\r\nsubmitSelfServiceRegistrationFlowWithPasswordMethodBody.SetCsrfToken(csrfToken)\r\n\r\nsubmitSelfServiceRegistrationFlowBody := kratos.SubmitSelfServiceRegistrationFlowBody{\r\n\tSubmitSelfServiceRegistrationFlowWithPasswordMethodBody: submitSelfServiceRegistrationFlowWithPasswordMethodBody,\r\n}\r\n```\r\n\r\nI can see that if I `json.Marshal` the `submitSelfServiceRegistrationFlowWithPasswordMethodBody` that the `csrf_token` field is on the object as expected.\r\n\r\nHowever when I execute the submission flow, I get back a CSRF error:\r\n\r\n```\r\nsuccessfulSelfServiceRegistration, httpResponse, err := client.kratosPublicClient.V0alpha2Api.\r\n\tSubmitSelfServiceRegistrationFlow(context.Background()).\r\n\tFlow(flowId).\r\n\tSubmitSelfServiceRegistrationFlowBody(submitSelfServiceRegistrationFlowBody).\r\n\tExecute()\r\n```\r\n\r\n```\r\n{{\"error\":{\"id\":\"security_csrf_violation\",\"code\":403,\"status\":\"Forbidden\",\"request\":\"a9d454e8-56b8-4545-bbf1-dbfe94e1231c\",\"reason\":\"The request was rejected to protect you from Cross-Site-Request-Forgery (CSRF) which could cause account takeover, leaking personal information, and other serious security issues.\",\"details\":{\"docs\":\"https://www.ory.sh/kratos/docs/debug/csrf\",\"hint\":\"The anti-CSRF cookie was found but the CSRF token was not included in the HTTP request body (csrf_token) nor in the HTTP Header (X-CSRF-Token).\",\"reject_reason\":\"The HTTP Cookie Header was set and a CSRF token was sent but they do not match. We recommend deleting all cookies for this domain and retrying the flow.\"},\"message\":\"the request was rejected to protect you from Cross-Site-Request-Forgery\"}}\r\n```\r\n\r\nThe value I'm setting is the value of the CSRF token cookie received back from prior `InitializeSelfServiceRegistrationFlowForBrowsers` request.\r\n\r\nDo I need to use the name of the cookie also somehow? Or only the value in this field?\n\n### Reproducing the bug\n\nSee code above\n\n### Relevant log output\n\n_No response_\n\n### Relevant configuration\n\n_No response_\n\n### Version\n\nv0.8.0-alpha.2\n\n### On which operating system are you observing this issue?\n\nLinux\n\n### In which environment are you deploying?\n\nKubernetes with Helm\n\n### Additional Context\n\n_No response_", "closed_by": {"login": "aeneasr", "id": 3372410, "node_id": "MDQ6VXNlcjMzNzI0MTA=", "avatar_url": "https://avatars.githubusercontent.com/u/3372410?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aeneasr", "html_url": "https://github.com/aeneasr", "followers_url": "https://api.github.com/users/aeneasr/followers", "following_url": "https://api.github.com/users/aeneasr/following{/other_user}", "gists_url": "https://api.github.com/users/aeneasr/gists{/gist_id}", "starred_url": "https://api.github.com/users/aeneasr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aeneasr/subscriptions", "organizations_url": "https://api.github.com/users/aeneasr/orgs", "repos_url": "https://api.github.com/users/aeneasr/repos", "events_url": "https://api.github.com/users/aeneasr/events{/privacy}", "received_events_url": "https://api.github.com/users/aeneasr/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/ory/kratos/issues/2003/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/ory/kratos/issues/2003/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/ory/kratos/issues/1077", "repository_url": "https://api.github.com/repos/ory/kratos", "labels_url": "https://api.github.com/repos/ory/kratos/issues/1077/labels{/name}", "comments_url": "https://api.github.com/repos/ory/kratos/issues/1077/comments", "events_url": "https://api.github.com/repos/ory/kratos/issues/1077/events", "html_url": "https://github.com/ory/kratos/issues/1077", "id": 810418324, "node_id": "MDU6SXNzdWU4MTA0MTgzMjQ=", "number": 1077, "title": "Recovery link doesn't log out existing users", "user": {"login": "andrewbanchich", "id": 13824577, "node_id": "MDQ6VXNlcjEzODI0NTc3", "avatar_url": "https://avatars.githubusercontent.com/u/13824577?v=4", "gravatar_id": "", "url": "https://api.github.com/users/andrewbanchich", "html_url": "https://github.com/andrewbanchich", "followers_url": "https://api.github.com/users/andrewbanchich/followers", "following_url": "https://api.github.com/users/andrewbanchich/following{/other_user}", "gists_url": "https://api.github.com/users/andrewbanchich/gists{/gist_id}", "starred_url": "https://api.github.com/users/andrewbanchich/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/andrewbanchich/subscriptions", "organizations_url": "https://api.github.com/users/andrewbanchich/orgs", "repos_url": "https://api.github.com/users/andrewbanchich/repos", "events_url": "https://api.github.com/users/andrewbanchich/events{/privacy}", "received_events_url": "https://api.github.com/users/andrewbanchich/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 948357241, "node_id": "MDU6TGFiZWw5NDgzNTcyNDE=", "url": "https://api.github.com/repos/ory/kratos/labels/bug", "name": "bug", "color": "F44336", "default": true, "description": "Something is not working."}, {"id": 948357244, "node_id": "MDU6TGFiZWw5NDgzNTcyNDQ=", "url": "https://api.github.com/repos/ory/kratos/labels/help%20wanted", "name": "help wanted", "color": "43A047", "default": true, "description": "We are looking for help on this one."}, {"id": 948357245, "node_id": "MDU6TGFiZWw5NDgzNTcyNDU=", "url": "https://api.github.com/repos/ory/kratos/labels/good%20first%20issue", "name": "good first issue", "color": "8BDC8E", "default": true, "description": "A good issue to tackle when being a novice to the project."}], "state": "closed", "locked": false, "assignees": [{"login": "aeneasr", "id": 3372410, "node_id": "MDQ6VXNlcjMzNzI0MTA=", "avatar_url": "https://avatars.githubusercontent.com/u/3372410?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aeneasr", "html_url": "https://github.com/aeneasr", "followers_url": "https://api.github.com/users/aeneasr/followers", "following_url": "https://api.github.com/users/aeneasr/following{/other_user}", "gists_url": "https://api.github.com/users/aeneasr/gists{/gist_id}", "starred_url": "https://api.github.com/users/aeneasr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aeneasr/subscriptions", "organizations_url": "https://api.github.com/users/aeneasr/orgs", "repos_url": "https://api.github.com/users/aeneasr/repos", "events_url": "https://api.github.com/users/aeneasr/events{/privacy}", "received_events_url": "https://api.github.com/users/aeneasr/received_events", "type": "User", "user_view_type": "public", "site_admin": false}], "milestone": {"url": "https://api.github.com/repos/ory/kratos/milestones/11", "html_url": "https://github.com/ory/kratos/milestone/11", "labels_url": "https://api.github.com/repos/ory/kratos/milestones/11/labels", "id": 6942505, "node_id": "MDk6TWlsZXN0b25lNjk0MjUwNQ==", "number": 11, "title": "v0.9.0-alpha.1", "description": "This milestone focuses on passwordless authentication and improved recovery and verification flows.", "creator": {"login": "aeneasr", "id": 3372410, "node_id": "MDQ6VXNlcjMzNzI0MTA=", "avatar_url": "https://avatars.githubusercontent.com/u/3372410?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aeneasr", "html_url": "https://github.com/aeneasr", "followers_url": "https://api.github.com/users/aeneasr/followers", "following_url": "https://api.github.com/users/aeneasr/following{/other_user}", "gists_url": "https://api.github.com/users/aeneasr/gists{/gist_id}", "starred_url": "https://api.github.com/users/aeneasr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aeneasr/subscriptions", "organizations_url": "https://api.github.com/users/aeneasr/orgs", "repos_url": "https://api.github.com/users/aeneasr/repos", "events_url": "https://api.github.com/users/aeneasr/events{/privacy}", "received_events_url": "https://api.github.com/users/aeneasr/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "open_issues": 0, "closed_issues": 7, "state": "closed", "created_at": "2021-07-13T15:29:56Z", "updated_at": "2022-05-30T10:15:12Z", "due_on": null, "closed_at": "2022-05-30T10:15:12Z"}, "comments": 12, "created_at": "2021-02-17T18:11:30Z", "updated_at": "2022-03-26T11:02:34Z", "closed_at": "2022-03-05T11:07:35Z", "assignee": {"login": "aeneasr", "id": 3372410, "node_id": "MDQ6VXNlcjMzNzI0MTA=", "avatar_url": "https://avatars.githubusercontent.com/u/3372410?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aeneasr", "html_url": "https://github.com/aeneasr", "followers_url": "https://api.github.com/users/aeneasr/followers", "following_url": "https://api.github.com/users/aeneasr/following{/other_user}", "gists_url": "https://api.github.com/users/aeneasr/gists{/gist_id}", "starred_url": "https://api.github.com/users/aeneasr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aeneasr/subscriptions", "organizations_url": "https://api.github.com/users/aeneasr/orgs", "repos_url": "https://api.github.com/users/aeneasr/repos", "events_url": "https://api.github.com/users/aeneasr/events{/privacy}", "received_events_url": "https://api.github.com/users/aeneasr/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "author_association": "CONTRIBUTOR", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "To reproduce:\r\n\r\n1. Create an identity using `foo@test.com`.\r\n2. Generate recovery link for that account.\r\n3. Set password using the recovery link.\r\n4. While logged in on the same computer, create a new identity `bar@test.com`.\r\n5. Generate a recovery link for `bar@test.com`.\r\n6. Clicking on the link opens the UI, but still logged in as `foo@test.com`.", "closed_by": {"login": "aeneasr", "id": 3372410, "node_id": "MDQ6VXNlcjMzNzI0MTA=", "avatar_url": "https://avatars.githubusercontent.com/u/3372410?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aeneasr", "html_url": "https://github.com/aeneasr", "followers_url": "https://api.github.com/users/aeneasr/followers", "following_url": "https://api.github.com/users/aeneasr/following{/other_user}", "gists_url": "https://api.github.com/users/aeneasr/gists{/gist_id}", "starred_url": "https://api.github.com/users/aeneasr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aeneasr/subscriptions", "organizations_url": "https://api.github.com/users/aeneasr/orgs", "repos_url": "https://api.github.com/users/aeneasr/repos", "events_url": "https://api.github.com/users/aeneasr/events{/privacy}", "received_events_url": "https://api.github.com/users/aeneasr/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/ory/kratos/issues/1077/reactions", "total_count": 2, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 1}, "timeline_url": "https://api.github.com/repos/ory/kratos/issues/1077/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/ory/kratos/issues/1012", "repository_url": "https://api.github.com/repos/ory/kratos", "labels_url": "https://api.github.com/repos/ory/kratos/issues/1012/labels{/name}", "comments_url": "https://api.github.com/repos/ory/kratos/issues/1012/comments", "events_url": "https://api.github.com/repos/ory/kratos/issues/1012/events", "html_url": "https://github.com/ory/kratos/pull/1012", "id": 793376893, "node_id": "MDExOlB1bGxSZXF1ZXN0NTYxMDc1Mjc4", "number": 1012, "title": "Umbrella PR for Ory Kratos v0.6 with MFA and improved flows (#961)", "user": {"login": "aeneasr", "id": 3372410, "node_id": "MDQ6VXNlcjMzNzI0MTA=", "avatar_url": "https://avatars.githubusercontent.com/u/3372410?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aeneasr", "html_url": "https://github.com/aeneasr", "followers_url": "https://api.github.com/users/aeneasr/followers", "following_url": "https://api.github.com/users/aeneasr/following{/other_user}", "gists_url": "https://api.github.com/users/aeneasr/gists{/gist_id}", "starred_url": "https://api.github.com/users/aeneasr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aeneasr/subscriptions", "organizations_url": "https://api.github.com/users/aeneasr/orgs", "repos_url": "https://api.github.com/users/aeneasr/repos", "events_url": "https://api.github.com/users/aeneasr/events{/privacy}", "received_events_url": "https://api.github.com/users/aeneasr/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 948357241, "node_id": "MDU6TGFiZWw5NDgzNTcyNDE=", "url": "https://api.github.com/repos/ory/kratos/labels/bug", "name": "bug", "color": "F44336", "default": true, "description": "Something is not working."}, {"id": 948357243, "node_id": "MDU6TGFiZWw5NDgzNTcyNDM=", "url": "https://api.github.com/repos/ory/kratos/labels/feat", "name": "feat", "color": "2979FF", "default": false, "description": "New feature or request."}, {"id": 1811357018, "node_id": "MDU6TGFiZWwxODExMzU3MDE4", "url": "https://api.github.com/repos/ory/kratos/labels/blocking", "name": "blocking", "color": "FF2929", "default": false, "description": "Blocks milestones or other issues or pulls."}, {"id": 2098294644, "node_id": "MDU6TGFiZWwyMDk4Mjk0NjQ0", "url": "https://api.github.com/repos/ory/kratos/labels/breaking%20change", "name": "breaking change", "color": "FF4F29", "default": false, "description": "Changes behavior in a breaking manner."}], "state": "closed", "locked": false, "assignees": [{"login": "aeneasr", "id": 3372410, "node_id": "MDQ6VXNlcjMzNzI0MTA=", "avatar_url": "https://avatars.githubusercontent.com/u/3372410?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aeneasr", "html_url": "https://github.com/aeneasr", "followers_url": "https://api.github.com/users/aeneasr/followers", "following_url": "https://api.github.com/users/aeneasr/following{/other_user}", "gists_url": "https://api.github.com/users/aeneasr/gists{/gist_id}", "starred_url": "https://api.github.com/users/aeneasr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aeneasr/subscriptions", "organizations_url": "https://api.github.com/users/aeneasr/orgs", "repos_url": "https://api.github.com/users/aeneasr/repos", "events_url": "https://api.github.com/users/aeneasr/events{/privacy}", "received_events_url": "https://api.github.com/users/aeneasr/received_events", "type": "User", "user_view_type": "public", "site_admin": false}], "milestone": {"url": "https://api.github.com/repos/ory/kratos/milestones/8", "html_url": "https://github.com/ory/kratos/milestone/8", "labels_url": "https://api.github.com/repos/ory/kratos/milestones/8/labels", "id": 5495775, "node_id": "MDk6TWlsZXN0b25lNTQ5NTc3NQ==", "number": 8, "title": "v0.6.0-alpha.1", "description": null, "creator": {"login": "aeneasr", "id": 3372410, "node_id": "MDQ6VXNlcjMzNzI0MTA=", "avatar_url": "https://avatars.githubusercontent.com/u/3372410?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aeneasr", "html_url": "https://github.com/aeneasr", "followers_url": "https://api.github.com/users/aeneasr/followers", "following_url": "https://api.github.com/users/aeneasr/following{/other_user}", "gists_url": "https://api.github.com/users/aeneasr/gists{/gist_id}", "starred_url": "https://api.github.com/users/aeneasr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aeneasr/subscriptions", "organizations_url": "https://api.github.com/users/aeneasr/orgs", "repos_url": "https://api.github.com/users/aeneasr/repos", "events_url": "https://api.github.com/users/aeneasr/events{/privacy}", "received_events_url": "https://api.github.com/users/aeneasr/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "open_issues": 0, "closed_issues": 30, "state": "closed", "created_at": "2020-06-03T14:47:05Z", "updated_at": "2021-06-15T09:21:20Z", "due_on": null, "closed_at": "2021-06-15T09:21:20Z"}, "comments": 8, "created_at": "2021-01-25T13:21:26Z", "updated_at": "2021-04-09T18:27:02Z", "closed_at": "2021-04-09T18:27:00Z", "assignee": {"login": "aeneasr", "id": 3372410, "node_id": "MDQ6VXNlcjMzNzI0MTA=", "avatar_url": "https://avatars.githubusercontent.com/u/3372410?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aeneasr", "html_url": "https://github.com/aeneasr", "followers_url": "https://api.github.com/users/aeneasr/followers", "following_url": "https://api.github.com/users/aeneasr/following{/other_user}", "gists_url": "https://api.github.com/users/aeneasr/gists{/gist_id}", "starred_url": "https://api.github.com/users/aeneasr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aeneasr/subscriptions", "organizations_url": "https://api.github.com/users/aeneasr/orgs", "repos_url": "https://api.github.com/users/aeneasr/repos", "events_url": "https://api.github.com/users/aeneasr/events{/privacy}", "received_events_url": "https://api.github.com/users/aeneasr/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "author_association": "MEMBER", "type": null, "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/ory/kratos/pulls/1012", "html_url": "https://github.com/ory/kratos/pull/1012", "diff_url": "https://github.com/ory/kratos/pull/1012.diff", "patch_url": "https://github.com/ory/kratos/pull/1012.patch", "merged_at": "2021-04-09T18:27:00Z"}, "body": "Description TBD\r\n\r\n## Release notes\r\n\r\n- Removing the method table makes things even faster (no joins)\r\n- \r\n\r\n## Related issues\r\n\r\n- https://github.com/ory/cli/pull/63\r\n- https://github.com/ory/kratos-client-go/pull/6\r\n- https://github.com/ory/cli/pull/62\r\n\r\n## Todo\r\n\r\n- [ ] write tests for domain aliasing, especially in session manager and form actions\r\n- [ ] hooks exxecute per strat and after everything is done too\r\n- [ ] make sure hooks dont execute twice then\r\n- [x] Before applying strategy we need to be sure that it is actually enabled (e.g. login -> password)\r\n- [ ] Update docs\r\n  - [ ] SDK usage examples\r\n  - [ ] Form rendering\r\n  - [ ] Explain UI nodes\r\n- [ ] In ORY CLI revert\r\n     ```\r\n \t//ctx = context.WithValue(ctx, cliclient.HTTPClientContextKey, func(cmd *cobra.Command) *http.Client {\r\n\t//\treturn remote.NewHTTPClient(cmd)\r\n\t//})\r\n     ```\r\n- [ ] Protect against ID guessing / sharing\r\n- [x] // TODO replace \"payload.Identifier\"\r\n- [ ] `testhelpers.EncodeFormAsJSON` no longer escapes `.`\r\n- [ ] `// TODO merge`\r\n- [ ] feature overview page? include login delay time for non-existing accounts\r\n- [ ] `// TODO: check prefix only password group?`\r\n- [x] document that individual redirect urls for login / reg methods no longer exist", "closed_by": {"login": "aeneasr", "id": 3372410, "node_id": "MDQ6VXNlcjMzNzI0MTA=", "avatar_url": "https://avatars.githubusercontent.com/u/3372410?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aeneasr", "html_url": "https://github.com/aeneasr", "followers_url": "https://api.github.com/users/aeneasr/followers", "following_url": "https://api.github.com/users/aeneasr/following{/other_user}", "gists_url": "https://api.github.com/users/aeneasr/gists{/gist_id}", "starred_url": "https://api.github.com/users/aeneasr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aeneasr/subscriptions", "organizations_url": "https://api.github.com/users/aeneasr/orgs", "repos_url": "https://api.github.com/users/aeneasr/repos", "events_url": "https://api.github.com/users/aeneasr/events{/privacy}", "received_events_url": "https://api.github.com/users/aeneasr/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/ory/kratos/issues/1012/reactions", "total_count": 7, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 7, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/ory/kratos/issues/1012/timeline", "performed_via_github_app": null, "state_reason": null}]}