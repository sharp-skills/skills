{"d": [{"url": "https://api.github.com/repos/nextauthjs/next-auth/issues/3920", "repository_url": "https://api.github.com/repos/nextauthjs/next-auth", "labels_url": "https://api.github.com/repos/nextauthjs/next-auth/issues/3920/labels{/name}", "comments_url": "https://api.github.com/repos/nextauthjs/next-auth/issues/3920/comments", "events_url": "https://api.github.com/repos/nextauthjs/next-auth/issues/3920/events", "html_url": "https://github.com/nextauthjs/next-auth/issues/3920", "id": 1133096564, "node_id": "I_kwDOBxpGM85Dia50", "number": 3920, "title": "Request timed out error while using Google provider", "user": {"login": "appocal-main", "id": 99488243, "node_id": "U_kgDOBe4R8w", "avatar_url": "https://avatars.githubusercontent.com/u/99488243?v=4", "gravatar_id": "", "url": "https://api.github.com/users/appocal-main", "html_url": "https://github.com/appocal-main", "followers_url": "https://api.github.com/users/appocal-main/followers", "following_url": "https://api.github.com/users/appocal-main/following{/other_user}", "gists_url": "https://api.github.com/users/appocal-main/gists{/gist_id}", "starred_url": "https://api.github.com/users/appocal-main/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/appocal-main/subscriptions", "organizations_url": "https://api.github.com/users/appocal-main/orgs", "repos_url": "https://api.github.com/users/appocal-main/repos", "events_url": "https://api.github.com/users/appocal-main/events{/privacy}", "received_events_url": "https://api.github.com/users/appocal-main/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 818290553, "node_id": "MDU6TGFiZWw4MTgyOTA1NTM=", "url": "https://api.github.com/repos/nextauthjs/next-auth/labels/bug", "name": "bug", "color": "ffb8bb", "default": true, "description": "Something isn't working"}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 80, "created_at": "2022-02-11T21:08:53Z", "updated_at": "2025-08-01T14:57:56Z", "closed_at": "2022-02-12T23:29:37Z", "assignee": null, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### Description \ud83d\udc1c\n\nAfter following the docs for Prisma Adapter and Google Provider, I added auth to my repo, but when trying to log in through google auth, it's timing out for some reason.\r\n\r\n![image](https://user-images.githubusercontent.com/99488243/153669996-7d06547b-31b0-4551-b068-e576f365982d.png)\r\n\r\nI even tried with a longer timeout, but still no luck :(\r\n\r\n```js\r\nproviders: [\r\n    GoogleProvider({\r\n      clientId: process.env.GOOGLE_CLIENT_ID,\r\n      clientSecret: process.env.GOOGLE_CLIENT_SECRET,\r\n      httpOptions: {\r\n        timeout: 10000,\r\n      }\r\n    })\r\n  ],\r\n```\r\n\r\n![image](https://user-images.githubusercontent.com/99488243/153670205-e3b0915d-e8a5-4171-af7d-b20d426fadef.png)\r\n\n\n### Is this a bug in your own project?\n\nYes\n\n### How to reproduce \u2615\ufe0f\n\nI replicated the issue in a new separate repo, just add the env variable and run it in local - https://github.com/Nikit-Singh/next-auth-google-issue\n\n### Screenshots / Logs \ud83d\udcfd\n\n_No response_\n\n### Environment \ud83d\udda5\n\nSystem:\r\n    OS: Windows 10 10.0.22000\r\n    CPU: (16) x64 AMD Ryzen 7 3700X 8-Core Processor\r\n    Memory: 4.38 GB / 15.95 GB\r\n  Binaries:\r\n    Node: 16.13.0 - C:\\Program Files\\nodejs\\node.EXE\r\n    Yarn: 1.22.17 - ~\\AppData\\Roaming\\npm\\yarn.CMD\r\n    npm: 8.3.1 - C:\\Program Files\\nodejs\\npm.CMD\r\n  Browsers:\r\n    Edge: Spartan (44.22000.120.0), Chromium (96.0.1054.62)\r\n    Internet Explorer: 11.0.22000.120       \r\n  npmPackages:\r\n    next: 12.0.10 => 12.0.10\r\n    next-auth: ^4.2.1 => 4.2.1\r\n    react: 17.0.2 => 17.0.2\n\n### Contributing \ud83d\ude4c\ud83c\udffd\n\nYes,  I am willing to help solve this bug in a PR", "closed_by": {"login": "balazsorban44", "id": 18369201, "node_id": "MDQ6VXNlcjE4MzY5MjAx", "avatar_url": "https://avatars.githubusercontent.com/u/18369201?v=4", "gravatar_id": "", "url": "https://api.github.com/users/balazsorban44", "html_url": "https://github.com/balazsorban44", "followers_url": "https://api.github.com/users/balazsorban44/followers", "following_url": "https://api.github.com/users/balazsorban44/following{/other_user}", "gists_url": "https://api.github.com/users/balazsorban44/gists{/gist_id}", "starred_url": "https://api.github.com/users/balazsorban44/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/balazsorban44/subscriptions", "organizations_url": "https://api.github.com/users/balazsorban44/orgs", "repos_url": "https://api.github.com/users/balazsorban44/repos", "events_url": "https://api.github.com/users/balazsorban44/events{/privacy}", "received_events_url": "https://api.github.com/users/balazsorban44/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/nextauthjs/next-auth/issues/3920/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/nextauthjs/next-auth/issues/3920/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/nextauthjs/next-auth/issues/8831", "repository_url": "https://api.github.com/repos/nextauthjs/next-auth", "labels_url": "https://api.github.com/repos/nextauthjs/next-auth/issues/8831/labels{/name}", "comments_url": "https://api.github.com/repos/nextauthjs/next-auth/issues/8831/comments", "events_url": "https://api.github.com/repos/nextauthjs/next-auth/issues/8831/events", "html_url": "https://github.com/nextauthjs/next-auth/issues/8831", "id": 1936026234, "node_id": "I_kwDOBxpGM85zZWp6", "number": 8831, "title": "Auth provider for Linkedin not working", "user": {"login": "andersengenolsen", "id": 27057646, "node_id": "MDQ6VXNlcjI3MDU3NjQ2", "avatar_url": "https://avatars.githubusercontent.com/u/27057646?v=4", "gravatar_id": "", "url": "https://api.github.com/users/andersengenolsen", "html_url": "https://github.com/andersengenolsen", "followers_url": "https://api.github.com/users/andersengenolsen/followers", "following_url": "https://api.github.com/users/andersengenolsen/following{/other_user}", "gists_url": "https://api.github.com/users/andersengenolsen/gists{/gist_id}", "starred_url": "https://api.github.com/users/andersengenolsen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/andersengenolsen/subscriptions", "organizations_url": "https://api.github.com/users/andersengenolsen/orgs", "repos_url": "https://api.github.com/users/andersengenolsen/repos", "events_url": "https://api.github.com/users/andersengenolsen/events{/privacy}", "received_events_url": "https://api.github.com/users/andersengenolsen/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 818290553, "node_id": "MDU6TGFiZWw4MTgyOTA1NTM=", "url": "https://api.github.com/repos/nextauthjs/next-auth/labels/bug", "name": "bug", "color": "ffb8bb", "default": true, "description": "Something isn't working"}, {"id": 2564729261, "node_id": "MDU6TGFiZWwyNTY0NzI5MjYx", "url": "https://api.github.com/repos/nextauthjs/next-auth/labels/providers", "name": "providers", "color": "000000", "default": false, "description": ""}, {"id": 2646868137, "node_id": "MDU6TGFiZWwyNjQ2ODY4MTM3", "url": "https://api.github.com/repos/nextauthjs/next-auth/labels/upstream", "name": "upstream", "color": "B2715F", "default": false, "description": "The issue dervies from one of next-auth dependencies"}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 71, "created_at": "2023-10-10T19:01:31Z", "updated_at": "2025-09-19T09:28:20Z", "closed_at": "2024-04-26T11:09:29Z", "assignee": null, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### Environment\r\n\r\nSystem:\r\n    OS: Linux 6.2 Ubuntu 22.04.3 LTS 22.04.3 LTS (Jammy Jellyfish)\r\n    CPU: (12) x64 AMD Ryzen 5 3600X 6-Core Processor\r\n    Memory: 2.63 GB / 15.53 GB\r\n    Container: Yes\r\n    Shell: 5.1.16 - /bin/bash\r\n  Binaries:\r\n    Node: 20.4.0 - /usr/local/bin/node\r\n    npm: 9.7.2 - /usr/local/bin/npm\r\n\r\n### Reproduction URL\r\n\r\nhttps://github.com/nextauthjs/next-auth-example\r\n\r\n### Describe the issue\r\n\r\nAs per the documentation from Linkedin, I've set up a new LinkedIn app, and added \"Sign In with LinkedIn using OpenID Connect\" as a product.\r\n\r\nAt first I had some problems when not specifying scope.\r\n\r\n``\r\n    providers: [\r\n        LinkedIn({\r\n            clientId: process.env.LINKEDIN_ID,\r\n            clientSecret: process.env.LINKEDIN_SECRET,\r\n        })\r\n    ], pages: {\r\n        signIn: '/register-cv'\r\n    },\r\n``\r\n\r\nThis returns an 'unauthorized_scope_error' for r_emailaddress. Managed to fix that issue by providing scopes as per the documentation from Microsoft:\r\n\r\n\r\n> Authenticating Members\r\nNew members logging in to your service for the first time will need to follow the Authenticating with OAuth 2.0 Guide. When requesting the authorization code in Step 2 of the OAuth 2.0 Guide, make sure you use the OpenID scope openid to get the ID Token. We are also introducing new scopes profile and email.\r\n\r\n\r\n> openid\tRequired to indicate the application wants to use OIDC to authenticate the member.\r\n> profile\tRequired to retrieve the member's lite profile including their id, name, and profile picture.\r\n> email\tRequired to retrieve the member's email address.\r\n> After successful authentication, you will receive the member's access token and ID token.\r\n\r\n> If your application does not have these permissions provisioned, you can request access through the Developer Portal. Select your app from My Apps, navigate to the Products tab, and request the Sign in with LinkedIn using OpenID Connect product.\r\n\r\nLink: https://learn.microsoft.com/en-us/linkedin/consumer/integrations/self-serve/sign-in-with-linkedin-v2\r\n\r\nUpdated scopes to match the documentation from Microsoft:\r\n\r\n`LinkedIn({\r\n            clientId: process.env.LINKEDIN_ID,\r\n            clientSecret: process.env.LINKEDIN_SECRET,\r\n            authorization: { params: { scope: 'openid profile email' } }})`\r\n            \r\nNow getting this error:\r\n\r\n`https://next-auth.js.org/errors#oauth_callback_error unexpected iss value, expected undefined, got: https://www.linkedin.com {\r\n  error: RPError: unexpected iss value, expected undefined, got: https://www.linkedin.com\r\n      at Client.validateJWT (/home/deb/PhpstormProjects/cvmaker/node_modules/openid-client/lib/client.js:931:15)\r\n      at Client.validateIdToken (/home/deb/PhpstormProjects/cvmaker/node_modules/openid-client/lib/client.js:766:60)\r\n      at Client.callback (/home/deb/PhpstormProjects/cvmaker/node_modules/openid-client/lib/client.js:505:18)\r\n      at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\r\n      at async oAuthCallback (/home/deb/PhpstormProjects/cvmaker/node_modules/next-auth/core/lib/oauth/callback.js:109:16)\r\n      at async Object.callback (/home/deb/PhpstormProjects/cvmaker/node_modules/next-auth/core/routes/callback.js:52:11)\r\n      at async AuthHandler (/home/deb/PhpstormProjects/cvmaker/node_modules/next-auth/core/index.js:208:28)\r\n      at async NextAuthApiHandler (/home/deb/PhpstormProjects/cvmaker/node_modules/next-auth/next/index.js:22:19)\r\n      at async NextAuth._args$ (/home/deb/PhpstormProjects/cvmaker/node_modules/next-auth/next/index.js:108:14) {\r\n    name: 'OAuthCallbackError',\r\n    code: undefined\r\n  },\r\n  providerId: 'linkedin',\r\n  message: 'unexpected iss value, expected undefined, got: https://www.linkedin.com'\r\n`\r\n\r\n![image](https://github.com/nextauthjs/next-auth/assets/27057646/d113d3c3-d85c-4026-b843-5920579dfcba)\r\n\r\n\r\n\r\n\r\n### How to reproduce\r\n\r\n1: Set up new app on Linkedin, add \"Sign In with LinkedIn using OpenID Connect\" as a product.\r\n2: Add authentication provider for Linkedin:\r\n\r\n```import NextAuth from \"next-auth\"\r\nimport LinkedIn from \"next-auth/providers/linkedin\"\r\n\r\nexport const authOptions = {\r\n    secret: 'NOT SO SECRET ANYMORE',\r\n    providers: [\r\n        LinkedIn({\r\n            clientId: process.env.LINKEDIN_ID,\r\n            clientSecret: process.env.LINKEDIN_SECRET,\r\n            authorization: { params: { scope: 'openid profile email' } },\r\n        })\r\n    ], pages: {\r\n        signIn: '/register-cv'\r\n    },\r\n}\r\nexport default `NextAuth(authOptions);", "closed_by": {"login": "ndom91", "id": 7415984, "node_id": "MDQ6VXNlcjc0MTU5ODQ=", "avatar_url": "https://avatars.githubusercontent.com/u/7415984?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ndom91", "html_url": "https://github.com/ndom91", "followers_url": "https://api.github.com/users/ndom91/followers", "following_url": "https://api.github.com/users/ndom91/following{/other_user}", "gists_url": "https://api.github.com/users/ndom91/gists{/gist_id}", "starred_url": "https://api.github.com/users/ndom91/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ndom91/subscriptions", "organizations_url": "https://api.github.com/users/ndom91/orgs", "repos_url": "https://api.github.com/users/ndom91/repos", "events_url": "https://api.github.com/users/ndom91/events{/privacy}", "received_events_url": "https://api.github.com/users/ndom91/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/nextauthjs/next-auth/issues/8831/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/nextauthjs/next-auth/issues/8831/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/nextauthjs/next-auth/issues/3830", "repository_url": "https://api.github.com/repos/nextauthjs/next-auth", "labels_url": "https://api.github.com/repos/nextauthjs/next-auth/issues/3830/labels{/name}", "comments_url": "https://api.github.com/repos/nextauthjs/next-auth/issues/3830/comments", "events_url": "https://api.github.com/repos/nextauthjs/next-auth/issues/3830/events", "html_url": "https://github.com/nextauthjs/next-auth/issues/3830", "id": 1124590532, "node_id": "MDU6SXNzdWUxMTI0NTkwNTMy", "number": 3830, "title": "Try signing with a different account. - Callback error", "user": {"login": "CheeseBTW", "id": 45247477, "node_id": "MDQ6VXNlcjQ1MjQ3NDc3", "avatar_url": "https://avatars.githubusercontent.com/u/45247477?v=4", "gravatar_id": "", "url": "https://api.github.com/users/CheeseBTW", "html_url": "https://github.com/CheeseBTW", "followers_url": "https://api.github.com/users/CheeseBTW/followers", "following_url": "https://api.github.com/users/CheeseBTW/following{/other_user}", "gists_url": "https://api.github.com/users/CheeseBTW/gists{/gist_id}", "starred_url": "https://api.github.com/users/CheeseBTW/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/CheeseBTW/subscriptions", "organizations_url": "https://api.github.com/users/CheeseBTW/orgs", "repos_url": "https://api.github.com/users/CheeseBTW/repos", "events_url": "https://api.github.com/users/CheeseBTW/events{/privacy}", "received_events_url": "https://api.github.com/users/CheeseBTW/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 818290553, "node_id": "MDU6TGFiZWw4MTgyOTA1NTM=", "url": "https://api.github.com/repos/nextauthjs/next-auth/labels/bug", "name": "bug", "color": "ffb8bb", "default": true, "description": "Something isn't working"}, {"id": 818290556, "node_id": "MDU6TGFiZWw4MTgyOTA1NTY=", "url": "https://api.github.com/repos/nextauthjs/next-auth/labels/help-needed", "name": "help-needed", "color": "fbff55", "default": false, "description": "The maintainer needs help due to time constraint/missing knowledge"}, {"id": 2628184934, "node_id": "MDU6TGFiZWwyNjI4MTg0OTM0", "url": "https://api.github.com/repos/nextauthjs/next-auth/labels/adapters", "name": "adapters", "color": "000000", "default": false, "description": "Changes related to the core code concerning database adapters"}, {"id": 3799355650, "node_id": "MDU6TGFiZWwzNzk5MzU1NjUw", "url": "https://api.github.com/repos/nextauthjs/next-auth/labels/prisma", "name": "prisma", "color": "0c344c", "default": false, "description": "@auth/prisma-adapter"}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 58, "created_at": "2021-01-14T00:40:00Z", "updated_at": "2025-05-25T20:13:20Z", "closed_at": "2023-03-25T09:13:10Z", "assignee": null, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "**Describe the bug**\r\nWhen trying to sign in to GitHub it says \"Try signing with a different account.\"\r\n\r\n**Steps to reproduce**\r\n- Clone orangopus/libby\r\n- click \"Login\" \r\n- Click \"Sign in with GitHub\"\r\n\r\nMake sure to include the client ID and secret in .env as `GITHUB_ID` and `GITHUB_SECRET`\r\n\r\n**Expected behavior**\r\nI expected it to login and return to the app.\r\n\r\n**Screenshots or error logs**\r\nThe error is\r\n![browser_7MIk0bI7BK](https://user-images.githubusercontent.com/45247477/104529167-fc6e2e00-5600-11eb-8127-f78be5dd7ca9.png)\r\n\r\n**Feedback**\r\n*Documentation refers to searching through [online documentation](https://next-auth.js.org), code comments and issue history. The example project refers to [next-auth-example](https://github.com/iaincollins/next-auth-example).*\r\n\r\n* [x] Found the documentation helpful\r\n* [ ] Found documentation but was incomplete\r\n* [ ] Could not find relevant documentation\r\n* [x] Found the example project helpful\r\n* [ ] Did not find the example project helpful\r\n", "closed_by": {"login": "ThangHuuVu", "id": 31528554, "node_id": "MDQ6VXNlcjMxNTI4NTU0", "avatar_url": "https://avatars.githubusercontent.com/u/31528554?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ThangHuuVu", "html_url": "https://github.com/ThangHuuVu", "followers_url": "https://api.github.com/users/ThangHuuVu/followers", "following_url": "https://api.github.com/users/ThangHuuVu/following{/other_user}", "gists_url": "https://api.github.com/users/ThangHuuVu/gists{/gist_id}", "starred_url": "https://api.github.com/users/ThangHuuVu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ThangHuuVu/subscriptions", "organizations_url": "https://api.github.com/users/ThangHuuVu/orgs", "repos_url": "https://api.github.com/users/ThangHuuVu/repos", "events_url": "https://api.github.com/users/ThangHuuVu/events{/privacy}", "received_events_url": "https://api.github.com/users/ThangHuuVu/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/nextauthjs/next-auth/issues/3830/reactions", "total_count": 39, "+1": 32, "-1": 0, "laugh": 0, "hooray": 1, "confused": 0, "heart": 0, "rocket": 6, "eyes": 0}, "timeline_url": "https://api.github.com/repos/nextauthjs/next-auth/issues/3830/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/nextauthjs/next-auth/issues/371", "repository_url": "https://api.github.com/repos/nextauthjs/next-auth", "labels_url": "https://api.github.com/repos/nextauthjs/next-auth/issues/371/labels{/name}", "comments_url": "https://api.github.com/repos/nextauthjs/next-auth/issues/371/comments", "events_url": "https://api.github.com/repos/nextauthjs/next-auth/issues/371/events", "html_url": "https://github.com/nextauthjs/next-auth/issues/371", "id": 648309517, "node_id": "MDU6SXNzdWU2NDgzMDk1MTc=", "number": 371, "title": "Is mutating the session possible?", "user": {"login": "dkreft", "id": 272745, "node_id": "MDQ6VXNlcjI3Mjc0NQ==", "avatar_url": "https://avatars.githubusercontent.com/u/272745?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dkreft", "html_url": "https://github.com/dkreft", "followers_url": "https://api.github.com/users/dkreft/followers", "following_url": "https://api.github.com/users/dkreft/following{/other_user}", "gists_url": "https://api.github.com/users/dkreft/gists{/gist_id}", "starred_url": "https://api.github.com/users/dkreft/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dkreft/subscriptions", "organizations_url": "https://api.github.com/users/dkreft/orgs", "repos_url": "https://api.github.com/users/dkreft/repos", "events_url": "https://api.github.com/users/dkreft/events{/privacy}", "received_events_url": "https://api.github.com/users/dkreft/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 818290553, "node_id": "MDU6TGFiZWw4MTgyOTA1NTM=", "url": "https://api.github.com/repos/nextauthjs/next-auth/labels/bug", "name": "bug", "color": "ffb8bb", "default": true, "description": "Something isn't working"}, {"id": 818290559, "node_id": "MDU6TGFiZWw4MTgyOTA1NTk=", "url": "https://api.github.com/repos/nextauthjs/next-auth/labels/question", "name": "question", "color": "d6c1ff", "default": true, "description": "Ask how to do something or how something works"}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 57, "created_at": "2020-06-30T16:16:41Z", "updated_at": "2025-01-11T13:31:25Z", "closed_at": "2020-12-01T16:53:39Z", "assignee": null, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "Following-up on #325 because I'm not sure if GitHub sends you notifications after an issue has been closed.\r\n\r\nI don't see a way to update data in the session after login. If I'm to store my tokens in the session, I need to be able to write to it after I refresh my access token. I've tried Googling for a solution, but to no avail. Is there something else I'm missing?\r\n\r\nThanks.", "closed_by": {"login": "iaincollins", "id": 595695, "node_id": "MDQ6VXNlcjU5NTY5NQ==", "avatar_url": "https://avatars.githubusercontent.com/u/595695?v=4", "gravatar_id": "", "url": "https://api.github.com/users/iaincollins", "html_url": "https://github.com/iaincollins", "followers_url": "https://api.github.com/users/iaincollins/followers", "following_url": "https://api.github.com/users/iaincollins/following{/other_user}", "gists_url": "https://api.github.com/users/iaincollins/gists{/gist_id}", "starred_url": "https://api.github.com/users/iaincollins/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/iaincollins/subscriptions", "organizations_url": "https://api.github.com/users/iaincollins/orgs", "repos_url": "https://api.github.com/users/iaincollins/repos", "events_url": "https://api.github.com/users/iaincollins/events{/privacy}", "received_events_url": "https://api.github.com/users/iaincollins/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/nextauthjs/next-auth/issues/371/reactions", "total_count": 8, "+1": 8, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/nextauthjs/next-auth/issues/371/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/nextauthjs/next-auth/issues/5008", "repository_url": "https://api.github.com/repos/nextauthjs/next-auth", "labels_url": "https://api.github.com/repos/nextauthjs/next-auth/issues/5008/labels{/name}", "comments_url": "https://api.github.com/repos/nextauthjs/next-auth/issues/5008/comments", "events_url": "https://api.github.com/repos/nextauthjs/next-auth/issues/5008/events", "html_url": "https://github.com/nextauthjs/next-auth/issues/5008", "id": 1315691249, "node_id": "I_kwDOBxpGM85Oa9rx", "number": 5008, "title": "next-auth is not working with Next 12.2.3", "user": {"login": "RafalFilipek", "id": 80960, "node_id": "MDQ6VXNlcjgwOTYw", "avatar_url": "https://avatars.githubusercontent.com/u/80960?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RafalFilipek", "html_url": "https://github.com/RafalFilipek", "followers_url": "https://api.github.com/users/RafalFilipek/followers", "following_url": "https://api.github.com/users/RafalFilipek/following{/other_user}", "gists_url": "https://api.github.com/users/RafalFilipek/gists{/gist_id}", "starred_url": "https://api.github.com/users/RafalFilipek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RafalFilipek/subscriptions", "organizations_url": "https://api.github.com/users/RafalFilipek/orgs", "repos_url": "https://api.github.com/users/RafalFilipek/repos", "events_url": "https://api.github.com/users/RafalFilipek/events{/privacy}", "received_events_url": "https://api.github.com/users/RafalFilipek/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 818290553, "node_id": "MDU6TGFiZWw4MTgyOTA1NTM=", "url": "https://api.github.com/repos/nextauthjs/next-auth/labels/bug", "name": "bug", "color": "ffb8bb", "default": true, "description": "Something isn't working"}, {"id": 2646868137, "node_id": "MDU6TGFiZWwyNjQ2ODY4MTM3", "url": "https://api.github.com/repos/nextauthjs/next-auth/labels/upstream", "name": "upstream", "color": "B2715F", "default": false, "description": "The issue dervies from one of next-auth dependencies"}, {"id": 3956270729, "node_id": "LA_kwDOBxpGM87rz-aJ", "url": "https://api.github.com/repos/nextauthjs/next-auth/labels/middleware", "name": "middleware", "color": "A83D92", "default": false, "description": "Related to middleware"}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 53, "created_at": "2022-07-23T16:03:40Z", "updated_at": "2023-11-18T23:31:48Z", "closed_at": "2022-08-11T07:18:24Z", "assignee": null, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### Environment\r\n\r\n```\r\n  System:\r\n    OS: Windows 10 10.0.22000\r\n    CPU: (8) x64 Intel(R) Core(TM) i7-9700K CPU @ 3.60GHz\r\n    Memory: 2.23 GB / 15.94 GB\r\n  Binaries:\r\n    Node: 16.13.0 - ~\\scoop\\apps\\nvm\\current\\nodejs\\nodejs\\node.EXE\r\n    Yarn: 1.22.19 - ~\\scoop\\apps\\yarn\\current\\bin\\yarn.CMD\r\n    npm: 8.1.0 - ~\\scoop\\apps\\nvm\\current\\nodejs\\nodejs\\npm.CMD\r\n    Watchman: 20210110.135312.0 - C:\\ProgramData\\chocolatey\\bin\\watchman.EXE\r\n  Browsers:\r\n    Edge: Spartan (44.22000.120.0), Chromium (103.0.1264.62)\r\n    Internet Explorer: 11.0.22000.120\r\n  npmPackages:\r\n    next: latest => 12.2.3\r\n    next-auth: latest => 4.10.2\r\n    react: ^18.2.0 => 18.2.0\r\n```\r\n\r\n### Reproduction URL\r\n\r\nhttps://github.com/RafalFilipek/next-auth-bug\r\n\r\n### Describe the issue\r\n\r\nAfter login, you get login page again. Cookies are set and everything looks good. But you can't access your app. It works with `12.2.2` and below.\r\n\r\n### How to reproduce\r\n\r\n1. clone `https://github.com/RafalFilipek/next-auth-bug`\r\n2. setup any provider in `[...nextauth].ts`\r\n3. try to login\r\n\r\n### Expected behavior\r\n\r\nLogin process should work as expected.", "closed_by": {"login": "balazsorban44", "id": 18369201, "node_id": "MDQ6VXNlcjE4MzY5MjAx", "avatar_url": "https://avatars.githubusercontent.com/u/18369201?v=4", "gravatar_id": "", "url": "https://api.github.com/users/balazsorban44", "html_url": "https://github.com/balazsorban44", "followers_url": "https://api.github.com/users/balazsorban44/followers", "following_url": "https://api.github.com/users/balazsorban44/following{/other_user}", "gists_url": "https://api.github.com/users/balazsorban44/gists{/gist_id}", "starred_url": "https://api.github.com/users/balazsorban44/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/balazsorban44/subscriptions", "organizations_url": "https://api.github.com/users/balazsorban44/orgs", "repos_url": "https://api.github.com/users/balazsorban44/repos", "events_url": "https://api.github.com/users/balazsorban44/events{/privacy}", "received_events_url": "https://api.github.com/users/balazsorban44/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/nextauthjs/next-auth/issues/5008/reactions", "total_count": 39, "+1": 30, "-1": 0, "laugh": 0, "hooray": 0, "confused": 2, "heart": 0, "rocket": 0, "eyes": 7}, "timeline_url": "https://api.github.com/repos/nextauthjs/next-auth/issues/5008/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/nextauthjs/next-auth/issues/9900", "repository_url": "https://api.github.com/repos/nextauthjs/next-auth", "labels_url": "https://api.github.com/repos/nextauthjs/next-auth/issues/9900/labels{/name}", "comments_url": "https://api.github.com/repos/nextauthjs/next-auth/issues/9900/comments", "events_url": "https://api.github.com/repos/nextauthjs/next-auth/issues/9900/events", "html_url": "https://github.com/nextauthjs/next-auth/issues/9900", "id": 2117169522, "node_id": "I_kwDOBxpGM85-MXFy", "number": 9900, "title": "[auth][error] CredentialsSignin, when return null for CredentialsProvider in the authorize function.", "user": {"login": "DevTheFool", "id": 110111354, "node_id": "U_kgDOBpAqeg", "avatar_url": "https://avatars.githubusercontent.com/u/110111354?v=4", "gravatar_id": "", "url": "https://api.github.com/users/DevTheFool", "html_url": "https://github.com/DevTheFool", "followers_url": "https://api.github.com/users/DevTheFool/followers", "following_url": "https://api.github.com/users/DevTheFool/following{/other_user}", "gists_url": "https://api.github.com/users/DevTheFool/gists{/gist_id}", "starred_url": "https://api.github.com/users/DevTheFool/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/DevTheFool/subscriptions", "organizations_url": "https://api.github.com/users/DevTheFool/orgs", "repos_url": "https://api.github.com/users/DevTheFool/repos", "events_url": "https://api.github.com/users/DevTheFool/events{/privacy}", "received_events_url": "https://api.github.com/users/DevTheFool/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 818290553, "node_id": "MDU6TGFiZWw4MTgyOTA1NTM=", "url": "https://api.github.com/repos/nextauthjs/next-auth/labels/bug", "name": "bug", "color": "ffb8bb", "default": true, "description": "Something isn't working"}, {"id": 3829113515, "node_id": "LA_kwDOBxpGM87kO6Kr", "url": "https://api.github.com/repos/nextauthjs/next-auth/labels/triage", "name": "triage", "color": "AED87D", "default": false, "description": "Unseen or unconfirmed by a maintainer yet. Provide extra information in the meantime."}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 45, "created_at": "2024-02-04T16:10:31Z", "updated_at": "2025-10-13T21:00:53Z", "closed_at": "2024-02-05T02:55:52Z", "assignee": null, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### Environment\n\n  System:\r\n    OS: Windows 11 10.0.22631\r\n    CPU: (24) x64 AMD Ryzen 9 3900X 12-Core Processor\r\n    Memory: 25.36 GB / 47.93 GB\r\n  Binaries:\r\n    Node: 20.11.0 - C:\\Program Files\\nodejs\\node.EXE\r\n    npm: 10.2.4 - C:\\Program Files\\nodejs\\npm.CMD\r\n  Browsers:\r\n    Edge: Chromium (121.0.2277.98)\r\n    Internet Explorer: 11.0.22621.1\r\n  npmPackages:\r\n    @auth/prisma-adapter: ^1.2.1 => 1.2.1\r\n    next: 14.1.0 => 14.1.0\r\n    next-auth: ^5.0.0-beta.5 => 5.0.0-beta.5\r\n    react: ^18 => 18.2.0\n\n### Reproduction URL\n\nhttps://github.com/AmphibianDev/todo-app/tree/main\n\n### Describe the issue\n\nThe error occurs only when `authorize` returns null, if it's returning a user, it works.\n\n### How to reproduce\n\nauth.config.ts\r\n```\r\nimport { NextAuthConfig } from \"next-auth\";\r\nimport CredentialsProvider from \"next-auth/providers/credentials\";\r\n\r\nexport default {\r\n  providers: [\r\n    CredentialsProvider({\r\n      async authorize(credentials, req) {\r\n        return null;\r\n      },\r\n    }),\r\n  ],\r\n} satisfies NextAuthConfig;\r\n```\r\nauth.ts\r\n```\r\nimport NextAuth from \"next-auth\";\r\nimport authConfig from \"@/auth.config\";\r\nimport prisma from \"@/lib/prisma\";\r\nimport { PrismaAdapter } from \"@auth/prisma-adapter\";\r\n\r\nexport const {\r\n  handlers: { GET, POST },\r\n  auth,\r\n  signIn,\r\n  signOut,\r\n} = NextAuth({ adapter: PrismaAdapter(prisma), session: { strategy: \"jwt\" }, ...authConfig });\r\n```\r\nError:\r\n```\r\n[auth][error] CredentialsSignin: Read more at https://errors.authjs.dev#credentialssignin\r\n    at Module.callback (C:\\Users\\Work\\Desktop\\todo-app\\.next\\server\\chunks\\node_modules_f27a4e._.js:2982:30)\r\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\r\n    at async Module.AuthInternal (C:\\Users\\Work\\Desktop\\todo-app\\.next\\server\\chunks\\node_modules_f27a4e._.js:3597:24)\r\n    at async Module.Auth (C:\\Users\\Work\\Desktop\\todo-app\\.next\\server\\chunks\\node_modules_f27a4e._.js:3722:29)\r\n    at async Module.signIn (C:\\Users\\Work\\Desktop\\todo-app\\.next\\server\\chunks\\node_modules_edd83f._.js:3286:17)\r\n    at async logInAction (C:\\Users\\Work\\Desktop\\todo-app\\.next\\server\\chunks\\[root of the server]__19aaaf._.js:351:9)\r\n    at async C:\\Users\\Work\\Desktop\\todo-app\\node_modules\\next\\dist\\compiled\\next-server\\app-page.runtime.dev.js:39:406\r\n    at async t4 (C:\\Users\\Work\\Desktop\\todo-app\\node_modules\\next\\dist\\compiled\\next-server\\app-page.runtime.dev.js:38:6379)\r\n    at async rk (C:\\Users\\Work\\Desktop\\todo-app\\node_modules\\next\\dist\\compiled\\next-server\\app-page.runtime.dev.js:39:25934)\r\n    at async doRender (C:\\Users\\Work\\Desktop\\todo-app\\node_modules\\next\\dist\\server\\base-server.js:1394:30)\r\n    at async cacheEntry.responseCache.get.routeKind (C:\\Users\\Work\\Desktop\\todo-app\\node_modules\\next\\dist\\server\\base-server.js:1555:28)\r\n    at async DevServer.renderToResponseWithComponentsImpl (C:\\Users\\Work\\Desktop\\todo-app\\node_modules\\next\\dist\\server\\base-server.js:1463:28)\r\n    at async DevServer.renderPageComponent (C:\\Users\\Work\\Desktop\\todo-app\\node_modules\\next\\dist\\server\\base-server.js:1856:24)       \r\n    at async DevServer.renderToResponseImpl (C:\\Users\\Work\\Desktop\\todo-app\\node_modules\\next\\dist\\server\\base-server.js:1894:32)      \r\n    at async DevServer.pipeImpl (C:\\Users\\Work\\Desktop\\todo-app\\node_modules\\next\\dist\\server\\base-server.js:911:25)\r\n    at async NextNodeServer.handleCatchallRenderRequest (C:\\Users\\Work\\Desktop\\todo-app\\node_modules\\next\\dist\\server\\next-server.js:271:17)\r\n    at async DevServer.handleRequestImpl (C:\\Users\\Work\\Desktop\\todo-app\\node_modules\\next\\dist\\server\\base-server.js:807:17)\r\n    at async C:\\Users\\Work\\Desktop\\todo-app\\node_modules\\next\\dist\\server\\dev\\next-dev-server.js:331:20\r\n    at async Span.traceAsyncFn (C:\\Users\\Work\\Desktop\\todo-app\\node_modules\\next\\dist\\trace\\trace.js:151:20)\r\n    at async DevServer.handleRequest (C:\\Users\\Work\\Desktop\\todo-app\\node_modules\\next\\dist\\server\\dev\\next-dev-server.js:328:24)      \r\n    at async invokeRender (C:\\Users\\Work\\Desktop\\todo-app\\node_modules\\next\\dist\\server\\lib\\router-server.js:163:21)\r\n    at async handleRequest (C:\\Users\\Work\\Desktop\\todo-app\\node_modules\\next\\dist\\server\\lib\\router-server.js:342:24)\r\n    at async requestHandlerImpl (C:\\Users\\Work\\Desktop\\todo-app\\node_modules\\next\\dist\\server\\lib\\router-server.js:366:13)\r\n    at async Server.requestListener (C:\\Users\\Work\\Desktop\\todo-app\\node_modules\\next\\dist\\server\\lib\\start-server.js:140:13)\r\n```\n\n### Expected behavior\n\nRejecting the singin attempt without throwing a server error in the console, and showing the user \"Invalid credentials\"\r\n```\r\n\"use server\";\r\n\r\nimport { signIn } from \"@/auth\";\r\nimport { $LogInSchema, LogInSchema } from \"@/lib/validation\";\r\nimport { DEFAULT_LOGIN_REDIRECT } from \"@/routes\";\r\nimport { AuthError } from \"next-auth\";\r\n\r\nexport async function logInAction(formData: LogInSchema) {\r\n  const validatedFields = $LogInSchema.safeParse(formData);\r\n\r\n  if (!validatedFields.success) return { error: \"Invalid fields\" };\r\n\r\n  const { email, phone } = validatedFields.data;\r\n\r\n  try {\r\n    await signIn(\"credentials\", { email, phone, redirectTo: DEFAULT_LOGIN_REDIRECT });\r\n  } catch (error) {\r\n    if (error instanceof AuthError) {\r\n      switch (error.type) {\r\n        case \"CredentialsSignin\":\r\n          return { error: \"Invalid credentials\" };\r\n        default:\r\n          return { error: \"Something went wrong\" };\r\n      }\r\n    }\r\n\r\n    throw error;\r\n  }\r\n}\r\n```", "closed_by": {"login": "balazsorban44", "id": 18369201, "node_id": "MDQ6VXNlcjE4MzY5MjAx", "avatar_url": "https://avatars.githubusercontent.com/u/18369201?v=4", "gravatar_id": "", "url": "https://api.github.com/users/balazsorban44", "html_url": "https://github.com/balazsorban44", "followers_url": "https://api.github.com/users/balazsorban44/followers", "following_url": "https://api.github.com/users/balazsorban44/following{/other_user}", "gists_url": "https://api.github.com/users/balazsorban44/gists{/gist_id}", "starred_url": "https://api.github.com/users/balazsorban44/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/balazsorban44/subscriptions", "organizations_url": "https://api.github.com/users/balazsorban44/orgs", "repos_url": "https://api.github.com/users/balazsorban44/repos", "events_url": "https://api.github.com/users/balazsorban44/events{/privacy}", "received_events_url": "https://api.github.com/users/balazsorban44/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/nextauthjs/next-auth/issues/9900/reactions", "total_count": 23, "+1": 23, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/nextauthjs/next-auth/issues/9900/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/nextauthjs/next-auth/issues/11074", "repository_url": "https://api.github.com/repos/nextauthjs/next-auth", "labels_url": "https://api.github.com/repos/nextauthjs/next-auth/issues/11074/labels{/name}", "comments_url": "https://api.github.com/repos/nextauthjs/next-auth/issues/11074/comments", "events_url": "https://api.github.com/repos/nextauthjs/next-auth/issues/11074/events", "html_url": "https://github.com/nextauthjs/next-auth/issues/11074", "id": 2334069653, "node_id": "I_kwDOBxpGM86LHxOV", "number": 11074, "title": "CallbackRouteError on Credentials when following docs", "user": {"login": "theswampire", "id": 66920279, "node_id": "MDQ6VXNlcjY2OTIwMjc5", "avatar_url": "https://avatars.githubusercontent.com/u/66920279?v=4", "gravatar_id": "", "url": "https://api.github.com/users/theswampire", "html_url": "https://github.com/theswampire", "followers_url": "https://api.github.com/users/theswampire/followers", "following_url": "https://api.github.com/users/theswampire/following{/other_user}", "gists_url": "https://api.github.com/users/theswampire/gists{/gist_id}", "starred_url": "https://api.github.com/users/theswampire/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/theswampire/subscriptions", "organizations_url": "https://api.github.com/users/theswampire/orgs", "repos_url": "https://api.github.com/users/theswampire/repos", "events_url": "https://api.github.com/users/theswampire/events{/privacy}", "received_events_url": "https://api.github.com/users/theswampire/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 818290553, "node_id": "MDU6TGFiZWw4MTgyOTA1NTM=", "url": "https://api.github.com/repos/nextauthjs/next-auth/labels/bug", "name": "bug", "color": "ffb8bb", "default": true, "description": "Something isn't working"}, {"id": 2564729261, "node_id": "MDU6TGFiZWwyNTY0NzI5MjYx", "url": "https://api.github.com/repos/nextauthjs/next-auth/labels/providers", "name": "providers", "color": "000000", "default": false, "description": ""}, {"id": 3829113515, "node_id": "LA_kwDOBxpGM87kO6Kr", "url": "https://api.github.com/repos/nextauthjs/next-auth/labels/triage", "name": "triage", "color": "AED87D", "default": false, "description": "Unseen or unconfirmed by a maintainer yet. Provide extra information in the meantime."}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 43, "created_at": "2024-06-04T17:50:45Z", "updated_at": "2025-05-20T22:52:48Z", "closed_at": "2024-07-27T13:54:18Z", "assignee": null, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### Provider type\n\nCredentials\n\n### Environment\n\n```\r\nSystem:\r\n    OS: Linux 5.15 Ubuntu 22.04.3 LTS 22.04.3 LTS (Jammy Jellyfish)\r\n    CPU: (16) x64 13th Gen Intel(R) Core(TM) i7-1360P\r\n    Memory: 10.10 GB / 15.47 GB\r\n    Container: Yes\r\n    Shell: 5.1.16 - /bin/bash\r\n  Binaries:\r\n    Node: 20.14.0 - ~/.nvm/versions/node/v20.14.0/bin/node\r\n    npm: 10.7.0 - ~/.nvm/versions/node/v20.14.0/bin/npm\r\n    pnpm: 9.1.4 - ~/.nvm/versions/node/v20.14.0/bin/pnpm\r\n  npmPackages:\r\n    next: 14.2.3 => 14.2.3 \r\n    next-auth: 5.0.0-beta.19 => 5.0.0-beta.19 \r\n    react: ^18 => 18.3.1 \r\n\r\n```\r\n\n\n### Reproduction URL\n\nhttps://github.com/theswampire/authjs-bug-reproduction\n\n### Describe the issue\n\nWhen using the Credentials Provider, submitting a wrong password throws an CallbackRouteError. I tested it on 5.0.0-beta.18, 17 and 16 too but they throw CredentialsSignIn instead. \r\nI followed the v5 docs for setting up Nextjs and the Credentials Provider step by step thus this should be unexpected behaviour.\r\n\r\nThis is the `auth.ts` file:\r\n```typescript\r\n// auth.ts\r\nimport NextAuth from \"next-auth\";\r\nimport Credentials from \"next-auth/providers/credentials\";\r\n\r\nexport const { handlers, signIn, signOut, auth } = NextAuth({\r\n  providers: [\r\n    Credentials({\r\n      credentials: {\r\n        password: {},\r\n      },\r\n\r\n      authorize: async (credentials) => {\r\n        if (credentials.password !== \"password\") {\r\n          return null;\r\n        }\r\n        return { id: \"admin\", name: \"admin\" };\r\n      },\r\n    }),\r\n  ],\r\n\r\n  pages: {\r\n    signIn: \"/signin\",\r\n  },\r\n});\r\n```\r\n\r\nThe SignIn page looks like this:\r\n```tsx\r\nimport { signIn } from \"@/auth\";\r\n\r\nexport default function SignIn() {\r\n  return (\r\n    <form\r\n      className=\"flex flex-col max-w-sm gap-2\"\r\n      action={async (formData) => {\r\n        \"use server\";\r\n        await signIn(\"credentials\", formData);\r\n      }}\r\n    >\r\n      <label>\r\n        Password\r\n        <input name=\"password\" type=\"password\" className=\"border\" />\r\n        <input name=\"redirectTo\" type=\"hidden\" value=\"/secure\" />\r\n      </label>\r\n      <span>Password is &quot;password&quot;</span>\r\n      <button className=\"bg-neutral-300\">Sign In</button>\r\n    </form>\r\n  );\r\n}\r\n```\r\nI tried to wrap the signIn call in a try-catch like in #11010 but that obviously didn't fix the underlying issue.\r\n\r\nAccording to the documentation, the CallbackRouteError using the Credentials Provider means that either the `authorize` or another callback throws but I didn't overwrite any callbacks nor should `authorize` throw anything. Furthermore, if I remember correctly, when setting `redirect` to false, the `SignInResponse` contained `ok: true` and a Configuration error which I find odd.\n\n### How to reproduce\n\nEnter anything but the correct password \"password\" and then the exception should be thrown.\r\nUsing the correct password works just fine.\n\n### Expected behavior\n\nDon't throw an exception.", "closed_by": {"login": "ThangHuuVu", "id": 31528554, "node_id": "MDQ6VXNlcjMxNTI4NTU0", "avatar_url": "https://avatars.githubusercontent.com/u/31528554?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ThangHuuVu", "html_url": "https://github.com/ThangHuuVu", "followers_url": "https://api.github.com/users/ThangHuuVu/followers", "following_url": "https://api.github.com/users/ThangHuuVu/following{/other_user}", "gists_url": "https://api.github.com/users/ThangHuuVu/gists{/gist_id}", "starred_url": "https://api.github.com/users/ThangHuuVu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ThangHuuVu/subscriptions", "organizations_url": "https://api.github.com/users/ThangHuuVu/orgs", "repos_url": "https://api.github.com/users/ThangHuuVu/repos", "events_url": "https://api.github.com/users/ThangHuuVu/events{/privacy}", "received_events_url": "https://api.github.com/users/ThangHuuVu/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/nextauthjs/next-auth/issues/11074/reactions", "total_count": 32, "+1": 32, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/nextauthjs/next-auth/issues/11074/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/nextauthjs/next-auth/issues/7132", "repository_url": "https://api.github.com/repos/nextauthjs/next-auth", "labels_url": "https://api.github.com/repos/nextauthjs/next-auth/issues/7132/labels{/name}", "comments_url": "https://api.github.com/repos/nextauthjs/next-auth/issues/7132/comments", "events_url": "https://api.github.com/repos/nextauthjs/next-auth/issues/7132/events", "html_url": "https://github.com/nextauthjs/next-auth/issues/7132", "id": 1651005763, "node_id": "I_kwDOBxpGM85iaFlD", "number": 7132, "title": "TypeScript issues in session callback", "user": {"login": "lionelrudaz", "id": 592678, "node_id": "MDQ6VXNlcjU5MjY3OA==", "avatar_url": "https://avatars.githubusercontent.com/u/592678?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lionelrudaz", "html_url": "https://github.com/lionelrudaz", "followers_url": "https://api.github.com/users/lionelrudaz/followers", "following_url": "https://api.github.com/users/lionelrudaz/following{/other_user}", "gists_url": "https://api.github.com/users/lionelrudaz/gists{/gist_id}", "starred_url": "https://api.github.com/users/lionelrudaz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lionelrudaz/subscriptions", "organizations_url": "https://api.github.com/users/lionelrudaz/orgs", "repos_url": "https://api.github.com/users/lionelrudaz/repos", "events_url": "https://api.github.com/users/lionelrudaz/events{/privacy}", "received_events_url": "https://api.github.com/users/lionelrudaz/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 818290553, "node_id": "MDU6TGFiZWw4MTgyOTA1NTM=", "url": "https://api.github.com/repos/nextauthjs/next-auth/labels/bug", "name": "bug", "color": "ffb8bb", "default": true, "description": "Something isn't working"}, {"id": 2376415471, "node_id": "MDU6TGFiZWwyMzc2NDE1NDcx", "url": "https://api.github.com/repos/nextauthjs/next-auth/labels/TypeScript", "name": "TypeScript", "color": "3178C6", "default": false, "description": "Issues relating to TypeScript"}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 42, "created_at": "2023-04-02T16:14:31Z", "updated_at": "2024-10-16T00:29:35Z", "closed_at": "2023-04-03T10:17:30Z", "assignee": null, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### Environment\r\n\r\nSystem:\r\n    OS: macOS 13.1\r\n    CPU: (8) arm64 Apple M2\r\n    Memory: 604.00 MB / 16.00 GB\r\n    Shell: 5.8.1 - /bin/zsh\r\n  Binaries:\r\n    Node: 19.1.0 - /usr/local/bin/node\r\n    Yarn: 3.3.0 - /usr/local/bin/yarn\r\n    npm: 8.19.3 - /usr/local/bin/npm\r\n  Browsers:\r\n    Safari: 16.2\r\n\r\n### Reproduction URL\r\n\r\nhttps://github.com/lionelrudaz/tasters/tree/release\r\n\r\n### Describe the issue\r\n\r\nI've not done any change on my environment lately, but I have a build error with the latest version of Next.\r\n\r\nHere it is:\r\n\r\n```\r\nType error: Property 'id' does not exist on type '{ name?: string; email?: string; image?: string; }'.\r\n\r\n  136 |         // Add property to session, like an access_token from a provider.\r\n  137 |         //console.log(\"Session callback\", session, token, user)\r\n> 138 |         session.user.id = token.sub;\r\n      |                      ^\r\n  139 |         session.user.isAdmin = token.isAdmin;\r\n  140 |         session.user.vendorId = token.vendorId;\r\n  141 |         session.user.stripe_id = token.stripeId;\r\n```\r\n\r\nThis is in the session callback method.\r\n\r\nHere's the complete method:\r\n\r\n```\r\n/**\r\n       * @param  {object} session      Session object\r\n       * @param  {object} token        User object    (if using database sessions)\r\n       *                               JSON Web Token (if not using database sessions)\r\n       * @return {object}              Session that will be returned to the client\r\n       */\r\n      async session({ session, token, user }) {\r\n        // Add property to session, like an access_token from a provider.\r\n        //console.log(\"Session callback\", session, token, user)\r\n        session.user.id = token.sub;\r\n        session.user.isAdmin = token.isAdmin;\r\n        session.user.vendorId = token.vendorId;\r\n        session.user.stripe_id = token.stripeId;\r\n        return session\r\n      },\r\n```\r\n\r\nThis is my next-auth.d.ts file:\r\n\r\n```\r\nimport NextAuth, { DefaultSession } from \"next-auth\"\r\nimport { JWT } from \"next-auth/jwt\"\r\nimport type UserType from \"./user\"\r\n\r\ndeclare module \"next-auth\" {\r\n  /**\r\n   * Returned by `useSession`, `getSession` and received as a prop on the `SessionProvider` React Context\r\n   */\r\n  interface Session {\r\n    user: UserType & DefaultSession[\"user\"]\r\n  }\r\n\r\n  interface User {\r\n    image?: string\r\n    isAdmin?: boolean\r\n    vendorId?: number\r\n    stripeId?: string\r\n  }\r\n}\r\n\r\ndeclare module \"next-auth/jwt\" {\r\n  /** Returned by the `jwt` callback and `getToken`, when using JWT sessions */\r\n  interface JWT {\r\n    /** OpenID ID Token */\r\n    idToken?: string\r\n    isAdmin?: boolean\r\n    vendorId?: number\r\n    stripeId?: string\r\n  }\r\n}\r\n```\r\n\r\nNothing really different from the documentation.\r\n\r\nI've checked my code, looks like session is from type DefaultSession and not Session anymore. I have no clue why.\r\n\r\nI've tried to implement a DefaultSession interface, no luck...\r\n\r\nMy file was in /interfaces/next-auth.d.ts, I've moved it in /types like in https://next-auth.js.org/getting-started/typescript, no luck.\r\n\r\nHere's my tsconfig.js file:\r\n\r\n```\r\n{\r\n  \"compilerOptions\": {\r\n    \"target\": \"es5\",\r\n    \"lib\": [\r\n      \"dom\",\r\n      \"dom.iterable\",\r\n      \"esnext\"\r\n    ],\r\n    \"allowJs\": true,\r\n    \"skipLibCheck\": true,\r\n    \"strict\": false,\r\n    \"forceConsistentCasingInFileNames\": true,\r\n    \"noEmit\": true,\r\n    \"incremental\": true,\r\n    \"esModuleInterop\": true,\r\n    \"module\": \"esnext\",\r\n    \"moduleResolution\": \"node\",\r\n    \"resolveJsonModule\": true,\r\n    \"isolatedModules\": true,\r\n    \"jsx\": \"preserve\"\r\n  },\r\n  \"include\": [\r\n    \"next-env.d.ts\",\r\n    \"**/*.ts\",\r\n    \"**/*.tsx\"\r\n  ],\r\n  \"exclude\": [\r\n    \"node_modules\"\r\n  ]\r\n}\r\n```\r\n\r\nI've checked the docs over and over, there must be something silly that has changed in a recent version, I just don't get it. It looks like it's a different issue than https://github.com/nextauthjs/next-auth/discussions/7033 encountered by @krinklesaurus and @arnekolja.\r\n\r\nWhat I understand is that now in the session() callback, the type is DefaultSession instead of Session. Which means my interface is not used anymore. No idea why it stopped working all the sudden.\r\n\r\nLet me know if there's anything useful I can add.\r\n\r\n### How to reproduce\r\n\r\nExplained above.\r\n\r\n### Expected behavior\r\n\r\nExtend the session with additional attributes.", "closed_by": {"login": "balazsorban44", "id": 18369201, "node_id": "MDQ6VXNlcjE4MzY5MjAx", "avatar_url": "https://avatars.githubusercontent.com/u/18369201?v=4", "gravatar_id": "", "url": "https://api.github.com/users/balazsorban44", "html_url": "https://github.com/balazsorban44", "followers_url": "https://api.github.com/users/balazsorban44/followers", "following_url": "https://api.github.com/users/balazsorban44/following{/other_user}", "gists_url": "https://api.github.com/users/balazsorban44/gists{/gist_id}", "starred_url": "https://api.github.com/users/balazsorban44/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/balazsorban44/subscriptions", "organizations_url": "https://api.github.com/users/balazsorban44/orgs", "repos_url": "https://api.github.com/users/balazsorban44/repos", "events_url": "https://api.github.com/users/balazsorban44/events{/privacy}", "received_events_url": "https://api.github.com/users/balazsorban44/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/nextauthjs/next-auth/issues/7132/reactions", "total_count": 24, "+1": 24, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/nextauthjs/next-auth/issues/7132/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/nextauthjs/next-auth/issues/6788", "repository_url": "https://api.github.com/repos/nextauthjs/next-auth", "labels_url": "https://api.github.com/repos/nextauthjs/next-auth/issues/6788/labels{/name}", "comments_url": "https://api.github.com/repos/nextauthjs/next-auth/issues/6788/comments", "events_url": "https://api.github.com/repos/nextauthjs/next-auth/issues/6788/events", "html_url": "https://github.com/nextauthjs/next-auth/issues/6788", "id": 1595885175, "node_id": "I_kwDOBxpGM85fH0Z3", "number": 6788, "title": "Apple provider broken - blowing up when not finding userinfo endpoint", "user": {"login": "kyllerss", "id": 65538, "node_id": "MDQ6VXNlcjY1NTM4", "avatar_url": "https://avatars.githubusercontent.com/u/65538?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kyllerss", "html_url": "https://github.com/kyllerss", "followers_url": "https://api.github.com/users/kyllerss/followers", "following_url": "https://api.github.com/users/kyllerss/following{/other_user}", "gists_url": "https://api.github.com/users/kyllerss/gists{/gist_id}", "starred_url": "https://api.github.com/users/kyllerss/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kyllerss/subscriptions", "organizations_url": "https://api.github.com/users/kyllerss/orgs", "repos_url": "https://api.github.com/users/kyllerss/repos", "events_url": "https://api.github.com/users/kyllerss/events{/privacy}", "received_events_url": "https://api.github.com/users/kyllerss/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 818290553, "node_id": "MDU6TGFiZWw4MTgyOTA1NTM=", "url": "https://api.github.com/repos/nextauthjs/next-auth/labels/bug", "name": "bug", "color": "ffb8bb", "default": true, "description": "Something isn't working"}, {"id": 2564729261, "node_id": "MDU6TGFiZWwyNTY0NzI5MjYx", "url": "https://api.github.com/repos/nextauthjs/next-auth/labels/providers", "name": "providers", "color": "000000", "default": false, "description": ""}, {"id": 2646868137, "node_id": "MDU6TGFiZWwyNjQ2ODY4MTM3", "url": "https://api.github.com/repos/nextauthjs/next-auth/labels/upstream", "name": "upstream", "color": "B2715F", "default": false, "description": "The issue dervies from one of next-auth dependencies"}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 42, "created_at": "2023-02-22T21:49:02Z", "updated_at": "2024-11-25T15:20:46Z", "closed_at": "2024-10-19T19:37:26Z", "assignee": null, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### Provider type\n\nApple\n\n### Environment\n\n  System:\r\n    OS: Linux 5.19 KDE neon 5.27 5.27\r\n    CPU: (16) x64 11th Gen Intel(R) Core(TM) i7-11800H @ 2.30GHz\r\n    Memory: 6.74 GB / 15.34 GB\r\n    Container: Yes\r\n    Shell: 5.1.16 - /bin/bash\r\n  Binaries:\r\n    Node: 16.18.0 - ~/apps/node-v16.18.0-linux-x64/bin/node\r\n    npm: 9.3.0 - ~/apps/node-v16.18.0-linux-x64/bin/npm\r\n  Browsers:\r\n    Brave Browser: 110.1.48.164\r\n    Chrome: 110.0.5481.100\r\n    Firefox: 110.0\r\n\n\n### Reproduction URL\n\nNeeded?\n\n### Describe the issue\n\nSeems as if Apple another one of those providers that does not provide user info. \r\n\r\nWhen the redirect endpoint is invoked I get the following error:\r\n\r\n```\r\n[auth][cause]: TypeError: TODO: Authorization server did not provide a userinfo endpoint.\r\n     at handleOAuth (file:///xxx/node_modules/@auth/sveltekit/node_modules/@auth/core/lib/oauth/callback.js:28:19)\r\n     ...\r\n``` \r\n\r\nThe line in question is [here](https://github.com/nextauthjs/next-auth/blob/2130765a577570cbb1a85ab3d540bdb40a184b94/packages/core/src/lib/oauth/callback.ts#L52).\r\n\r\nI found [a relevant issue](https://github.com/nextauthjs/next-auth/issues/573) that had a specific work-around, but pertained to *Todoist*. \r\n\r\nDoesn't seem to me that requiring a user-info endpoint is part of the OAuth spec, but I could be wrong. I would rather have this restriction be a configuration option or handled explicitly by some callback. I wouldn't be surprised if the push for privacy is going to push additional partners to follow a similar pattern.\n\n### How to reproduce\n\nTry to do a sign-in using Apple.\n\n### Expected behavior\n\nFor it to work and have the client specify how to handle the missing information.", "closed_by": {"login": "balazsorban44", "id": 18369201, "node_id": "MDQ6VXNlcjE4MzY5MjAx", "avatar_url": "https://avatars.githubusercontent.com/u/18369201?v=4", "gravatar_id": "", "url": "https://api.github.com/users/balazsorban44", "html_url": "https://github.com/balazsorban44", "followers_url": "https://api.github.com/users/balazsorban44/followers", "following_url": "https://api.github.com/users/balazsorban44/following{/other_user}", "gists_url": "https://api.github.com/users/balazsorban44/gists{/gist_id}", "starred_url": "https://api.github.com/users/balazsorban44/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/balazsorban44/subscriptions", "organizations_url": "https://api.github.com/users/balazsorban44/orgs", "repos_url": "https://api.github.com/users/balazsorban44/repos", "events_url": "https://api.github.com/users/balazsorban44/events{/privacy}", "received_events_url": "https://api.github.com/users/balazsorban44/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/nextauthjs/next-auth/issues/6788/reactions", "total_count": 1, "+1": 1, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/nextauthjs/next-auth/issues/6788/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/nextauthjs/next-auth/issues/9122", "repository_url": "https://api.github.com/repos/nextauthjs/next-auth", "labels_url": "https://api.github.com/repos/nextauthjs/next-auth/issues/9122/labels{/name}", "comments_url": "https://api.github.com/repos/nextauthjs/next-auth/issues/9122/comments", "events_url": "https://api.github.com/repos/nextauthjs/next-auth/issues/9122/events", "html_url": "https://github.com/nextauthjs/next-auth/issues/9122", "id": 1989227830, "node_id": "I_kwDOBxpGM852kTU2", "number": 9122, "title": "Can't use auth() to get values from jwt() callback in v5", "user": {"login": "Celsiusss", "id": 3050747, "node_id": "MDQ6VXNlcjMwNTA3NDc=", "avatar_url": "https://avatars.githubusercontent.com/u/3050747?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Celsiusss", "html_url": "https://github.com/Celsiusss", "followers_url": "https://api.github.com/users/Celsiusss/followers", "following_url": "https://api.github.com/users/Celsiusss/following{/other_user}", "gists_url": "https://api.github.com/users/Celsiusss/gists{/gist_id}", "starred_url": "https://api.github.com/users/Celsiusss/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Celsiusss/subscriptions", "organizations_url": "https://api.github.com/users/Celsiusss/orgs", "repos_url": "https://api.github.com/users/Celsiusss/repos", "events_url": "https://api.github.com/users/Celsiusss/events{/privacy}", "received_events_url": "https://api.github.com/users/Celsiusss/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 818290553, "node_id": "MDU6TGFiZWw4MTgyOTA1NTM=", "url": "https://api.github.com/repos/nextauthjs/next-auth/labels/bug", "name": "bug", "color": "ffb8bb", "default": true, "description": "Something isn't working"}, {"id": 3829113515, "node_id": "LA_kwDOBxpGM87kO6Kr", "url": "https://api.github.com/repos/nextauthjs/next-auth/labels/triage", "name": "triage", "color": "AED87D", "default": false, "description": "Unseen or unconfirmed by a maintainer yet. Provide extra information in the meantime."}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 39, "created_at": "2023-11-12T04:02:26Z", "updated_at": "2025-02-11T00:43:53Z", "closed_at": "2024-02-14T08:54:33Z", "assignee": null, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### Environment\r\n\r\n    next: 14.0.2 => 14.0.2 \r\n    next-auth: ^5.0.0-beta.3 => 5.0.0-beta.3 \r\n    react: ^18 => 18.2.0 \r\n\r\n### Reproduction URL\r\n\r\nhttps://github.com/Celsiusss/nextauth-demo\r\n\r\n### Describe the issue\r\n\r\nIn the [documentation](https://authjs.dev/guides/upgrade-to-v5?authentication-method=server-component#authenticating-server-side), it says that:\r\n\r\n> When using auth(), the [session() callback](https://authjs.dev/reference/core/types#session) is ignored. **auth() will expose anything returned from the [jwt() callback](https://authjs.dev/guides/reference/core/types#jwt)** or if using a [\"database\" strategy](https://authjs.dev/reference/core#session), from the [User](https://authjs.dev/reference/core/adapters#adapteruser). This is because the session() callback was designed to protect you from exposing sensitive information to the client, but when using auth() you are always on the server.\r\n\r\nI tried to test this, but could not get values from the `jwt()` callback to be returned by `auth()`. It seems like the opposite of what this text says is true.  Values from the `session()` callback is being returned, instead of `jwt()`. Not quite sure what the intended behavior really is, but I would love to access encrypted token values using `auth()`.\r\n\r\n### How to reproduce\r\n\r\nI have tried to create a minimal example in the Github link.\r\n\r\nHere I am using `auth()` in a server component and in a route handler, to demonstrate it in two different ways.\r\n[`page.tsx`](https://github.com/Celsiusss/nextauth-demo/blob/master/app/page.tsx) shows it being used in a server component.\r\n[`api/route.ts`](https://github.com/Celsiusss/nextauth-demo/blob/master/app/api/route.ts) shows it being used in a route handler.\r\n[`client.tsx`](https://github.com/Celsiusss/nextauth-demo/blob/master/app/client.tsx) client component for signing in and using the route handler\r\n[`auth.ts` ](https://github.com/Celsiusss/nextauth-demo/blob/master/app/auth.ts)registers an oidc provider and defines the `jwt()` callback.\r\n\r\n### Expected behavior\r\n\r\nI expected to be able to use `auth()` to retrieve values from the `jwt()` callback in server side components.", "closed_by": {"login": "Celsiusss", "id": 3050747, "node_id": "MDQ6VXNlcjMwNTA3NDc=", "avatar_url": "https://avatars.githubusercontent.com/u/3050747?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Celsiusss", "html_url": "https://github.com/Celsiusss", "followers_url": "https://api.github.com/users/Celsiusss/followers", "following_url": "https://api.github.com/users/Celsiusss/following{/other_user}", "gists_url": "https://api.github.com/users/Celsiusss/gists{/gist_id}", "starred_url": "https://api.github.com/users/Celsiusss/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Celsiusss/subscriptions", "organizations_url": "https://api.github.com/users/Celsiusss/orgs", "repos_url": "https://api.github.com/users/Celsiusss/repos", "events_url": "https://api.github.com/users/Celsiusss/events{/privacy}", "received_events_url": "https://api.github.com/users/Celsiusss/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/nextauthjs/next-auth/issues/9122/reactions", "total_count": 30, "+1": 27, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 3}, "timeline_url": "https://api.github.com/repos/nextauthjs/next-auth/issues/9122/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/nextauthjs/next-auth/issues/5551", "repository_url": "https://api.github.com/repos/nextauthjs/next-auth", "labels_url": "https://api.github.com/repos/nextauthjs/next-auth/issues/5551/labels{/name}", "comments_url": "https://api.github.com/repos/nextauthjs/next-auth/issues/5551/comments", "events_url": "https://api.github.com/repos/nextauthjs/next-auth/issues/5551/events", "html_url": "https://github.com/nextauthjs/next-auth/issues/5551", "id": 1404029071, "node_id": "I_kwDOBxpGM85Tr8iP", "number": 5551, "title": "FirebaseAdapter and Firebase giving \"import\" error", "user": {"login": "bcthakre", "id": 92829471, "node_id": "U_kgDOBYh3Hw", "avatar_url": "https://avatars.githubusercontent.com/u/92829471?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bcthakre", "html_url": "https://github.com/bcthakre", "followers_url": "https://api.github.com/users/bcthakre/followers", "following_url": "https://api.github.com/users/bcthakre/following{/other_user}", "gists_url": "https://api.github.com/users/bcthakre/gists{/gist_id}", "starred_url": "https://api.github.com/users/bcthakre/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bcthakre/subscriptions", "organizations_url": "https://api.github.com/users/bcthakre/orgs", "repos_url": "https://api.github.com/users/bcthakre/repos", "events_url": "https://api.github.com/users/bcthakre/events{/privacy}", "received_events_url": "https://api.github.com/users/bcthakre/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 818290553, "node_id": "MDU6TGFiZWw4MTgyOTA1NTM=", "url": "https://api.github.com/repos/nextauthjs/next-auth/labels/bug", "name": "bug", "color": "ffb8bb", "default": true, "description": "Something isn't working"}, {"id": 2628184934, "node_id": "MDU6TGFiZWwyNjI4MTg0OTM0", "url": "https://api.github.com/repos/nextauthjs/next-auth/labels/adapters", "name": "adapters", "color": "000000", "default": false, "description": "Changes related to the core code concerning database adapters"}, {"id": 3799355476, "node_id": "MDU6TGFiZWwzNzk5MzU1NDc2", "url": "https://api.github.com/repos/nextauthjs/next-auth/labels/firebase", "name": "firebase", "color": "fbcb3d", "default": false, "description": "@auth/firebase-adapter"}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 38, "created_at": "2022-10-11T05:33:32Z", "updated_at": "2023-02-10T10:06:50Z", "closed_at": "2022-12-03T08:48:56Z", "assignee": null, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### Adapter type\n\n@next-auth/firebase-adapter\n\n### Environment\n\n\r\n**System Information.**\r\n```\r\n\r\nSystem:\r\n    OS: macOS 12.6\r\n    CPU: (8) x64 Intel(R) Core(TM) i5-8257U CPU @ 1.40GHz\r\n    Memory: 135.65 MB / 16.00 GB\r\n    Shell: 5.8.1 - /bin/zsh\r\n  Binaries:\r\n    Node: 16.16.0 - /usr/local/bin/node\r\n    Yarn: 1.22.19 - /usr/local/bin/yarn\r\n    npm: 8.11.0 - /usr/local/bin/npm\r\n  Browsers:\r\n    Chrome: 105.0.5195.125\r\n    Safari: 16.0\r\n  npmPackages:\r\n    next: 12.3.1 => 12.3.1 \r\n    next-auth: ^4.13.0 => 4.13.0 \r\n    react: 18.2.0 => 18.2.0 \r\n\r\n\r\n  npmPackages:\r\n    @next-auth/firebase-adapter: ^1.0.2 => 1.0.2 \r\n```\n\n### Reproduction URL\n\nhttps://github.com/bcthakre/nextjs-nextauth-2.git\n\n### Describe the issue\n\nI am trying to use the FirebaseAdapter and Firestore to store user information for my NextJS app. However, getting the following error. \r\n\r\n```\r\n\r\nimport { initializeApp } from \"firebase/app\";\r\n^^^^^^\r\n\r\nSyntaxError: Cannot use import statement outside a module\r\n    at Object.compileFunction (node:vm:352:18)\r\n    at wrapSafe (node:internal/modules/cjs/loader:1033:15)\r\n    at Module._compile (node:internal/modules/cjs/loader:1069:27)\r\n    at Object.Module._extensions..js (node:internal/modules/cjs/loader:1159:10)\r\n    at Module.load (node:internal/modules/cjs/loader:981:32)\r\n    at Function.Module._load (node:internal/modules/cjs/loader:822:12)\r\n    at Module.require (node:internal/modules/cjs/loader:1005:19)\r\n    at require (node:internal/modules/cjs/helpers:102:18)\r\n    at Object.@next-auth/firebase-adapter (/Users/bt/Documents/nextjs/nextjs-nextauth-2/.next/server/pages/api/auth/[...nextauth].js:22:18)\r\n    at __webpack_require__ (/Users/ct/Documents/nextjs/nextjs-nextauth-2/.next/server/webpack-api-runtime.js:33:42)\r\n\r\n```\r\n\r\nThe issue was raised earlier but has not been fully resolved. Things I tried.\r\n\r\n1. Adding .mjs and .cjs to package-lock and next.config file.\r\n2. Removing and adding different firebase versions. From 9 to 11.\r\n\n\n### How to reproduce\n\nCopy the github link as well.\r\n\r\n[https://github.com/bcthakre/nextjs-nextauth-2.git]\n\n### Expected behavior\n\nShould allow to store user and session information in Firestore. Also, need to provide a way to signIn and signOut", "closed_by": {"login": "balazsorban44", "id": 18369201, "node_id": "MDQ6VXNlcjE4MzY5MjAx", "avatar_url": "https://avatars.githubusercontent.com/u/18369201?v=4", "gravatar_id": "", "url": "https://api.github.com/users/balazsorban44", "html_url": "https://github.com/balazsorban44", "followers_url": "https://api.github.com/users/balazsorban44/followers", "following_url": "https://api.github.com/users/balazsorban44/following{/other_user}", "gists_url": "https://api.github.com/users/balazsorban44/gists{/gist_id}", "starred_url": "https://api.github.com/users/balazsorban44/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/balazsorban44/subscriptions", "organizations_url": "https://api.github.com/users/balazsorban44/orgs", "repos_url": "https://api.github.com/users/balazsorban44/repos", "events_url": "https://api.github.com/users/balazsorban44/events{/privacy}", "received_events_url": "https://api.github.com/users/balazsorban44/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/nextauthjs/next-auth/issues/5551/reactions", "total_count": 7, "+1": 5, "-1": 0, "laugh": 0, "hooray": 0, "confused": 2, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/nextauthjs/next-auth/issues/5551/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/nextauthjs/next-auth/issues/2701", "repository_url": "https://api.github.com/repos/nextauthjs/next-auth", "labels_url": "https://api.github.com/repos/nextauthjs/next-auth/issues/2701/labels{/name}", "comments_url": "https://api.github.com/repos/nextauthjs/next-auth/issues/2701/comments", "events_url": "https://api.github.com/repos/nextauthjs/next-auth/issues/2701/events", "html_url": "https://github.com/nextauthjs/next-auth/issues/2701", "id": 991272274, "node_id": "MDU6SXNzdWU5OTEyNzIyNzQ=", "number": 2701, "title": "TypeScript error for the Credentials provider", "user": {"login": "dragoncorf", "id": 67753301, "node_id": "MDQ6VXNlcjY3NzUzMzAx", "avatar_url": "https://avatars.githubusercontent.com/u/67753301?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dragoncorf", "html_url": "https://github.com/dragoncorf", "followers_url": "https://api.github.com/users/dragoncorf/followers", "following_url": "https://api.github.com/users/dragoncorf/following{/other_user}", "gists_url": "https://api.github.com/users/dragoncorf/gists{/gist_id}", "starred_url": "https://api.github.com/users/dragoncorf/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dragoncorf/subscriptions", "organizations_url": "https://api.github.com/users/dragoncorf/orgs", "repos_url": "https://api.github.com/users/dragoncorf/repos", "events_url": "https://api.github.com/users/dragoncorf/events{/privacy}", "received_events_url": "https://api.github.com/users/dragoncorf/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 818290553, "node_id": "MDU6TGFiZWw4MTgyOTA1NTM=", "url": "https://api.github.com/repos/nextauthjs/next-auth/labels/bug", "name": "bug", "color": "ffb8bb", "default": true, "description": "Something isn't working"}, {"id": 2376415471, "node_id": "MDU6TGFiZWwyMzc2NDE1NDcx", "url": "https://api.github.com/repos/nextauthjs/next-auth/labels/TypeScript", "name": "TypeScript", "color": "3178C6", "default": false, "description": "Issues relating to TypeScript"}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 38, "created_at": "2021-09-08T15:35:01Z", "updated_at": "2024-12-19T22:59:12Z", "closed_at": "2021-09-09T10:54:34Z", "assignee": null, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### Description \ud83d\udc1c\r\n\r\nThe changes to Providers in [...nextauth].ts in V4 appered a TypeScript error for the Credentials provider.\r\n\r\n``` TypeScript\r\nType 'CredentialsConfig<{ username: { label: string; type: string; }; password: { label: string; type: string; }; }>' is not assignable to type 'Provider'.\r\n  Type 'CredentialsConfig<{ username: { label: string; type: string; }; password: { label: string; type: string; }; }>' is not assignable to type 'CredentialsConfig<{}>'.\r\n    Types of property 'authorize' are incompatible.\r\n      Type '(credentials: Record<\"username\" | \"password\", string>, req: NextApiRequest) => Awaitable<Omit<User, \"id\"> | { id?: string | undefined; } | null>' is not assignable to type '(credentials: Record<never, string>, req: NextApiRequest) => Awaitable<Omit<User, \"id\"> | { id?: string | undefined; } | null>'.\r\n        Types of parameters 'credentials' and 'credentials' are incompatible.\r\n          Type 'Record<never, string>' is missing the following properties from type 'Record<\"username\" | \"password\", string>': username, password\r\n```\r\n\r\n### Is this a bug in your own project?\r\n\r\nNo\r\n\r\n### How to reproduce \u2615\ufe0f\r\n\r\n``` TypeScript\r\nimport bcrypt from 'bcryptjs';\r\nimport prisma from 'lib/prisma';\r\nimport NextAuth from 'next-auth';\r\nimport CredentialsProvider from 'next-auth/providers/credentials';\r\n\r\nexport default NextAuth({\r\n  providers: [\r\n    CredentialsProvider({\r\n      name: 'Credentials',\r\n      credentials: {\r\n        username: { label: 'Username', type: 'text' },\r\n        password: { label: 'Password', type: 'password' }\r\n      },\r\n      async authorize(credentials: any, req) {\r\n        const user = await prisma.user.findUnique({\r\n          where: {\r\n            username: credentials.username\r\n          }\r\n        });\r\n\r\n        if (!user) {\r\n          return null;\r\n        }\r\n\r\n        const valid = await bcrypt.compare(credentials.password, user.password);\r\n\r\n        if (!valid) {\r\n          console.log(`Credentials not valid`);\r\n          return null;\r\n        }\r\n\r\n        if (user) {\r\n          return { ...user, email: user.username };\r\n        }\r\n        return null;\r\n      }\r\n    })\r\n  ]\r\n});\r\n```\r\n\r\n\r\n### Screenshots / Logs \ud83d\udcfd\r\n\r\n_No response_\r\n\r\n### Environment \ud83d\udda5\r\n\r\n  System:\r\n    OS: Windows 10 10.0.19042\r\n    CPU: (8) x64 Intel(R) Core(TM) i5-1035G1 CPU @ 1.00GHz \r\n    Memory: 3.44 GB / 11.81 GB\r\n  Binaries:\r\n    Node: 14.15.4 - D:\\Node\\node.EXE\r\n    npm: 6.14.10 - D:\\Node\\npm.CMD\r\n  Browsers:\r\n    Edge: Spartan (44.19041.1023.0), Chromium (93.0.961.38)\r\n    Internet Explorer: 11.0.19041.906\r\n  npmPackages:\r\n    next: ^10.2.3 => 10.2.3\r\n    next-auth: ^4.0.0-beta.2 => 4.0.0-beta.2\r\n    react: ^17.0.2 => 17.0.2\r\n\r\n### Contributing \ud83d\ude4c\ud83c\udffd\r\n\r\nNo, I am afraid I cannot help regarding this", "closed_by": {"login": "balazsorban44", "id": 18369201, "node_id": "MDQ6VXNlcjE4MzY5MjAx", "avatar_url": "https://avatars.githubusercontent.com/u/18369201?v=4", "gravatar_id": "", "url": "https://api.github.com/users/balazsorban44", "html_url": "https://github.com/balazsorban44", "followers_url": "https://api.github.com/users/balazsorban44/followers", "following_url": "https://api.github.com/users/balazsorban44/following{/other_user}", "gists_url": "https://api.github.com/users/balazsorban44/gists{/gist_id}", "starred_url": "https://api.github.com/users/balazsorban44/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/balazsorban44/subscriptions", "organizations_url": "https://api.github.com/users/balazsorban44/orgs", "repos_url": "https://api.github.com/users/balazsorban44/repos", "events_url": "https://api.github.com/users/balazsorban44/events{/privacy}", "received_events_url": "https://api.github.com/users/balazsorban44/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/nextauthjs/next-auth/issues/2701/reactions", "total_count": 8, "+1": 8, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/nextauthjs/next-auth/issues/2701/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/nextauthjs/next-auth/issues/6949", "repository_url": "https://api.github.com/repos/nextauthjs/next-auth", "labels_url": "https://api.github.com/repos/nextauthjs/next-auth/issues/6949/labels{/name}", "comments_url": "https://api.github.com/repos/nextauthjs/next-auth/issues/6949/comments", "events_url": "https://api.github.com/repos/nextauthjs/next-auth/issues/6949/events", "html_url": "https://github.com/nextauthjs/next-auth/issues/6949", "id": 1624808430, "node_id": "I_kwDOBxpGM85g2Jvu", "number": 6949, "title": "NEXTAUTH_URL_INTERNAL=http://nextjs:3000 fails in docker using next-auth 4.20.1", "user": {"login": "redimongo", "id": 8399907, "node_id": "MDQ6VXNlcjgzOTk5MDc=", "avatar_url": "https://avatars.githubusercontent.com/u/8399907?v=4", "gravatar_id": "", "url": "https://api.github.com/users/redimongo", "html_url": "https://github.com/redimongo", "followers_url": "https://api.github.com/users/redimongo/followers", "following_url": "https://api.github.com/users/redimongo/following{/other_user}", "gists_url": "https://api.github.com/users/redimongo/gists{/gist_id}", "starred_url": "https://api.github.com/users/redimongo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/redimongo/subscriptions", "organizations_url": "https://api.github.com/users/redimongo/orgs", "repos_url": "https://api.github.com/users/redimongo/repos", "events_url": "https://api.github.com/users/redimongo/events{/privacy}", "received_events_url": "https://api.github.com/users/redimongo/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 818290553, "node_id": "MDU6TGFiZWw4MTgyOTA1NTM=", "url": "https://api.github.com/repos/nextauthjs/next-auth/labels/bug", "name": "bug", "color": "ffb8bb", "default": true, "description": "Something isn't working"}], "state": "closed", "locked": false, "assignees": [{"login": "ThangHuuVu", "id": 31528554, "node_id": "MDQ6VXNlcjMxNTI4NTU0", "avatar_url": "https://avatars.githubusercontent.com/u/31528554?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ThangHuuVu", "html_url": "https://github.com/ThangHuuVu", "followers_url": "https://api.github.com/users/ThangHuuVu/followers", "following_url": "https://api.github.com/users/ThangHuuVu/following{/other_user}", "gists_url": "https://api.github.com/users/ThangHuuVu/gists{/gist_id}", "starred_url": "https://api.github.com/users/ThangHuuVu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ThangHuuVu/subscriptions", "organizations_url": "https://api.github.com/users/ThangHuuVu/orgs", "repos_url": "https://api.github.com/users/ThangHuuVu/repos", "events_url": "https://api.github.com/users/ThangHuuVu/events{/privacy}", "received_events_url": "https://api.github.com/users/ThangHuuVu/received_events", "type": "User", "user_view_type": "public", "site_admin": false}], "milestone": null, "comments": 37, "created_at": "2023-03-15T05:57:09Z", "updated_at": "2025-05-27T15:58:37Z", "closed_at": "2023-04-02T10:20:42Z", "assignee": {"login": "ThangHuuVu", "id": 31528554, "node_id": "MDQ6VXNlcjMxNTI4NTU0", "avatar_url": "https://avatars.githubusercontent.com/u/31528554?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ThangHuuVu", "html_url": "https://github.com/ThangHuuVu", "followers_url": "https://api.github.com/users/ThangHuuVu/followers", "following_url": "https://api.github.com/users/ThangHuuVu/following{/other_user}", "gists_url": "https://api.github.com/users/ThangHuuVu/gists{/gist_id}", "starred_url": "https://api.github.com/users/ThangHuuVu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ThangHuuVu/subscriptions", "organizations_url": "https://api.github.com/users/ThangHuuVu/orgs", "repos_url": "https://api.github.com/users/ThangHuuVu/repos", "events_url": "https://api.github.com/users/ThangHuuVu/events{/privacy}", "received_events_url": "https://api.github.com/users/ThangHuuVu/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### Question \ud83d\udcac\n\nI am having issues with this with the latest version 4.20.1 and while running in a docker container.\r\n\r\nI am using\r\n```\r\nNEXTAUTH_URL_INTERNAL=http://nextjs:3000\r\n```\r\nas my docker name is nextjs it was working find when using `4.10.3`. Tried to upgrade and bam things broke.\n\n### How to reproduce \u2615\ufe0f\n\ncreate a docker image with a project using next-auth and start with version `4.10.3` then try and upgrade it and you run into issues\r\n```\r\nNEXTAUTH_URL_INTERNAL=http://nextjs:3000\r\n```\r\n\n\n### Contributing \ud83d\ude4c\ud83c\udffd\n\nYes, I am willing to help answer this question in a PR", "closed_by": {"login": "balazsorban44", "id": 18369201, "node_id": "MDQ6VXNlcjE4MzY5MjAx", "avatar_url": "https://avatars.githubusercontent.com/u/18369201?v=4", "gravatar_id": "", "url": "https://api.github.com/users/balazsorban44", "html_url": "https://github.com/balazsorban44", "followers_url": "https://api.github.com/users/balazsorban44/followers", "following_url": "https://api.github.com/users/balazsorban44/following{/other_user}", "gists_url": "https://api.github.com/users/balazsorban44/gists{/gist_id}", "starred_url": "https://api.github.com/users/balazsorban44/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/balazsorban44/subscriptions", "organizations_url": "https://api.github.com/users/balazsorban44/orgs", "repos_url": "https://api.github.com/users/balazsorban44/repos", "events_url": "https://api.github.com/users/balazsorban44/events{/privacy}", "received_events_url": "https://api.github.com/users/balazsorban44/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/nextauthjs/next-auth/issues/6949/reactions", "total_count": 13, "+1": 13, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/nextauthjs/next-auth/issues/6949/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/nextauthjs/next-auth/issues/4042", "repository_url": "https://api.github.com/repos/nextauthjs/next-auth", "labels_url": "https://api.github.com/repos/nextauthjs/next-auth/issues/4042/labels{/name}", "comments_url": "https://api.github.com/repos/nextauthjs/next-auth/issues/4042/comments", "events_url": "https://api.github.com/repos/nextauthjs/next-auth/issues/4042/events", "html_url": "https://github.com/nextauthjs/next-auth/issues/4042", "id": 1146618892, "node_id": "I_kwDOBxpGM85EWAQM", "number": 4042, "title": "Getting token in middleware doesn't work with authorization header request", "user": {"login": "pramodkandel", "id": 1330646, "node_id": "MDQ6VXNlcjEzMzA2NDY=", "avatar_url": "https://avatars.githubusercontent.com/u/1330646?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pramodkandel", "html_url": "https://github.com/pramodkandel", "followers_url": "https://api.github.com/users/pramodkandel/followers", "following_url": "https://api.github.com/users/pramodkandel/following{/other_user}", "gists_url": "https://api.github.com/users/pramodkandel/gists{/gist_id}", "starred_url": "https://api.github.com/users/pramodkandel/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pramodkandel/subscriptions", "organizations_url": "https://api.github.com/users/pramodkandel/orgs", "repos_url": "https://api.github.com/users/pramodkandel/repos", "events_url": "https://api.github.com/users/pramodkandel/events{/privacy}", "received_events_url": "https://api.github.com/users/pramodkandel/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 818290553, "node_id": "MDU6TGFiZWw4MTgyOTA1NTM=", "url": "https://api.github.com/repos/nextauthjs/next-auth/labels/bug", "name": "bug", "color": "ffb8bb", "default": true, "description": "Something isn't working"}, {"id": 2571274087, "node_id": "MDU6TGFiZWwyNTcxMjc0MDg3", "url": "https://api.github.com/repos/nextauthjs/next-auth/labels/good%20first%20issue", "name": "good first issue", "color": "D93F0B", "default": true, "description": "Good issue to take for first time contributors"}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 38, "created_at": "2022-02-22T08:49:55Z", "updated_at": "2025-01-31T19:00:40Z", "closed_at": "2022-05-31T17:08:30Z", "assignee": null, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### Environment\r\n\r\n  System:\r\n    OS: macOS 11.6\r\n    CPU: (4) x64 Intel(R) Core(TM) i5-7360U CPU @ 2.30GHz\r\n    Memory: 169.62 MB / 16.00 GB\r\n    Shell: 3.2.57 - /bin/bash\r\n  Binaries:\r\n    Node: 16.13.0 - /usr/local/bin/node\r\n    Yarn: 1.22.15 - ~/.yarn/bin/yarn\r\n    npm: 8.1.0 - /usr/local/bin/npm\r\n  Browsers:\r\n    Brave Browser: 72.0.59.35\r\n    Chrome: 98.0.4758.102\r\n    Edge: 98.0.1108.56\r\n    Safari: 14.1.2\r\n  npmPackages:\r\n    next: ^12.0.7 => 12.0.9 \r\n    next-auth: ^4.2.1 => 4.2.1 \r\n    react: 17.0.2 => 17.0.2 \r\n\r\n### Reproduction URL\r\n\r\nNone\r\n\r\n### Describe the issue\r\n\r\nWhen using just the authorization header, the getToken(req) method returns correctly in the server with NextApiRequest, but not in the middleware with NextRequest. When I dug through the code, it seems it's because NextApiRequest authorization header is in the list, whereas getToken function is trying to split the authorization header by space, which shouldn't work for this case.\r\n\r\n### How to reproduce\r\n\r\nFor any OAuth provider, get the raw token.\r\n\r\nUse it from a REST client with the Authorization: Bearer <token> and send an API request.\r\n\r\nIn the middleware, try getToken({req}). It returns null, whereas in the actual API route code, it returns the token info correctly. Also, it works correctly when a user actually logs in in the browser and there's cookies and other jazz from the browser.\r\n\r\nThe middleware code is very simple:\r\n\r\n```typescript\r\nimport { getToken } from \"next-auth/jwt\"\r\nimport { NextRequest, NextResponse } from \"next/server\"\r\n\r\nexport async function middleware(req: NextRequest) {\r\n  const token = await getToken({ req })\r\n  console.log(\"Middleware token\", token)\r\n  NextResponse.next()\r\n}\r\n```\r\n\r\nMy API request is:\r\n```\r\nGET http://localhost:3000/api/<api_path> HTTP/1.1\r\nContent-Type: application/json\r\nAuthorization: Bearer {{token}} \r\n```\r\n\r\n\r\n### Expected behavior\r\n\r\nI should get the token info in the middleware with just the auth header with bearer token (not only with browser session). ", "closed_by": {"login": "balazsorban44", "id": 18369201, "node_id": "MDQ6VXNlcjE4MzY5MjAx", "avatar_url": "https://avatars.githubusercontent.com/u/18369201?v=4", "gravatar_id": "", "url": "https://api.github.com/users/balazsorban44", "html_url": "https://github.com/balazsorban44", "followers_url": "https://api.github.com/users/balazsorban44/followers", "following_url": "https://api.github.com/users/balazsorban44/following{/other_user}", "gists_url": "https://api.github.com/users/balazsorban44/gists{/gist_id}", "starred_url": "https://api.github.com/users/balazsorban44/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/balazsorban44/subscriptions", "organizations_url": "https://api.github.com/users/balazsorban44/orgs", "repos_url": "https://api.github.com/users/balazsorban44/repos", "events_url": "https://api.github.com/users/balazsorban44/events{/privacy}", "received_events_url": "https://api.github.com/users/balazsorban44/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/nextauthjs/next-auth/issues/4042/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/nextauthjs/next-auth/issues/4042/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/nextauthjs/next-auth/issues/596", "repository_url": "https://api.github.com/repos/nextauthjs/next-auth", "labels_url": "https://api.github.com/repos/nextauthjs/next-auth/issues/596/labels{/name}", "comments_url": "https://api.github.com/repos/nextauthjs/next-auth/issues/596/comments", "events_url": "https://api.github.com/repos/nextauthjs/next-auth/issues/596/events", "html_url": "https://github.com/nextauthjs/next-auth/issues/596", "id": 683170037, "node_id": "MDU6SXNzdWU2ODMxNzAwMzc=", "number": 596, "title": "getSession call does not trigger session object update until window loses focus", "user": {"login": "blms", "id": 7234006, "node_id": "MDQ6VXNlcjcyMzQwMDY=", "avatar_url": "https://avatars.githubusercontent.com/u/7234006?v=4", "gravatar_id": "", "url": "https://api.github.com/users/blms", "html_url": "https://github.com/blms", "followers_url": "https://api.github.com/users/blms/followers", "following_url": "https://api.github.com/users/blms/following{/other_user}", "gists_url": "https://api.github.com/users/blms/gists{/gist_id}", "starred_url": "https://api.github.com/users/blms/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/blms/subscriptions", "organizations_url": "https://api.github.com/users/blms/orgs", "repos_url": "https://api.github.com/users/blms/repos", "events_url": "https://api.github.com/users/blms/events{/privacy}", "received_events_url": "https://api.github.com/users/blms/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 818290553, "node_id": "MDU6TGFiZWw4MTgyOTA1NTM=", "url": "https://api.github.com/repos/nextauthjs/next-auth/labels/bug", "name": "bug", "color": "ffb8bb", "default": true, "description": "Something isn't working"}, {"id": 818290559, "node_id": "MDU6TGFiZWw4MTgyOTA1NTk=", "url": "https://api.github.com/repos/nextauthjs/next-auth/labels/question", "name": "question", "color": "d6c1ff", "default": true, "description": "Ask how to do something or how something works"}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 36, "created_at": "2020-08-21T00:15:05Z", "updated_at": "2023-03-25T14:11:17Z", "closed_at": "2023-03-25T14:11:16Z", "assignee": null, "author_association": "CONTRIBUTOR", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "I'm currently trying to update some page components when the session changes after an `onClick`-triggered `Promise` is fulfilled. Here the function `DeleteGroup` returns a `Promise`. I print the value of the session before the `Promise` is returned, and then print it again after it is fulfilled by calling `getSession()`.\r\n\r\n```jsx\r\n<Button\r\n  onClick={() => {\r\n    console.log(session);\r\n    DeleteGroup(value.id).then(async () => console.log(await getSession()));\r\n  }}\r\n>\r\n```\r\n\r\nAccording to the console, everything I've logged looks right. The initial `console.log(session)` output shows `groups` as an `Array` of length 2, while the second `console.log(await getSession())` output shows it as length 1.\r\n\r\n<img width=\"635\" alt=\"Screen Shot 2020-08-20 at 6 02 35 PM\" src=\"https://user-images.githubusercontent.com/7234006/90837630-d5d8ef00-e30f-11ea-863e-71b7d3704c41.png\">\r\n\r\nHowever, until the window loses focus, my UI continues to show 2 groups despite the console output clearly showing the result of the `getSession` call having only 1 group. My UI is immediately synced once the window loses focus, so I do not believe there is anything wrong with the way I've written my UI components. If that is the case, why wouldn't my `getSession()` call immediately update the UI accordingly?\r\n\r\nApologies if this is a repeat; I find session updating to be the trickiest part of Next-Auth.", "closed_by": {"login": "balazsorban44", "id": 18369201, "node_id": "MDQ6VXNlcjE4MzY5MjAx", "avatar_url": "https://avatars.githubusercontent.com/u/18369201?v=4", "gravatar_id": "", "url": "https://api.github.com/users/balazsorban44", "html_url": "https://github.com/balazsorban44", "followers_url": "https://api.github.com/users/balazsorban44/followers", "following_url": "https://api.github.com/users/balazsorban44/following{/other_user}", "gists_url": "https://api.github.com/users/balazsorban44/gists{/gist_id}", "starred_url": "https://api.github.com/users/balazsorban44/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/balazsorban44/subscriptions", "organizations_url": "https://api.github.com/users/balazsorban44/orgs", "repos_url": "https://api.github.com/users/balazsorban44/repos", "events_url": "https://api.github.com/users/balazsorban44/events{/privacy}", "received_events_url": "https://api.github.com/users/balazsorban44/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/nextauthjs/next-auth/issues/596/reactions", "total_count": 28, "+1": 28, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/nextauthjs/next-auth/issues/596/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/nextauthjs/next-auth/issues/9307", "repository_url": "https://api.github.com/repos/nextauthjs/next-auth", "labels_url": "https://api.github.com/repos/nextauthjs/next-auth/issues/9307/labels{/name}", "comments_url": "https://api.github.com/repos/nextauthjs/next-auth/issues/9307/comments", "events_url": "https://api.github.com/repos/nextauthjs/next-auth/issues/9307/events", "html_url": "https://github.com/nextauthjs/next-auth/issues/9307", "id": 2022759192, "node_id": "I_kwDOBxpGM854kNsY", "number": 9307, "title": "NextAuth v5 `auth(req, res)` fails in `pages/` API route", "user": {"login": "howard36", "id": 26558499, "node_id": "MDQ6VXNlcjI2NTU4NDk5", "avatar_url": "https://avatars.githubusercontent.com/u/26558499?v=4", "gravatar_id": "", "url": "https://api.github.com/users/howard36", "html_url": "https://github.com/howard36", "followers_url": "https://api.github.com/users/howard36/followers", "following_url": "https://api.github.com/users/howard36/following{/other_user}", "gists_url": "https://api.github.com/users/howard36/gists{/gist_id}", "starred_url": "https://api.github.com/users/howard36/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/howard36/subscriptions", "organizations_url": "https://api.github.com/users/howard36/orgs", "repos_url": "https://api.github.com/users/howard36/repos", "events_url": "https://api.github.com/users/howard36/events{/privacy}", "received_events_url": "https://api.github.com/users/howard36/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 818290553, "node_id": "MDU6TGFiZWw4MTgyOTA1NTM=", "url": "https://api.github.com/repos/nextauthjs/next-auth/labels/bug", "name": "bug", "color": "ffb8bb", "default": true, "description": "Something isn't working"}, {"id": 3829113515, "node_id": "LA_kwDOBxpGM87kO6Kr", "url": "https://api.github.com/repos/nextauthjs/next-auth/labels/triage", "name": "triage", "color": "AED87D", "default": false, "description": "Unseen or unconfirmed by a maintainer yet. Provide extra information in the meantime."}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 36, "created_at": "2023-12-03T23:12:30Z", "updated_at": "2025-04-14T00:32:15Z", "closed_at": "2024-02-25T01:17:04Z", "assignee": null, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### Environment\r\n\r\n```\r\n$ npx envinfo --system --binaries --browsers --npmPackages \"{next,react,next-auth,@auth/*}\"\r\n  System:\r\n    OS: macOS 14.0\r\n    CPU: (8) arm64 Apple M2\r\n    Memory: 590.48 MB / 16.00 GB\r\n    Shell: 3.6.1 - /opt/homebrew/bin/fish\r\n  Binaries:\r\n    Node: 18.18.0 - ~/.local/share/nvm/v18.18.0/bin/node\r\n    Yarn: 1.22.19 - ~/.local/share/nvm/v18.18.0/bin/yarn\r\n    npm: 9.8.1 - ~/.local/share/nvm/v18.18.0/bin/npm\r\n    pnpm: 8.11.0 - ~/.local/share/nvm/v18.18.0/bin/pnpm\r\n  Browsers:\r\n    Chrome: 119.0.6045.199\r\n    Safari: 17.0\r\n  npmPackages:\r\n    next: latest => 14.0.3 \r\n    next-auth: 5.0.0-beta.2 => 5.0.0-beta.2 \r\n    react: ^18.2.0 => 18.2.0 \r\n```\r\n\r\n### Reproduction URL\r\n\r\nhttps://github.com/howard36/next-auth-v5-example/tree/api-route-bug-repro\r\n\r\n### Describe the issue\r\n\r\nI have a API route at `pages/api/endpoint.ts`:\r\n```\r\nimport type { NextApiRequest, NextApiResponse } from \"next\";\r\nimport { auth } from \"auth\";\r\n\r\nexport default async function handler(\r\n  req: NextApiRequest,\r\n  res: NextApiResponse,\r\n) {\r\n  const session = await auth(req, res);\r\n  return res.status(200).json({session});\r\n}\r\n```\r\n\r\nCalling `auth(req, res)` in this API route causes this error:\r\n```\r\n \u2a2f Error [ERR_MODULE_NOT_FOUND]: Cannot find module '/Users/howard/git/next-auth-v5-example/node_modules/next/headers' imported from /Users/howard/git/next-auth-v5-example/node_modules/next-auth/lib/index.js\r\nDid you mean to import next-auth-v5-example/node_modules/next/headers.js?\r\n    at new NodeError (node:internal/errors:405:5)\r\n    at finalizeResolution (node:internal/modules/esm/resolve:327:11)\r\n    at moduleResolve (node:internal/modules/esm/resolve:946:10)\r\n    at defaultResolve (node:internal/modules/esm/resolve:1132:11)\r\n    at nextResolve (node:internal/modules/esm/loader:163:28)\r\n    at ESMLoader.resolve (node:internal/modules/esm/loader:835:30)\r\n    at ESMLoader.getModuleJob (node:internal/modules/esm/loader:424:18)\r\n    at ModuleWrap.<anonymous> (node:internal/modules/esm/module_job:77:40)\r\n    at link (node:internal/modules/esm/module_job:76:36) {\r\n  code: 'ERR_MODULE_NOT_FOUND'\r\n}\r\n```\r\n\r\nThis is with next-auth 5.0.0-beta.2, next 14.0.3, and node 18.18.0. If I switch to nextjs v13 (specifically v13.5.6), the error changes to:\r\n```\r\n \u2a2f node_modules/next-auth/lib/index.js (117:0) @ eval\r\n \u2a2f TypeError: Cannot read properties of undefined (reading 'append')\r\n    at eval (webpack-internal:///(api)/./node_modules/next-auth/lib/index.js:128:52)\r\n    at Array.forEach (<anonymous>)\r\n    at cloneSetCookie (webpack-internal:///(api)/./node_modules/next-auth/lib/index.js:128:21)\r\n    at eval (webpack-internal:///(api)/./node_modules/next-auth/lib/index.js:73:13)\r\n    at async handler (webpack-internal:///(api)/./pages/api/endpoint.ts:11:21) {\r\n  page: '/api/endpoint'\r\n}\r\nnull\r\n```\r\n\r\n### How to reproduce\r\n\r\n```\r\ngit clone -b api-route-bug-repro https://github.com/howard36/next-auth-v5-example.git\r\ncd next-auth-v5-example\r\nnpm install\r\ncp .env.local.example .env.local\r\nnpm run dev\r\n```\r\n\r\nThen visit http://localhost:3000/api/endpoint to trigger the error\r\n\r\n### Expected behavior\r\n\r\nCalling `auth(req, res)` should successfully return the session without throwing an error.", "closed_by": {"login": "ThangHuuVu", "id": 31528554, "node_id": "MDQ6VXNlcjMxNTI4NTU0", "avatar_url": "https://avatars.githubusercontent.com/u/31528554?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ThangHuuVu", "html_url": "https://github.com/ThangHuuVu", "followers_url": "https://api.github.com/users/ThangHuuVu/followers", "following_url": "https://api.github.com/users/ThangHuuVu/following{/other_user}", "gists_url": "https://api.github.com/users/ThangHuuVu/gists{/gist_id}", "starred_url": "https://api.github.com/users/ThangHuuVu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ThangHuuVu/subscriptions", "organizations_url": "https://api.github.com/users/ThangHuuVu/orgs", "repos_url": "https://api.github.com/users/ThangHuuVu/repos", "events_url": "https://api.github.com/users/ThangHuuVu/events{/privacy}", "received_events_url": "https://api.github.com/users/ThangHuuVu/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/nextauthjs/next-auth/issues/9307/reactions", "total_count": 14, "+1": 14, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/nextauthjs/next-auth/issues/9307/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/nextauthjs/next-auth/issues/9300", "repository_url": "https://api.github.com/repos/nextauthjs/next-auth", "labels_url": "https://api.github.com/repos/nextauthjs/next-auth/issues/9300/labels{/name}", "comments_url": "https://api.github.com/repos/nextauthjs/next-auth/issues/9300/comments", "events_url": "https://api.github.com/repos/nextauthjs/next-auth/issues/9300/events", "html_url": "https://github.com/nextauthjs/next-auth/issues/9300", "id": 2021973788, "node_id": "I_kwDOBxpGM854hN8c", "number": 9300, "title": "Auth v5 - Prisma Adapter with Google Provider on Runtime Edge - [TypeError]: immutable", "user": {"login": "riccardolinares", "id": 10235116, "node_id": "MDQ6VXNlcjEwMjM1MTE2", "avatar_url": "https://avatars.githubusercontent.com/u/10235116?v=4", "gravatar_id": "", "url": "https://api.github.com/users/riccardolinares", "html_url": "https://github.com/riccardolinares", "followers_url": "https://api.github.com/users/riccardolinares/followers", "following_url": "https://api.github.com/users/riccardolinares/following{/other_user}", "gists_url": "https://api.github.com/users/riccardolinares/gists{/gist_id}", "starred_url": "https://api.github.com/users/riccardolinares/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/riccardolinares/subscriptions", "organizations_url": "https://api.github.com/users/riccardolinares/orgs", "repos_url": "https://api.github.com/users/riccardolinares/repos", "events_url": "https://api.github.com/users/riccardolinares/events{/privacy}", "received_events_url": "https://api.github.com/users/riccardolinares/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 818290553, "node_id": "MDU6TGFiZWw4MTgyOTA1NTM=", "url": "https://api.github.com/repos/nextauthjs/next-auth/labels/bug", "name": "bug", "color": "ffb8bb", "default": true, "description": "Something isn't working"}, {"id": 2628184934, "node_id": "MDU6TGFiZWwyNjI4MTg0OTM0", "url": "https://api.github.com/repos/nextauthjs/next-auth/labels/adapters", "name": "adapters", "color": "000000", "default": false, "description": "Changes related to the core code concerning database adapters"}, {"id": 3829113515, "node_id": "LA_kwDOBxpGM87kO6Kr", "url": "https://api.github.com/repos/nextauthjs/next-auth/labels/triage", "name": "triage", "color": "AED87D", "default": false, "description": "Unseen or unconfirmed by a maintainer yet. Provide extra information in the meantime."}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 33, "created_at": "2023-12-02T09:59:10Z", "updated_at": "2024-05-19T12:55:46Z", "closed_at": "2024-05-16T09:26:10Z", "assignee": null, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### Adapter type\r\n\r\n@auth/prisma-adapter\r\n\r\n### Environment\r\n\r\nSystem:\r\n    OS: macOS 14.1.1\r\n    CPU: (8) x64 Intel(R) Core(TM) i5-8259U CPU @ 2.30GHz\r\n    Memory: 44.29 MB / 8.00 GB\r\n    Shell: 3.2.57 - /bin/bash\r\n  Binaries:\r\n    Node: 20.10.0 - /usr/local/bin/node\r\n    npm: 10.2.4 - /usr/local/bin/npm\r\n  Browsers:\r\n    Chrome: 119.0.6045.199\r\n    Safari: 17.1\r\n  npmPackages:\r\n    @auth/prisma-adapter: ^1.0.8 => 1.0.8 \r\n    next: ^14.0.3 => 14.0.3 \r\n    next-auth: ^5.0.0-beta.4 => 5.0.0-beta.4 \r\n    react: ^18 => 18.2.0 \r\n\r\n### Reproduction URL\r\n\r\nhttps://github.com/riccardolinares/next-auth-v5\r\n\r\n### Describe the issue\r\n\r\nI am currently working on a project that utilizes the Prisma adapter in conjunction with Prisma Accelerate. However, I am encountering a persistent and somewhat random error related to the Prisma Adapter, then a Session error and at the end I get an `Error [TypeError]: immutable` when I try to login again using the google provider.\r\n\r\nI am not sure if it's related mainly to the adapter itself or to the Google Provider. It is driving me crazy!\r\n\r\nThe issue mainly arises when a user is logged in for an unspecified duration. Unfortunately, the error's sporadic nature makes it difficult to reproduce reliably, complicating the troubleshooting process.\r\n\r\n**Key points to note:**\r\n\r\n- Runtime Environment: The project is built on Next.js version 14, specifically using the Runtime Edge configuration.\r\n- Error Description: The error associated with the Prisma Adapter surfaces randomly during a user's session. Once it appears, it persists and affects the user experience.\r\n- Temporary Resolution: The only way I have found to temporarily resolve the issue is by clearing the application's cache and deleting the .next folder. Then after a few minutes I am able to login again... However, this is not a viable long-term solution. \r\n\r\n**Attempts to Resolve:**\r\n\r\nI have tried to monitor the application to pinpoint the cause but due to the randomness of the error, this approach has not yielded any significant insights.\r\nI have also checked for any potential updates or patches for Prisma and Next.js that might address this issue but have not found any relevant updates.\r\n\r\n**Additional Information:**\r\n\r\nThere are no clear patterns or specific user actions that seem to trigger this error.\r\nThe application logs do not provide detailed information that could help in isolating the problem.\r\nI am looking for any guidance or suggestions on how to approach this issue, especially from others who might have encountered similar problems with Prisma Adapter and Prisma Accelerate on Next.js Runtime Edge.\r\n\r\n\r\nHere is the log of the error:\r\n\r\n```\r\n[auth][error] AdapterError: Read more at https://errors.authjs.dev#adaptererror\r\n[auth][cause]: PrismaClientUnknownRequestError: \r\nInvalid `prisma.session.findUnique()` invocation:\r\n\r\n\r\nError occurred during query execution:\r\nConnectorError(ConnectorError { user_facing_error: None, kind: QueryError(PostgresError { code: \"26000\", message: \"prepared statement \\\"s489\\\" does not exist\", severity: \"ERROR\", detail: None, column: None, hint: None }), transient: false })\r\n    at Ei.handleRequestError (/Users/ac/RiccardoProjects/secondsoul/node_modules/@prisma/client/runtime/edge.js:84:7381)\r\n    at Ei.handleAndLogRequestError (/Users/ac/RiccardoProjects/secondsoul/node_modules/@prisma/client/runtime/edge.js:84:6595)\r\n    at Ei.request (/Users/ac/RiccardoProjects/secondsoul/node_modules/@prisma/client/runtime/edge.js:84:6293)\r\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\r\n    at async u (/Users/ac/RiccardoProjects/secondsoul/node_modules/@prisma/client/runtime/edge.js:89:10383)\r\n    at async getSessionAndUser (webpack-internal:///(rsc)/./node_modules/@auth/prisma-adapter/index.js:250:36)\r\n    at async acc.<computed> (webpack-internal:///(rsc)/./node_modules/next-auth/node_modules/@auth/core/lib/init.js:169:24)\r\n    at async Module.session (webpack-internal:///(rsc)/./node_modules/next-auth/node_modules/@auth/core/lib/actions/session.js:84:30)\r\n    at async AuthInternal (webpack-internal:///(rsc)/./node_modules/next-auth/node_modules/@auth/core/lib/index.js:50:24)\r\n    at async Auth (webpack-internal:///(rsc)/./node_modules/next-auth/node_modules/@auth/core/index.js:123:29)\r\n    at async ChatPage (webpack-internal:///(rsc)/./src/app/(private)/chat/[id]/page.tsx:43:21)\r\n[auth][details]: {}\r\n[auth][error] SessionTokenError: Read more at https://errors.authjs.dev#sessiontokenerror\r\n[auth][cause]: PrismaClientUnknownRequestError: \r\nInvalid `prisma.session.findUnique()` invocation:\r\n\r\n\r\nError occurred during query execution:\r\nConnectorError(ConnectorError { user_facing_error: None, kind: QueryError(PostgresError { code: \"26000\", message: \"prepared statement \\\"s489\\\" does not exist\", severity: \"ERROR\", detail: None, column: None, hint: None }), transient: false })\r\n    at Ei.handleRequestError (/Users/ac/RiccardoProjects/secondsoul/node_modules/@prisma/client/runtime/edge.js:84:7381)\r\n    at Ei.handleAndLogRequestError (/Users/ac/RiccardoProjects/secondsoul/node_modules/@prisma/client/runtime/edge.js:84:6595)\r\n    at Ei.request (/Users/ac/RiccardoProjects/secondsoul/node_modules/@prisma/client/runtime/edge.js:84:6293)\r\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\r\n    at async u (/Users/ac/RiccardoProjects/secondsoul/node_modules/@prisma/client/runtime/edge.js:89:10383)\r\n    at async getSessionAndUser (webpack-internal:///(rsc)/./node_modules/@auth/prisma-adapter/index.js:250:36)\r\n    at async acc.<computed> (webpack-internal:///(rsc)/./node_modules/next-auth/node_modules/@auth/core/lib/init.js:169:24)\r\n    at async Module.session (webpack-internal:///(rsc)/./node_modules/next-auth/node_modules/@auth/core/lib/actions/session.js:84:30)\r\n    at async AuthInternal (webpack-internal:///(rsc)/./node_modules/next-auth/node_modules/@auth/core/lib/index.js:50:24)\r\n    at async Auth (webpack-internal:///(rsc)/./node_modules/next-auth/node_modules/@auth/core/index.js:123:29)\r\n    at async ChatPage (webpack-internal:///(rsc)/./src/app/(private)/chat/[id]/page.tsx:43:21)\r\n[auth][details]: {}\r\n``` \r\n\r\n...After multiple errors like the previous one, if I try to login again, then I get:\r\n\r\n```\r\nerror { error: 'invalid_grant', error_description: 'Bad Request' }\r\n[auth][error] CallbackRouteError: Read more at https://errors.authjs.dev#callbackrouteerror\r\n[auth][cause]: Error: TODO: Handle OIDC response body error\r\n    at handleOAuth (webpack-internal:///(rsc)/./node_modules/next-auth/node_modules/@auth/core/lib/actions/callback/oauth/callback.js:80:19)\r\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\r\n    at async Module.callback (webpack-internal:///(rsc)/./node_modules/next-auth/node_modules/@auth/core/lib/actions/callback/index.js:33:41)\r\n    at async AuthInternal (webpack-internal:///(rsc)/./node_modules/next-auth/node_modules/@auth/core/lib/index.js:42:24)\r\n    at async Auth (webpack-internal:///(rsc)/./node_modules/next-auth/node_modules/@auth/core/index.js:123:29)\r\n    at async eval (webpack-internal:///(rsc)/./node_modules/next/dist/esm/server/future/route-modules/app-route/module.js:215:37)\r\n[auth][details]: {\r\n  \"provider\": \"google\"\r\n}\r\n \u2a2f Error [TypeError]: immutable\r\n    at _Headers.delete (file:///Users/ac/RiccardoProjects/secondsoul/node_modules/next/dist/compiled/edge-runtime/index.js:1:657096)\r\n    at runWithTaggedErrors (file:///Users/ac/RiccardoProjects/secondsoul/node_modules/next/dist/server/web/sandbox/sandbox.js:106:43)\r\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\r\n    at async DevServer.runEdgeFunction (file:///Users/ac/RiccardoProjects/secondsoul/node_modules/next/dist/server/next-server.js:1169:24)\r\n    at async NextNodeServer.handleCatchallRenderRequest (file:///Users/ac/RiccardoProjects/secondsoul/node_modules/next/dist/server/next-server.js:242:37)\r\n    at async DevServer.handleRequestImpl (file:///Users/ac/RiccardoProjects/secondsoul/node_modules/next/dist/server/base-server.js:798:17)\r\n\r\n``` \r\n\r\nThank you for your attention to this matter. Any assistance or insights into this issue would be greatly appreciated.\r\n\r\n### How to reproduce\r\n\r\nUnfortunately, the error's sporadic nature makes it difficult to reproduce reliably, complicating the troubleshooting process.\r\n\r\n### Expected behavior\r\n\r\nKeep the user logged in and don't give the error \"immutable\"", "closed_by": {"login": "ndom91", "id": 7415984, "node_id": "MDQ6VXNlcjc0MTU5ODQ=", "avatar_url": "https://avatars.githubusercontent.com/u/7415984?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ndom91", "html_url": "https://github.com/ndom91", "followers_url": "https://api.github.com/users/ndom91/followers", "following_url": "https://api.github.com/users/ndom91/following{/other_user}", "gists_url": "https://api.github.com/users/ndom91/gists{/gist_id}", "starred_url": "https://api.github.com/users/ndom91/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ndom91/subscriptions", "organizations_url": "https://api.github.com/users/ndom91/orgs", "repos_url": "https://api.github.com/users/ndom91/repos", "events_url": "https://api.github.com/users/ndom91/events{/privacy}", "received_events_url": "https://api.github.com/users/ndom91/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/nextauthjs/next-auth/issues/9300/reactions", "total_count": 34, "+1": 34, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/nextauthjs/next-auth/issues/9300/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/nextauthjs/next-auth/issues/7650", "repository_url": "https://api.github.com/repos/nextauthjs/next-auth", "labels_url": "https://api.github.com/repos/nextauthjs/next-auth/issues/7650/labels{/name}", "comments_url": "https://api.github.com/repos/nextauthjs/next-auth/issues/7650/comments", "events_url": "https://api.github.com/repos/nextauthjs/next-auth/issues/7650/events", "html_url": "https://github.com/nextauthjs/next-auth/issues/7650", "id": 1726868757, "node_id": "I_kwDOBxpGM85m7e0V", "number": 7650, "title": "'NextResponse' has already been declared in middleware. ", "user": {"login": "Ethansev", "id": 17817935, "node_id": "MDQ6VXNlcjE3ODE3OTM1", "avatar_url": "https://avatars.githubusercontent.com/u/17817935?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Ethansev", "html_url": "https://github.com/Ethansev", "followers_url": "https://api.github.com/users/Ethansev/followers", "following_url": "https://api.github.com/users/Ethansev/following{/other_user}", "gists_url": "https://api.github.com/users/Ethansev/gists{/gist_id}", "starred_url": "https://api.github.com/users/Ethansev/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Ethansev/subscriptions", "organizations_url": "https://api.github.com/users/Ethansev/orgs", "repos_url": "https://api.github.com/users/Ethansev/repos", "events_url": "https://api.github.com/users/Ethansev/events{/privacy}", "received_events_url": "https://api.github.com/users/Ethansev/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 818290553, "node_id": "MDU6TGFiZWw4MTgyOTA1NTM=", "url": "https://api.github.com/repos/nextauthjs/next-auth/labels/bug", "name": "bug", "color": "ffb8bb", "default": true, "description": "Something isn't working"}, {"id": 2646868137, "node_id": "MDU6TGFiZWwyNjQ2ODY4MTM3", "url": "https://api.github.com/repos/nextauthjs/next-auth/labels/upstream", "name": "upstream", "color": "B2715F", "default": false, "description": "The issue dervies from one of next-auth dependencies"}], "state": "closed", "locked": true, "assignees": [], "milestone": null, "comments": 32, "created_at": "2023-05-26T04:04:12Z", "updated_at": "2023-06-13T11:10:22Z", "closed_at": "2023-06-01T10:23:16Z", "assignee": null, "author_association": "NONE", "type": null, "active_lock_reason": "off-topic", "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### Environment\r\n```\r\nSystem:\r\n  OS: Windows 10 10.0.22621\r\n  CPU: (24) x64 13th Gen Intel(R) Core(TM) i7-13700K\r\n  Memory: 18.51 GB / 31.76 GB\r\n\r\nBinaries:\r\n  Node: 18.12.1 - C:\\Program Files\\nodejs\\node.EXE\r\n  Yarn: 1.22.19 - ~\\AppData\\Roaming\\npm\\yarn.CMD\r\n  npm: 9.6.7 - C:\\Program Files\\nodejs\\npm.CMD\r\n\r\nBrowsers:\r\n  Edge: Spartan (44.22621.1702.0), Chromium (113.0.1774.50)\r\n  Internet Explorer: 11.0.22621.1\r\n```\r\n\r\n\r\n### Reproduction URL\r\n\r\nhttps://github.com/Ethansev/facebook-messenger-clone\r\n\r\n### Describe the issue\r\n\r\nAfter updating my NextJS to 13.4.4, I'm getting the following error:\r\n\r\n```\r\n> next dev\r\n\r\n- ready started server on 0.0.0.0:3000, url: http://localhost:3000\r\n- info Loaded env from C:\\Users\\pulse\\Code\\Github\\facebook-messenger-clone\\.env.local\r\n(node:21948) ExperimentalWarning: The Fetch API is an experimental feature. This feature could change at any time\r\n(Use `node --trace-warnings ...` to show where the warning was created)\r\n- event compiled client and server successfully in 498 ms (306 modules)\r\n- wait compiling...\r\n- event compiled client and server successfully in 158 ms (306 modules)\r\n- wait compiling /middleware (client and server)...\r\n- error ./node_modules/next-auth/next/middleware.js\r\nModule parse failed: Identifier 'NextResponse' has already been declared (3:6)\r\n| \"use strict\";\r\n| const NextResponse = require(\"next/dist/server/web/spec-extension/response\").NextResponse;\r\n> const NextResponse = require(\"next/dist/server/web/spec-extension/response\").NextResponse;\r\n| var _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\r\n| Object.defineProperty(exports, \"__esModule\", {\r\n\r\nImport trace for requested module:\r\n./node_modules/next-auth/next/middleware.js\r\n./node_modules/next-auth/middleware.js\r\n- wait compiling /_error (client and server)...\r\n- event compiled client and server successfully in 135 ms (311 modules)\r\n- warn Fast Refresh had to perform a full reload due to a runtime error.\r\n```\r\n\r\n### How to reproduce\r\n\r\nI'm running `npm run dev` to start my Nextjs project.\r\n\r\n### Expected behavior\r\n\r\nThe project should be running a server on my localhost, but instead I'm getting a `\"Module parse failed: Identifier 'NextResponse' has already been declared\"` which I can't find in the file. ", "closed_by": {"login": "balazsorban44", "id": 18369201, "node_id": "MDQ6VXNlcjE4MzY5MjAx", "avatar_url": "https://avatars.githubusercontent.com/u/18369201?v=4", "gravatar_id": "", "url": "https://api.github.com/users/balazsorban44", "html_url": "https://github.com/balazsorban44", "followers_url": "https://api.github.com/users/balazsorban44/followers", "following_url": "https://api.github.com/users/balazsorban44/following{/other_user}", "gists_url": "https://api.github.com/users/balazsorban44/gists{/gist_id}", "starred_url": "https://api.github.com/users/balazsorban44/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/balazsorban44/subscriptions", "organizations_url": "https://api.github.com/users/balazsorban44/orgs", "repos_url": "https://api.github.com/users/balazsorban44/repos", "events_url": "https://api.github.com/users/balazsorban44/events{/privacy}", "received_events_url": "https://api.github.com/users/balazsorban44/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/nextauthjs/next-auth/issues/7650/reactions", "total_count": 46, "+1": 46, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/nextauthjs/next-auth/issues/7650/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/nextauthjs/next-auth/issues/11028", "repository_url": "https://api.github.com/repos/nextauthjs/next-auth", "labels_url": "https://api.github.com/repos/nextauthjs/next-auth/issues/11028/labels{/name}", "comments_url": "https://api.github.com/repos/nextauthjs/next-auth/issues/11028/comments", "events_url": "https://api.github.com/repos/nextauthjs/next-auth/issues/11028/events", "html_url": "https://github.com/nextauthjs/next-auth/issues/11028", "id": 2321016610, "node_id": "I_kwDOBxpGM86KV-ci", "number": 11028, "title": "V5 Fails Behind Corporate Proxy with Provider", "user": {"login": "SolidAnonDev", "id": 160133821, "node_id": "U_kgDOCYtyvQ", "avatar_url": "https://avatars.githubusercontent.com/u/160133821?v=4", "gravatar_id": "", "url": "https://api.github.com/users/SolidAnonDev", "html_url": "https://github.com/SolidAnonDev", "followers_url": "https://api.github.com/users/SolidAnonDev/followers", "following_url": "https://api.github.com/users/SolidAnonDev/following{/other_user}", "gists_url": "https://api.github.com/users/SolidAnonDev/gists{/gist_id}", "starred_url": "https://api.github.com/users/SolidAnonDev/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/SolidAnonDev/subscriptions", "organizations_url": "https://api.github.com/users/SolidAnonDev/orgs", "repos_url": "https://api.github.com/users/SolidAnonDev/repos", "events_url": "https://api.github.com/users/SolidAnonDev/events{/privacy}", "received_events_url": "https://api.github.com/users/SolidAnonDev/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 818290553, "node_id": "MDU6TGFiZWw4MTgyOTA1NTM=", "url": "https://api.github.com/repos/nextauthjs/next-auth/labels/bug", "name": "bug", "color": "ffb8bb", "default": true, "description": "Something isn't working"}, {"id": 818290556, "node_id": "MDU6TGFiZWw4MTgyOTA1NTY=", "url": "https://api.github.com/repos/nextauthjs/next-auth/labels/help-needed", "name": "help-needed", "color": "fbff55", "default": false, "description": "The maintainer needs help due to time constraint/missing knowledge"}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 30, "created_at": "2024-05-28T13:03:28Z", "updated_at": "2025-05-15T15:02:18Z", "closed_at": "2024-10-05T17:00:11Z", "assignee": null, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### Environment\r\n\r\n```\r\nOS: Windows 11 10.0.22621\r\nCPU: (12) x64 Intel(R) Core(TM) i7-8700 CPU @ 3.20GHz\r\nMemory: 6.80 GB / 15.78 GB\r\nBinaries:\r\nNode: 20.9.0 - C:\\Program Files\\nodejs\\node.EXE\r\nYarn: 1.22.19 - C:\\Program Files (x86)\\Yarn\\bin\\yarn.CMD\r\nnpm: 10.8.0 - C:\\Program Files\\nodejs\\npm.CMD\r\nBrowsers:\r\nEdge: Chromium (125.0.2535.51)\r\nInternet Explorer: 11.0.22621.3527\r\nnpmPackages:\r\nnext: ^14.2.3 => 14.2.3\r\nnext-auth: ^5.0.0-beta.18 <= 5.0.0-beta.18\r\nreact: ^18.3.1 => 18.3.1\r\n```\r\n\r\n\r\n### Reproduction URL\r\n\r\nhttps://github.com/tbrundige/authjs-adapter-issue\r\n\r\n### Describe the issue\r\n\r\nFirst off, I pulled a random repro link from other open issues to make it valid for the bot. This isn't really something I can reproduce. The reproduction is to try to use next-auth with a provider behind a corporate proxy, there's not really a minimal reproduction for that. I'm sorry for doing this but there's not much I can do to reproduce this.\r\n\r\nNext-Auth, just as in #2509  - appears to fail behind a corporate proxy in V5 as well. We are using the Microsoft Entra ID provider, coming from the V4 Azure AD Provider.\r\n\r\nFor V4, we had been using [this solution which was coined in the issue linked above](https://next-auth.js.org/tutorials/corporate-proxy), involving patching the next-auth source code with patch-package. This worked fine, but it appears things have changed a great deal in the V5 source and we cannot find where we should patch the source to allow the requests to make it through.\r\n\r\nIf support cannot be added for a corporate proxy with providers, we would like to at least see how/where to apply a patch to the source to make this workable as we did in V4. If not, this may completely bar and shutdown any ability to use next-auth moving forward when V5 is released, which would be really unfortunate for us.\r\n\r\nV5 is working in development for us (Microsoft Entra Id Provider) without issue, with successful authentication, but upon deployment, we receive errors very remeniscent of what we saw with V4 behind a corporate proxy.\r\n\r\n### How to reproduce\r\n\r\nust run any application with NextAuth behind a corporate proxy and try to log in with a Provider (like Google or GitHub).\r\n\r\nYou will see something similar to the following:\r\n```\r\nmessage: 'fetch failed',\r\n    stack: 'TypeError: fetch failed\\n' +\r\n      '    at Object.processResponse (node:internal/deps/undici/undici:5555:34)\\n' \r\n```\r\n\r\n### Expected behavior\r\n\r\nThe requests are able to make it out to the providers for successful authentication from behind a corporate proxy. In previous iterations, we acheived this using an HttpProxyAgent.", "closed_by": {"login": "balazsorban44", "id": 18369201, "node_id": "MDQ6VXNlcjE4MzY5MjAx", "avatar_url": "https://avatars.githubusercontent.com/u/18369201?v=4", "gravatar_id": "", "url": "https://api.github.com/users/balazsorban44", "html_url": "https://github.com/balazsorban44", "followers_url": "https://api.github.com/users/balazsorban44/followers", "following_url": "https://api.github.com/users/balazsorban44/following{/other_user}", "gists_url": "https://api.github.com/users/balazsorban44/gists{/gist_id}", "starred_url": "https://api.github.com/users/balazsorban44/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/balazsorban44/subscriptions", "organizations_url": "https://api.github.com/users/balazsorban44/orgs", "repos_url": "https://api.github.com/users/balazsorban44/repos", "events_url": "https://api.github.com/users/balazsorban44/events{/privacy}", "received_events_url": "https://api.github.com/users/balazsorban44/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/nextauthjs/next-auth/issues/11028/reactions", "total_count": 7, "+1": 7, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/nextauthjs/next-auth/issues/11028/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}, {"url": "https://api.github.com/repos/nextauthjs/next-auth/issues/3251", "repository_url": "https://api.github.com/repos/nextauthjs/next-auth", "labels_url": "https://api.github.com/repos/nextauthjs/next-auth/issues/3251/labels{/name}", "comments_url": "https://api.github.com/repos/nextauthjs/next-auth/issues/3251/comments", "events_url": "https://api.github.com/repos/nextauthjs/next-auth/issues/3251/events", "html_url": "https://github.com/nextauthjs/next-auth/issues/3251", "id": 1059827368, "node_id": "I_kwDOBxpGM84_K66o", "number": 3251, "title": "'checks.state argument is missing' error when click back button after authentication with keycloak", "user": {"login": "jalbissimo", "id": 37750567, "node_id": "MDQ6VXNlcjM3NzUwNTY3", "avatar_url": "https://avatars.githubusercontent.com/u/37750567?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jalbissimo", "html_url": "https://github.com/jalbissimo", "followers_url": "https://api.github.com/users/jalbissimo/followers", "following_url": "https://api.github.com/users/jalbissimo/following{/other_user}", "gists_url": "https://api.github.com/users/jalbissimo/gists{/gist_id}", "starred_url": "https://api.github.com/users/jalbissimo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jalbissimo/subscriptions", "organizations_url": "https://api.github.com/users/jalbissimo/orgs", "repos_url": "https://api.github.com/users/jalbissimo/repos", "events_url": "https://api.github.com/users/jalbissimo/events{/privacy}", "received_events_url": "https://api.github.com/users/jalbissimo/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "labels": [{"id": 818290553, "node_id": "MDU6TGFiZWw4MTgyOTA1NTM=", "url": "https://api.github.com/repos/nextauthjs/next-auth/labels/bug", "name": "bug", "color": "ffb8bb", "default": true, "description": "Something isn't working"}, {"id": 2242799575, "node_id": "MDU6TGFiZWwyMjQyNzk5NTc1", "url": "https://api.github.com/repos/nextauthjs/next-auth/labels/incomplete", "name": "incomplete", "color": "fbca04", "default": false, "description": "Insufficient reproduction. Without more info, we won't take further actions/provide help."}], "state": "closed", "locked": false, "assignees": [], "milestone": null, "comments": 30, "created_at": "2021-11-22T08:09:51Z", "updated_at": "2023-03-25T22:00:22Z", "closed_at": "2023-03-25T20:33:06Z", "assignee": null, "author_association": "NONE", "type": null, "active_lock_reason": null, "sub_issues_summary": {"total": 0, "completed": 0, "percent_completed": 0}, "issue_dependencies_summary": {"blocked_by": 0, "total_blocked_by": 0, "blocking": 0, "total_blocking": 0}, "body": "### Description \ud83d\udc1c\n\nHello there! \r\n\r\nI`m having an issue with next-auth. After  successfully sign in into the application using the keycloack provider, clicking the back button in the browser window leads to  : \r\n```sh\nerror: {\r\n    message: 'checks.state argument is missing',\r\n    stack: 'TypeError: checks.state argument is missing\\n' +...//stack trace\r\n     name: 'TypeError'\r\n  },\r\n  providerId: 'sso_provider_1',\r\n  message: 'checks.state argument is missing'\r\n}\n```\r\n\r\nMy configuration for the keycloack provider looks something like this \r\n```js\nexport default NextAuth({\r\n  providers: [\r\n    KeycloakProvider({\r\n      id: 'sso_provider_1',\r\n      clientId: process.env.AP_CLIENT_ID,\r\n      clientSecret: process.env.AP_CLIENT_SECRET,\r\n      issuer: process.env.AP_BASE_URL\r\n    })\r\n  ],\r\n  secret: process.env.SECRET,\r\n  debug: true\r\n}); \n```\r\n\r\nIs there anything else I should configure in order to make my application work with the keycloack provider or it is just a bug ?\r\n\n\n### Is this a bug in your own project?\n\nYes\n\n### How to reproduce \u2615\ufe0f\n\nClicking back button after sign in with Keycloack will display this page and the error mentioned above.\r\n![image](https://user-images.githubusercontent.com/37750567/142824926-49f5d486-eec0-4aca-95d4-abf7f9e3bcee.png)\r\n\n\n### Screenshots / Logs \ud83d\udcfd\n\n_No response_\n\n### Environment \ud83d\udda5\n\nnext.js\n\n### Contributing \ud83d\ude4c\ud83c\udffd\n\nYes,  I am willing to help solve this bug in a PR", "closed_by": {"login": "balazsorban44", "id": 18369201, "node_id": "MDQ6VXNlcjE4MzY5MjAx", "avatar_url": "https://avatars.githubusercontent.com/u/18369201?v=4", "gravatar_id": "", "url": "https://api.github.com/users/balazsorban44", "html_url": "https://github.com/balazsorban44", "followers_url": "https://api.github.com/users/balazsorban44/followers", "following_url": "https://api.github.com/users/balazsorban44/following{/other_user}", "gists_url": "https://api.github.com/users/balazsorban44/gists{/gist_id}", "starred_url": "https://api.github.com/users/balazsorban44/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/balazsorban44/subscriptions", "organizations_url": "https://api.github.com/users/balazsorban44/orgs", "repos_url": "https://api.github.com/users/balazsorban44/repos", "events_url": "https://api.github.com/users/balazsorban44/events{/privacy}", "received_events_url": "https://api.github.com/users/balazsorban44/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "reactions": {"url": "https://api.github.com/repos/nextauthjs/next-auth/issues/3251/reactions", "total_count": 6, "+1": 6, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/nextauthjs/next-auth/issues/3251/timeline", "performed_via_github_app": null, "state_reason": "completed", "pinned_comment": null}]}